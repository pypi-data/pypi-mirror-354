import{b as c}from"./chunk-74KQCU7Q.js";import{a as m}from"./chunk-ULT7T2WM.js";import{b as f}from"./chunk-JC2BH436.js";var d=f(m());var l=class extends c{constructor(r){super(r);this.getValue=()=>[];this.filterByValues=new Map;this.touch=()=>{this.fieldGroup.classList.remove("dj-untouched","dj-validated"),this.fieldGroup.classList.add("dj-touched")};this.isIncomplete=r.hasAttribute("incomplete")}setupFilters(r){var s;(((s=r.getAttribute("filter-by"))==null?void 0:s.split(","))??[]).forEach(n=>{var o;let e=(o=r.form)==null?void 0:o.elements.namedItem(n);e instanceof HTMLInputElement?(this.filterByValues.set(n,e.value),e.addEventListener("change",async a=>{let i=a.currentTarget;i instanceof HTMLInputElement&&(this.filterByValues.set(n,i.value),await this.reloadOptions(!0))})):e instanceof HTMLSelectElement&&(this.filterByValues.set(n,Array.from(e.selectedOptions).map(a=>a.value)),e.addEventListener("change",async a=>{a.currentTarget instanceof HTMLSelectElement&&(this.filterByValues.set(n,Array.from(e.selectedOptions).map(p=>p.value)),await this.reloadOptions(!0))}))})}mustReloadOptions(){return Array.from(this.filterByValues.values()).some(r=>r.some(t=>t))}buildFetchQuery(r,t){let s=new URLSearchParams;s.set("offset",String(r)),t!=null&&t.pk?s.set("pk",t.pk):t!=null&&t.search&&s.set("search",encodeURIComponent(t.search));for(let[n,e]of this.filterByValues)(0,d.default)(e)?s.set(`filter-${n}`,encodeURIComponent(e)):Array.isArray(e)&&(e.length===0?s.append(`filter-${n}`,""):e.forEach(o=>s.append(`filter-${n}`,encodeURIComponent(o))));return s}async loadOptions(r,t){let s=new Headers;s.append("Accept","application/json"),r.set("field",this.fieldName);let n=await fetch(`${this.endpoint}?${r.toString()}`,{method:"GET",headers:s});if(n.status===200){let e=await n.json();typeof e.incomplete=="boolean"&&(this.isIncomplete=e.incomplete),t(e.options)}else console.error(`Failed to fetch from ${this.endpoint} (status=${n.status})`)}};export{l as a};

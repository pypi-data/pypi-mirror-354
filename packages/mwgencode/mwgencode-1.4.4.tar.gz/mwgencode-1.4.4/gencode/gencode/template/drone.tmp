kind: pipeline
type: docker
name: {{swagger.name}}
steps:

# - name: push-image
#   image: plugins/docker
#   settings:
#     dockerfile: Dockerfile
#     repo: maxwinch/{{swagger.name}}
#     use_cache: true
#     username:
#       from_secret: DOCKER_USER
#     password:
#       from_secret: DOCKER_PASSWORD
#     tags:
#       - latest
#   when:
#     event: push
#     branch: master

- name: push_maxwin_latest
  image: plugins/docker
  settings:
    insecure: true
    dockerfile: Dockerfile
    repo: cicd-so-happy.maxwin.com.tw:5000/{{swagger.name}}
    registry: cicd-so-happy.maxwin.com.tw:5000
    tags:
      - latest
  when:
    branch: master

- name: push_maxwin_tag
  image: plugins/docker
  settings:
    dockerfile: Dockerfile
    repo: cicd-so-happy.maxwin.com.tw:5000/{{swagger.name}}
    registry: cicd-so-happy.maxwin.com.tw:5000
    use_cache: true
    tags: ${DRONE_TAG}
    insecure: true
  when:
    event:
      - tag
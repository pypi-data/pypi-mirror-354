"use strict";(self.webpackChunkpackage_edit=self.webpackChunkpackage_edit||[]).push([[983],{3924:(t,e,i)=>{i.r(e),i.d(e,{default:()=>p});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"activity-edit-block"},[t.showErrors?e("Errors",{attrs:{errors:t.errors}}):t._e(),t._v(" "),e("div",{staticClass:"activity-edit-fields attribution-row"},[e("select-field",{attrs:{options:Object.keys(t.controlledLists.activityTypes)},on:{input:function(){return t.getOptions(t.edits.scheme)}},scopedSlots:t._u([{key:"help",fn:function(){return[t._v("\n                Standardised role taxonomies like "),e("a",{attrs:{href:"http://credit.niso.org",target:"_blank"}},[t._v("CRediT")]),t._v(" and "),e("a",{attrs:{href:"https://schema.datacite.org/meta/kernel-4/include/datacite-contributorType-v4.xsd",target:"_blank"}},[t._v("DataCite's\n                contributor types")]),t._v(" enables more accurate attribution of work.\n                "),t.settings.doiPlugin?e("div",[t._v('\n                    DataCite roles will be included in the DOI metadata as "contributor type".\n                ')]):t._e()]},proxy:!0}]),model:{value:t.edits.scheme,callback:function(e){t.$set(t.edits,"scheme",e)},expression:"edits.scheme"}},[t._v("\n            Role scheme\n            ")]),t._v(" "),t.edits.scheme?e("select-field",{attrs:{options:t.activityOptions,"opt-value":function(t){return t.name},"opt-label":function(t){return t.name}},on:{input:t.getAgents},model:{value:t.edits.activity,callback:function(e){t.$set(t.edits,"activity",e)},expression:"edits.activity"}},[t._v("\n            Contribution role\n        ")]):t._e(),t._v(" "),e("select-field",{attrs:{options:t.controlledLists.activityLevels},scopedSlots:t._u([{key:"help",fn:function(){return[t._v("\n                Optional; the status of this contributor within this particular role, as defined by "),e("a",{attrs:{href:"http://credit.niso.org",target:"_blank"}},[t._v("CRediT")]),t._v(".\n            ")]},proxy:!0}]),model:{value:t.edits.level,callback:function(e){t.$set(t.edits,"level",e)},expression:"edits.level"}},[t._v("\n            Contribution level\n            ")]),t._v(" "),e("div",{staticClass:"attribution"},[e("datefield",{attrs:{placeholder:"Select date (optional)"},scopedSlots:t._u([{key:"help",fn:function(){return[t._v("\n                    Optional; can be used as a start date, or if the work only took place on a single day, etc.\n                ")]},proxy:!0}]),model:{value:t.edits.time,callback:function(e){t.$set(t.edits,"time",e)},expression:"edits.time"}},[t._v("\n                Contribution date\n                ")])],1)],1),t._v(" "),e("div",{staticClass:"expand-bar",attrs:{title:"Expand"},on:{click:function(){t.expand=!t.expand}}},[e("i",{staticClass:"fas",class:t.expand?"fa-caret-up":"fa-caret-down"}),t._v(" "),e("small",[t._v("Advanced options")]),t._v(" "),e("i",{staticClass:"fas",class:t.expand?"fa-caret-up":"fa-caret-down"})]),t._v(" "),t.expand?[e("div",{staticClass:"activity-sorted-agents attribution-row"},[t._m(0),t._v(" "),t._m(1),t._v(" "),e("draggable",{attrs:{group:"allAgents"},on:{change:t.updateOrder},model:{value:t.sortedAgents,callback:function(e){t.sortedAgents=e},expression:"sortedAgents"}},t._l(t.sortedAgents,(function(i){return e("div",{staticClass:"activity-agent",class:i.id===t.activityId?"active-agent":""},[e("i",{staticClass:"fas fa-arrows"}),t._v(" "),e("span",[t._v(t._s(i.name))]),t._v(" "),e("span",[t._v(t._s(i.order))])])})),0)],1),t._v(" "),e("div",{staticClass:"activity-unsorted-agents attribution-row"},[t._m(2),t._v(" "),t._m(3),t._v(" "),e("draggable",{attrs:{group:"allAgents"},on:{change:t.updateOrder},model:{value:t.unsortedAgents,callback:function(e){t.unsortedAgents=e},expression:"unsortedAgents"}},t._l(t.unsortedAgents,(function(i){return e("div",{staticClass:"activity-agent",class:i.id===t.activityId?"active-agent":""},[e("i",{staticClass:"fas fa-arrows"}),t._v(" "),e("span",[t._v(t._s(i.name))]),t._v(" "),e("span",[t._v(t._s(i.order))])])})),0)],1)]:t._e(),t._v(" "),t.activity.meta.is_temporary?t._e():e("div",{staticClass:"attribution-save"},[e("span",{staticClass:"btn",class:t.isValid?"btn-primary":"btn-disabled",on:{click:t.saveEdit}},[e("i",{staticClass:"fas fa-save"}),t._v("\n            Save changes\n        ")]),t._v(" "),e("span",{staticClass:"btn btn-primary",on:{click:t.stopEdit}},[e("i",{staticClass:"fas fa-times"}),t._v("\n            Cancel\n        ")])])],2)};s._withStripped=!0;var n=i(6977),a=i.n(n),r=function(){var t=this,e=t._self._c;return e("div",{class:t.classes},[e("label",{attrs:{for:t.fieldId}},[t._t("default")],2),t._v(" "),t.showHelpText?e("help-tooltip",[t._t("help")],2):t._e(),t._v(" "),e("input",{staticClass:"form-control",attrs:{type:"date",id:t.fieldId,placeholder:t.placeholder},domProps:{value:t.dateOnly},on:{change:t.setValue}})],1)};r._withStripped=!0;const o={name:"DateField",extends:i(2599).Z,props:["placeholder"],computed:{dateOnly:function(){if(this.value)try{return new Date(this.value).toISOString().split("T")[0]}catch(t){return this.value}}}};var c=i(1900);const d=(0,c.Z)(o,r,[],!1,null,null,null).exports;var l=i(2942),u=i(1927),v=i(1283);const h={name:"EditActivity",extends:l.Z,props:{activityId:String},components:{draggable:a(),datefield:d,Errors:function(){return i.e(555).then(i.bind(i,5555))}},data:function(){return{activityOptions:[],sortedAgents:[],unsortedAgents:[]}},computed:{activity:function(){return u.Z.query().with("meta").with("agent").find(this.activityId)},contributor:function(){return this.activity.agent},isValid:function(){return this.errors=[],this.edits.activity||this.errors.push("Activity not provided."),null!==this.edits.activity}},methods:{refresh:function(){var t=this;this.getOptions(this.activity.scheme).then((function(){t.edits=t.activity.getCopy(),t.edits.activity&&t.getAgents(t.edits.activity)})),this.$emit("validated",this.isValid)},saveEdit:function(){var t=this,e=this.isValid&&this.canSave;if(this.showErrors=!e,e){var i=[u.Z.update({where:this.activityId,data:this.edits}).then((function(){return u.Z.updateMeta(t.activityId,{is_dirty:!0,is_editing:!1})}))];return this.sortedAgents.concat(this.unsortedAgents).forEach((function(t){t.id&&i.push(u.Z.update({where:t.id,data:{order:t.order}}).then((function(){return u.Z.updateMeta(t.id,{is_dirty:!0})})))})),Promise.all(i).then((function(){t.$emit(t.events.editsSaved)})).catch((function(t){return v.error(t)})).finally((function(){t.stopEdit()}))}},getAgents:function(t){this.$set(this.edits,"activity",t);var e=u.Z.query().with("agent").where("activity",this.edits.activity).orderBy((function(t){return t.order})).get().map((function(t){return{name:t.agent.displayName,id:t.id,order:t.order}}));this.sortedAgents=e.filter((function(t){return null!==t.order})),this.unsortedAgents=e.filter((function(t){return null===t.order})),this.activity.activity!==this.edits.activity&&this.unsortedAgents.push({name:this.contributor.displayName,id:null,order:null})},getOptions:function(t){var e=this;return new Promise((function(i){t||(e.activityOptions=[],i());var s=e.contributor.activities.filter((function(i){return i.id!==e.activityId&&i.scheme===t})).map((function(t){return t.activity}));e.activityOptions=e.controlledLists.activityTypes[t].filter((function(t){return!s.includes(t.name)})),i()}))},updateOrder:function(){var t=this;this.sortedAgents=this.sortedAgents.map((function(e,i){return e.order=i+1,e.id===t.activityId&&t.$set(t.edits,"order",i+1),e})),this.unsortedAgents=this.unsortedAgents.map((function(e){return e.order=null,e.id===t.activityId&&t.$set(t.edits,"order",null),e}))}},created:function(){var t=this;this.refresh(),this.eventBus.$on(this.events.saveActivity,(function(e){e===t.activityId&&t.saveEdit()}))},watch:{activityId:function(){this.refresh()}}};const p=(0,c.Z)(h,s,[function(){var t=this._self._c;return t("div",[t("b",[this._v("Ordered contributors")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"help-icon"},[e("i",{staticClass:"fas fa-question-circle"}),t._v(" "),e("div",{staticClass:"help-tooltip",attrs:{role:"tooltip"}},[t._v("\n                    Contributors that should be listed in a particular order when citing.\n                ")])])},function(){var t=this._self._c;return t("div",[t("b",[this._v("Unordered contributors")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"help-icon"},[e("i",{staticClass:"fas fa-question-circle"}),t._v(" "),e("div",{staticClass:"help-tooltip",attrs:{role:"tooltip"}},[t._v("\n                    Contributors that do not have to be listed in any particular order. These will be listed\n                    "),e("em",[t._v("after")]),t._v(" the ordered contributors.\n                ")])])}],!1,null,null,null).exports},2942:(t,e,i)=>{i.d(e,{Z:()=>o});var s=function(){return(0,this._self._c)("div")};s._withStripped=!0;var n=i(5170),a=i(7570);const r={name:"EditBase",extends:n.Z,abstract:!0,props:{canSave:{default:function(){return!0}}},data:function(){return{edits:{},errors:[],showErrors:!1,loading:{},expand:!1,valid:{}}},computed:{idGen:function(){return[(0,a.x0)(8)]}},methods:{saveEdit:function(){this.isValid||this.errors.push(["Not valid"])},stopEdit:function(){this.$emit(this.events.editsDone)}},watch:{errors:function(t){0===t.length&&(this.showErrors=!1)}}};const o=(0,i(1900).Z)(r,s,[],!1,null,null,null).exports}}]);

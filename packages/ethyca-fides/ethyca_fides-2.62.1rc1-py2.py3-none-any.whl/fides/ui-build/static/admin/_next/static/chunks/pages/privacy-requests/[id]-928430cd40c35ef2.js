(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9650],{96539:function(e,t,n){var i=n(77400).Symbol;e.exports=i},52033:function(e,t,n){var i=n(26194),s=n(26789)(i);e.exports=s},49819:function(e,t,n){var i=n(18911)();e.exports=i},26194:function(e,t,n){var i=n(49819),s=n(50098);e.exports=function(e,t){return e&&i(e,t,s)}},99736:function(e,t,n){var i=n(96539),s=n(34840),l=n(21258),r=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":r&&r in Object(e)?s(e):l(e)}},67375:function(e,t,n){var i=n(52033),s=n(80068);e.exports=function(e,t){var n=-1,l=s(e)?Array(e.length):[];return i(e,function(e,i,s){l[++n]=t(e,i,s)}),l}},26789:function(e,t,n){var i=n(80068);e.exports=function(e,t){return function(n,s){if(null==n)return n;if(!i(n))return e(n,s);for(var l=n.length,r=t?l:-1,a=Object(n);(t?r--:++r<l)&&!1!==s(a[r],r,a););return n}}},18911:function(e){e.exports=function(e){return function(t,n,i){for(var s=-1,l=Object(t),r=i(t),a=r.length;a--;){var o=r[e?a:++s];if(!1===n(l[o],o,l))break}return t}}},39120:function(e,t,n){var i="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;e.exports=i},34840:function(e,t,n){var i=n(96539),s=Object.prototype,l=s.hasOwnProperty,r=s.toString,a=i?i.toStringTag:void 0;e.exports=function(e){var t=l.call(e,a),n=e[a];try{e[a]=void 0;var i=!0}catch(e){}var s=r.call(e);return i&&(t?e[a]=n:delete e[a]),s}},21258:function(e){var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},77400:function(e,t,n){var i=n(39120),s="object"==typeof self&&self&&self.Object===Object&&self,l=i||s||Function("return this")();e.exports=l},92360:function(e){e.exports=function(e){return null!=e&&"object"==typeof e}},55807:function(e,t,n){var i=n(66070),s=n(89278),l=n(67375),r=n(19785);e.exports=function(e,t){return(r(e)?i:l)(e,s(t,3))}},6554:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/privacy-requests/[id]",function(){return n(43144)}])},18225:function(e,t,n){"use strict";var i=n(24246),s=n(91942);t.Z=e=>{let{alignment:t="center",...n}=e;return(0,i.jsx)(s.kCb,{boxSize:"full",align:"center",justify:t,children:(0,i.jsx)(s.$jN,{color:"primary",...n})})}},77213:function(e,t,n){"use strict";n.d(t,{Z:function(){return p}});var i=n(24246),s=n(91942),l=n(88038),r=n.n(l),a=n(86677);n(27378);var o=n(25980),c=n(90867),d=n(77830),u=()=>{let e=(0,a.useRouter)();return(0,i.jsx)(s.xuv,{bg:"gray.50",border:"1px solid",borderColor:"blue.400",borderRadius:"md",justifyContent:"space-between",p:5,mb:5,mt:5,children:(0,i.jsxs)(s.xuv,{children:[(0,i.jsxs)(s.Kqy,{direction:{base:"column",sm:"row"},justifyContent:"space-between",children:[(0,i.jsx)(s.xvT,{fontWeight:"semibold",children:"Configure your storage and messaging provider"}),(0,i.jsx)(s.wpx,{onClick:()=>{e.push(d.fz)},children:"Configure"})]}),(0,i.jsxs)(s.xvT,{children:["Before Fides can process your privacy requests we need two simple steps to configure your storage and email client."," "]})]})})},p=e=>{let{children:t,title:n,padded:l=!0,mainProps:d}=e,p=(0,o.hz)(),h=(0,a.useRouter)(),x="/privacy-requests"===h.pathname||"/datastore-connection"===h.pathname,m=!(p.flags.privacyRequestsConfiguration&&x),{data:g}=(0,c.JE)(void 0,{skip:m}),{data:j}=(0,c.PW)(void 0,{skip:m}),v=p.flags.privacyRequestsConfiguration&&(!g||!j)&&x;return(0,i.jsxs)(s.kCb,{"data-testid":n,direction:"column",h:"100vh",children:[(0,i.jsxs)(r(),{children:[(0,i.jsxs)("title",{children:["Fides Admin UI - ",n]}),(0,i.jsx)("meta",{name:"description",content:"Privacy Engineering Platform"}),(0,i.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,i.jsxs)(s.kCb,{as:"main",direction:"column",py:l?6:0,px:l?10:0,h:l?"calc(100% - 48px)":"full",flex:1,minWidth:0,overflow:"auto",...d,children:[v?(0,i.jsx)(u,{}):null,t]})]})}},812:function(e,t,n){"use strict";n.d(t,{D4:function(){return l.D4},MM:function(){return p},Ot:function(){return c},c6:function(){return s},cj:function(){return x},e$:function(){return a},fn:function(){return o},iC:function(){return h},nU:function(){return u},tB:function(){return d}});var i,s,l=n(19043);let r="An unexpected error occurred. Please try again.",a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r;if((0,l.Bw)(e)){if((0,l.hE)(e.data))return e.data.detail;if((0,l.cz)(e.data)){var n;let t=null===(n=e.data.detail)||void 0===n?void 0:n[0];return"".concat(null==t?void 0:t.msg,": ").concat(null==t?void 0:t.loc)}if(409===e.status&&(0,l.Dy)(e.data)||404===e.status&&(0,l.XD)(e.data))return"".concat(e.data.detail.error," (").concat(e.data.detail.fides_key,")")}return t};function o(e){return"object"==typeof e&&null!=e&&"status"in e}function c(e){return"object"==typeof e&&null!=e&&"data"in e&&"string"==typeof e.data.detail}function d(e){return"object"==typeof e&&null!=e&&"data"in e&&Array.isArray(e.data.detail)}let u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{status:500,message:r};if((0,l.oK)(e))return{status:e.originalStatus,message:e.data};if((0,l.Bw)(e)){let{status:n}=e;return{status:n,message:a(e,t.message)}}return t},p=e=>Object.entries(e).map(e=>({value:e[1],label:e[1]}));(i=s||(s={})).GVL="gvl",i.AC="gacp",i.COMPASS="compass";let h={gvl:{label:"GVL",fullName:"Global Vendor List"},gacp:{label:"AC",fullName:"Google Additional Consent List"},compass:{label:"",fullName:""}},x=e=>{let t=e.split(".")[0];return"gacp"===t?"gacp":"gvl"===t?"gvl":"compass"}},43144:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return e_}});var i,s,l=n(24246),r=n(91942),a=n(86677),o=n(77213),c=n(77830),d=n(58754),u=n(99716),p=n(27378),h=n(7448);(i=s||(s={})).IN_PROCESSING="in_processing",i.PENDING="pending",i.COMPLETE="complete",i.ERROR="error",i.PAUSED="paused",i.RETRYING="retrying",i.SKIPPED="skipped";let x={in_processing:"In processing",pending:"Pending",complete:"Complete",error:"Error",paused:"Paused",retrying:"Retrying",skipped:"Skipped"},m={error:"error",skipped:"warning",in_processing:void 0,pending:void 0,complete:void 0,paused:void 0,retrying:void 0};var g=n(90005),j=n.n(g),v=n(55807),f=n.n(v),y=n(16394),b=n(33254),_=n.n(b),w=e=>{let{results:t,onItemClicked:n}=e,i=f()(t,(e,t)=>({logs:e,key:t})),s=(0,p.useCallback)(e=>{let{logs:t,key:i}=e,s=t.some(e=>e.status===h.np.ERROR),a=t.some(e=>e.status===h.np.SKIPPED);return(0,l.jsx)("button",{type:"button",onClick:()=>n({key:i,logs:t}),className:j()(_().itemButton,{[_()["itemButton--error"]]:s}),"data-testid":"activity-timeline-item",children:(0,l.jsxs)("div",{className:_().header,children:[(0,l.jsx)("span",{"data-testid":"activity-timeline-author",children:"Fides:"}),(0,l.jsxs)("span",{className:j()(_().title,{[_()["title--error"]]:s,[_()["title--skipped"]]:a}),"data-testid":"activity-timeline-title",children:[i,s&&" failed"]}),(0,l.jsx)("span",{className:_().timestamp,"data-testid":"activity-timeline-timestamp",children:(0,y.p6)(t[0].updated_at)}),(0,l.jsx)(r.j8w,{color:"sandstone","data-testid":"activity-timeline-type",children:"Request update"}),(s||a)&&(0,l.jsx)("span",{className:_().viewLogs,"data-testid":"activity-timeline-view-logs",children:"View Log"})]})},i)},[n]);return(0,l.jsx)(r.krs,{className:_().collapse,bordered:!1,split:!1,"data-testid":"activity-timeline-list",children:i.map(s)})},R=n(88340),C=e=>{let{errorMessage:t,status:n=s.ERROR}=e;return(0,l.jsxs)(r.xuv,{height:"100%",id:"outer",children:[(0,l.jsxs)(r.kCb,{alignItems:"center",children:[(0,l.jsx)(r.xvT,{size:"sm",color:"gray.700",fontWeight:"medium",marginRight:"8px",lineHeight:"20px",children:"Status"}),(0,l.jsx)(r.j8w,{color:m[n],children:x[n]}),(0,l.jsx)(r.xuv,{padding:"0px",marginBottom:"3px",children:(0,l.jsx)(R.Z,{copyText:t})})]}),(0,l.jsx)(r.izJ,{marginTop:"4px",marginBottom:"6px"}),(0,l.jsx)(r.xuv,{id:"errorWrapper",overflow:"auto",height:"100%",children:(0,l.jsx)(r.xvT,{children:t})})]})},T=n(3124),k=n.n(T);let S=e=>{switch(e){case h.Us.ACCESS:return"Data Retrieval";case h.Us.ERASURE:return"Data Deletion";case h.Us.CONSENT:return"Consent";case h.Us.UPDATE:return"Data Update";default:return e}};var q=e=>{let{eventLogs:t,openErrorPanel:n}=e,i=null==t?void 0:t.map(e=>(0,l.jsxs)(r.Tr,{backgroundColor:e.status===s.ERROR||e.status===s.SKIPPED&&e.message?k().FIDESUI_NEUTRAL_50:"unset",onClick:()=>{(e.status===s.ERROR||e.status===s.SKIPPED&&e.message)&&n(e.message,e.status)},style:{cursor:e.status===s.ERROR||e.status===s.SKIPPED&&e.message?"pointer":"unset"},children:[(0,l.jsx)(r.Td,{children:(0,l.jsx)(r.xvT,{color:"gray.600",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:(0,y.p6)(e.updated_at)})}),(0,l.jsx)(r.Td,{children:(0,l.jsx)(r.xvT,{color:"gray.600",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:S(e.action_type)})}),(0,l.jsx)(r.Td,{children:(0,l.jsx)(r.j8w,{color:m[e.status],children:x[e.status]})}),(0,l.jsx)(r.Td,{children:(0,l.jsx)(r.xvT,{color:"gray.600",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:e.collection_name})})]},e.updated_at));return(0,l.jsx)(r.xuv,{width:"100%",paddingTop:"0px",height:"100%",children:(0,l.jsx)(r.xJi,{id:"tableContainer",height:"100%",style:{overflowY:"auto"},children:(0,l.jsxs)(r.iA_,{size:"sm",id:"table",position:"relative",children:[(0,l.jsx)(r.hrZ,{id:"tableHeader",position:"sticky",top:"0px",backgroundColor:"white",children:(0,l.jsxs)(r.Tr,{children:[(0,l.jsx)(r.Th,{children:(0,l.jsx)(r.xvT,{color:"black",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:"Time"})}),(0,l.jsx)(r.Th,{children:(0,l.jsx)(r.xvT,{color:"black",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:"Action Type"})}),(0,l.jsx)(r.Th,{children:(0,l.jsx)(r.xvT,{color:"black",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:"Status"})}),(0,l.jsx)(r.Th,{children:(0,l.jsx)(r.xvT,{color:"black",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:"Collection"})})]})}),(0,l.jsx)(r.p3B,{id:"tableBody",children:i})]})})})},E=e=>{let{isOpen:t,onClose:n,currentLogs:i,isViewingError:a,errorMessage:o,currentStatus:c=s.ERROR,onCloseErrorPanel:d,onOpenErrorPanel:u}=e;return(0,l.jsxs)(r.dys,{isOpen:t,placement:"right",onClose:n,size:"full",autoFocus:!1,"data-testid":"log-drawer",children:[(0,l.jsx)(r.P1B,{}),(0,l.jsxs)(r.scA,{style:{width:"50%"},"data-testid":"log-drawer",children:[(0,l.jsx)(r.OXI,{style:{paddingBottom:"0px"},children:(0,l.jsxs)(r.kCb,{justifyContent:"space-between",alignItems:"center",height:"40px",children:[(0,l.jsxs)(r.kCb,{alignItems:"center",children:[a&&(0,l.jsx)(r.wpx,{icon:(0,l.jsx)(r.Rpv,{}),"aria-label":"Close error logs",size:"small",onClick:d}),(0,l.jsx)(r.xvT,{color:"gray.900",fontSize:"md",lineHeight:"6",fontWeight:"medium",ml:1,children:a?"Event detail":"Event log"})]}),(0,l.jsx)(r.wpx,{icon:(0,l.jsx)(r.LGN,{width:"17px"}),"aria-label":"Stop viewing error message",size:"small",onClick:n,"data-testid":"log-drawer-close"})]})}),(0,l.jsxs)(r.Ng0,{id:"drawerBody",overflow:"hidden",children:[i&&!a?(0,l.jsx)(q,{eventLogs:i,openErrorPanel:u}):null,a?(0,l.jsx)(C,{errorMessage:o,status:c}):null]})]})]})},A=e=>{let{subjectRequest:t}=e,{isOpen:n,onOpen:i,onClose:a}=(0,r.qY0)(),[o,c]=(0,p.useState)([]),[d,u]=(0,p.useState)(""),[h,x]=(0,p.useState)(!1),[m,g]=(0,p.useState)(""),[j,v]=(0,p.useState)(s.ERROR),{results:f}=t;(0,p.useEffect)(()=>{d&&f&&f[d]&&c(f[d])},[f,d]);let y=()=>{x(!1)},b=(e,t)=>{u(e),c(t),i()};return(0,l.jsxs)(r.xuv,{width:"100%",children:[(0,l.jsx)(w,{results:f,onItemClicked:e=>{let{key:t,logs:n}=e;return b(t,n)}}),(0,l.jsx)(E,{isOpen:n,onClose:()=>{h&&y(),u(""),a()},currentLogs:o,isViewingError:h,errorMessage:m,currentStatus:j,onOpenErrorPanel:(e,t)=>{g(e),t&&v(t),x(!0)},onCloseErrorPanel:y})]})},P=n(14047),N=n(14207),O=n(90867),I=n(16134);let D=e=>Array.from(new Set(e.filter(e=>Object.values(h.Us).includes(e.action_type)).map(e=>e.action_type)));var z=e=>{let{rules:t}=e,n=D(t).map(e=>(0,y.kC)(e)).map(e=>e);return(0,l.jsx)(r.AntTypography.Text,{children:n.join(" - ")})},L=n(34090),U=n(55484),M=e=>{let{connectorName:t,data:n,isSubmitting:i=!1,onSaveClick:s}=e,{isOpen:a,onOpen:o,onClose:c}=(0,r.qY0)(),d=(0,p.useRef)(null),u=async(e,t)=>{s({connection_key:n.connection_key,privacy_request_id:n.privacy_request_id,body:{...e}}),c()};return(0,l.jsxs)(l.Fragment,{children:[(null==n?void 0:n.checked)&&(0,l.jsx)(r.wpx,{onClick:o,size:"small",children:"Review"}),!(null==n?void 0:n.checked)&&(0,l.jsx)(r.wpx,{onClick:o,size:"small",type:"primary",children:"Begin manual input"}),(0,l.jsx)(L.J9,{enableReinitialize:!0,initialValues:{...n.fields},onSubmit:u,validateOnBlur:!1,validateOnChange:!1,validationSchema:U.Ry().shape({}),children:e=>(0,l.jsxs)(r.dys,{isOpen:a,placement:"right",initialFocusRef:d,onClose:c,size:"lg",children:[(0,l.jsx)(r.P1B,{}),(0,l.jsxs)(r.scA,{children:[(0,l.jsx)(r.cCv,{}),(0,l.jsxs)(r.OXI,{color:"gray.900",children:[(0,l.jsx)(r.xvT,{fontSize:"xl",mb:8,children:t}),(0,l.jsx)(r.izJ,{}),(0,l.jsx)(r.xvT,{fontSize:"md",mt:"4",children:"Manual access"}),(0,l.jsx)(r.xuv,{mt:"8px",children:(0,l.jsx)(r.xvT,{color:"gray.700",fontSize:"sm",fontWeight:"normal",children:"Please complete the following PII fields that have been collected for the selected subject."})})]}),(0,l.jsx)(r.Ng0,{children:(0,l.jsx)(L.l0,{id:"manual-detail-form",noValidate:!0,children:(0,l.jsx)(r.gCW,{align:"stretch",gap:"16px",children:Object.entries(n.fields).map((e,t)=>{let[n]=e;return(0,l.jsx)(r.Ugi,{children:(0,l.jsx)(L.gN,{id:n,name:n,children:e=>{let{field:i}=e;return(0,l.jsxs)(r.NIc,{alignItems:"baseline",display:"inline-flex",children:[(0,l.jsx)(r.lXp,{color:"gray.900",fontSize:"14px",fontWeight:"semibold",htmlFor:n,w:"50%",children:n}),(0,l.jsx)(r.IIB,{...i,autoComplete:"off",color:"gray.700",placeholder:"Please enter ".concat(n),ref:0===t?d:void 0,size:"sm"})]})}})},n)})})})}),(0,l.jsx)(r.zeN,{justifyContent:"flex-start",children:(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(r.wpx,{onClick:c,children:"Cancel"}),(0,l.jsx)(r.wpx,{form:"manual-detail-form",loading:i,htmlType:"submit",children:"Save"})]})})]})]})})]})},W=e=>{let{connectorName:t,data:n,isSubmitting:i=!1,onSaveClick:s}=e,{isOpen:a,onOpen:o,onClose:c}=(0,r.qY0)(),d=(0,p.useRef)(null),u=async(e,t)=>{s({connection_key:n.connection_key,privacy_request_id:n.privacy_request_id,body:{...e}}),c()};return(0,l.jsxs)(l.Fragment,{children:[(null==n?void 0:n.checked)&&(0,l.jsx)(r.wpx,{onClick:o,size:"small",children:"Review"}),!(null==n?void 0:n.checked)&&(0,l.jsx)(r.wpx,{onClick:o,size:"small",type:"primary",children:"Begin manual input"}),(0,l.jsx)(L.J9,{enableReinitialize:!0,initialValues:{...n.fields},onSubmit:u,validateOnBlur:!1,validateOnChange:!1,validationSchema:U.Ry().shape({}),children:e=>(0,l.jsxs)(r.dys,{isOpen:a,placement:"right",initialFocusRef:d,onClose:c,size:"lg",children:[(0,l.jsx)(r.P1B,{}),(0,l.jsxs)(r.scA,{children:[(0,l.jsx)(r.cCv,{}),(0,l.jsxs)(r.OXI,{color:"gray.900",children:[(0,l.jsx)(r.xvT,{fontSize:"xl",mb:8,children:t}),(0,l.jsx)(r.izJ,{}),(0,l.jsx)(r.xvT,{fontSize:"md",mt:"4",children:"Manual erasure"}),(0,l.jsx)(r.xuv,{mt:"8px",children:(0,l.jsx)(r.xvT,{color:"gray.700",fontSize:"sm",fontWeight:"normal",children:"Please delete the following PII fields associated with the selected subject if they are available. Once deleted, check the box to confirm the deletion."})})]}),(0,l.jsx)(r.Ng0,{children:(0,l.jsx)(L.l0,{id:"manual-detail-form",noValidate:!0,children:(0,l.jsx)(r.gCW,{align:"stretch",gap:"16px",children:Object.entries(n.fields).map(e=>{let[t]=e;return(0,l.jsx)(r.Ugi,{children:(0,l.jsx)(L.gN,{id:t,name:t,children:e=>{let{field:n}=e;return(0,l.jsxs)(r.NIc,{alignItems:"baseline",display:"inline-flex",children:[(0,l.jsx)(r.lXp,{color:"gray.900",fontSize:"14px",fontWeight:"semibold",htmlFor:t,w:"50%",children:t}),(0,l.jsx)(r.XZJ,{...n,isChecked:!!n.value,onChange:n.onChange,name:t,id:t})]})}})},t)})})})}),(0,l.jsx)(r.zeN,{justifyContent:"flex-start",children:(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(r.wpx,{onClick:c,children:"Cancel"}),(0,l.jsx)(r.wpx,{form:"manual-detail-form",loading:i,htmlType:"submit",children:"Save"})]})})]})]})})]})};let B=(e,t,n)=>e.includes(h.Us.ACCESS)?{ProcessingDetailComponent:M,uploadMutation:t,getUploadedWebhookDataEndpoint:O.$I.endpoints.getUploadedManualAccessWebhookData}:e.includes(h.Us.ERASURE)?{ProcessingDetailComponent:W,uploadMutation:n,getUploadedWebhookDataEndpoint:O.$I.endpoints.getUploadedManualErasureWebhookData}:null;var F=e=>{let{subjectRequest:t,onComplete:n}=e,i=(0,I.T)(),{errorAlert:s,successAlert:a}=(0,P.V)(),{handleError:o}=(0,P.H)(),[c,d]=(0,p.useState)([]),[u,x]=(0,p.useState)(!1),[m,g]=(0,p.useState)(!1),{data:j,isFetching:v,isLoading:f,isSuccess:y}=(0,N.W6)(),[b]=(0,O.w3)(),_=D(t.policy.rules),[w]=(0,O.nL)(),[R]=(0,O.UR)(),{ProcessingDetailComponent:C,uploadMutation:T,getUploadedWebhookDataEndpoint:k}=B(_,w,R),S=async()=>{try{x(!0),await b(t.id).unwrap(),a("Manual request has been received. Request now processing."),n()}catch(e){o(e)}finally{x(!1)}},q=async e=>{try{g(!0),await T(e).unwrap();let t={connection_key:e.connection_key,fields:{}};Object.entries(e.body).forEach(e=>{let[n,i]=e;t.fields[n]=i||""});let n=c.map(e=>e.connection_key===t.connection_key?{...e,checked:!0,fields:{...t.fields}}:e);d(n),a("Manual input successfully saved!")}catch(e){o(e)}finally{g(!1)}};return((0,p.useEffect)(()=>(y&&j.length>0&&0===c.length&&(()=>{if(c.length>0)return;let e=[],n=null==j?void 0:j.map(e=>e.connection_config.key);null==n||n.every(n=>e.push(i(k.initiate({connection_key:n,privacy_request_id:t.id})))),Promise.allSettled(e).then(e=>{let t=[];e.forEach((e,n)=>{if("fulfilled"===e.status&&e.value.isSuccess&&e.value.data){let n={checked:e.value.data.checked,fields:{},connection_key:e.value.originalArgs.connection_key,privacy_request_id:e.value.originalArgs.privacy_request_id};Object.entries(e.value.data.fields).forEach(e=>{let[t,i]=e;n.fields[t]=i||""}),t.push(n)}else s("An error occurred while loading manual input data for ".concat(j[n].connection_config.name))}),d(t)})})(),()=>{}),[j,c.length,i,s,y,t.id,k]),_.includes(h.Us.ACCESS)||_.includes(h.Us.ERASURE))?(0,l.jsxs)(r.gCW,{align:"stretch",spacing:8,children:[(0,l.jsx)(r.xuv,{children:(0,l.jsx)(r.xvT,{color:"gray.700",fontSize:"sm",children:"The following table details the integrations that require manual input from you."})}),(0,l.jsxs)(r.xuv,{children:[(v||f)&&(0,l.jsx)(r.M5Y,{children:(0,l.jsx)(r.$jN,{})}),y&&j?(0,l.jsx)(r.xJi,{children:(0,l.jsxs)(r.iA_,{size:"sm",variant:"unstyled",children:[(0,l.jsx)(r.hrZ,{children:(0,l.jsxs)(r.Tr,{children:[(0,l.jsx)(r.Th,{fontSize:"sm",fontWeight:"semibold",pl:"0",textTransform:"none",children:"Integration Identifier"}),(0,l.jsx)(r.Th,{})]})}),(0,l.jsxs)(r.p3B,{children:[j.length>0&&j.map(e=>(0,l.jsxs)(r.Tr,{display:"block",children:[(0,l.jsx)(r.Td,{pl:"0",children:e.connection_config.key}),(0,l.jsx)(r.Td,{children:c.length>0?(0,l.jsx)(C,{connectorName:e.connection_config.name,data:c.find(t=>t.connection_key===e.connection_config.key),isSubmitting:m,onSaveClick:q}):null})]},e.id)),0===j.length&&(0,l.jsx)(r.Tr,{children:(0,l.jsx)(r.Td,{colSpan:3,pl:"0",children:(0,l.jsx)(r.M5Y,{children:(0,l.jsx)(r.xvT,{children:"You don‘t have any Manual Process connections set up yet."})})})})]}),c.length>0&&c.every(e=>e.checked)?(0,l.jsx)(r.$RU,{children:(0,l.jsx)(r.Tr,{children:(0,l.jsx)(r.Th,{pl:"0px",children:(0,l.jsx)(r.wpx,{type:"primary",loading:u,onClick:S,className:"mt-2",children:"Complete DSR"})})})}):null]})}):null]})]}):null},Z=n(8557),J=e=>{let{daysLeft:t,includeText:n,status:i}=e;if(!t||i===Z.q.COMPLETE||i===Z.q.CANCELED||i===Z.q.DENIED||i===Z.q.IDENTITY_UNVERIFIED)return(0,l.jsx)("span",{children:"-"});let s="";switch(!0){case t>=10:s="success";break;case t<10&&t>4:s="warning";break;case t<5:s="error"}return(0,l.jsx)(r.j8w,{color:s,children:n?"".concat(t," days left"):t})},V=n(25980);let Y={approved:{color:"success",label:"Approved"},complete:{color:"success",label:"Completed"},awaiting_email_send:{color:"marble",label:"Awaiting Email Send"},denied:{color:"warning",label:"Denied"},canceled:{color:"marble",label:"Canceled"},error:{color:"error",label:"Error"},in_processing:{color:"caution",label:"In Progress"},paused:{color:"marble",label:"Paused"},pending:{color:"info",label:"New"},identity_unverified:{color:"marble",label:"Unverified"},requires_input:{color:"alert",label:"Requires Input"}};var G=e=>{let{status:t}=e;return(0,l.jsx)(r.j8w,{color:Y[t].color,className:"justify-center","data-testid":"request-status-badge",children:Y[t].label})},H=n(18225),X=n(812),K=n(46238),$=n(19904),Q=n(7842),ee=n(54427);let{useGetAttachmentsQuery:et,useUploadAttachmentMutation:en,useGetAttachmentDetailsQuery:ei,useLazyGetAttachmentDetailsQuery:es}=n(78780).u.injectEndpoints({endpoints:e=>({getAttachments:e.query({query:e=>{let{privacy_request_id:t,page:n=1,size:i}=e;return{url:"plus/privacy-request/".concat(t,"/attachment"),method:"GET",params:{page:n,size:i}}},providesTags:["Privacy Request Attachments"]}),uploadAttachment:e.mutation({query:e=>{let{privacy_request_id:t,attachment_type:n,attachment_file:i}=e,s=new FormData;return s.append("attachment_type",n),s.append("attachment_file",i),{url:"plus/privacy-request/".concat(t,"/attachment"),method:"POST",body:s,params:{}}},invalidatesTags:["Privacy Request Attachments"]}),getAttachmentDetails:e.query({query:e=>{let{privacy_request_id:t,attachment_id:n}=e;return{url:"plus/privacy-request/".concat(t,"/attachment/").concat(n),method:"GET"}}})})}),{reducer:el}=(0,ee.oM)({name:"privacyRequestAttachments",initialState:{},reducers:{}}),er=e=>{let{file:t}=e,[n,i]=(0,p.useState)(!1),[s]=es(),a=async()=>{var e,n,l;if((null===(e=t.customData)||void 0===e?void 0:e.attachment_id)&&(null===(n=t.customData)||void 0===n?void 0:n.privacy_request_id)){i(!0);try{let e=await s({privacy_request_id:t.customData.privacy_request_id,attachment_id:t.customData.attachment_id}),n=null===(l=e.data)||void 0===l?void 0:l.retrieved_attachment_url,i=null==n?void 0:n.startsWith("http");n&&i?window.open(n,"_blank"):n&&!i?r.Pg3.info("Download is not available when using local storage methods."):r.Pg3.error("No download URL available for ".concat(t.name))}catch(e){r.Pg3.error("Failed to fetch attachment download URL")}finally{i(!1)}}};return(0,l.jsxs)(r.jqI,{align:"center",gap:8,children:[(0,l.jsx)(r.PJP.PgN,{className:"shrink-0"}),(0,l.jsx)(r.lKn,{ellipsis:{tooltip:t.name},className:"grow",children:t.name}),(0,l.jsx)(r.wpx,{type:"text",icon:(0,l.jsx)(r.PJP.UWx,{}),onClick:a,loading:n,className:"shrink-0"})]})},ea=(e,t)=>(0,l.jsx)(er,{file:t});var eo=e=>{let{subjectRequest:t}=e,[n,i]=(0,p.useState)(!1),s=(0,$.Tg)([h.Sh.ATTACHMENT_READ]),a=(0,$.Tg)([h.Sh.ATTACHMENT_CREATE]),[o]=en(),{data:c,isLoading:d,error:u}=(0,O.PW)(),{data:x,isLoading:m}=et({privacy_request_id:t.id}),{refetch:g}=et({privacy_request_id:t.id}),j=(null==x?void 0:x.items.map(e=>({uid:e.id,name:e.file_name,status:"done",customData:{attachment_id:e.id,privacy_request_id:t.id}})))||[],v=(0,p.useCallback)(()=>(0,l.jsx)(r.PJP.PgN,{}),[]);if(!s)return null;let f=a&&(null==c?void 0:c.key),y=[".pdf",".doc",".docx",".xls",".xlsx",".txt",".csv",".jpg",".jpeg",".png",".zip"];return(0,l.jsx)("div",{children:(0,l.jsxs)("div",{className:"mt-6",children:[(0,l.jsx)("div",{className:"mb-6",children:(0,l.jsx)(r.lQT,{level:3,children:"Attachments"})}),d||m?(0,l.jsx)(H.Z,{size:"md",alignment:"start"}):(0,l.jsx)(r.pMK,{name:"attachment_file",fileList:j,iconRender:v,showUploadList:{showRemoveIcon:!1,showDownloadIcon:!1},itemRender:ea,accept:y.join(","),customRequest:async e=>{let{file:n,onSuccess:s,onError:l}=e,a=n.name;try{i(!0),await o({privacy_request_id:t.id,attachment_file:n,attachment_type:Q.s.INTERNAL_USE_ONLY}).unwrap(),r.Pg3.success("".concat(a," file uploaded successfully")),g(),null==s||s(n)}catch(e){r.Pg3.error("".concat(a," file upload failed.")),null==l||l(e)}finally{i(!1)}},disabled:!f,children:a&&(0,l.jsx)(r.esZ,{title:u&&"Add attachment not available: ".concat((0,X.e$)(u)),placement:"top",children:(0,l.jsxs)(r.jqI,{align:"center",gap:12,className:"mb-4",children:[(0,l.jsx)(r.wpx,{icon:(0,l.jsx)(r.PJP.mm_,{}),iconPosition:"end",disabled:!f||n,loading:n,children:n?"Uploading":"Add"}),(0,l.jsx)(K.b,{label:"Uploaded attachments are for internal use and won't be send as part of the request package.\n                      Accepted filetypes: ".concat(y.join(", ")),placement:"top"})]})})})]})})},ec=n(15709),ed=n.n(ec),eu=e=>{let{label:t,children:n}=e;return(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"shrink-0 grow-0 basis-1/2 pr-2 ".concat(ed().label),children:(0,l.jsxs)(r.AntTypography.Text,{children:[t,":"]})}),(0,l.jsx)("div",{className:"min-w-0 shrink grow ".concat(ed().value),"data-testid":"request-detail-value-".concat(t),children:n})]})},ep=e=>{let{subjectRequest:t}=e,{custom_privacy_request_fields:n}=t;return(0,l.jsx)("div",{className:"flex flex-col gap-2",children:n&&Object.keys(n).length>0&&Object.entries(n).filter(e=>{let[,t]=e;return t.value}).map(e=>{let[t,n]=e;return(0,l.jsx)(eu,{label:n.label,children:(0,l.jsx)(r.AntTypography.Text,{children:Array.isArray(n.value)?n.value.join(", "):n.value})},t)})})},eh=e=>{let{subjectRequest:t}=e,{plus:n}=(0,V.hz)(),{id:i,status:s,policy:a,identity:o,identity_verified_at:c}=t;return(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"mb-6",children:(0,l.jsx)(r.AntTypography.Title,{level:2,children:"Request details"})}),(0,l.jsxs)(r.jqI,{vertical:!0,gap:12,className:"mb-6",children:[(0,l.jsx)(eu,{label:"Status",children:(0,l.jsx)(G,{status:s})}),(0,l.jsx)(eu,{label:"Time remaining",children:(0,l.jsx)(J,{daysLeft:t.days_left,includeText:!0,status:t.status})}),(0,l.jsx)(eu,{label:"Request type",children:(0,l.jsx)(z,{rules:a.rules})}),(0,l.jsx)(eu,{label:"Source",children:n&&(0,l.jsx)(r.AntTypography.Text,{children:t.source||"-"})}),Object.entries(o).filter(e=>{let[,{value:t}]=e;return null!==t}).map(e=>{let[t,{value:n="",label:i}]=e,s="".concat(n).concat(c?"":" (Unverified)");return(0,l.jsx)(eu,{label:"Subject ".concat(i.toLocaleLowerCase()),children:(0,l.jsx)(r.esZ,{title:s,trigger:"click",children:(0,l.jsx)(r.AntTypography.Text,{ellipsis:!0,children:s})})},t)}),(0,l.jsx)(ep,{subjectRequest:t})]}),(0,l.jsxs)(r.PPS,{layout:"vertical",children:[(0,l.jsx)(r.PPS.Item,{label:"Request ID:",className:"mb-4",children:(0,l.jsxs)(r.jqI,{gap:1,children:[(0,l.jsx)(r.uFc,{readOnly:!0,value:i,"data-testid":"request-detail-value-id"}),(0,l.jsx)(R.Z,{copyText:i,size:"small"})]})}),(0,l.jsx)(r.PPS.Item,{label:"Policy key:",className:"mb-4",children:(0,l.jsx)(r.uFc,{readOnly:!0,value:t.policy.key,"data-testid":"request-detail-value-policy"})})]}),(0,l.jsx)(eo,{subjectRequest:t})]})},ex=e=>{var t;let{data:n}=e,i=(0,p.useMemo)(()=>({id:n.id,verbose:!0}),[n.id]),{data:s}=(0,u.QA)(i,{pollingInterval:n.status===h.q2.APPROVED||n.status===h.q2.IN_PROCESSING?2e3:0,skip:!n.id}),a=null!==(t=null==s?void 0:s.items[0])&&void 0!==t?t:n,o=a.status===h.q2.REQUIRES_INPUT,[c,d]=(0,p.useState)(o?"manual-steps":"activity"),x=(0,p.useMemo)(()=>[{key:"activity",label:"Activity",children:(0,l.jsx)(A,{subjectRequest:a})},{key:"manual-steps",label:"Manual steps",children:(0,l.jsx)(F,{subjectRequest:a,onComplete:()=>d("activity")}),disabled:!o}],[o,a]);return(0,l.jsxs)("div",{className:"flex gap-8",children:[(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsx)(r.A5g,{items:x,activeKey:c,onChange:d})}),(0,l.jsx)("div",{className:"w-1/3 2xl:w-[432px]","data-testid":"privacy-request-details",children:(0,l.jsx)(eh,{subjectRequest:a})})]})},em=n(57526),eg=n(66548),ej=n(45489),ev=e=>{let{privacyRequest:t,action:n}=e,{handleApproveRequest:i,handleDenyRequest:s}=(0,ej.Z)({subjectRequest:t}),l=t.status===h.q2.PENDING,a=(0,r.qY0)(),o=async e=>{let{reason:t}=e,l=r.Pg3.loading({content:"approve"===n?"Approving request...":"Denying request..."});"deny"===n&&await s(t),"approve"===n&&await i(),l()};return{showAction:l,closeModal:a.onClose,performAction:o,openConfirmationModal:a.onOpen,isModalOpen:a.isOpen}},ef=e=>{var t,n,i;let{privacyRequest:s}=e,l=null===(n=(0,V.hz)())||void 0===n?void 0:null===(t=n.flags)||void 0===t?void 0:t.downloadAccessRequestResults,r=s.status===h.q2.COMPLETE,a=D(s.policy.rules).includes(h.Us.ACCESS),o=(0,$.Tg)([h.Sh.PRIVACY_REQUEST_ACCESS_RESULTS_READ]),{data:c,isLoading:d,isError:u,error:p}=(0,O.br)({privacy_request_id:s.id}),x=null!==(i=null==c?void 0:c.access_result_urls[0])&&void 0!==i?i:"",m=!!x&&"your local fides_uploads folder"!==x,g=null;return u?g=(0,X.e$)(p,"Unable to resolve download URL"):m||(g="Requests stored locally cannot be downloaded"),{showDownloadResults:l&&o&&a&&r,downloadResults:()=>{let e=document.createElement("a");e.href=x,e.target="_blank",e.rel="noopener noreferrer",e.click(),e.remove()},infoTooltip:g,isLoading:d,isDisabled:!m}},ey=e=>{let{privacyRequest:t}=e,{errorAlert:n,successAlert:i}=(0,P.V)(),s=t.status===h.q2.ERROR,[l]=(0,O.Fq)();return{reprocessPrivacyRequest:async()=>{if(!t)return;let e=r.Pg3.loading("Reprocessing privacy request...",0),s=await l(t);"error"in s?n((0,X.e$)(s.error),"DSR automation has failed for this privacy request due to the following:",{duration:null}):i("Privacy request is now being reprocessed."),e()},showReprocess:s}},eb=e=>{let{privacyRequest:t}=e,{showDownloadResults:n,downloadResults:i,infoTooltip:s,isDisabled:a}=ef({privacyRequest:t}),{isModalOpen:o,closeModal:c,performAction:d,openConfirmationModal:u,showAction:h}=ev({privacyRequest:t,action:"approve"}),{isModalOpen:x,closeModal:m,performAction:g,openConfirmationModal:j,showAction:v}=ev({privacyRequest:t,action:"deny"}),{reprocessPrivacyRequest:f,showReprocess:y}=ey({privacyRequest:t}),b=(0,p.useMemo)(()=>{let e=[];return e.push({key:"approve",label:(0,l.jsx)("span",{"data-testid":"privacy-request-approve-btn",children:"Approve"}),onClick:u,disabled:!h}),e.push({key:"deny",label:(0,l.jsx)("span",{"data-testid":"privacy-request-deny-btn",children:"Deny"}),onClick:j,disabled:!v}),e.push({key:"reprocess",label:(0,l.jsx)("span",{"data-testid":"privacy-request-action-reprocess",children:"Reprocess"}),onClick:f,disabled:!y}),n&&e.push({key:"download",label:(0,l.jsx)(r.esZ,{title:a?s:null,placement:"bottom",children:(0,l.jsx)("span",{"data-testid":"download-results-btn",children:"Download request results"})}),onClick:i,disabled:a}),e},[n,i,s,a,h,v,u,j,y,f]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.S0p,{menu:{items:b},trigger:["click"],overlayStyle:{minWidth:"160px"},children:(0,l.jsx)(r.wpx,{icon:(0,l.jsx)(r.PJP.pO,{}),"data-testid":"privacy-request-actions-dropdown-btn",iconPosition:"end",type:"primary",disabled:!b.length,size:"large",children:"Actions"})}),(0,l.jsx)(em.Z,{isOpen:o,isLoading:!1,onClose:c,onApproveRequest:()=>d({reason:""}),subjectRequest:t}),(0,l.jsx)(eg.Z,{isOpen:x,onClose:m,onDenyRequest:e=>g({reason:e})})]})},e_=()=>{let e=(0,a.useRouter)().query.id,{data:t,isLoading:n}=(0,u.QA)({id:e,verbose:!0},{skip:!e}),i=(null==t?void 0:t.items[0])||null;return(0,l.jsxs)(o.Z,{title:"Privacy Request - ".concat(e),children:[(0,l.jsx)(d.Z,{heading:"Privacy Requests",breadcrumbItems:[{title:"All requests",href:c.Jw},{title:"Request details"}],rightContent:!!i&&(0,l.jsx)(eb,{privacyRequest:i})}),n&&(0,l.jsx)(r.M5Y,{children:(0,l.jsx)(r.$jN,{})}),!n&&!i&&(0,l.jsx)(r.xvT,{children:"404 no privacy request found"}),!n&&i&&(0,l.jsx)(ex,{data:i})]})}},19043:function(e,t,n){"use strict";n.d(t,{Bw:function(){return r},D4:function(){return s},Dy:function(){return o},XD:function(){return c},cz:function(){return d},hE:function(){return a},oK:function(){return l}});var i=n(76649);let s=e=>"error"in e,l=e=>(0,i.Ln)({status:"string"},e)&&"PARSING_ERROR"===e.status,r=e=>(0,i.Ln)({status:"number",data:{}},e),a=e=>(0,i.Ln)({detail:"string"},e),o=e=>(0,i.Ln)({detail:{error:"string",resource_type:"string",fides_key:"string"}},e),c=e=>(0,i.Ln)({detail:{error:"string",resource_type:"string",fides_key:"string"}},e),d=e=>(0,i.Ln)({detail:[{loc:["string","number"],msg:"string",type:"string"}]},e)},15709:function(e){e.exports={value:"RequestDetailsRow_value__WMXn3",label:"RequestDetailsRow_label__dn3CQ"}},33254:function(e){e.exports={itemButton:"ActivityTimelineList_itemButton___zZAL","itemButton--error":"ActivityTimelineList_itemButton--error__s_p3y",header:"ActivityTimelineList_header__c6_1X",title:"ActivityTimelineList_title__BhPbu","title--error":"ActivityTimelineList_title--error__OWYRS",timestamp:"ActivityTimelineList_timestamp__kg6oj",viewLogs:"ActivityTimelineList_viewLogs__dD3WJ",logs:"ActivityTimelineList_logs__uuT2f","logs--open":"ActivityTimelineList_logs--open__rkg5L"}},76649:function(e,t,n){"use strict";n.d(t,{Ln:function(){return i}});let i=(e,t)=>l(e,t),s=Symbol("SOME"),l=(e,t)=>"string"==typeof e?e===typeof t:Array.isArray(e)?s in e?e.some(e=>l(e,t)):!!Array.isArray(t)&&(0===e.length||t.every(t=>e.some(e=>l(e,t)))):"object"==typeof t&&null!==t&&Object.entries(e).every(([e,n])=>l(n,t[e]));class r{static narrow(e){return new r(t=>i(e,t))}constructor(e){this.NF=void 0,this.NF=e}satisfied(e){return this.NF(e)}build(e){return e}and(e){let t=this.NF,n=e instanceof r?e.NF:e instanceof Function?e:t=>i(e,t);return new r(e=>t(e)&&n(e))}}new r(e=>!0)}},function(e){e.O(0,[2858,2866,9278,8433,2888,9774,179],function(){return e(e.s=6554)}),_N_E=e.O()}]);
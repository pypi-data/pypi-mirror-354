"use strict";(self.webpackChunkjupyter_specta=self.webpackChunkjupyter_specta||[]).push([[77],{77:(e,t,o)=>{o.r(t),o.d(t,{ISpectaDocTracker:()=>N,ISpectaLayoutRegistry:()=>L,createFileBrowser:()=>x,default:()=>M,hideAppLoadingIndicator:()=>b,isSpectaApp:()=>F,registerDocumentFactory:()=>S});var s=o(560),i=o(963),n=o(88),r=o(767),a=o(424),d=o(689),c=o(313),l=o(305),p=o(375);class u extends p.DocumentWidget{constructor(e){super(e)}dispose(){this.content.dispose(),super.dispose()}}var h=o(256);class m extends p.ABCWidgetFactory{constructor(e){super(e),this._spectaWidgetFactory=e.spectaWidgetFactory}createNewWidget(e){const t=new h.Widget;return t.addClass("jp-specta-notebook-panel"),e.ready.then((async()=>{const o=await this._spectaWidgetFactory.createNew({context:e});o&&h.Widget.attach(o,t.node)})),new u({context:e,content:t})}}var y,g=o(559),w=o(442);class _ extends h.Panel{constructor(e,t,o){super(),this._info={},this.removeClass("lm-Widget"),this.removeClass("p-Widget"),this.addClass("specta-cell-output");const s=new h.Panel;s.addClass("specta-cell-content"),t.addClass("specta-item-widget"),s.addWidget(t),this.addWidget(s),this._cellOutput=t,this.cellIdentity=e,this._info=null!=o?o:{}}get cellOutput(){return this._cellOutput}get info(){return this._info}}class v{constructor(e){this.options=e,this._isDisposed=!1,this._context=e.context}get isDisposed(){return this._isDisposed}dispose(){var e,t;this.isDisposed||(this._isDisposed=!0,null===(e=this._context)||void 0===e||e.dispose(),null===(t=this._notebookPanel)||void 0===t||t.dispose())}get rendermime(){return this.options.rendermime}get cells(){var e;return null===(e=this._context)||void 0===e?void 0:e.model.cells}get context(){return this._context}get panel(){return this._notebookPanel}async initialize(){var e;await(null===(e=this._context)||void 0===e?void 0:e.sessionContext.ready),this._notebookPanel=function(e){const{context:t,rendermime:o,editorServices:s}=e,i=s.factoryService.newInlineEditor,r=new n.Notebook({rendermime:o,contentFactory:new n.Notebook.ContentFactory({editorFactory:i}),mimeTypeService:s.mimeTypeService});return new n.NotebookPanel({content:r,context:t})}({context:this._context,rendermime:this.options.rendermime,editorServices:this.options.editorServices}),this.options.tracker.widgetAdded.emit(this._notebookPanel)}createCell(e){let t;const o={cellModel:e.toJSON()};switch(e.type){case"code":{const s=new w.OutputAreaModel({trusted:!0}),i=new w.SimplifiedOutputArea({model:s,rendermime:this.options.rendermime});t=new _(e.id,i,o);break}case"markdown":{const s=new g.MarkdownCell({model:e,rendermime:this.options.rendermime,contentFactory:this.options.contentFactory,editorConfig:this.options.editorConfig.markdown});s.inputHidden=!1,s.rendered=!0,y.removeElements(s.node,"jp-Collapser"),y.removeElements(s.node,"jp-InputPrompt"),t=new _(e.id,s,o);break}default:{const s=new g.RawCell({model:e,contentFactory:this.options.contentFactory,editorConfig:this.options.editorConfig.raw});s.inputHidden=!1,y.removeElements(s.node,"jp-Collapser"),y.removeElements(s.node,"jp-InputPrompt"),t=new _(e.id,s,o);break}}return t}async executeCell(e,t){if("code"!==e.type||!this._context)return;const o=e.sharedModel.source;return await w.SimplifiedOutputArea.execute(o,t,this._context.sessionContext)}}!function(e){e.removeElements=function(e,t){const o=e.getElementsByClassName(t);for(let e=0;e<o.length;e++)o[e].remove()}}(y||(y={}));var f=o(262);class C extends h.Panel{constructor(e){super(),this._ready=new f.PromiseDelegate,this.node.id=e.id,this.title.label=e.label,this.title.closable=!0,this._model=e.model,this._layoutRegistry=e.layoutRegistry,this.node.style.padding="5px",this._host=new h.Panel,this._host.addClass("specta-output-host"),this.addWidget(this._host),this.node.style.overflow="auto",F()||this.addSpinner(),this._model.initialize().then((()=>{this.render().catch(console.error).then((()=>window.dispatchEvent(new Event("resize"))))}))}get ready(){return this._ready.promise}get model(){return this._model}addSpinner(){const e=this._loaderHost=new h.Widget;e.addClass("specta-loader-host");const t=document.createElement("div");t.className="specta-loader",e.node.appendChild(t);const o=document.createElement("div");o.className="specta-loading-indicator-text",o.textContent="Loading Specta",e.node.appendChild(o),this.addWidget(e)}dispose(){this.isDisposed||(this._model.dispose(),super.dispose())}async render(){var e;const t=null!==(e=this._model.cells)&&void 0!==e?e:[],o=[];for(const e of t){if(0===e.sharedModel.source.length)continue;const t=this._model.createCell(e);await this._model.executeCell(e,t.cellOutput),o.push(t)}await this._layoutRegistry.selectedLayout.layout.render({host:this._host,items:o,notebook:this._model.context.model.toJSON(),readyCallback:async()=>{this._loaderHost?(this._loaderHost.node.style.opacity="0",setTimeout((()=>{var e;null===(e=this.layout)||void 0===e||e.removeWidget(this._loaderHost)}),100)):b()}})}onCloseRequest(e){this._model.dispose(),super.onCloseRequest(e)}}class k{constructor(e){this._options=e}async createNew(e){const{context:t}=e,o=new v({context:t,manager:this._options.manager,rendermime:this._options.rendermime,tracker:this._options.tracker,contentFactory:this._options.contentFactory,mimeTypeService:this._options.mimeTypeService,editorConfig:n.StaticNotebook.defaultEditorConfig,notebookConfig:n.StaticNotebook.defaultNotebookConfig,editorServices:this._options.editorServices});return new C({id:f.UUID.uuid4(),label:"",model:o,layoutRegistry:this._options.spectaLayoutRegistry})}}function S(e){const{factoryName:t,app:o,rendermime:s,tracker:i,editorServices:r,contentFactory:a,spectaTracker:d,spectaLayoutRegistry:c}=e,l=new k({manager:o.serviceManager,rendermime:s,tracker:i,contentFactory:a,mimeTypeService:r.mimeTypeService,editorServices:r,spectaLayoutRegistry:c}),p=new m({name:t,modelName:"notebook",fileTypes:["ipynb"],spectaWidgetFactory:l,preferKernel:!0,canStartKernel:!0,autoStartDefault:!0,shutdownOnClose:!0});o.docRegistry.addWidgetFactory(p);const u=new n.NotebookModelFactory({});o.docRegistry.addModelFactory(u),o.docRegistry.addFileType({name:"ipynb",displayName:"IPYNB",mimeTypes:["text/json"],extensions:[".ipynb",".IPYNB"],fileFormat:"json",contentType:"notebook"}),p.widgetCreated.connect(((e,t)=>{t.context.pathChanged.connect((()=>{d.save(t)})),d.add(t)}))}function x(e){const{docManager:t}=e,o=new c.FilterFileBrowserModel({manager:t,auto:!0}),s=new l.VoilaFileBrowser({id:"filebrowser",model:o,restore:!1,urlFactory:e=>{const t=d.PageConfig.getBaseUrl();let o=d.PageConfig.getOption("appUrl");o.endsWith("/")||(o=`${o}/`);const s=new URL(d.URLExt.join(t,o));return s.searchParams.set("path",e),d.PageConfig.getOption("query").split("&").filter(Boolean).forEach((e=>{const[t,o]=e.split("=");s.searchParams.set(t,o)})),s.toString()},title:"Select items to open with Specta."});return s.showFileCheckboxes=!1,s.showLastModifiedColumn=!1,s.addClass("specta-file-browser"),s}function b(){const e=document.getElementById("specta-loader-host"),t=document.getElementById("specta-loader-spinner");e&&t&&(e.style.opacity="0",setTimeout((()=>{t.remove(),e.remove(),document.body.classList.remove("jp-mod-dark","jp-mod-light")}),1e3))}function F(){return!!document.querySelector('meta[name="specta-config"]')}const L=new f.Token("specta:ISpectaLayoutRegistry"),N=new f.Token("exampleDocTracker");var R=o(186);const W={id:"specta:notebook-doc",autoStart:!0,requires:[r.IRenderMimeRegistry,n.INotebookTracker,i.IEditorServices,n.NotebookPanel.IContentFactory,L],activate:(e,t,o,i,n,r)=>{const a=new s.WidgetTracker({namespace:"specta"});return S({factoryName:"specta",app:e,rendermime:t,tracker:o,editorServices:i,contentFactory:n,spectaTracker:a,spectaLayoutRegistry:r}),a},provides:N},P={id:"specta/application-extension:opener",autoStart:!0,requires:[a.IDocumentManager,N,R.IKernelSpecManager],activate:async(e,t)=>{if(!F())return;const o=new URLSearchParams(window.location.search).get("path");if(o){const s=t.openOrReveal(o,"specta");s&&e.shell.add(s,"main")}else{const o=x({docManager:t});e.shell.add(o,"main",{rank:100}),b()}}};var T=o(602);class E{async render(e){const{host:t,items:o,readyCallback:s}=e;for(const e of o){const o=e.cellOutput.node,s=e.info.cellModel,i=e.info;"code"===(null==s?void 0:s.cell_type)?o.childNodes.length>0&&(i.hidden||t.addWidget(e)):i.hidden||t.addWidget(e)}await s()}}class I{constructor(){this._registry=new Map,this._layoutAdded=new T.Signal(this),this._selectedLayoutChanged=new T.Signal(this);const e=new E;this._registry=new Map,this._registry.set("default",e),this._selectedLayout={name:"default",layout:e}}get layoutAdded(){return this._layoutAdded}get selectedLayout(){return this._selectedLayout}get selectedLayoutChanged(){return this._selectedLayoutChanged}get(e){return this._registry.get(e)}setSelectedLayout(e){if(!this._registry.has(e))throw new Error(`Layout with name ${e} does not exist`);this._selectedLayout={name:e,layout:this._registry.get(e)}}register(e,t){if(this._registry.has(e))throw new Error(`Layout with name ${e} already exists`);this._registry.set(e,t),this._layoutAdded.emit(e)}allLayouts(){return Array.from(this._registry.keys())}}const M=[W,P,{id:"specta:layout-registry",autoStart:!0,provides:L,activate:e=>new I}]}}]);
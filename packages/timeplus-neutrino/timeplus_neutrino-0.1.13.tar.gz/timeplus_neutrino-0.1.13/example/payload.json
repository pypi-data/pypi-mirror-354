{"sql":"with pipeline as (\nselect debezium_payload_extraction(\n    $${\n\t\"schema\": {\n\t\t\"type\": \"struct\",\n\t\t\"fields\": [\n\t\t\t{\n\t\t\t\t\"type\": \"string\",\n\t\t\t\t\"optional\": true,\n\t\t\t\t\"name\": \"io.debezium.data.Json\",\n\t\t\t\t\"version\": 1,\n\t\t\t\t\"field\": \"before\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"string\",\n\t\t\t\t\"optional\": true,\n\t\t\t\t\"name\": \"io.debezium.data.Json\",\n\t\t\t\t\"version\": 1,\n\t\t\t\t\"field\": \"after\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"struct\",\n\t\t\t\t\"fields\": [\n\t\t\t\t\t{\n\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\t\"optional\": false\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"optional\": true,\n\t\t\t\t\t\t\"field\": \"removedFields\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"optional\": true,\n\t\t\t\t\t\t\"name\": \"io.debezium.data.Json\",\n\t\t\t\t\t\t\"version\": 1,\n\t\t\t\t\t\t\"field\": \"updatedFields\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\"type\": \"struct\",\n\t\t\t\t\t\t\t\"fields\": [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\t\t\t\"optional\": false,\n\t\t\t\t\t\t\t\t\t\"field\": \"field\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\"type\": \"int32\",\n\t\t\t\t\t\t\t\t\t\"optional\": false,\n\t\t\t\t\t\t\t\t\t\"field\": \"size\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\"optional\": false,\n\t\t\t\t\t\t\t\"name\": \"io.debezium.connector.mongodb.changestream.truncatedarray\",\n\t\t\t\t\t\t\t\"version\": 1\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"optional\": true,\n\t\t\t\t\t\t\"field\": \"truncatedArrays\"\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\t\"optional\": true,\n\t\t\t\t\"name\": \"io.debezium.connector.mongodb.changestream.updatedescription\",\n\t\t\t\t\"version\": 1,\n\t\t\t\t\"field\": \"updateDescription\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"struct\",\n\t\t\t\t\"fields\": [\n\t\t\t\t\t{\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"optional\": false,\n\t\t\t\t\t\t\"field\": \"version\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"optional\": false,\n\t\t\t\t\t\t\"field\": \"connector\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"optional\": false,\n\t\t\t\t\t\t\"field\": \"name\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"type\": \"int64\",\n\t\t\t\t\t\t\"optional\": false,\n\t\t\t\t\t\t\"field\": \"ts_ms\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"optional\": true,\n\t\t\t\t\t\t\"name\": \"io.debezium.data.Enum\",\n\t\t\t\t\t\t\"version\": 1,\n\t\t\t\t\t\t\"parameters\": {\n\t\t\t\t\t\t\t\"allowed\": \"true,first,first_in_data_collection,last_in_data_collection,last,false,incremental\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"default\": \"false\",\n\t\t\t\t\t\t\"field\": \"snapshot\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"optional\": false,\n\t\t\t\t\t\t\"field\": \"db\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"optional\": true,\n\t\t\t\t\t\t\"field\": \"sequence\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"type\": \"int64\",\n\t\t\t\t\t\t\"optional\": true,\n\t\t\t\t\t\t\"field\": \"ts_us\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"type\": \"int64\",\n\t\t\t\t\t\t\"optional\": true,\n\t\t\t\t\t\t\"field\": \"ts_ns\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"optional\": false,\n\t\t\t\t\t\t\"field\": \"collection\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"type\": \"int32\",\n\t\t\t\t\t\t\"optional\": false,\n\t\t\t\t\t\t\"field\": \"ord\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"optional\": true,\n\t\t\t\t\t\t\"field\": \"lsid\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"type\": \"int64\",\n\t\t\t\t\t\t\"optional\": true,\n\t\t\t\t\t\t\"field\": \"txnNumber\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"type\": \"int64\",\n\t\t\t\t\t\t\"optional\": true,\n\t\t\t\t\t\t\"field\": \"wallTime\"\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\t\"optional\": false,\n\t\t\t\t\"name\": \"io.debezium.connector.mongo.Source\",\n\t\t\t\t\"field\": \"source\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"string\",\n\t\t\t\t\"optional\": true,\n\t\t\t\t\"field\": \"op\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"int64\",\n\t\t\t\t\"optional\": true,\n\t\t\t\t\"field\": \"ts_ms\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"struct\",\n\t\t\t\t\"fields\": [\n\t\t\t\t\t{\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"optional\": false,\n\t\t\t\t\t\t\"field\": \"id\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"type\": \"int64\",\n\t\t\t\t\t\t\"optional\": false,\n\t\t\t\t\t\t\"field\": \"total_order\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"type\": \"int64\",\n\t\t\t\t\t\t\"optional\": false,\n\t\t\t\t\t\t\"field\": \"data_collection_order\"\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\t\"optional\": true,\n\t\t\t\t\"name\": \"event.block\",\n\t\t\t\t\"version\": 1,\n\t\t\t\t\"field\": \"transaction\"\n\t\t\t}\n\t\t],\n\t\t\"optional\": false,\n\t\t\"name\": \"mongodb.lumi_data.unstructured_data.Envelope\"\n\t},\n\t\"payload\": {\n\t\t\"before\": null,\n\t\t\"after\": \"{\\\"_id\\\": {\\\"$oid\\\": \\\"67c1f7612964e981957b187c\\\"},\\\"customer_id\\\": 199,\\\"raw_data\\\": {\\\"transaction_history\\\": [{\\\"date\\\": {\\\"$date\\\": 1736121600000},\\\"amount\\\": 538.57},{\\\"date\\\": {\\\"$date\\\": 1740441600000},\\\"amount\\\": 70.97},{\\\"date\\\": {\\\"$date\\\": 1739750400000},\\\"amount\\\": 356.52},{\\\"date\\\": {\\\"$date\\\": 1736294400000},\\\"amount\\\": 884.05},{\\\"date\\\": {\\\"$date\\\": 1735948800000},\\\"amount\\\": 988.7},{\\\"date\\\": {\\\"$date\\\": 1739750400000},\\\"amount\\\": 165.18},{\\\"date\\\": {\\\"$date\\\": 1738886400000},\\\"amount\\\": 970.24}],\\\"social_media_activity\\\": {\\\"platform\\\": \\\"Twitter\\\",\\\"activity_score\\\": 8},\\\"miscellaneous\\\": {\\\"notes\\\": \\\"Training challenge field current season enough south.\\\",\\\"risk_flags\\\": \\\"Low\\\"}}}\",\n\t\t\"updateDescription\": null,\n\t\t\"source\": {\n\t\t\t\"version\": \"3.0.6.Final\",\n\t\t\t\"connector\": \"mongodb\",\n\t\t\t\"name\": \"mongodb\",\n\t\t\t\"ts_ms\": 0,\n\t\t\t\"snapshot\": \"true\",\n\t\t\t\"db\": \"lumi_data\",\n\t\t\t\"sequence\": null,\n\t\t\t\"ts_us\": 0,\n\t\t\t\"ts_ns\": 0,\n\t\t\t\"collection\": \"unstructured_data\",\n\t\t\t\"ord\": -1,\n\t\t\t\"lsid\": null,\n\t\t\t\"txnNumber\": null,\n\t\t\t\"wallTime\": null\n\t\t},\n\t\t\"op\": \"r\",\n\t\t\"ts_ms\": 1740765066949,\n\t\t\"transaction\": false\n\t}\n}\n    $$, 'kafka_cdc_postgres_customers', 'customers'\n) as p\n)\nselect p:target_stream_ddl, p:extraction_mv_ddl from pipeline"}
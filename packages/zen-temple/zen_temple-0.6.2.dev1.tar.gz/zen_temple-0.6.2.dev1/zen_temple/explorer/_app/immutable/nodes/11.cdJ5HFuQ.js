import"../chunks/CWj6FrbW.js";import{o as Le}from"../chunks/CTIMrZMQ.js";import{p as Ue,s as f,a as D,u as H,b as p,f as F,c as Ve,g as e,d as v,e as ne,h as o,t as qe,n as we,j as J,r as K,l as Ge}from"../chunks/BUw4_zXp.js";import{s as He}from"../chunks/CaQtvwPl.js";import{i as T}from"../chunks/DZ2ir7Ph.js";import{g as Q,u as Je,e as Ke,i as Qe}from"../chunks/CGkOqb8s.js";import{f as y,a as m,c as ye}from"../chunks/CSp5jfsq.js";import{s as xe}from"../chunks/b0kE6qlU.js";import{F as We,a as W,S as Xe,b as Se,r as Ze,c as je,t as et,f as tt}from"../chunks/DAT8a9Ut.js";import{A as te,T as ie}from"../chunks/BwpfFw4c.js";import{B as rt}from"../chunks/D-uQzuoh.js";import{D as st}from"../chunks/7t7HpQMM.js";import{g as Pe}from"../chunks/CqS7hfz2.js";var ot=y('<label class="col-6 col-md-2 fw-medium fs-5">Subdivision</label> <div class="col-4 col-md-2"><!></div>',1),nt=y('<div class="row align-items-baseline"><label class="col-6 col-md-3 fw-medium fs-4"> </label> <div class="col-4 col-md-3"><!></div> <!></div>'),it=y("<!> <!>",1),at=y("<!> <!> <!>",1),lt=y("<!> <!> <!> <!>",1),dt=y("<!> <!>",1),ut=y('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),_t=y("<div></div>"),ct=y('<div class="text-center">No carriers with this selection.</div>'),vt=y('<div class="text-center">No data with this selection.</div>'),ft=y('<h1 class="mt-2 mb-4">The Transition Pathway &ndash; Production</h1> <!> <div class="mt-4"><!></div>',1);function Ct(Oe,Ne){Ue(Ne,!0);let B=f(null),U=f(D([])),V=f(D([])),ae=f(D([])),Y=D([{id:"conversion",title:"Conversion",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_conversion_output",positive_label:"Conversion output",negative:"flow_conversion_input",negative_label:"Conversion input"},{id:"storage",title:"Storage",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_storage_discharge",positive_label:"Storage discharge",positive_suffix:" (discharge)",negative:"flow_storage_charge",negative_label:"Storage charge",negative_suffix:" (charge)"},{id:"import_export",title:"Import/Export",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"flow_import",positive_label:"Import",negative:"flow_export",negative_label:"Export"},{id:"demand_shed_demand",title:"Demand/Shed Demand",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"shed_demand",positive_label:"Shed Demand",negative:"demand",negative_label:"Demand"}]),n=f(null),_=f(null),j=f(D([])),P=f(D([])),le=v(()=>[...e(j),...e(P)]),re=f(!1),z=f(D([])),L=f(D([])),x=f(!1),S=f(!1),Ce=v(()=>{var r;if(!((r=e(n))!=null&&r.solution_name)||!e(_))return"";let t=e(n).solution_name.split(".");return[t[(t==null?void 0:t.length)-1],e(n).scenario_name,e(_)].join("_")}),de=f(D([])),ue=v(()=>{let t=null;return!t&&e(_)&&(t=e(de).find(r=>r.carrier==e(_))),t&&(t[0]||t.units)||""});const _e=7;let De=v(()=>e(L).map(t=>t.toString())),Ee=v(()=>({responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`Production [${e(ue)}]`}}},plugins:{tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue} ${e(ue)}`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}})),M=v(()=>e(n)?e(n).detail.system.set_carriers.slice().sort():[]),X=v(()=>e(n)?Ze(Object.entries(e(n).detail.carriers_input).concat(Object.entries(e(n).detail.carriers_output)).filter(t=>e(_)&&t[1].includes(e(_))).map(t=>t[0])):[]),Z=v(()=>e(n)?e(n).detail.system.set_storage_technologies.filter(t=>{var r;return((r=e(n))==null?void 0:r.detail.reference_carrier[t])==e(_)}):[]);H(()=>{e(M),ne(()=>{(e(M).length>=1&&!e(_)||!e(M).includes(e(_)))&&o(_,e(M)[0],!0)})}),H(()=>{e(X),ne(()=>{e(X).length>0&&e(j).length==0&&o(j,e(X),!0)})}),H(()=>{e(Z),ne(()=>{e(Z).length>0&&e(P).length==0&&o(P,e(Z),!0)})}),H(()=>{o(z,e(V),!0)}),Le(()=>{var t,r;o(_,Q("carrier")||null,!0),Y.forEach(l=>{let s=Q(l.id+"_show"),a=Q(l.id+"_subdivision");l.show=s!==null?s==="true":l.show,l.subdivision=a!==null?a==="true":l.subdivision}),o(j,((t=Q("conversion_technologies"))==null?void 0:t.split(","))||[],!0),o(P,((r=Q("storage_technologies"))==null?void 0:r.split(","))||[],!0)}),H(()=>{e(_),Y.forEach(t=>{t.show,t.subdivision}),e(j),e(P),qe().then(()=>{let t={carrier:e(_),conversion_technologies:e(j).join(","),storage_technologies:e(P).join(",")};Y.forEach(r=>{t[r.id+"_show"]=r.show?"true":"false",t[r.id+"_subdivision"]=r.subdivision?"true":"false"}),Je(t)})});function $e(){o(L,e(U),!0),o(z,e(V),!0)}async function ke(){$e(),await Fe()}function Ie(){o(j,[],!0),o(P,[],!0)}async function Fe(){var r,l;if(e(n)===null)return;o(S,!0),o(B,null);const t=await Promise.all(Y.flatMap(s=>{var a,u;return[je(e(n).solution_name,Pe(s.positive,(a=e(n))==null?void 0:a.version),e(n).scenario_name,e(n).detail.system.reference_year,e(n).detail.system.interval_between_years),je(e(n).solution_name,Pe(s.negative,(u=e(n))==null?void 0:u.version),e(n).scenario_name,e(n).detail.system.reference_year,e(n).detail.system.interval_between_years)]}));o(B,t.map(s=>!s||!s.data?null:s.data),!0),(l=(r=t[_e])==null?void 0:r.unit)!=null&&l.data&&o(de,t[_e].unit.data,!0),o(S,!1)}function Te(t,r,l){return r.subdivision?t:Object.entries(t.reduce((s,a)=>{const u=a.node,g=a.technology;if(l&&!l.includes(g))return s;let h=Object.fromEntries(Object.entries(a).filter(([d])=>!isNaN(Number(d))).map(([d,i])=>[d,Number(i)]));return s[u]=s[u]||{technology:r.title,data:{}},s[u].data=Object.fromEntries(Object.entries(h).map(([d,i])=>[d,(i||0)+(s[u].data[d]||0)])),s},{})).map(([s,a])=>({...a.data,technology:a.technology,node:s}))}function ce(t,r,l,s,a,u){if(t===null)return[];let g={technology:[...e(le),r.title]},h={node:e(z)};const d=Te(t.data.filter(A=>A.carrier===void 0||A.carrier==e(_)),r,r.filter_by_technologies?e(le):void 0);let i=tt(d,g,h,l,e(re),void 0,a||"");return u!==void 0&&(i=i.map(u)),!r.subdivision&&i.length>0&&(i[0].label=s),i}let ve=v(()=>{if(e(z).length==0||e(L).length==0||!e(B)||e(B).length==0)return[];let t=e(U).filter(r=>!e(L).includes(r));return Y.flatMap((r,l)=>{if(!r.show||!e(B))return[];let s=ce(e(B)[2*l],r,t,r.positive_label,r.positive_suffix,void 0),a=ce(e(B)[2*l+1],r,t,r.negative_label,r.negative_suffix,u=>({...u,data:Object.fromEntries(Object.entries(u.data).map(([g,h])=>[g,-h]))}));return[...s,...a]})});var fe=ft(),ge=p(F(fe),2);We(ge,{children:(t,r)=>{var l=dt(),s=F(l);W(s,{title:"Solution Selection",children:(g,h)=>{const d=v(()=>e(S)||e(x));Xe(g,{solution_selected:ke,get disabled(){return e(d)},get selected_solution(){return e(n)},set selected_solution(i){o(n,i,!0)},get years(){return e(U)},set years(i){o(U,i,!0)},get nodes(){return e(V)},set nodes(i){o(V,i,!0)},get edges(){return e(ae)},set edges(i){o(ae,i,!0)},get loading(){return e(x)},set loading(i){o(x,i,!0)}})}});var a=p(s,2);{var u=g=>{var h=lt(),d=F(h);W(d,{title:"Carrier Selection",children:(b,ee)=>{var O=ye(),N=F(O);{var $=c=>{Se(c,{label:"Carrier",content:(w,k=we)=>{const I=v(()=>et(e(M))),R=v(()=>e(x)||e(S));st(w,{get formId(){return k()},get options(){return e(I)},get disabled(){return e(R)},onUpdate:Ie,get value(){return e(_)},set value(q){o(_,q,!0)}})}})};T(N,c=>{e(M).length>0&&c($)})}m(b,O)}});var i=p(d,2);W(i,{title:"Production Component Selection",children:(b,ee)=>{var O=ye(),N=F(O);Ke(N,17,()=>Y,Qe,($,c,C)=>{var w=nt(),k=J(w);xe(k,"for","variables"+C);var I=J(k,!0);K(k);var R=p(k,2),q=J(R);ie(q,{formId:"variables"+C,get value(){return e(c).show},set value(G){e(c).show=G}}),K(R);var oe=p(R,2);{var Re=G=>{var pe=ot(),he=F(pe);xe(he,"for","subdivision"+C);var be=p(he,2),Ye=J(be);ie(Ye,{formId:"subdivision"+C,get value(){return e(c).subdivision},set value(ze){e(c).subdivision=ze}}),K(be),m(G,pe)};T(oe,G=>{e(c).show&&e(c).show_subdivision&&G(Re)})}K(w),Ge(()=>He(I,e(c).title)),m($,w)}),m(b,O)}});var A=p(i,2);W(A,{title:"Technology Selection",children:(b,ee)=>{var O=it(),N=F(O);const $=v(()=>e(x)||e(S));te(N,{label:"Conversion",get elements(){return e(X)},get disabled(){return e($)},get value(){return e(j)},set value(w){o(j,w,!0)}});var c=p(N,2);const C=v(()=>e(x)||e(S));te(c,{label:"Storage",get elements(){return e(Z)},get disabled(){return e(C)},get value(){return e(P)},set value(w){o(P,w,!0)}}),m(b,O)}});var se=p(A,2);{var E=b=>{W(b,{title:"Data Selection",children:(ee,O)=>{var N=at(),$=F(N);Se($,{label:"Normalization",content:(R,q=we)=>{ie(R,{get formId(){return q()},get value(){return e(re)},set value(oe){o(re,oe,!0)}})}});var c=p($,2);const C=v(()=>e(x)||e(S));te(c,{label:"Nodes",get elements(){return e(V)},get disabled(){return e(C)},get value(){return e(z)},set value(I){o(z,I,!0)}});var w=p(c,2);const k=v(()=>e(x)||e(S));te(w,{label:"Years",get elements(){return e(U)},get disabled(){return e(k)},get value(){return e(L)},set value(I){o(L,I,!0)}}),m(ee,N)}})};T(se,b=>{!e(S)&&e(_)!=null&&b(E)})}m(g,h)};T(a,g=>{!e(x)&&e(n)&&g(u)})}m(t,l)}});var me=p(ge,2),Be=J(me);{var Me=t=>{var r=ut();m(t,r)},Ae=(t,r)=>{{var l=a=>{var u=_t();m(a,u)},s=(a,u)=>{{var g=d=>{var i=ct();m(d,i)},h=(d,i)=>{{var A=E=>{var b=vt();m(E,b)},se=E=>{rt(E,{type:"bar",get options(){return e(Ee)},get labels(){return e(De)},get datasets(){return e(ve)},get plot_name(){return e(Ce)}})};T(d,E=>{e(ve).length==0?E(A):E(se,!1)},i)}};T(a,d=>{e(M).length==0?d(g):d(h,!1)},u)}};T(t,a=>{e(n)==null?a(l):a(s,!1)},r)}};T(Be,t=>{e(x)||e(S)?t(Me):t(Ae,!1)})}K(me),m(Oe,fe),Ve()}export{Ct as component};

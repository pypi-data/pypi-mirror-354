import"../chunks/CWj6FrbW.js";import{o as We}from"../chunks/CTIMrZMQ.js";import{p as Xe,s as u,a as S,u as R,b as m,f as Y,c as Ze,g as e,d as x,e as se,h as r,t as et,n as tt,j as oe,r as ne,l as rt}from"../chunks/BUw4_zXp.js";import{s as at}from"../chunks/CaQtvwPl.js";import{i as y}from"../chunks/DZ2ir7Ph.js";import{g as G,u as st,e as ot,i as nt}from"../chunks/CGkOqb8s.js";import{f as D,a as j,c as Ee}from"../chunks/CSp5jfsq.js";import{s as De}from"../chunks/b0kE6qlU.js";import{F as lt,a as fe,S as it,b as ut,r as ge,t as dt,c as ct,f as Fe}from"../chunks/DAT8a9Ut.js";import{A as H,T as $e}from"../chunks/BwpfFw4c.js";import{R as _t}from"../chunks/DFTcpuzr.js";import{B as vt}from"../chunks/D-uQzuoh.js";import{g as ft}from"../chunks/CqS7hfz2.js";var gt=D('<label class="col-6 col-md-2">Subdivision</label> <div class="col-4 col-md-2"><!></div>',1),ht=D('<div class="row mb-2"><label class="col-6 col-md-3 fw-medium fs-4"> </label> <div class="col-4 col-md-2"><!></div> <!></div>'),mt=D("<h3>Technologies (for Capex/Opex)</h3> <!> <!> <!> <!> <!>",1),pt=D("<!> <!> <!>",1),bt=D("<!> <!> <!>",1),xt=D("<!> <!>",1),yt=D('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),wt=D('<div class="text-center">No data with this selection.</div>'),Ct=D('<div class="text-center">Please select at least one year.</div>'),St=D('<h1 class="mt-2 mb-4">The Transition Pathway &ndash; Costs</h1> <!> <div class="mt-4"><!></div>',1);function It(Le,Me){Xe(Me,!0);const i="Techology / Carrier",be=" (Capex)",xe=" (Opex)",Ae="Capex",Be="Opex",Ie="Carrier",Re="Shed Demand";let ye=u(S([])),we=u(S([])),Q=u(S([]));const Ce=["Location",i];let U=u(S([])),s=u(null),J=u(S([])),Ye=!1,F=u(S([])),$=u(S([])),L=u(S([])),M=u(S([])),A=u(S([])),le=u("Location"),ie=u(null),ue=u(null),W=u(null),de=u(null),ce=u(null),_e=u(S({})),X=u(!1),Z=u(!1),P=S({capex:{title:"Capex",show:!0,subdivision:!1,show_subdivision:!0,label:Ae},opex:{title:"Opex",show:!0,subdivision:!1,show_subdivision:!0,label:Be},carrier:{title:"Carrier",show:!0,subdivision:!1,show_subdivision:!0,label:Ie},shed_demand:{title:"Shed Demand",show:!0,subdivision:!1,show_subdivision:!0,label:Re},carbon_emission:{title:"Carbon Emissions",show:!0,subdivision:!1,show_subdivision:!1}}),ze=x(()=>{if(e(s)==null)return"";let t=e(s).solution_name.split(".");return[t[t.length-1],e(s).scenario_name,"costs"].join("_")}),Ne=x(()=>e(N).length>0?e(_e)[e(N)[0]]||"":e(z).length>0?e(_e)[e(z)[0]]||"":e(V).length>0&&e(_e)[e(V)[0]]||""),Ve=x(()=>({responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`Costs [${e(Ne)}]`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}})),he=x(()=>!e(W)||!e(de)?new Set:new Set([...e(W).data.map(t=>t[i])||[],...e(de).data.map(t=>t[i])||[]])),z=x(()=>e(s)==null?[]:e(s).detail.system.set_transport_technologies.filter(t=>e(he).has(t))),N=x(()=>e(s)==null?[]:ge(e(s).detail.system.set_conversion_technologies.filter(t=>e(he).has(t)))),V=x(()=>e(s)==null?[]:ge(e(s).detail.system.set_storage_technologies.filter(t=>e(he).has(t)))),ee=x(()=>{var t;return e(s)==null||!((t=e(ue))!=null&&t.data)?[]:ge(e(ue).data.map(n=>n[i]))}),te=x(()=>{var t;return e(s)==null||!((t=e(ce))!=null&&t.data)?[]:ge(e(ce).data.map(n=>n[i]))}),me=x(()=>e(s)==null?[]:Object.keys(e(s).detail.edges).concat(e(s).detail.system.set_nodes));R(()=>{e(z),se(()=>{e(z).length>0&&e(L).length===0&&r(L,e(z),!0)})}),R(()=>{e(N),se(()=>{e(N).length>0&&e(A).length===0&&r(A,e(N),!0)})}),R(()=>{e(V),se(()=>{e(V).length>0&&e(M).length===0&&r(M,e(V),!0)})}),R(()=>{e(ee),se(()=>{e(ee).length>0&&e(F).length===0&&r(F,e(ee),!0)})}),R(()=>{e(te),se(()=>{e(te).length>0&&e($).length===0&&r($,e(te),!0)})}),R(()=>{r(U,e(me),!0)}),R(()=>{r(J,e(Q),!0)}),We(()=>{var t,n,_,c,f;Object.entries(P).forEach(([p,o])=>{let b=G(p+"_show"),v=G(p+"_subdivision");o.show=b!==null?b==="true":o.show,o.subdivision=v!==null?v==="true":o.subdivision}),r(L,((t=G("transport_technologies"))==null?void 0:t.split(","))||[],!0),r(A,((n=G("conversion_technologies"))==null?void 0:n.split(","))||[],!0),r(M,((_=G("storage_technologies"))==null?void 0:_.split(","))||[],!0),r(F,((c=G("cost_carriers"))==null?void 0:c.split(","))||[],!0),r($,((f=G("demand_carriers"))==null?void 0:f.split(","))||[],!0)}),R(()=>{e(L),e(A),e(M),e(F),e($),Object.values(P).forEach(t=>{t.show,t.subdivision}),et().then(()=>{let t={transport_technologies:e(L).join(","),conversion_technologies:e(A).join(","),storage_technologies:e(M).join(","),cost_carriers:e(F).join(","),demand_carriers:e($).join(",")};Object.entries(P).forEach(([n,_])=>{t[n+"_show"]=_.show?"true":"false",t[n+"_subdivision"]=_.subdivision?"true":"false"}),st(t)})});function qe(){e(s)!=null&&Ge()}function ve(t,n){return!t||!t.data||(t.data=t.data.map(_=>n.reduce((c,[f,p])=>{if(!(f in _))return c;const{[f]:o,...b}=c;return{...b,[p]:o}},_))),t}async function Ge(){var p;if(e(s)==null)return;r(Z,!0);let[t,n,_,c,f]=await Promise.all(["capex_yearly","opex_yearly","cost_carbon_emissions_total","cost_carrier","cost_shed_demand"].map(o=>ct(e(s).solution_name,ft(o,e(s).version),e(s).scenario_name,e(s).detail.system.reference_year,e(s).detail.system.interval_between_years)));r(W,ve(t.data,[["technology",i]]),!0),r(de,ve(n.data,[["technology",i]]),!0),r(ie,_.data,!0),r(ue,ve(c.data,[["node","location"],["carrier",i]]),!0),r(ce,ve(f.data,[["node","location"],["carrier",i]]),!0),(p=t.unit)!=null&&p.data&&r(_e,Object.fromEntries(t.unit.data.map(o=>[o.technology,o[0]||o.units])),!0),r(Z,!1)}let pe=x(()=>{var v,d,K,k,w;let t=[...e(A).concat(e(M)).concat(e(L)).flatMap(a=>[a+be,a+xe]),...e(F),...e($)];const n=[{key:"capex",data:(((v=e(W))==null?void 0:v.data)||[]).map(a=>({...a,[i]:a[i]+be}))},{key:"opex",data:(((d=e(de))==null?void 0:d.data)||[]).map(a=>({...a,[i]:a[i]+xe}))},{key:"carrier",data:(((K=e(ue))==null?void 0:K.data)||[]).filter(a=>e(F).includes(a[i]))},{key:"shed_demand",data:(((k=e(ce))==null?void 0:k.data)||[]).filter(a=>e($).includes(a[i]))||null}];let _=n.flatMap(({key:a,data:O})=>!P[a].show||!O?[]:P[a].subdivision?O:Fe(O,{location:e(U)},{[i]:t},[],!1).map(T=>(T.data.location=T.label,T.data[i]=P[a].label,T.data)));n.forEach(({key:a})=>{P[a].label&&t.push(P[a].label)});let c,f;e(le)==i?(c={location:e(me)},f={[i]:t}):(c={[i]:t},f={location:e(U)});let p=e(Q).filter(a=>!e(J).includes(a)),o=Fe(_,c,f,p,Ye),b=[];return(w=e(ie))!=null&&w.data&&e(ie).data.length>0&&P.carbon_emission.show&&(b=[{label:"Total Carbon Costs",data:e(ie).data[0],type:"bar"}]),[...o,...b]});var Se=St(),je=m(Y(Se),2);lt(je,{children:(t,n)=>{var _=xt(),c=Y(_);fe(c,{title:"Solution Selection",children:(o,b)=>{const v=x(()=>e(Z)||e(X));it(o,{solution_selected:qe,get disabled(){return e(v)},get carriers(){return e(ye)},set carriers(d){r(ye,d,!0)},get nodes(){return e(we)},set nodes(d){r(we,d,!0)},get years(){return e(Q)},set years(d){r(Q,d,!0)},get selected_solution(){return e(s)},set selected_solution(d){r(s,d,!0)},get loading(){return e(X)},set loading(d){r(X,d,!0)}})}});var f=m(c,2);{var p=o=>{var b=bt(),v=Y(b);fe(v,{title:"Cost Selection",children:(k,w)=>{var a=Ee(),O=Y(a);ot(O,17,()=>Object.values(P),nt,(T,C,B)=>{var I=ht(),g=oe(I);De(g,"for","variables"+B);var E=oe(g,!0);ne(g);var q=m(g,2),re=oe(q);$e(re,{formId:"variables"+B,get value(){return e(C).show},set value(h){e(C).show=h}}),ne(q);var ae=m(q,2);{var l=h=>{var Te=gt(),Pe=Y(Te);De(Pe,"for","subdivision"+B);var ke=m(Pe,2),Qe=oe(ke);$e(Qe,{formId:"subdivision"+B,get value(){return e(C).subdivision},set value(Ue){e(C).subdivision=Ue}}),ne(ke),j(h,Te)};y(ae,h=>{e(C).show&&e(C).show_subdivision&&h(l)})}ne(I),rt(()=>at(E,e(C).title)),j(T,I)}),j(k,a)}});var d=m(v,2);fe(d,{title:"Technology Selection",children:(k,w)=>{var a=mt(),O=m(Y(a),2);{var T=l=>{H(l,{label:"Transport",get elements(){return e(z)},get value(){return e(L)},set value(h){r(L,h,!0)}})};y(O,l=>{e(z).length>0&&l(T)})}var C=m(O,2);{var B=l=>{H(l,{label:"Storage",get elements(){return e(V)},get value(){return e(M)},set value(h){r(M,h,!0)}})};y(C,l=>{e(V).length>0&&l(B)})}var I=m(C,2);{var g=l=>{H(l,{label:"Conversion",get elements(){return e(N)},get value(){return e(A)},set value(h){r(A,h,!0)}})};y(I,l=>{e(N).length>0&&l(g)})}var E=m(I,2);{var q=l=>{H(l,{label:"Cost of Carrier",get elements(){return e(ee)},get value(){return e(F)},set value(h){r(F,h,!0)}})};y(E,l=>{e(ee).length>0&&l(q)})}var re=m(E,2);{var ae=l=>{H(l,{label:"Shed Demand",get elements(){return e(te)},get value(){return e($)},set value(h){r($,h,!0)}})};y(re,l=>{e(te).length>0&&l(ae)})}j(k,a)}});var K=m(d,2);fe(K,{title:"Data Selection",children:(k,w)=>{var a=pt(),O=Y(a);ut(O,{label:"Aggregation",content:(E,q=tt)=>{const re=x(()=>dt(Ce));_t(E,{get formId(){return q()},get options(){return e(re)},get value(){return e(le)},set value(ae){r(le,ae,!0)}})}});var T=m(O,2);{var C=g=>{H(g,{label:"Location",get elements(){return e(me)},get value(){return e(U)},set value(E){r(U,E,!0)}})};y(T,g=>{e(le)==Ce[1]&&g(C)})}var B=m(T,2);{var I=g=>{H(g,{label:"Year",get elements(){return e(Q)},get value(){return e(J)},set value(E){r(J,E,!0)}})};y(B,g=>{e(J)&&g(I)})}j(k,a)}}),j(o,b)};y(f,o=>{!e(Z)&&!e(X)&&e(W)&&e(s)!=null&&o(p)})}j(t,_)}});var Oe=m(je,2),He=oe(Oe);{var Je=t=>{var n=yt();j(t,n)},Ke=(t,n)=>{{var _=c=>{var f=Ee(),p=Y(f);{var o=v=>{var d=wt();j(v,d)},b=(v,d)=>{{var K=w=>{var a=Ct();j(w,a)},k=w=>{vt(w,{type:"line",get options(){return e(Ve)},get datasets(){return e(pe)},get plot_name(){return e(ze)}})};y(v,w=>{e(J).length==0?w(K):w(k,!1)},d)}};y(p,v=>{e(pe).length==0||e(pe)[0].data.length==0?v(o):v(b,!1)})}j(c,f)};y(t,c=>{e(s)!=null&&c(_)},n)}};y(He,t=>{e(X)||e(Z)?t(Je):t(Ke,!1)})}ne(Oe),j(Le,Se),Ze()}export{It as component};

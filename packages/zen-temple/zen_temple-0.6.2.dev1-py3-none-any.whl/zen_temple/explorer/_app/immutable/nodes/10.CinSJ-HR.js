import"../chunks/CWj6FrbW.js";import{o as Ve}from"../chunks/CTIMrZMQ.js";import{p as qe,s as o,a as P,u as M,b as h,f as O,c as Ge,h as n,g as e,d as u,t as He,n as Q,j as Je,r as Ke,i as Qe}from"../chunks/BUw4_zXp.js";import{f as x,a as y}from"../chunks/CSp5jfsq.js";import{i as p}from"../chunks/DZ2ir7Ph.js";import{F as Ue,a as de,S as We,b as U,r as _e,c as Xe,t as Ze,f as Ae}from"../chunks/DAT8a9Ut.js";import{T as Se,A as W}from"../chunks/BwpfFw4c.js";import{R as Pe}from"../chunks/DFTcpuzr.js";import{B as et}from"../chunks/D-uQzuoh.js";import{g as V}from"../chunks/CqS7hfz2.js";import{g as we,u as tt}from"../chunks/CGkOqb8s.js";var at=x("<!> <!>",1),rt=x("<!> <!>",1),nt=x("<!> <!> <!>",1),lt=x("<!> <!>",1),ot=x("<!> <!> <!>",1),st=x('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),it=x('<div class="text-center">No solution selected</div>'),ut=x('<div class="text-center">No data with this selection.</div>'),ct=x('<h1 class="mt-2 mb-4">The Transition Pathway &ndash; Emissions</h1> <!> <div class="mt-4"><!></div>',1);function At(Ce,Ee){qe(Ee,!0);let w=o(null),d=o(null),X=o(null),Z=o(null),ee=o(null),C=o(null),ve=o(P({})),Te=P({}),E=o(!1),k=o(!1),me=o(P([])),T=o(P([]));const je=[{label:"Location",value:"location"},{label:"Technology & Carrier",value:"technology_carrier"}],ke=["Annual","Cumulative"];let l=o(null),_=o(!0),b=o("Annual"),F=o(P([])),q=o(P([])),R=o("location"),G=o(!1),H=o(P([])),$=o(P([])),Fe=u(()=>{var r;if(!((r=e(l))!=null&&r.solution_name))return"";let t=e(l).solution_name.split(".");return[t[t.length-1],e(l).scenario_name,e(te)].join("_")}),Be=u(()=>e(F).length==0?"":e(_)?Object.values(e(ve))[0]||"":Te[e(F)[0]]||""),Ie=u(()=>({responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`Emissions [${e(Be)}]`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}})),te=u(()=>{var t,r,a;return e(_)?V("carbon_emissions_carrier",(t=e(l))==null?void 0:t.version):e(b)=="Annual"?V("carbon_emissions_annual",(r=e(l))==null?void 0:r.version):V("carbon_emissions_cumulative",(a=e(l))==null?void 0:a.version)}),J=u(()=>{var t;return(t=e(w))!=null&&t.data?_e(e(w).data.data.map(r=>r.technology)):[]}),K=u(()=>{var t;return(t=e(d))!=null&&t.data?_e(e(d).data.data.map(r=>r.carrier)):[]}),ae=u(()=>{var t,r,a,s,c,m;return!((t=e(w))!=null&&t.data)&&!((r=e(d))!=null&&r.data)?[]:_e([...((s=(a=e(w))==null?void 0:a.data)==null?void 0:s.data)||[],...((m=(c=e(d))==null?void 0:c.data)==null?void 0:m.data)||[]].map(g=>g.location))});M(()=>{n(q,e(J),!0)}),M(()=>{n(F,e(K),!0)}),M(()=>{n(H,e(ae),!0)}),M(()=>{n($,e(T),!0)}),Ve(()=>{let t=we("subdivision");n(_,t!==null?t==="true":e(_),!0),n(b,we("cumulation")||e(b),!0)}),M(()=>{e(_),e(b),He().then(()=>{tt({subdivision:e(_)?"true":"false",cumulation:e(b)})})});function Le(){Ne()}async function Ne(){var t,r;e(l)!==null&&(n(k,!0),await(async a=>{var s=Qe(a,6);n(w,s[0],!0),n(d,s[1],!0),n(ee,s[2],!0),n(C,s[3],!0),n(X,s[4],!0),n(Z,s[5],!0)})(await Promise.all(["carbon_emissions_technology","carbon_emissions_carrier","carbon_emissions_annual_limit","carbon_emissions_budget","carbon_emissions_annual","carbon_emissions_cumulative"].map(a=>Xe(e(l).solution_name,V(a,e(l).version),e(l).scenario_name,e(l).detail.system.reference_year,e(l).detail.system.interval_between_years)))),(t=e(d).data)!=null&&t.data&&(e(d).data.data=e(d).data.data.map(a=>({...a,location:a.location||a.node}))),(r=e(d).unit)!=null&&r.data&&n(ve,Object.fromEntries(e(d).unit.data.map(a=>[a.carrier,a[0]||a.units])),!0),e(C).data&&e(C).data.data.length>0&&(e(C).data.data[0]=Object.fromEntries(e(T).map(a=>[a,e(C).data.data[0][e(T)[0]]]))),n(k,!1))}let ge=u(()=>e(_)?e(R)=="location"?{technology_carrier:e(J).concat(e(K))}:{location:e(ae)}:{}),fe=u(()=>e(_)?e(R)=="location"?{location:e(H)}:{technology_carrier:e(q).concat(e(F))}:{}),pe=u(()=>e(T).filter(t=>!e($).includes(t))),Oe=u(()=>{var a,s,c,m;if(e(l)===null||!((a=e(X))!=null&&a.data)||!((s=e(Z))!=null&&s.data)||!((c=e(d))!=null&&c.data)||!((m=e(w))!=null&&m.data))return[];let t;e(_)?t={data:e(d).data.data.map(g=>({...g,technology_carrier:g.carrier})).concat(e(w).data.data.map(g=>({...g,technology_carrier:g.technology}))),meta:e(d).data.meta,errors:[]}:e(b)=="Annual"?t=e(X).data:t=e(Z).data;const r=Ae(t.data,e(ge),e(fe),e(pe),e(G));return r.length==1&&(r[0].label=e(te)),r}),Re=u(()=>{var a;if(e(l)===null||e(ee)===null||e(C)===null)return[];let t=null;if(e(te)==V("carbon_emissions_annual",(a=e(l))==null?void 0:a.version)?t=e(ee).data:t=e(C).data,(t==null?void 0:t.data)==null||t.data.length==0)return[];let r=Ae(t.data,e(ge),e(fe),e(pe),e(G));return r.length==0?[]:(r[0].label=e(b)=="Annual"?"Annual Emissions Limit":"Carbon Emissions Budget",r[0].type="line",r)}),be=u(()=>e(Oe).concat(e(Re)));var he=ct(),ye=h(O(he),2);Ue(ye,{children:(t,r)=>{var a=ot(),s=O(a);de(s,{title:"Solution Selection",children:(i,B)=>{const ne=u(()=>e(k)||e(E));We(i,{get disabled(){return e(ne)},solution_selected:Le,get selected_solution(){return e(l)},set selected_solution(v){n(l,v,!0)},get nodes(){return e(me)},set nodes(v){n(me,v,!0)},get years(){return e(T)},set years(v){n(T,v,!0)},get loading(){return e(E)},set loading(v){n(E,v,!0)}})}});var c=h(s,2);{var m=i=>{de(i,{title:"Variable Selection",children:(B,ne)=>{var v=at(),z=O(v);U(z,{label:"Subdivision",content:(Y,I=Q)=>{Se(Y,{get formId(){return I()},get value(){return e(_)},set value(L){n(_,L,!0)}})}});var le=h(z,2);{var oe=f=>{U(f,{label:"Cumulation",content:(I,L=Q)=>{const se=u(()=>Ze(ke)),ie=u(()=>e(k)||e(E));Pe(I,{get formId(){return L()},get options(){return e(se)},get disabled(){return e(ie)},get value(){return e(b)},set value(ue){n(b,ue,!0)}})}})};p(le,f=>{e(_)||f(oe)})}y(B,v)}})};p(c,i=>{!e(E)&&e(l)&&i(m)})}var g=h(c,2);{var re=i=>{de(i,{title:"Data Selection",children:(B,ne)=>{var v=lt(),z=O(v);{var le=f=>{var Y=nt(),I=O(Y);U(I,{label:"Aggregation",content:(S,N=Q)=>{Pe(S,{get formId(){return N()},get options(){return je},get value(){return e(R)},set value(D){n(R,D,!0)}})}});var L=h(I,2);U(L,{label:"Normalization",content:(S,N=Q)=>{Se(S,{get formId(){return N()},get value(){return e(G)},set value(D){n(G,D,!0)}})}});var se=h(L,2);{var ie=A=>{W(A,{label:"Location",get elements(){return e(ae)},get value(){return e(H)},set value(S){n(H,S,!0)}})},ue=A=>{var S=rt(),N=O(S);{var D=j=>{W(j,{label:"Technology",get elements(){return e(J)},get value(){return e(q)},set value(ce){n(q,ce,!0)}})};p(N,j=>{e(J).length>0&&j(D)})}var De=h(N,2);{var Me=j=>{W(j,{label:"Carrier",get elements(){return e(K)},get value(){return e(F)},set value(ce){n(F,ce,!0)}})};p(De,j=>{e(K).length>0&&j(Me)})}y(A,S)};p(se,A=>{e(R)=="location"?A(ie):A(ue,!1)})}y(f,Y)};p(z,f=>{e(_)&&f(le)})}var oe=h(z,2);W(oe,{label:"Year",get elements(){return e(T)},get value(){return e($)},set value(f){n($,f,!0)}}),y(B,v)}})};p(g,i=>{!e(E)&&e(l)&&!e(k)&&i(re)})}y(t,a)}});var xe=h(ye,2),$e=Je(xe);{var ze=t=>{var r=st();y(t,r)},Ye=(t,r)=>{{var a=c=>{var m=it();y(c,m)},s=(c,m)=>{{var g=i=>{var B=ut();y(i,B)},re=i=>{et(i,{type:"bar",get options(){return e(Ie)},get datasets(){return e(be)},get plot_name(){return e(Fe)}})};p(c,i=>{e(be).length==0||e($).length==0?i(g):i(re,!1)},m)}};p(t,c=>{e(l)==null?c(a):c(s,!1)},r)}};p($e,t=>{e(E)||e(k)?t(ze):t(Ye,!1)})}Ke(xe),y(Ce,he),Ge()}export{At as component};

import"../chunks/CWj6FrbW.js";import{o as fe}from"../chunks/CTIMrZMQ.js";import{p as me,s as c,a as G,u as P,b as M,f as J,c as be,g as e,e as E,h as r,t as ve,i as he,d,n as H,j as ye,r as we}from"../chunks/BUw4_zXp.js";import{f as N,a as W}from"../chunks/CSp5jfsq.js";import{i as Q}from"../chunks/DZ2ir7Ph.js";import{F as xe,e as ke,h as Se,a as te,S as ze,b as T,t as A,f as je}from"../chunks/DAT8a9Ut.js";import{D as K}from"../chunks/7t7HpQMM.js";import{B as Ce}from"../chunks/D-uQzuoh.js";import{g as y}from"../chunks/CqS7hfz2.js";import{g as L,u as De}from"../chunks/CGkOqb8s.js";const re=["rgb(75, 192, 192)","rgb(54, 162, 235)","rgb(255, 206, 86)","rgb(153, 102, 255)","rgb(255, 159, 64)","rgb(255, 99, 132)","rgb(201, 203, 207)","rgb(220,20,60)","rgb(255,99,71)","rgb(255,69,0)","rgb(154,205,50)","rgb(0,100,0)","rgb(50,205,50)","rgb(0,139,139)","rgb(153,50,204)","rgb(255,105,180)"];let F=0;function Me(){F=0}function Ie(){F>=re.length&&(F=0);const Y=re[F];return F++,Y}var Oe=N("<!> <!> <!> <!>",1),Pe=N("<!> <!>",1),We=N('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),Fe=N('<div class="text-center">No data with this selection.</div>'),Ne=N('<h1 class="mt-2 mb-4">The Energy Balance &ndash; Nodal</h1> <!> <div class="mt-4"><!></div>',1);function Ze(Y,ne){me(ne,!0);let Z=c(null),I=c(null),f=c(!1),m=c(!1),w=c(G([])),x=c(G([])),k=c(G([]));const oe=A(["Hourly","Daily","Weekly","Monthly"]);let n=c(null),a=c(null),l=c(null),u=c(null),b=c("Hourly"),ae=d(()=>{if(!e(n)||!e(n).solution_name)return"";let t=e(n).solution_name.split(".");return[t[t.length-1],e(n).scenario_name,"balance",e(l),e(a),e(u)].join("_")}),le=d(()=>{if(e(I)===null)return"";let t=e(I).data.find(s=>s.carrier===e(l));return t?t[0]||t.units||"":e(I).data[0][0]||e(I).data[0].units||""});const se=d(()=>({animation:!1,normalized:!0,elements:{point:{radius:0}},responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Time"}},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:`Power [${e(le)}]`}}},borderWidth:1,plugins:{zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x"},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x"}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}));P(()=>{e(k),E(()=>{e(k).length>0&&(e(u)==null||!e(k).includes(Number(e(u))))&&r(u,e(k)[0].toString(),!0)})}),P(()=>{e(w),E(()=>{e(w).length>0&&(e(a)==null||!e(w).includes(e(a)))&&r(a,e(w)[0],!0)})}),P(()=>{e(x),E(()=>{e(x).length>0&&(e(l)==null||!e(x).includes(e(l)))&&r(l,e(x)[0],!0)})}),P(()=>{e(n),e(u),e(a),e(l),e(b),E(ue)}),fe(()=>{r(u,L("year")||e(u),!0),r(a,L("node")||e(a),!0),r(l,L("carrier")||e(l),!0),r(b,L("window_size")||e(b),!0)}),P(()=>{e(u),e(a),e(l),e(b),ve().then(()=>{De({year:e(u),node:e(a),carrier:e(l),window_size:e(b)})})});let ie=d(()=>({Daily:24,Weekly:168,Monthly:720})[e(b)]||1);async function ue(){if(e(a)==null||e(l)==null||e(u)==null||e(n)==null)return;r(m,!0);let t=Math.floor((Number(e(u))-e(n).detail.system.reference_year)/e(n).detail.system.interval_between_years);await(async s=>{var _=he(s,2);r(Z,_[0],!0),r(I,_[1],!0)})(await Promise.all([ke(e(n).solution_name,e(a),e(l),e(n).scenario_name,t,e(ie)),Se(e(n).solution_name,y("flow_export",e(n).version),e(n).scenario_name)])),r(m,!1)}let de=d(()=>e($).length===0?[]:Object.keys(e($)[0].data)),$=d(()=>!e(n)||!e(a)||!e(l)||!e(u)||!e(Z)?[]:(Me(),Object.entries(e(Z)).flatMap(([t,s])=>{if(!s||!s.data||s.data.length===0)return[];let _={node:[e(a)]};return"technology"in s.data[0]&&(_={technology:s.data.map(o=>o.technology)}),je(s.data,_,{}).map(o=>{if(Object.keys(o.data).length==0)return null;const g=e(n).version,v={[y("flow_storage_discharge",g)]:p=>p+" (discharge)",[y("flow_transport_in",g)]:p=>p+" (transport in)",[y("flow_import",g)]:()=>"Import",[y("shed_demand",g)]:()=>"Shed Demand",[y("flow_storage_charge",g)]:p=>p+" (charge)",[y("flow_transport_out",g)]:p=>p+" (transport out)",[y("flow_export",g)]:()=>"Export"};t in v&&(o.label=v[t](o.label));let h=o,B=Object.keys(h.data).length==1?"bar":"line",i=Ie(),R=i.replace("rgb","rgba").replace(")",", 0.5)");return t=="demand"?{...h,label:"Demand",type:"line",stack:"ownCustomStack",fill:!1,borderColor:"black",backgroundColor:"white",borderWidth:2,stepped:!0,pointRadius:Object.keys(h.data).length==1?2:0}:{...h,type:B,fill:"origin",borderColor:i,backgroundColor:R,stepped:!0,cubicInterpolationMode:"monotone",pointRadius:Object.keys(h.data).length==1?2:0,borderWidth:2}}).filter(o=>o!==null)})));var U=Ne(),V=M(J(U),2);xe(V,{children:(t,s)=>{var _=Pe(),O=J(_);te(O,{title:"Solution Selection",children:(v,h)=>{const B=d(()=>e(m)||e(f));ze(v,{get disabled(){return e(B)},get selected_solution(){return e(n)},set selected_solution(i){r(n,i,!0)},get carriers(){return e(x)},set carriers(i){r(x,i,!0)},get nodes(){return e(w)},set nodes(i){r(w,i,!0)},get years(){return e(k)},set years(i){r(k,i,!0)},get loading(){return e(f)},set loading(i){r(f,i,!0)}})}});var o=M(O,2);{var g=v=>{te(v,{title:"Data Selection",children:(h,B)=>{var i=Oe(),R=J(i);T(R,{label:"Year",content:(S,z=H)=>{const j=d(()=>A(e(k).map(D=>D.toString()))),C=d(()=>e(m)||e(f));K(S,{get formId(){return z()},get options(){return e(j)},get disabled(){return e(C)},get value(){return e(u)},set value(D){r(u,D,!0)}})}});var p=M(R,2);T(p,{label:"Node",content:(S,z=H)=>{const j=d(()=>A(e(w))),C=d(()=>e(m)||e(f));K(S,{get formId(){return z()},get options(){return e(j)},get disabled(){return e(C)},get value(){return e(a)},set value(D){r(a,D,!0)}})}});var ee=M(p,2);T(ee,{label:"Carrier",content:(S,z=H)=>{const j=d(()=>A(e(x))),C=d(()=>e(m)||e(f));K(S,{get formId(){return z()},get options(){return e(j)},get disabled(){return e(C)},get value(){return e(l)},set value(D){r(l,D,!0)}})}});var pe=M(ee,2);T(pe,{label:"Smooting Window Size",content:(S,z=H)=>{const j=d(()=>e(m)||e(f));K(S,{get formId(){return z()},get options(){return oe},get disabled(){return e(j)},get value(){return e(b)},set value(C){r(b,C,!0)}})}}),W(h,i)}})};Q(o,v=>{!e(f)&&e(n)&&v(g)})}W(t,_)}});var X=M(V,2),ce=ye(X);{var ge=t=>{var s=We();W(t,s)},_e=(t,s)=>{{var _=o=>{var g=Fe();W(o,g)},O=o=>{Ce(o,{type:"line",get options(){return e(se)},get labels(){return e(de)},get datasets(){return e($)},get plot_name(){return e(ae)},zoom:!0})};Q(t,o=>{e($).length==0?o(_):o(O,!1)},s)}};Q(ce,t=>{e(m)?t(ge):t(_e,!1)})}we(X),W(Y,U),be()}export{Ze as component};

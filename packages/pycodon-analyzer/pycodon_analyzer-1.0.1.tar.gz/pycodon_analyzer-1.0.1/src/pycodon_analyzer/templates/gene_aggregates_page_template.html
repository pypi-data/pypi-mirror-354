{% extends "base_template.html" %}

{% block title %}Per-Gene Aggregate Analysis - PyCodon Analyzer Report{% endblock %}

{% block content %}
<h1>Per-Gene Aggregate Analysis</h1>

<p>This section provides an overview of metrics aggregated at the gene level (including the 'complete' concatenated set, if analyzed).</p>

<h2>Gene Summary: Sequence Counts and Lengths</h2>
{% if report_data.tables.gene_sequence_summary_html %}
    {{ report_data.tables.gene_sequence_summary_html | safe }}
    <p><small>Note: Sequence lengths for 'complete' represent concatenated lengths. For individual genes, typical length or range of lengths from input sequences is shown.</small></p>
{% else %}
    <p class="unavailable">Gene sequence summary table is not available.</p>
{% endif %}
<p>Download full table:
{% if report_data.tables.gene_sequence_summary_csv_path %}
<a href="{{ report_data.base_path_to_html_assets }}data/{{ report_data.tables.gene_sequence_summary_csv_path_from_root }}">{{ report_data.tables.gene_sequence_summary_csv_path_from_root }}</a>
{% else %}
    <span class="unavailable">CSV file path not available.</span>
{% endif %}
</p>


<h2>Mean Features per Gene</h2>
<p>The table below shows the average values for various calculated metrics for each gene and the 'complete' set.</p>
{% if report_data.tables.mean_features_per_gene_html %}
    {{ report_data.tables.mean_features_per_gene_html | safe }}
{% else %}
    <p class="unavailable">Mean features per gene table is not available.</p>
{% endif %}
<p>Download full table:
    {% if report_data.tables.mean_features_per_gene_csv_path_from_root %}
    <a href="{{ report_data.base_path_to_html_assets }}data/{{ report_data.tables.mean_features_per_gene_csv_path_from_root }}">{{ report_data.tables.mean_features_per_gene_csv_path_from_root }}</a>
{% else %}
    <span class="unavailable">CSV file path not available.</span>
{% endif %}
</p>


<h2>Aggregate Plots by Gene</h2>
<p>These plots show trends across all analyzed genes.</p>

<div class="plot-container">
    <h4>Mean GC Content by Gene</h4>
    {% if report_data.plot_paths.combined_plots.gc_means_barplot_by_Gene %}
    <img src="{{ report_data.base_path_to_root }}{{ report_data.plot_paths.combined_plots.gc_means_barplot_by_Gene }}"
             alt="Mean GC Content by Gene" 
             class="zoomable">
    {% else %}
        <p class="unavailable">Plot not available.</p>
    {% endif %}
</div>

<div class="plot-container">
    <h4>Relative Dinucleotide Abundance by Gene</h4>
    {% if report_data.plot_paths.combined_plots.relative_dinucleotide_abundance_combined %}
        <img src="{{ report_data.base_path_to_root }}{{ report_data.plot_paths.combined_plots.relative_dinucleotide_abundance_combined }}" 
             alt="Relative Dinucleotide Abundance by Gene"
             class="zoomable">
        <p>This plot illustrates the relative abundance of each dinucleotide (two-nucleotide sequence) across all analyzed genes. It helps in understanding biases in dinucleotide frequencies, which can be indicative of various biological processes or evolutionary pressures.</p>
    {% else %}
        <p class="unavailable">Plot not available.</p>
    {% endif %}
</div>

<div class="plot-container">
    <h4>ENC vs GC3 (Colored by Gene)</h4>
    {% if report_data.plot_paths.combined_plots.enc_vs_gc3_combined %}
        <img src="{{ report_data.base_path_to_root }}{{ report_data.plot_paths.combined_plots.enc_vs_gc3_combined }}" 
             alt="ENC vs GC3 Colored by Gene"
             class="zoomable">
        <p>This plot shows the Effective Number of Codons (ENC) against the GC content at the third codon position (GC3) for each gene. ENC measures codon usage bias, with lower values indicating stronger bias. GC3 reflects the mutational pressure on synonymous sites. The plot helps to assess the relative contributions of mutational bias and natural selection to codon usage patterns. Genes are colored to distinguish individual data points.</p>
    {% else %}
        <p class="unavailable">Plot not available.</p>
    {% endif %}
</div>

<div class="plot-container">
    <h4>Neutrality Plot (Colored by Gene)</h4>
    {% if report_data.plot_paths.combined_plots.neutrality_plot_combined %}
        <img src="{{ report_data.base_path_to_root }}{{ report_data.plot_paths.combined_plots.neutrality_plot_combined }}" 
             alt="Neutrality Plot Colored by Gene"
             class="zoomable">
        <p>This plot, also known as a GC12 vs GC3 plot, examines the relationship between GC content at the first and second codon positions (GC12) and the third codon position (GC3). It is used to infer the relative roles of mutation and selection in shaping genome evolution. A strong correlation suggests that mutational bias is the primary force, while scatter indicates the influence of natural selection. Genes are colored to distinguish individual data points.</p>
    {% else %}
        <p class="unavailable">Plot not available.</p>
    {% endif %}
</div>

{% endblock %}
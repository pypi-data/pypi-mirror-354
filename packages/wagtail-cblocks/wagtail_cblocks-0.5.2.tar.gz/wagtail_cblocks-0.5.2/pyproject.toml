[build-system]
requires = ["hatchling", "hatch-vcs"]
build-backend = "hatchling.build"

[project]
name = "wagtail_cblocks"
description = "Collection of StreamField blocks for Wagtail"
readme = "README.md"
license = "AGPL-3.0-or-later"
authors = [
  { name = "Cliss XXI", email = "contact@cliss21.com" },
]
classifiers = [
  "Development Status :: 3 - Alpha",
  "Environment :: Web Environment",
  "Intended Audience :: Developers",
  "License :: OSI Approved :: GNU Affero General Public License v3",
  "Programming Language :: Python :: 3",
  "Programming Language :: Python :: 3.8",
  "Programming Language :: Python :: 3.9",
  "Programming Language :: Python :: 3.10",
  "Programming Language :: Python :: 3.11",
  "Framework :: Django",
  "Framework :: Wagtail",
]
keywords = [
  "wagtail",
  "blocks",
  "streamfield",
]
dynamic = ["version"]

dependencies = [
  "django>=4.2",
  "wagtail>=5.2",
]
requires-python = ">=3.8"

[project.optional-dependencies]
factories = [
  "wagtail-factories>=4.0.0",
]
dev = [
  "wagtail_cblocks[factories]",
  "pytest~=8.2",
  "pytest-cov~=5.0",
  "pytest-django~=4.8",
  "ruff~=0.4.4",
]

[project.urls]
Repository = "https://framagit.org/cliss21/wagtail-cblocks"
Issues = "https://framagit.org/cliss21/wagtail-cblocks/-/issues"

[tool.hatch.version]
source = "vcs"

[tool.hatch.build.targets.wheel]
only-include = ["wagtail_cblocks"]

[tool.ruff]
extend-exclude = [
  "LC_MESSAGES",
  "locale",
  "tests/migrations/*.py",
]
line-length = 80

[tool.ruff.lint]
select = [
  "B",      # flake8-bugbear
  "C4",     # flake8-comprehensions
  "DJ",     # flake8-django
  "E",      # pycodestyle errors
  "F",      # pyflakes
  "I",      # isort
  "RUF100", # unused noqa
  "S",      # flake8-bandit
  "UP",     # pyupgrade
  "W",      # warning
]
fixable = ["C4", "E", "F", "I", "UP"]

[tool.ruff.lint.isort]
known-first-party = ["wagtail_cblocks"]
section-order = [
  "future",
  "standard-library",
  "django",
  "wagtail",
  "third-party",
  "first-party",
  "local-folder",
]

[tool.ruff.lint.isort.sections]
django = ["django"]
wagtail = ["wagtail"]

[tool.ruff.lint.per-file-ignores]
"tests/**/*.py" = [
  "S101",    # asserts allowed in tests
  "ARG",     # unused function args (pytest fixtures)
  "FBT",     # booleans as positional arguments (@pytest.mark.parametrize)
  "PLR2004", # magic value used in comparison
  "S311",    # standard pseudo-random generators are not suitable for cryptographic purposes
]

[tool.ruff.format]
docstring-code-format = true

[tool.pytest.ini_options]
markers = ["wip: mark a test as a work in progress"]
testpaths = ["tests"]
DJANGO_SETTINGS_MODULE = "tests.settings"

[tool.coverage.run]
branch = true
source = ["wagtail_cblocks"]

[tool.coverage.report]
exclude_lines = [
  "# pragma: no cover",
  "raise NotImplementedError",
]
show_missing = true

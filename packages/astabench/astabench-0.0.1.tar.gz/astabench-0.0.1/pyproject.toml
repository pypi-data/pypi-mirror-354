[build-system]
requires = ["setuptools>=61", "wheel"]
build-backend = "setuptools.build_meta"

[project]
name = "astabench"
version = "0.0.1"
readme = "README.md"
requires-python = ">=3.11"
dependencies = [
    # TODO: Bump to tagged version >0.3.103 (pinned to unreleased commits for claude web search tool and perplexity provider)
    "inspect_ai>=0.3.103",
    "agent-eval==0.1.4",
    "openai>=1.78.0", # required by inspect
    "pydantic>=2.11.4", # required by inspect
    "litellm",
    "datasets",
    "huggingface_hub",
    "google-genai>=1.16.1",
    "nltk",
    "tabulate",
    "click==8.1.8",
    "nora_lib-impl~=1.1.0",
    "mcp~=1.9.1",
    "httpx~=0.28.1",
    "h2~=4.2.0",
]

[project.optional-dependencies]
dev = [
    "black==24.2.0",
    "isort",
    "autoflake",
    "pytest",
    "pytest-asyncio",
    "flake8==7.2.0",
    "flake8-pyproject==1.2.3",
    "mypy==1.15",
    "pandas-stubs",
]
anthropic = [
    "anthropic>=0.52.0"
]
litqa2 = [
    "datasets==3.2.0",
    "pandas",
]
sqa = [
    "ai2-scholar-qa==0.6.11",
]
autogen_web_surfer_solver = [
    "playwright",
    "autogen-agentchat==0.4.4",
    "autogen-ext[openai,web-surfer]==0.4.4",
    "autogen-core==0.4.4",
]
langchain_solver = [
    "langchain-community==0.3.21",
    "langchain-core==0.3.51",
    "langchain-openai==0.3.1",
    "langgraph==0.2.67",
]
smolagents = [
    "smolagents==1.17.0",
]
datavoyager_solver = [
    "autogen-agentchat==0.4.4",
    "autogen-ext[openai, diskcache, azure]==0.4.4",
    "ipython~=8.18",
    "matplotlib==3.10.0",
    "nest_asyncio==1.6.0",
    "pyyaml==6.0.2",
    "termcolor==2.5.0",
]
futurehouse_solver = [
    "futurehouse-client==0.3.19",
]
e2e_discovery = [
      "anthropic"
]
super = [
      "websocket-client~=1.7.0",
      "nbconvert~=7.16.1",
      "ipython~=8.18.1",
]

[project.scripts]
astabench = "astabench.cli:cli"
inspect = "inspect_ai._cli.main:main"

[project.entry-points.inspect_ai]
astabench = "astabench.evals._registry"

[tool.setuptools.packages.find]
where = ["."]
include = [
    "astabench",
    "astabench.*",
]

[tool.uv]
conflicts = [
    [{extra = "inspect_evals"}, {extra = "sqa"}],
    [{extra = "inspect_evals"}, {extra = "litqa2"}],
    [{extra = "inspect_evals"}, {extra = "storm"}],
    [{extra = "sqa"}, {extra = "langchain_solver"}],
    [{extra = "sqa"}, {extra = "litqa2"}],
    [{extra = "sqa"}, {extra = "storm"}],
    [{extra = "sqa"}, {extra = "smolagents"}],
    [{extra = "sqa"}, {extra = "futurehouse_solver"}],
    [{extra = "litqa2"}, {extra = "storm"}],
    [{extra = "storm"}, {extra = "smolagents"}],
]
override-dependencies = [
    # sqa pins openai to a lower version than inspect requires
    "openai==1.78.0",
]

[tool.flake8]
select = [
    # F category for logical errors
    "F",

    # Serious "E" errors
    "E721", # `type(x) == <t>` instead of `isinstance(x, <t>)`
    "E901", "E902", "E999" # syntax errors
]

ignore = [
    "F401",  # module imported but unused
    "F541",  # f-string is missing placeholders
]

[tool.setuptools.package-data]
"astabench" = ["config/*.yml"]

[tool.pytest.ini_options]
testpaths = ["tests"]
# give each async test its own loop
asyncio_mode = "strict"
asyncio_default_fixture_loop_scope = "function"
# default to skipping expensive tests
addopts = "-m \"not expensive\""
markers = [
  "expensive: mark test as expensive (skipped by default)"
]

import{a as b,f as y}from"./chunk-MGNYDHM4.js";import{e as A}from"./chunk-3L3RRFVB.js";import{Fa as P,O as E}from"./chunk-FVXVO67X.js";import{bb as F,f as T,g as S,t as C,u as k}from"./chunk-KYOHYQWH.js";import{k as w}from"./chunk-KYPE3LET.js";var p={kTopLeft:1,kTopRight:2,kBottomLeft:3,kBottomRight:4},M=class v extends b{drawContent(){return w(this,null,function*(){return this})}drawPave(){return w(this,null,function*(){let t=this.getPadPainter().getPadRect(),i=this.getFramePainter();this.onFrame=i&&this.v7EvalAttr("onFrame",!0),this.corner=this.v7EvalAttr("corner",p.kTopRight);let e=this.v7EvalAttr("visible",!0),s=this.v7EvalLength("offsetX",t.width,.02),a=this.v7EvalLength("offsetY",t.height,.02),n=this.v7EvalLength("width",t.width,.3),r=this.v7EvalLength("height",t.height,.3);if(this.createG(),this.draw_g.classed("most_upper_primitives",!0),!e)return this;this.createv7AttLine("border_"),this.createv7AttFill();let h=this.onFrame?i.getFrameRect():t,l=0,c=0;switch(this.corner){case p.kTopLeft:l=h.x+s,c=h.y+a;break;case p.kBottomLeft:l=h.x+s,c=h.y+h.height-a-r;break;case p.kBottomRight:l=h.x+h.width-s-n,c=h.y+h.height-a-r;break;case p.kTopRight:default:l=h.x+h.width-s-n,c=h.y+a}return E(this.draw_g,l,c),this.draw_g.append("svg:rect").attr("x",0).attr("width",n).attr("y",0).attr("height",r).call(this.lineatt.func).call(this.fillatt.func),this.pave_width=n,this.pave_height=r,this.drawContent().then(()=>(this.isBatchMode()||(C.ContextMenu&&this.paveContextMenu&&this.draw_g.on("contextmenu",f=>this.paveContextMenu(f)),A(this,{x:l,y:c,width:n,height:r,minwidth:20,minheight:20,redraw:f=>this.sizeChanged(f)})),this))})}sizeChanged(t){this.pave_width=t.width,this.pave_height=t.height;let i=t.x,e=t.y,s=this.getPadPainter().getPadRect(),a=this.onFrame?this.getFramePainter().getFrameRect():s,n={},r,h;switch(this.corner){case p.kTopLeft:r=i-a.x,h=e-a.y;break;case p.kBottomLeft:r=i-a.x,h=a.y+a.height-e-this.pave_height;break;case p.kBottomRight:r=a.x+a.width-i-this.pave_width,h=a.y+a.height-e-this.pave_height;break;case p.kTopRight:default:r=a.x+a.width-i-this.pave_width,h=e-a.y}this.v7AttrChange(n,"offsetX",r/s.width),this.v7AttrChange(n,"offsetY",h/s.height),this.v7AttrChange(n,"width",this.pave_width/s.width),this.v7AttrChange(n,"height",this.pave_height/s.height),this.v7SendAttrChanges(n,!1),this.draw_g.selectChild("rect").attr("width",this.pave_width).attr("height",this.pave_height),this.drawContent()}redraw(){return w(this,null,function*(){return this.drawPave()})}static draw(t,i,e){return w(this,null,function*(){let s=new v(t,i,e,"pave");return y(s,!1).then(()=>s.drawPave())})}},L=class v extends M{drawContent(){return w(this,null,function*(){let t=this.getObject(),i=this.v7EvalFont("text",{size:12,color:"black",align:22}),e=this.pave_width,s=this.pave_height,a=this.getPadPainter(),n=t.fEntries.length;if(t.fTitle&&n++,!n||!a)return this;let r=s/n,h=.02*e;return i.setSize(s/(n*1.2)),this.startTextDrawingAsync(i,"font").then(()=>{let l=0;t.fTitle&&(this.drawText({latex:1,width:e-2*h,height:r,x:h,y:l,text:t.fTitle}),l+=r);for(let c=0;c<t.fEntries.length;++c){let f=t.fEntries[c],g=Math.round(e/4),d=null;this.drawText({latex:1,width:.75*e-3*h,height:r,x:2*h+g,y:l,text:f.fLabel}),f.fDrawableId!=="custom"?d=a.findSnap(f.fDrawableId,!0):f.fDrawable.fIO&&(d=new b(this.getPadPainter(),f.fDrawable.fIO),f.fLine&&d.createv7AttLine(),f.fFill&&d.createv7AttFill(),f.fMarker&&d.createv7AttMarker()),f.fFill&&d?.fillatt&&this.draw_g.append("svg:path").attr("d",`M${Math.round(h)},${Math.round(l+r*.1)}h${g}v${Math.round(r*.8)}h${-g}z`).call(d.fillatt.func),f.fLine&&d?.lineatt&&this.draw_g.append("svg:path").attr("d",`M${Math.round(h)},${Math.round(l+r/2)}h${g}`).call(d.lineatt.func),f.fError&&d?.lineatt&&this.draw_g.append("svg:path").attr("d",`M${Math.round(h+e/8)},${Math.round(l+r*.2)}v${Math.round(r*.6)}`).call(d.lineatt.func),f.fMarker&&d?.markeratt&&this.draw_g.append("svg:path").attr("d",d.markeratt.create(h+e/8,l+r/2)).call(d.markeratt.func),l+=r}return this.finishTextDrawing()})})}static draw(t,i,e){return w(this,null,function*(){let s=new v(t,i,e,"legend");return y(s,!1).then(()=>s.drawPave())})}},O=class v extends M{drawContent(){return w(this,null,function*(){let t=this.getObject(),i=this.v7EvalFont("text",{size:12,color:"black",align:22}),e=this.pave_width,s=this.pave_height,a=t.fText.length;if(!a)return;let n=s/a,r=.02*e;return i.setSize(s/(a*1.2)),this.startTextDrawingAsync(i,"font").then(()=>{for(let h=0,l=0;h<t.fText.length;++h,l+=n)this.drawText({latex:1,width:e-2*r,height:n,x:r,y:l,text:t.fText[h]});return this.finishTextDrawing(void 0,!0)})})}static draw(t,i,e){return w(this,null,function*(){let s=new v(t,i,e,"pavetext");return y(s,!1).then(()=>s.drawPave())})}},j=class v extends M{clearStat(){this.stats_lines=[]}addText(t){this.stats_lines.push(t)}updateStatistic(t){this.stats_lines=t.lines,this.drawStatistic(this.stats_lines)}fillStatistic(){if(this.getPadPainter()?._fast_drawing)return!1;let i=this.getObject();if(i.fLines!==void 0)return this.stats_lines=i.fLines,delete i.fLines,!0;if(this.v7OfflineMode()){let e=this.getMainPainter();return T(e?.fillStatistic)?e.fillStatistic(this,k.fOptStat,k.fOptFit):!1}return this.stats_lines!==void 0}drawContent(){return w(this,null,function*(){return this.fillStatistic()?this.drawStatistic(this.stats_lines):this})}changeMask(t){let i=this.getObject(),e=1<<t;i.fShowMask&e?i.fShowMask&=~e:i.fShowMask|=e,this.fillStatistic()&&this.drawStatistic(this.stats_lines)}statsContextMenu(t){t.preventDefault(),t.stopPropagation(),P(t,this).then(i=>{let e=this.getObject(),s=this.changeMask.bind(this);i.header("Stat Box");for(let a=0;a<e.fEntries.length;++a)i.addchk(e.fShowMask&1<<a,e.fEntries[a],a,s);return this.fillObjectExecMenu(i)}).then(i=>i.show())}drawStatistic(t){return w(this,null,function*(){if(!t)return this;let i=this.v7EvalFont("stats_text",{size:12,color:"black",align:22}),e=this.pave_width,s=this.pave_height,a=t.length,n=0,r=0,h=0;for(let d=0;d<a;++d){let o=t[d];if(d>0&&(h=Math.max(h,o.length)),d===0||o.indexOf("|")<0)continue;n===0&&(n=d);let m=o.split("|");m.length>r&&(r=m.length)}let l=s/a,c=.02*e,f=!1,g=this.draw_g.selectChild(".statlines");return g.empty()?g=this.draw_g.append("svg:g").attr("class","statlines"):g.selectAll("*").remove(),i.setSize(s/(a*1.2)),this.startTextDrawingAsync(i,"font",g).then(()=>{if(a===1)this.drawText({width:e,height:s,text:t[0],latex:1,draw_g:g});else for(let o=0;o<a;++o){let m=o*l;if(n&&o>=n){let _=t[o].split("|");for(let x=0;x<_.length;++x)this.drawText({align:"middle",x:e*x/r,y:m,latex:0,width:e/r,height:l,text:_[x],draw_g:g})}else if(t[o].indexOf("=")<0){if(o===0){f=!0;let _=Math.max(h,Math.round((e-2*c)/l/.65));t[o].length>_+5&&(t[o]=t[o].slice(0,_+2)+"...")}this.drawText({align:o===0?"middle":"start",x:c,y:m,width:e-2*c,height:l,text:t[o],draw_g:g})}else{let _=t[o].split("="),x=[];for(let u=0;u<2;++u){let R={align:u===0?"start":"end",x:c,y:m,width:e-2*c,height:l,text:_[u],draw_g:g,_expected_width:e-2*c,_args:x,post_process(D){this._args[0].ready&&this._args[1].ready&&D.scaleTextDrawing(1.05*(this._args[0].result_width&&this._args[1].result_width)/this.__expected_width,this.draw_g)}};x.push(R)}for(let u=0;u<2;++u)this.drawText(x[u])}}let d="";if(f&&(d+="M0,"+Math.round(l)+"h"+e),n>0&&r>1){for(let o=n;o<a;++o)d+="M0,"+Math.round(o*l)+"h"+e;for(let o=0;o<r-1;++o)d+="M"+Math.round(e/r*(o+1))+","+Math.round(n*l)+"V"+s}return d&&this.draw_g.append("svg:path").attr("d",d),this.finishTextDrawing(g)})})}redraw(t){return w(this,null,function*(){if(t&&S(t)&&t.indexOf("zoom")===0&&this.v7NormalMode()){let i={_typename:`${F}RHistStatBoxBase::RRequest`,mask:this.getObject().fShowMask};this.v7SubmitRequest("stat",i,e=>this.updateStatistic(e))}return this.drawPave()})}static draw(t,i,e){return w(this,null,function*(){let s=new v(t,i,e,i);return y(s,!1).then(()=>s.drawPave())})}};export{j as RHistStatsPainter,L as RLegendPainter,M as RPavePainter,O as RPaveTextPainter};

import{a as z,b as G}from"./chunk-TPOMYDRH.js";import"./chunk-O2YOIZWS.js";import{a as L}from"./chunk-C4APR3G7.js";import{a as j}from"./chunk-4U5XXNS7.js";import"./chunk-LGENSGLC.js";import"./chunk-LWQ6XHU3.js";import{h as O}from"./chunk-YC5SGHGH.js";import"./chunk-FYXTN3X2.js";import"./chunk-D3GAWKNQ.js";import"./chunk-K2P6CES6.js";import"./chunk-Z4ZYSIRC.js";import"./chunk-3L3RRFVB.js";import{H as k,I as B,ha as $}from"./chunk-FVXVO67X.js";import{Qa as P,Va as Y,eb as X,f as N,jb as A,kb as H,t as w,u as C}from"./chunk-KYOHYQWH.js";import{k as b}from"./chunk-KYPE3LET.js";var E=class W extends j{#e;getObjectName(){return this.$func?.fName??"func"}getClassName(){return this.$func?._typename??Y}isTF1(){return!0}getPrimaryObject(){return this.$func}updateObject(e){if(!e||this.getClassName()!==e._typename)return!1;delete e.evalPar;let t=this.getHisto();if(this.webcanv_hist){let i=this.getPadPainter()?.findInPrimitives("Func",P);i&&this.updateAxes(t,i,this.getFramePainter())}return this.$func=e,this.createTF2Histogram(e,t),this.scanContent(),!0}redraw(e){return!this.#e&&(e==="logx"||e==="logy"||e==="zoom")&&(this.createTF2Histogram(this.$func,this.getHisto()),this.scanContent()),super.redraw(e)}createTF2Histogram(e,t){let i=e.fSave.length-6;i>0&&i!==(e.fSave[i+4]+1)*(e.fSave[i+5]+1)&&(i=0),this.#e=i>0&&(w.PreferSavedPoints||this.use_saved>1);let c=this.getFramePainter(),v=this.getPadPainter()?.getRootPad(!0),f=v?.fLogx,g=v?.fLogy,r=c?.getGrFuncs(this.second_x,this.second_y),n=e.fXmin,h=e.fXmax,m=e.fYmin,y=e.fYmax,l=Math.max(e.fNpx,20),_=Math.max(e.fNpy,20);if(r?.zoom_xmin!==r?.zoom_xmax){let a=(h-n)/l;n<r.zoom_xmin&&r.zoom_xmin<h&&(n=Math.max(n,r.zoom_xmin-a)),n<r.zoom_xmax&&r.zoom_xmax<h&&(h=Math.min(h,r.zoom_xmax+a))}if(r?.zoom_ymin!==r?.zoom_ymax){let a=(y-m)/_;m<r.zoom_ymin&&r.zoom_ymin<y&&(m=Math.max(m,r.zoom_ymin-a)),m<r.zoom_ymax&&r.zoom_ymax<y&&(y=Math.min(y,r.zoom_ymax+a))}let T=(a,o)=>{t.fNcells!==(a+2)*(o+2)&&(t.fNcells=(a+2)*(o+2),t.fArray=new Float32Array(t.fNcells)),t.fArray.fill(0),t.fXaxis.fNbins=a,t.fXaxis.fXbins=[],t.fYaxis.fNbins=o,t.fYaxis.fXbins=[]};if(delete this._fail_eval,!this.#e){let a=!1;!e.evalPar&&!L(e)&&(a=!0),T(l,_),t.fXaxis.fXmin=n,t.fXaxis.fXmax=h,t.fYaxis.fXmin=m,t.fYaxis.fXmax=y,f&&z(t.fXaxis,l,n,h),g&&z(t.fYaxis,_,m,y);for(let o=0;o<_&&!a;++o)for(let u=0;u<l&&!a;++u){let x=t.fXaxis.GetBinCenter(u+1),d=t.fYaxis.GetBinCenter(o+1),s=0;try{s=e.evalPar(x,d)}catch{a=!0}a||t.setBinContent(t.getBin(u+1,o+1),Number.isFinite(s)?s:0)}a&&(this._fail_eval=!0),a&&i>6&&(this.#e=!0)}if(this.#e){l=Math.round(e.fSave[i+4]),_=Math.round(e.fSave[i+5]),n=e.fSave[i],h=e.fSave[i+1],m=e.fSave[i+2],y=e.fSave[i+3];let a=(h-n)/l,o=(y-m)/_,u=(x,d)=>{if(x<n||x>h||a<=0||d<m||d>y||o<=0)return 0;let s=Math.min(l-1,Math.floor((x-n)/a)),p=Math.min(_-1,Math.floor((d-m)/o)),S=n+s*a,I=m+p*o,M=(x-S)/a,F=(d-I)/o,D=p*(l+1)+s,R=p*(l+1)+s+1,q=(p+1)*(l+1)+s+1,J=(p+1)*(l+1)+s;return(1-M)*(1-F)*e.fSave[D]+M*(1-F)*e.fSave[R]+M*F*e.fSave[q]+(1-M)*F*e.fSave[J]};T(e.fNpx,e.fNpy),t.fXaxis.fXmin=e.fXmin,t.fXaxis.fXmax=e.fXmax,t.fYaxis.fXmin=e.fYmin,t.fYaxis.fXmax=e.fYmax;for(let x=0;x<e.fNpy;++x){let d=t.fYaxis.GetBinCenter(x+1);for(let s=0;s<e.fNpx;++s){let p=t.fXaxis.GetBinCenter(s+1),S=u(p,d);t.setBinContent(t.getBin(s+1,x+1),Number.isFinite(S)?S:0)}}}return t.fName="Func",H(t,e.fTitle),t.fMinimum=e.fMinimum,t.fMaximum=e.fMaximum,t.fLineColor=e.fLineColor,t.fLineStyle=e.fLineStyle,t.fLineWidth=e.fLineWidth,t.fFillColor=e.fFillColor,t.fFillStyle=e.fFillStyle,t.fMarkerColor=e.fMarkerColor,t.fMarkerStyle=e.fMarkerStyle,t.fMarkerSize=e.fMarkerSize,t.fBits|=X,t}extractAxesProperties(e){super.extractAxesProperties(e);let t=this.$func,i=t?.fSave.length??0;i>6&&this.#e&&(this.xmin=Math.min(this.xmin,t.fSave[i-6]),this.xmax=Math.max(this.xmax,t.fSave[i-5]),this.ymin=Math.min(this.ymin,t.fSave[i-4]),this.ymax=Math.max(this.ymax,t.fSave[i-3])),t&&(this.xmin=Math.min(this.xmin,t.fXmin),this.xmax=Math.max(this.xmax,t.fXmax),this.ymin=Math.min(this.ymin,t.fYmin),this.ymax=Math.max(this.ymax,t.fYmax))}getTF2Tooltips(e){let t=[this.getObjectHint()],i=this.getFramePainter()?.getGrFuncs(this.options.second_x,this.options.second_y);if(!i||!N(this.$func?.evalPar))return t.push("grx = "+e.x,"gry = "+e.y),t;let c=i.revertAxis("x",e.x),v=i.revertAxis("y",e.y),f=0,g=!1;try{f=this.$func.evalPar(c,v)}catch{g=!0}return t.push("x = "+i.axisAsText("x",c),"y = "+i.axisAsText("y",v),"value = "+(g?"<fail>":k(f,C.fStatFormat))),t}processTooltipEvent(e){if(this.#e)return super.processTooltipEvent(e);let t=this.draw_g?.selectChild(".tooltip_bin");if(!this.draw_g||!e)return t?.remove(),null;let i={name:this.$func?.fName,title:this.$func?.fTitle,x:e.x,y:e.y,color1:this.lineatt?.color??"green",color2:this.fillatt?.getFillColorAlt("blue")??"blue",lines:this.getTF2Tooltips(e),exact:!0,menu:!0};return e.disabled?t.remove():(t.empty()&&(t=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").style("fill","none").attr("r",(this.lineatt?.width??1)+4)),t.attr("cx",e.x).attr("cy",e.y),this.lineatt&&t.call(this.lineatt.func)),i}fillWebObjectOptions(e){e.fcust=this._fail_eval&&!this.use_saved?"func_fail":""}static draw(e,t,i){return b(this,null,function*(){let c=G(i);i=c.opt,delete c.opt;let v=new B(i);v.empty()?i="cont3":v.opt==="SAME"&&(i="cont2 same");let f;c.webcanv_hist&&(f=new $(e).getPadPainter()?.findInPrimitives("Func",P)),f||(f=A(P,20,20),f.fBits|=X);let g=new W(e,f);return g.$func=t,Object.assign(g,c),g.createTF2Histogram(t,f),O._drawHist(g,i)})}};export{E as TF2Painter};

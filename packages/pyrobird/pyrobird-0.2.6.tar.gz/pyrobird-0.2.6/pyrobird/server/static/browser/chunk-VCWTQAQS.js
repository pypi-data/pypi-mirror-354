import{a as C,b as j}from"./chunk-TPOMYDRH.js";import"./chunk-O2YOIZWS.js";import{a as $}from"./chunk-C4APR3G7.js";import{a as Z}from"./chunk-4U5XXNS7.js";import"./chunk-LGENSGLC.js";import"./chunk-LWQ6XHU3.js";import{h as O}from"./chunk-YC5SGHGH.js";import"./chunk-FYXTN3X2.js";import"./chunk-D3GAWKNQ.js";import"./chunk-K2P6CES6.js";import"./chunk-Z4ZYSIRC.js";import"./chunk-3L3RRFVB.js";import{I as B,ha as L}from"./chunk-FVXVO67X.js";import{Qa as w,Wa as T,eb as X,jb as k,kb as Y,t as H}from"./chunk-KYOHYQWH.js";import{k as A}from"./chunk-KYPE3LET.js";function G(S,t,e=0){for(let i=S.length-2;i>=0;--i){let o=t[i],s=t[i+1],n=S[i],x=S[i+1];if(o===e)return n;if(s===e)return x;if(o<e!=s<e)return n+(e-o)/(s-o)*(x-n)}return S[0]-1}var W=class S extends Z{#e;getObjectName(){return this.$func?.fName??"func"}getClassName(){return this.$func?._typename??T}isTF1(){return!0}getPrimaryObject(){return this.$func}updateObject(t){if(!t||this.getClassName()!==t._typename)return!1;delete t.evalPar;let e=this.getHisto();if(this.webcanv_hist){let i=this.getPadPainter()?.findInPrimitives("Func",w);i&&this.updateAxes(e,i,this.getFramePainter())}return this.$func=t,this.createTF3Histogram(t,e),this.scanContent(),!0}redraw(t){return!this.#e&&(t==="logx"||t==="logy"||t==="logy"||t==="zoom")&&(this.createTF3Histogram(this.$func,this.getHisto()),this.scanContent()),super.redraw(t)}createTF3Histogram(t,e){let i=t.fSave.length-9;this.#e=i>0&&(H.PreferSavedPoints||this.use_saved>1);let o=this.getFramePainter(),s=this.getPadPainter()?.getRootPad(!0),n=s?.fLogx,x=s?.fLogy,a=o?.getGrFuncs(this.second_x,this.second_y),y=t.fXmin,_=t.fXmax,v=t.fYmin,d=t.fYmax,l=t.fZmin,M=t.fZmax,g=Math.max(t.fNpx,20),c=Math.max(t.fNpy,20),f=Math.max(t.fNpz,20);if(a?.zoom_xmin!==a?.zoom_xmax){let m=(_-y)/g;y<a.zoom_xmin&&a.zoom_xmin<_&&(y=Math.max(y,a.zoom_xmin-m)),y<a.zoom_xmax&&a.zoom_xmax<_&&(_=Math.min(_,a.zoom_xmax+m))}if(a?.zoom_ymin!==a?.zoom_ymax){let m=(d-v)/c;v<a.zoom_ymin&&a.zoom_ymin<d&&(v=Math.max(v,a.zoom_ymin-m)),v<a.zoom_ymax&&a.zoom_ymax<d&&(d=Math.min(d,a.zoom_ymax+m))}a?.zoom_zmin!==a?.zoom_zmax&&(l<a.zoom_zmin&&a.zoom_zmin<M&&(l=a.zoom_zmin),l<a.zoom_zmax&&a.zoom_zmax<M&&(M=a.zoom_zmax));let b=(m,h)=>{e.fNcells!==(m+2)*(h+2)&&(e.fNcells=(m+2)*(h+2),e.fArray=new Float32Array(e.fNcells)),e.fArray.fill(0),e.fXaxis.fNbins=m,e.fXaxis.fXbins=[],e.fYaxis.fNbins=h,e.fYaxis.fXbins=[],e.fXaxis.fXmin=y,e.fXaxis.fXmax=_,e.fYaxis.fXmin=v,e.fYaxis.fXmax=d,e.fMinimum=l,e.fMaximum=M};if(delete this._fail_eval,!this.#e){let m=!1;!t.evalPar&&!$(t)&&(m=!0),b(g,c),n&&C(e.fXaxis,g,y,_),x&&C(e.fYaxis,c,v,d);let h=new Array(f),p=new Array(f);for(let r=0;r<f;++r)p[r]=l+r/(f-1)*(M-l);for(let r=0;r<c&&!m;++r)for(let z=0;z<g&&!m;++z){let P=e.fXaxis.GetBinCenter(z+1),u=e.fYaxis.GetBinCenter(r+1),N=0;try{for(let F=0;F<f;++F)h[F]=t.evalPar(P,u,p[F]);N=G(p,h)}catch{m=!0}m||e.setBinContent(e.getBin(z+1,r+1),Number.isFinite(N)?N:0)}m&&(this._fail_eval=!0),m&&i>0&&(this.#e=!0)}if(this.#e){y=t.fSave[i],_=t.fSave[i+1],v=t.fSave[i+2],d=t.fSave[i+3],l=t.fSave[i+4],M=t.fSave[i+5],g=Math.round(t.fSave[i+6]),c=Math.round(t.fSave[i+7]),f=Math.round(t.fSave[i+8]);let m=(M-l)/f;b(g+1,c+1);let h=new Array(f+1),p=new Array(f+1);for(let r=0;r<=f;r++)p[r]=l+r*m;for(let r=0;r<=g;++r)for(let z=0;z<=c;++z){for(let u=0;u<=f;u++)h[u]=t.fSave[r+(g+1)*(z+(c+1)*u)];let P=G(p,h);e.setBinContent(e.getBin(r+1,z+1),Number.isFinite(P)?P:0)}}return e.fName="Func",Y(e,t.fTitle),e.fLineColor=t.fLineColor,e.fLineStyle=t.fLineStyle,e.fLineWidth=t.fLineWidth,e.fFillColor=t.fFillColor,e.fFillStyle=t.fFillStyle,e.fMarkerColor=t.fMarkerColor,e.fMarkerStyle=t.fMarkerStyle,e.fMarkerSize=t.fMarkerSize,e.fBits|=X,e}extractAxesProperties(t){super.extractAxesProperties(t);let e=this.$func,i=e?.fSave.length??0;i>9&&this.#e&&(this.xmin=Math.min(this.xmin,e.fSave[i-9]),this.xmax=Math.max(this.xmax,e.fSave[i-8]),this.ymin=Math.min(this.ymin,e.fSave[i-7]),this.ymax=Math.max(this.ymax,e.fSave[i-6]),this.zmin=Math.min(this.zmin,e.fSave[i-5]),this.zmax=Math.max(this.zmax,e.fSave[i-4])),e&&(this.xmin=Math.min(this.xmin,e.fXmin),this.xmax=Math.max(this.xmax,e.fXmax),this.ymin=Math.min(this.ymin,e.fYmin),this.ymax=Math.max(this.ymax,e.fYmax),this.zmin=Math.min(this.zmin,e.fZmin),this.zmax=Math.max(this.zmax,e.fZmax))}fillWebObjectOptions(t){t.fcust=this._fail_eval&&!this.use_saved?"func_fail":""}static draw(t,e,i){return A(this,null,function*(){let o=j(i);i=o.opt,delete o.opt;let s=new B(i);s.empty()||i==="gl"?i="surf1":s.opt==="SAME"&&(i="surf1 same");let n;o.webcanv_hist&&(n=new L(t).getPadPainter()?.findInPrimitives("Func",w)),n||(n=k(w,20,20),n.fBits|=X);let x=new S(t,n);return x.$func=e,Object.assign(x,o),x.createTF3Histogram(e,n),O._drawHist(x,i)})}};export{W as TF3Painter};

import{a as G,f as B}from"./chunk-MGNYDHM4.js";import{e as V}from"./chunk-3L3RRFVB.js";import{Fa as S,O as H,b as O,e as _,f as E}from"./chunk-FVXVO67X.js";import{bb as j,f as T,t as P,z as Z}from"./chunk-KYOHYQWH.js";import{k as D}from"./chunk-KYPE3LET.js";function at(){let p=this.getObject(),e=this.getPadPainter(),i=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,r=i?this.v7EvalAttr("clipping",!1):!1,t=e.getCoordinate(p.fPos,i),s=this.v7EvalFont("text",{size:12,color:"black",align:22});return this.createG(r?"main_layer":i?"upper_layer":!1),this.startTextDrawingAsync(s,"font").then(()=>(this.drawText({x:t.x,y:t.y,text:p.fText,latex:1}),this.finishTextDrawing()))}function it(){let p=this.getObject(),e=this.getPadPainter(),i=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,r=i?this.v7EvalAttr("clipping",!1):!1,t=e.getCoordinate(p.fP1,i),s=e.getCoordinate(p.fP2,i);this.createG(r?"main_layer":i?"upper_layer":!1),this.createv7AttLine(),this.draw_g.append("svg:path").attr("d",`M${t.x},${t.y}L${s.x},${s.y}`).call(this.lineatt.func)}function rt(){let p=this.getObject(),e=this.getPadPainter(),i=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,r=i?this.v7EvalAttr("clipping",!1):!1,t=e.getCoordinate(p.fP1,i),s=e.getCoordinate(p.fP2,i);this.createG(r?"main_layer":i?"upper_layer":!1),this.createv7AttLine("border_"),this.createv7AttFill(),this.draw_g.append("svg:path").attr("d",`M${t.x},${t.y}H${s.x}V${s.y}H${t.x}Z`).call(this.lineatt.func).call(this.fillatt.func)}function nt(){let p=this.getObject(),e=this.getPadPainter(),i=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,r=i?this.v7EvalAttr("clipping",!1):!1,t=e.getCoordinate(p.fP,i);this.createG(r?"main_layer":i?"upper_layer":!1),this.createv7AttMarker();let s=this.markeratt.create(t.x,t.y);s&&this.draw_g.append("svg:path").attr("d",s).call(this.markeratt.func)}var W=class p extends G{getHistPalette(){let e=this.getObject()?.fPalette;return e&&!T(e.getColor)&&Z(e,`${j}RPalette`),e}drawPalette(e){let i=this.getHistPalette(),r=i.getContour(),t=this.getFramePainter();if(!r)return console.log("no contour - no palette");if(!t)return console.log("no frame painter - no palette");let s=r.at(0),F=r.at(-1),g=t.getFrameRect(),y=this.getPadPainter().getPadWidth(),k=this.getPadPainter().getPadHeight(),X=this.v7EvalAttr("visible",!0),l=this.v7EvalAttr("vertical",!0),M=i.full_min,A=i.full_max,b,C,o,d;if(e){o=e.width,d=e.height;let a={};l?(this.v7AttrChange(a,"margin",(e.x-g.x-g.width)/y),this.v7AttrChange(a,"width",o/y)):(this.v7AttrChange(a,"margin",(e.y-g.y-g.height)/y),this.v7AttrChange(a,"width",d/k)),this.v7SendAttrChanges(a,!1)}else{if(l){let a=this.v7EvalLength("margin",y,.02);b=Math.round(g.x+g.width+a),o=this.v7EvalLength("width",y,.05),C=g.y,d=g.height}else{let a=this.v7EvalLength("margin",k,.02);b=g.x,o=g.width,C=Math.round(g.y+g.height+a),d=this.v7EvalLength("width",k,.05)}H(this.draw_g,b,C)}let x=this.draw_g.selectChild(".colbtns");if(x.empty()?x=this.draw_g.append("svg:g").attr("class","colbtns"):x.selectAll("*").remove(),!X)return;x.append("svg:path").attr("d",`M0,0H${o}V${d}H0Z`).style("stroke","black").style("fill","none"),(M===void 0||A===void 0)&&(M=s,A=F),l?t.z_handle.configureAxis("zaxis",M,A,s,F,!0,[d,0],-d,{reverse:!1}):t.z_handle.configureAxis("zaxis",M,A,s,F,!1,[0,o],o,{reverse:!1});for(let a=0;a<r.length-1;++a){let f=Math.round(t.z_handle.gr(r[a])),m=Math.round(t.z_handle.gr(r[a+1])),c=i.getContourColor((r[a]+r[a+1])/2),v=x.append("svg:path").attr("d",l?`M0,${m}H${o}V${f}H0Z`:`M${f},0V${d}H${m}V0Z`).style("fill",c).style("stroke",c).property("fill0",c).property("fill1",O(c).darker(.5).formatRgb());this.isBatchMode()||(this.isTooltipAllowed()&&v.on("mouseover",function(){_(this).transition().duration(100).style("fill",_(this).property("fill1"))}).on("mouseout",function(){_(this).transition().duration(100).style("fill",_(this).property("fill0"))}).append("svg:title").text(r[a].toFixed(2)+" - "+r[a+1].toFixed(2)),P.Zooming&&v.on("dblclick",()=>t.unzoom("z")))}t.z_handle.maxTickSize=Math.round(o*.3);let R=t.z_handle.drawAxis(this.draw_g,H(l?o:0,d),l?-1:1);return this.isBatchMode()||e?R:R.then(()=>{if(P.ContextMenu&&this.draw_g.on("contextmenu",n=>{n.stopPropagation(),n.preventDefault(),S(n,this).then(h=>{h.header("Palette"),h.addchk(l,"Vertical",w=>{this.v7SetAttr("vertical",w),this.redrawPad()}),t.z_handle.fillAxisContextMenu(h,"z"),h.show()})}),V(this,{x:b,y:C,width:o,height:d,minwidth:20,minheight:20,no_change_x:!l,no_change_y:l,redraw:n=>this.drawPalette(n)}),!P.Zooming)return;let a=!1,f=0,m=0,c,v,$,u,q=n=>{if(!a)return;if(n.preventDefault(),u=E(n,this.draw_g.node()),$)return t.z_handle.processLabelsMove("move",u);l?m=Math.min(Math.max(u[1],0),d):m=Math.min(Math.max(u[0],0),o);let h=Math.abs(m-f);!v&&h>1&&(c.style("display",null),v=!0),l?c.attr("y",Math.min(f,m)).attr("height",h):c.attr("x",Math.min(f,m)).attr("width",h)},I=n=>{if(a)if(n.preventDefault(),_(window).on("mousemove.colzoomRect",null).on("mouseup.colzoomRect",null),c.remove(),c=null,a=!1,$)t.z_handle.processLabelsMove("stop",u);else{let h=t.z_handle.func,w=h.invert(f),z=h.invert(m);this.getFramePainter().zoom("z",Math.min(w,z),Math.max(w,z))}},J=n=>{a||(a=!0,n.preventDefault(),n.stopPropagation(),u=E(n,this.draw_g.node()),f=m=u[l?1:0],v=!1,$=!1,c=x.append("svg:rect").attr("class","zoom").attr("id","colzoomRect").style("display","none"),l?c.attr("x",0).attr("width",o).attr("y",f).attr("height",1):c.attr("x",f).attr("width",1).attr("y",0).attr("height",d),_(window).on("mousemove.colzoomRect",q).on("mouseup.colzoomRect",I,!0),setTimeout(()=>{!v&&a&&($=t.z_handle.processLabelsMove("start",u))},500))},L=()=>{this.draw_g.selectAll(".axis_zoom, .axis_labels").on("mousedown",J).on("dblclick",()=>t.unzoom("z")),P.ZoomWheel&&this.draw_g.on("wheel",n=>{n.stopPropagation(),n.preventDefault();let h=E(n,this.draw_g.node()),w=l?1-h[1]/d:h[0]/o,z=t.z_handle.analyzeWheelEvent(n,w);z.changed&&t.zoom("z",z.min,z.max)})};t.z_handle.setAfterDrawHandler(L),L()})}static draw(e,i,r){return D(this,null,function*(){let t=new p(e,i,r,"palette");return B(t,!1).then(()=>(t.createG(),t))})}};export{W as RPalettePainter,rt as drawBox,it as drawLine,nt as drawMarker,at as drawText};

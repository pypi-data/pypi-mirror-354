import{b as H}from"./chunk-O2YOIZWS.js";import{a as _,b as $}from"./chunk-C4APR3G7.js";import{h as w}from"./chunk-YC5SGHGH.js";import{H as T,ha as N,ka as C}from"./chunk-FVXVO67X.js";import{Na as u,Ta as X,Ua as S,eb as d,f as v,g as p,jb as b,kb as M,t as F,u as P}from"./chunk-KYOHYQWH.js";import{k as y}from"./chunk-KYPE3LET.js";function z(r,e,t,i){let n,a;i>0?(a=Math.log(i),n=t>0?Math.log(t):a-5):(a=-10,n=-15),r.fNbins=e,r.fXbins=new Array(e+1);for(let s=0;s<=e;++s)r.fXbins[s]=Math.exp(n+s/e*(a-n));r.fXmin=Math.exp(n),r.fXmax=Math.exp(a)}function A(r){p(r)||(r="");let e=r.indexOf(";webcanv_hist"),t=!1,i=0;return e>=0&&(t=!0,r=r.slice(0,e)),e=r.indexOf(";force_saved"),e>=0&&(i=2,r=r.slice(0,e)),e=r.indexOf(";prefer_saved"),e>=0&&(i=1,r=r.slice(0,e)),{opt:r,webcanv_hist:t,use_saved:i}}var O=class r extends H{#e;getObjectName(){return this.$func?.fName??"func"}getClassName(){return this.$func?._typename??X}isTF1(){return!0}isTF12(){return this.getClassName()===S}getPrimaryObject(){return this.$func}updateObject(e){if(!e||this.getClassName()!==e._typename)return!1;delete e.evalPar;let t=this.getHisto();if(this.webcanv_hist){let i=this.getPadPainter()?.findInPrimitives("Func",u);i&&this.updateAxes(t,i,this.getFramePainter())}return this.$func=e,this.createTF1Histogram(e,t),this.scanContent(),!0}redraw(e){return!this.#e&&(e==="logx"||e==="zoom")&&(this.createTF1Histogram(this.$func,this.getHisto()),this.scanContent()),super.redraw(e)}createTF1Histogram(e,t){let i=this.getFramePainter(),n=this.getPadPainter()?.getRootPad(!0),a=n?.fLogx,s=i?.getGrFuncs(this.second_x,this.second_y),o=e.fXmin,c=e.fXmax,m=Math.max(e.fNpx,100);if(s?.zoom_xmin!==s?.zoom_xmax){let l=(c-o)/m;o<s.zoom_xmin&&s.zoom_xmin<c&&(o=Math.max(o,s.zoom_xmin-l)),o<s.zoom_xmax&&s.zoom_xmax<c&&(c=Math.min(c,s.zoom_xmax+l))}this.#e=e.fSave.length>3&&(F.PreferSavedPoints||this.use_saved>1);let h=l=>{t.fNcells!==l+2&&(t.fNcells=l+2,t.fArray=new Float32Array(t.fNcells)),t.fArray.fill(0),t.fXaxis.fNbins=l,t.fXaxis.fXbins=[]};if(delete this._fail_eval,!this.#e){let l=!1;if(!e.evalPar)try{this.isTF12()?_(e.fF2)?e.evalPar=function(f){return this.fCase?this.fF2.evalPar(f,this.fXY):this.fF2.evalPar(this.fXY,f)}:l=!0:_(e)||(l=!0)}catch{l=!0}h(m),a?z(t.fXaxis,m,o,c):(t.fXaxis.fXmin=o,t.fXaxis.fXmax=c);for(let f=0;f<m&&!l;f++){let x=t.fXaxis.GetBinCenter(f+1),g=0;try{g=e.evalPar(x)}catch{l=!0}l||t.setBinContent(f+1,Number.isFinite(g)?g:0)}l&&(this._fail_eval=!0),l&&e.fSave.length>3&&(this.#e=!0)}if(this.#e){m=e.fSave.length-3;let l=null;if(o=e.fSave[m+1],c=e.fSave[m+2],o===c){let f=this.getMainPainter();v(f?.getHisto)&&(l=f?.getHisto()?.fXaxis)}if(l){h(t.fXaxis.fNbins),Object.assign(t.fXaxis,l);for(let f=0;f<m;++f){let x=e.fSave[f];t.setBinContent(f+1,Number.isFinite(x)?x:0)}}else{h(e.fNpx),t.fXaxis.fXmin=e.fXmin,t.fXaxis.fXmax=e.fXmax;for(let f=0;f<e.fNpx;++f){let x=$(e,t.fXaxis.GetBinCenter(f+1));t.setBinContent(f+1,Number.isFinite(x)?x:0)}}}t.fName="Func",M(t,e.fTitle),t.fMinimum=e.fMinimum,t.fMaximum=e.fMaximum,t.fLineColor=e.fLineColor,t.fLineStyle=e.fLineStyle,t.fLineWidth=e.fLineWidth,t.fFillColor=e.fFillColor,t.fFillStyle=e.fFillStyle,t.fMarkerColor=e.fMarkerColor,t.fMarkerStyle=e.fMarkerStyle,t.fMarkerSize=e.fMarkerSize,t.fBits|=d}extractAxesProperties(e){super.extractAxesProperties(e);let t=this.$func,i=t?.fSave.length??0;i>3&&this.#e&&(this.xmin=Math.min(this.xmin,t.fSave[i-2]),this.xmax=Math.max(this.xmax,t.fSave[i-1])),t&&(this.xmin=Math.min(this.xmin,t.fXmin),this.xmax=Math.max(this.xmax,t.fXmax))}canZoomInside(e,t,i){let n=this.$func?.fSave.length??0;if(n>3&&this.#e&&e==="x"){let a=n-2,s=this.$func.fSave[n-2],o=this.$func.fSave[n-1];return Math.abs(o-s)/a<Math.abs(i-t)}return e==="x"||e==="y"}getTF1Tooltips(e){delete this.$tmp_tooltip;let t=[this.getObjectHint()],i=this.getFramePainter()?.getGrFuncs(this.options.second_x,this.options.second_y);if(!i||!v(this.$func?.evalPar))return t.push("grx = "+e.x,"gry = "+e.y),t;let n=i.revertAxis("x",e.x),a=0,s=0,o=!1;try{a=this.$func.evalPar(n),s=Math.round(i.gry(a))}catch{o=!0}return t.push("x = "+i.axisAsText("x",n),"value = "+(o?"<fail>":T(a,P.fStatFormat))),o||(this.$tmp_tooltip={y:a,gry:s}),t}processTooltipEvent(e){if(this.#e)return super.processTooltipEvent(e);let t=this.draw_g?.selectChild(".tooltip_bin");if(!this.draw_g||!e)return t?.remove(),null;let i={name:this.$func?.fName,title:this.$func?.fTitle,x:e.x,y:e.y,color1:this.lineatt?.color??"green",color2:this.fillatt?.getFillColorAlt("blue")??"blue",lines:this.getTF1Tooltips(e),exact:!0,menu:!0};return e.disabled?t.remove():(t.empty()&&(t=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").style("fill","none").attr("r",(this.lineatt?.width??1)+4)),t.attr("cx",e.x).attr("cy",this.$tmp_tooltip.gry??e.y),this.lineatt&&t.call(this.lineatt.func)),i}fillWebObjectOptions(e){e.fcust=this._fail_eval&&!this.use_saved?"func_fail":""}static draw(e,t,i){return y(this,null,function*(){let n=A(i);i=n.opt,delete n.opt;let a;n.webcanv_hist&&(a=new N(e).getPadPainter()?.findInPrimitives("Func",u)),a||(a=b(u,100),a.fBits|=d),!i&&C(e)&&(i="same");let s=new r(e,a);return s.$func=t,Object.assign(s,n),s.createTF1Histogram(t,a),w._drawHist(s,i)})}};export{z as a,A as b,O as c};

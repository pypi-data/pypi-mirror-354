import{a as w}from"./chunk-MGNYDHM4.js";import{qa as M,ta as S}from"./chunk-FVXVO67X.js";import{bb as x,e as b,f as g,g as z,j as A,t as I,u as C}from"./chunk-KYOHYQWH.js";import{k as y}from"./chunk-KYPE3LET.js";function u(f){f._typename===`${x}RAxisEquidistant`||f._typename===`${x}RAxisLabels`?(f.fInvBinWidth===0&&(f.$dummy=!0,f.fInvBinWidth=1,f.fNBinsNoOver=0,f.fLow=0),f.min=f.fLow,f.max=f.fLow+f.fNBinsNoOver/f.fInvBinWidth,f.GetNumBins=function(){return this.fNBinsNoOver},f.GetBinCoord=function(i){return this.fLow+i/this.fInvBinWidth},f.FindBin=function(i,n){return Math.floor((i-this.fLow)*this.fInvBinWidth+n)}):f._typename===`${x}RAxisIrregular`&&(f.min=f.fBinBorders.at(0),f.max=f.fBinBorders.at(-1),f.GetNumBins=function(){return this.fBinBorders.length},f.GetBinCoord=function(i){let n=Math.round(i);if(n<=0)return this.fBinBorders.at(0);if(n>=this.fBinBorders.length)return this.fBinBorders.at(-1);if(n===i)return this.fBinBorders[n];let t=i<n?n-1:n+1;return this.fBinBorders[n]*Math.abs(i-t)+this.fBinBorders[t]*Math.abs(i-n)},f.FindBin=function(i,n){for(let t=1;t<this.fBinBorders.length;++t)if(i<this.fBinBorders[t])return Math.floor(t-1+n);return this.fBinBorders.length-1}),f.GetBinCenter=function(i){return this.GetBinCoord(i-.5)},f.GetBinLowEdge=function(i){return this.GetBinCoord(i-1)}}function _(f){return f?.fHistImpl?.fIO||null}var P=class extends w{constructor(i,n){super(i,n),this.csstype="hist",this.draw_content=!0,this.nbinsx=0,this.nbinsy=0,this.mode3d=!1,this.getHisto(!0)}isDisplayItem(){return this.getObject()?.fAxes}getHisto(i){let n=this.getObject(),t=_(n);return t&&(!t.getBinContent||i)?t.fAxes._2?(u(t.fAxes._0),u(t.fAxes._1),u(t.fAxes._2),t.getBin=function(s,o,r){return s-1+this.fAxes._0.GetNumBins()*(o-1)+this.fAxes._0.GetNumBins()*this.fAxes._1.GetNumBins()*(r-1)},t.getBinContent=function(s,o,r){return this.fStatistics.fBinContent[this.getBin(s,o,r)]},t.getBinError=function(s,o,r){let e=this.getBin(s,o,r);return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[e]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[e]))}):t.fAxes._1?(u(t.fAxes._0),u(t.fAxes._1),t.getBin=function(s,o){return s-1+this.fAxes._0.GetNumBins()*(o-1)},t.getBinContent=function(s,o){return this.fStatistics.fBinContent[this.getBin(s,o)]},t.getBinError=function(s,o){let r=this.getBin(s,o);return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[r]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[r]))}):(u(t.fAxes._0),t.getBin=function(s){return s-1},t.getBinContent=function(s){return this.fStatistics.fBinContent[s-1]},t.getBinError=function(s){return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[s-1]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[s-1]))}):!t&&n?.fAxes&&(t=n,(!t.getBinContent||i)&&(t.fAxes.length===3?(u(t.fAxes[0]),u(t.fAxes[1]),u(t.fAxes[2]),t.nx=t.fIndicies[1]-t.fIndicies[0],t.dx=t.fIndicies[0]+1,t.stepx=t.fIndicies[2],t.ny=t.fIndicies[4]-t.fIndicies[3],t.dy=t.fIndicies[3]+1,t.stepy=t.fIndicies[5],t.nz=t.fIndicies[7]-t.fIndicies[6],t.dz=t.fIndicies[6]+1,t.stepz=t.fIndicies[8],t.getBin=function(s,o,r){return s-1+this.fAxes[0].GetNumBins()*(o-1)+this.fAxes[0].GetNumBins()*this.fAxes[1].GetNumBins()*(r-1)},t.stepx>1||t.stepy>1||t.stepz>1?t.getBin0=function(s,o,r){return Math.floor((s-this.dx)/this.stepx)+this.nx/this.stepx*Math.floor((o-this.dy)/this.stepy)+this.nx/this.stepx*this.ny/this.stepy*Math.floor((r-this.dz)/this.stepz)}:t.getBin0=function(s,o,r){return s-this.dx+this.nx*(o-this.dy)+this.nx*this.ny*(r-this.dz)},t.getBinContent=function(s,o,r){return this.fBinContent[this.getBin0(s,o,r)]},t.getBinError=function(s,o,r){return Math.sqrt(Math.abs(this.getBinContent(s,o,r)))}):t.fAxes.length===2?(u(t.fAxes[0]),u(t.fAxes[1]),t.nx=t.fIndicies[1]-t.fIndicies[0],t.dx=t.fIndicies[0]+1,t.stepx=t.fIndicies[2],t.ny=t.fIndicies[4]-t.fIndicies[3],t.dy=t.fIndicies[3]+1,t.stepy=t.fIndicies[5],t.getBin=function(s,o){return s-1+this.fAxes[0].GetNumBins()*(o-1)},t.stepx>1||t.stepy>1?t.getBin0=function(s,o){return Math.floor((s-this.dx)/this.stepx)+this.nx/this.stepx*Math.floor((o-this.dy)/this.stepy)}:t.getBin0=function(s,o){return s-this.dx+this.nx*(o-this.dy)},t.getBinContent=function(s,o){return this.fBinContent[this.getBin0(s,o)]},t.getBinError=function(s,o){return Math.sqrt(Math.abs(this.getBinContent(s,o)))}):(u(t.fAxes[0]),t.nx=t.fIndicies[1]-t.fIndicies[0],t.dx=t.fIndicies[0]+1,t.stepx=t.fIndicies[2],t.getBin=function(s){return s-1},t.stepx>1?t.getBin0=function(s){return Math.floor((s-this.dx)/this.stepx)}:t.getBin0=function(s){return s-this.dx},t.getBinContent=function(s){return this.fBinContent[this.getBin0(s)]},t.getBinError=function(s){return Math.sqrt(Math.abs(this.getBinContent(s)))}))),t}decodeOptions(){this.options||(this.options={Hist:1,System:1})}copyOptionsFrom(i){if(i===this)return;let n=this.options,t=i.options;n.Mode3D=t.Mode3D}copyOptionsToOthers(){this.forEachPainter(i=>{i!==this&&g(i.copyOptionsFrom)&&i.copyOptionsFrom(this)},"objects")}clear3DScene(){let i=this.getFramePainter();g(i?.create3DScene)&&i.create3DScene(-1),this.mode3d=!1}cleanup(){this.clear3DScene(),delete this.options,super.cleanup()}getDimension(){return 1}scanContent(){}drawFrameAxes(){return y(this,null,function*(){let i=this.getFramePainter();return i?this.draw_content?this.isMainPainter()?(i.cleanupAxes(),i.xmin=i.xmax=0,i.ymin=i.ymax=0,i.zmin=i.zmax=0,i.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,this.getAxis("z"),this.zmin,this.zmax),i.drawAxes()):!this.options.second_x&&!this.options.second_y?!0:(i.setAxes2Ranges(this.options.second_x,this.getAxis("x"),this.xmin,this.xmax,this.options.second_y,this.getAxis("y"),this.ymin,this.ymax),i.drawAxes2(this.options.second_x,this.options.second_y)):!0:!1})}createHistDrawAttributes(){this.createv7AttFill(),this.createv7AttLine()}updateDisplayItem(i,n){return!i||!n?!1:(i.fAxes=n.fAxes,i.fIndicies=n.fIndicies,i.fBinContent=n.fBinContent,i.fContMin=n.fContMin,i.fContMinPos=n.fContMinPos,i.fContMax=n.fContMax,this.getHisto(!0),!0)}updateObject(i){let n=this.getObject();if(i!==n){if(!this.matchObjectType(i))return!1;if(this.isDisplayItem())this.updateDisplayItem(n,i);else{let t=_(n),s=_(i);if(!t||!s)return!1;t.fStatistics=s.fStatistics,n.fTitle=i.fTitle}}return this.scanContent(),this.histogram_updated=!0,!0}getAxis(i){let n=this.getHisto(),t=this.getObject(),s;if(t?.fAxes)switch(i){case"x":s=t.fAxes[0];break;case"y":s=t.fAxes[1];break;case"z":s=t.fAxes[2];break;default:s=t.fAxes[0];break}else if(n?.fAxes)switch(i){case"x":s=n.fAxes._0;break;case"y":s=n.fAxes._1;break;case"z":s=n.fAxes._2;break;default:s=n.fAxes._0;break}return s&&!s.GetBinCoord&&u(s),s}getAxisBinTip(i,n,t){let s=this.getFramePainter(),o=s[`${i}_handle`],r=this.getAxis(i),e=r.GetBinCoord(n);if(o.kind===M)return s.axisAsText(i,e);let a=r.GetBinCoord(n+(t||1));return o.kind===S?s.axisAsText(i,(e+a)/2):`[${s.axisAsText(i,e)}, ${s.axisAsText(i,a)})`}extractAxesProperties(i){if(!this.getHisto())return;this.nbinsx=this.nbinsy=this.nbinsz=0;let t=this.getAxis("x");this.nbinsx=t.GetNumBins(),this.xmin=t.min,this.xmax=t.max,!(i<2)&&(t=this.getAxis("y"),this.nbinsy=t.GetNumBins(),this.ymin=t.min,this.ymax=t.max,!(i<3)&&(t=this.getAxis("z"),this.nbinsz=t.GetNumBins(),this.zmin=t.min,this.zmax=t.max))}addInteractivity(){let i=this.isMainPainter(),n=this.options.second_x||this.options.second_y;return(i||n?this.getFramePainter():null)?.addInteractivity(!i&&n)??!0}processItemReply(i,n){if(!this.isDisplayItem())return console.error("Get item when display normal histogram");n.reqid===this.current_item_reqid&&(i!==null&&this.updateDisplayItem(this.getObject(),i.item),n.resolveFunc(!0))}drawingBins(i){return y(this,null,function*(){let n=!1;return i&&z(i)&&i.indexOf("zoom")===0&&(i.indexOf("0")>0&&(n=!0),this.getDimension()>1&&i.indexOf("1")>0&&(n=!0),this.getDimension()>2&&i.indexOf("2")>0&&(n=!0)),this.isDisplayItem()&&n&&this.v7NormalMode()&&this.prepareDraw({only_indexes:!0}).incomplete?new Promise(s=>{let o=this.v7SubmitRequest("",{_typename:`${x}RHistDrawableBase::RRequest`},this.processItemReply.bind(this));o?(this.current_item_reqid=o.reqid,o.resolveFunc=s,setTimeout(this.processItemReply.bind(this,null,o),1e3)):s(!0)}):!0})}toggleStat(){}getSelectIndex(i,n,t){let s=this.getAxis(i),o=this["nbins"+i]||0;this.options.second_x&&i==="x"&&(i="x2"),this.options.second_y&&i==="y"&&(i="y2");let r=this.getFramePainter(),e=r?r[`zoom_${i}min`]:0,a=r?r[`zoom_${i}max`]:0,h;return e!==a&&s?(n==="left"?h=s.FindBin(e,t||0):h=s.FindBin(a,(t||0)+.5),h<0?h=0:h>o&&(h=o)):h=n==="left"?0:o,h}autoZoom(){}clickButton(i){let n=this.getFramePainter();if(!n)return!1;switch(i){case"ToggleZoom":if(this.zoom_xmin!==this.zoom_xmax||this.zoom_ymin!==this.zoom_ymax||this.zoom_zmin!==this.zoom_zmax){let t=this.unzoom();return n.zoomChangedInteractive("reset"),t}if(this.draw_content)return this.autoZoom();break;case"ToggleLogX":return n.toggleAxisLog("x");case"ToggleLogY":return n.toggleAxisLog("y");case"ToggleLogZ":return n.toggleAxisLog("z");case"ToggleStatBox":return A(this.toggleStat())}return!1}fillToolbar(i){let n=this.getPadPainter();n&&(n.addPadButton("auto_zoom","Toggle between unzoom and autozoom-in","ToggleZoom","Ctrl *"),n.addPadButton("arrow_right","Toggle log x","ToggleLogX","PageDown"),n.addPadButton("arrow_up","Toggle log y","ToggleLogY","PageUp"),this.getDimension()>1&&n.addPadButton("arrow_diag","Toggle log z","ToggleLogZ"),this.draw_content&&n.addPadButton("statbox","Toggle stat box","ToggleStatBox"),i||n.showPadButtons())}getBinErrors(i,n){let t=i.getBinError(n);return{low:t,up:t}}get3DToolTip(i){let n=this.getHisto(),t={bin:i,name:n.fName||"histo",title:n.fTitle};switch(this.getDimension()){case 1:t.ix=i+1,t.iy=1,t.value=n.getBinContent(t.ix),t.error=n.getBinError(t.ix),t.lines=this.getBinTooltips(i-1);break;case 2:t.ix=i%this.nbinsx+1,t.iy=(i-(t.ix-1))/this.nbinsx+1,t.value=n.getBinContent(t.ix,t.iy),t.error=n.getBinError(t.ix,t.iy),t.lines=this.getBinTooltips(t.ix-1,t.iy-1);break;case 3:t.ix=i%this.nbinsx+1,t.iy=(i-(t.ix-1))/this.nbinsx%this.nbinsy+1,t.iz=(i-(t.ix-1)-(t.iy-1)*this.nbinsx)/this.nbinsx/this.nbinsy+1,t.value=n.getBinContent(t.ix,t.iy,t.iz),t.error=n.getBinError(t.ix,t.iy,t.iz),t.lines=this.getBinTooltips(t.ix-1,t.iy-1,t.iz-1);break}return t}createContour(i,n,t){if(!i||!n)return;t||(t={});let s=C.fNumberContours,o=this.minbin,r=this.maxbin,e=this.minposbin;t.scatter_plot&&(s>50&&(s=50),o=this.minposbin),o===r&&(o=this.gminbin,r=this.gmaxbin,e=this.gminposbin),this.getDimension()<3&&(i.zoom_zmin!==i.zoom_zmax?(o=i.zoom_zmin,r=i.zoom_zmax):t.full_z_range&&(o=i.zmin,r=i.zmax)),n.setFullRange(i.zmin,i.zmax),n.createContour(i.logz,s,o,r,e),this.getDimension()<3&&(i.scale_zmin=n.colzmin,i.scale_zmax=n.colzmax)}changeValuesRange(i,n){let t=this.getFramePainter();if(!t)return;let s=t.isAxisZoomed(n)?"zoom_"+n:n,o="["+t[`${s}min`]+","+t[`${s}max`]+"]";i.input("Enter values range for axis "+n+" like [0,100] or empty string to unzoom",o).then(r=>{r=r?JSON.parse(r):[],!b(r)||r.length!==2||!Number.isFinite(r[0])||!Number.isFinite(r[1])?t.unzoom(n):t.zoom(n,r[0],r[1])})}fillContextMenuItems(i){this.draw_content&&(i.addchk(this.toggleStat("only-check"),"Show statbox",()=>this.toggleStat()),this.getDimension()===2&&i.add("Values range",()=>this.changeValuesRange(i,"z")),g(this.fillHistContextMenu)&&this.fillHistContextMenu(i));let n=this.getFramePainter();if(this.options.Mode3D){i.size()>0&&i.separator();let t=this.getMainPainter()||this;i.addchk(t.isTooltipAllowed(),"Show tooltips",()=>t.setTooltipAllowed("toggle")),i.addchk(n?.enable_highlight,"Highlight bins",()=>{n.enable_highlight=!n.enable_highlight,!n.enable_highlight&&t.mode3d&&g(t.highlightBin3D)&&t.highlightBin3D(null)}),g(n?.render3D)&&(i.addchk(t.options.FrontBox,"Front box",()=>{t.options.FrontBox=!t.options.FrontBox,n.render3D()}),i.addchk(t.options.BackBox,"Back box",()=>{t.options.BackBox=!t.options.BackBox,n.render3D()})),this.draw_content&&(i.addchk(!this.options.Zero,"Suppress zeros",()=>{this.options.Zero=!this.options.Zero,this.redrawPad()}),(this.options.Lego===12||this.options.Lego===14)&&this.fillPaletteMenu(i)),g(t.control?.reset)&&i.add("Reset camera",()=>t.control.reset())}this.histogram_updated&&n.zoomChangedInteractive()&&i.add("Let update zoom",()=>n.zoomChangedInteractive("reset"))}updatePaletteDraw(){this.isMainPainter()&&this.getPadPainter().findPainterFor(void 0,void 0,`${x}RPaletteDrawable`)?.drawPalette()}fillPaletteMenu(i){i.addPaletteMenu(this.options.Palette||I.Palette,n=>{this.options.Palette=parseInt(n),this.redraw()})}toggleMode3D(){return this.options.Mode3D=!this.options.Mode3D,this.options.Mode3D&&!this.options.Surf&&!this.options.Lego&&!this.options.Error&&(this.nbinsx>=50||this.nbinsy>=50?this.options.Lego=this.options.Color?14:13:this.options.Lego=this.options.Color?12:1,this.options.Zero=!1),this.copyOptionsToOthers(),this.interactiveRedraw("pad","drawopt")}prepareDraw(i){i||(i={rounding:!0,extra:0,middle:0}),i.extra===void 0&&(i.extra=0),i.right_extra===void 0&&(i.right_extra=i.extra),i.middle===void 0&&(i.middle=0);let n=this.getHisto(),t=this.getAxis("x"),s=this.getAxis("y"),o=this.getFramePainter(),r=this.getDimension(),e={i1:this.getSelectIndex("x","left",0-i.extra),i2:this.getSelectIndex("x","right",1+i.right_extra),j1:r<2?0:this.getSelectIndex("y","left",0-i.extra),j2:r<2?1:this.getSelectIndex("y","right",1+i.right_extra),k1:r<3?0:this.getSelectIndex("z","left",0-i.extra),k2:r<3?1:this.getSelectIndex("z","right",1+i.right_extra),stepi:1,stepj:1,stepk:1,min:0,max:0,sumz:0,xbar1:0,xbar2:1,ybar1:0,ybar2:1},a,h,l,m,d,p;if(this.isDisplayItem()&&n.fIndicies&&(e.i1<n.fIndicies[0]&&(e.i1=n.fIndicies[0],e.incomplete=!0),e.i2>n.fIndicies[1]&&(e.i2=n.fIndicies[1],e.incomplete=!0),e.stepi=n.fIndicies[2],e.stepi>1&&(e.incomplete=!0),r>1&&n.fIndicies.length>5&&(e.j1<n.fIndicies[3]&&(e.j1=n.fIndicies[3],e.incomplete=!0),e.j2>n.fIndicies[4]&&(e.j2=n.fIndicies[4],e.incomplete=!0),e.stepj=n.fIndicies[5],e.stepj>1&&(e.incomplete=!0)),r>2&&n.fIndicies.length>8&&(e.k1<n.fIndicies[6]&&(e.k1=n.fIndicies[6],e.incomplete=!0),e.k2>n.fIndicies[7]&&(e.k2=n.fIndicies[7],e.incomplete=!0),e.stepk=n.fIndicies[8],e.stepk>1&&(e.incomplete=!0))),i.only_indexes)return e;e.grx=new Array(e.i2+e.stepi+1),e.gry=new Array(e.j2+e.stepj+1),i.original&&(e.original=!0,e.origx=new Array(e.i2+1),e.origy=new Array(e.j2+1)),i.pixel_density&&(i.rounding=!0);let c=o.getGrFuncs(this.options.second_x,this.options.second_y);for(a=e.i1;a<=e.i2;++a){if(l=t.GetBinCoord(a+i.middle),c.logx&&l<=0){e.i1=a+1;continue}e.origx&&(e.origx[a]=l),e.grx[a]=c.grx(l),i.rounding&&(e.grx[a]=Math.round(e.grx[a])),i.use3d&&(e.grx[a]<-o.size_x3d&&(e.i1=a,e.grx[a]=-o.size_x3d),e.grx[a]>o.size_x3d&&(e.i2=a,e.grx[a]=o.size_x3d))}for(i.use3d&&(e.i1<e.i2-2&&e.grx[e.i1]===e.grx[e.i1+1]&&e.i1++,e.i1<e.i2-2&&e.grx[e.i2-1]===e.grx[e.i2]&&e.i2--);a<e.i2+e.stepi+1;)e.grx[a++]=e.grx[e.i2];if(r===1)e.gry[0]=c.gry(0),e.gry[1]=c.gry(1);else for(h=e.j1;h<=e.j2;++h){if(m=s.GetBinCoord(h+i.middle),c.logy&&m<=0){e.j1=h+1;continue}e.origy&&(e.origy[h]=m),e.gry[h]=c.gry(m),i.rounding&&(e.gry[h]=Math.round(e.gry[h])),i.use3d&&(e.gry[h]<-o.size_y3d&&(e.j1=h,e.gry[h]=-o.size_y3d),e.gry[h]>o.size_y3d&&(e.j2=h,e.gry[h]=o.size_y3d))}if(i.use3d&&r>1&&(e.j1<e.j2-2&&e.gry[e.j1]===e.gry[e.j1+1]&&e.j1++,e.j1<e.j2-2&&e.gry[e.j2-1]===e.gry[e.j2]&&e.j2--),r>1)for(;h<e.j2+e.stepj+1;)e.gry[h++]=e.gry[e.j2];let B=!0;for(this.minposbin=0,a=e.i1;a<e.i2;a+=e.stepi)for(h=e.j1;h<e.j2;h+=e.stepj)if(d=n.getBinContent(a+1,h+1),!!Number.isFinite(d)){if(e.sumz+=d,i.pixel_density){if(p=(e.grx[a+e.stepi]-e.grx[a])*(e.gry[h]-e.gry[h+e.stepj]),p<=0)continue;e.max=Math.max(e.max,d),d>0&&(d<e.min||e.min===0)&&(e.min=d),d/=p}B?(this.maxbin=this.minbin=d,B=!1):(this.maxbin=Math.max(this.maxbin,d),this.minbin=Math.min(this.minbin,d)),d>0&&(this.minposbin===0||d<this.minposbin)&&(this.minposbin=d)}return B&&(this.maxbin=this.minbin=0),e.palette=o.getHistPalette(),e.palette&&this.createContour(o,e.palette,i),e}};export{P as a};

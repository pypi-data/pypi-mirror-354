import{Aa as _,I as X,Ja as v,M as O,O as u}from"./chunk-FVXVO67X.js";import{f as k,ta as D,ua as R,va as b,wa as E,x as S}from"./chunk-KYOHYQWH.js";import{k as Y}from"./chunk-KYPE3LET.js";function I(){return Y(this,null,function*(){let t=this.getObject(),c=this.getPadPainter(),o=this.getFramePainter(),e=t.fName.startsWith("http://")||t.fName.startsWith("https://"),a=t.fX,f=t.fY,d=!1,n=1,h=this.matchObjectType(E);if(this.createAttText({attr:t}),h&&o?.mode3d&&k(o?.convert3DtoPadNDC)){let i=o.convert3DtoPadNDC(t.fX,t.fY,t.fZ);a=i.x,f=i.y,this.isndc=!0,h="3d"}else t.TestBit(S(14))?this.isndc=!0:c.getRootPad(!0)?d=new X(this.getDrawOpt()).check("FRAME"):(this.isndc=!0,a=f=.5,t.fTextAlign=22);this.createG(d?"frame2d":void 0,e),this.draw_g.attr("transform",null),this.pos_x=this.axisToSvg("x",a,this.isndc),this.pos_y=this.axisToSvg("y",f,this.isndc),this.swap_xy=d&&o?.swap_xy,this.swap_xy&&([this.pos_x,this.pos_y]=[this.pos_y,this.pos_x]);let r=this.textatt.createArg({x:this.pos_x,y:this.pos_y,text:t.fTitle,latex:0});return t._typename===R||h?r.latex=1:t._typename===b&&(r.latex=2,n=.8),e&&(this.draw_g.attr("href",t.fName),this.isBatchMode()||this.draw_g.append("svg:title").text(`link on ${t.fName}`)),this.startTextDrawingAsync(this.textatt.font,this.textatt.getSize(c,n)).then(()=>this.drawText(r)).then(()=>this.finishTextDrawing()).then(()=>this.isBatchMode()?this:c.isButton()&&!c.isEditable()?(this.draw_g.on("click",()=>this.getCanvPainter().selectActivePad(c)),this):(this.pos_dx=this.pos_dy=0,this.moveDrag||(this.moveDrag=function(i,s){this.pos_dx+=i,this.pos_dy+=s,u(this.draw_g,this.pos_dx,this.pos_dy)}),this.moveEnd||(this.moveEnd=function(i){if(i)return;let s=this.getObject(),x=this.svgToAxis("x",this.pos_x+this.pos_dx,this.isndc),l=this.svgToAxis("y",this.pos_y+this.pos_dy,this.isndc);this.swap_xy&&([x,l]=[l,x]),s.fX=x,s.fY=l,this.submitCanvExec(`SetX(${x});;SetY(${l});;`)}),h!=="3d"?_(this,!0,e):(o.processRender3D=!0,this.handleRender3D=()=>{let i=o.convert3DtoPadNDC(t.fX,t.fY,t.fZ),s=this.axisToSvg("x",i.x,!0),x=this.axisToSvg("y",i.y,!0);u(this.draw_g,s-this.pos_x,x-this.pos_y)}),v(this),this.fillContextMenuItems=function(i){i.add("Change text",()=>i.input("Enter new text",t.fTitle).then(s=>{t.fTitle=s,this.interactiveRedraw("pad",`exec:SetTitle("${s}")`)}))},this.matchObjectType(D)&&this.draw_g.style("cursor","pointer").on("click",()=>this.submitCanvExec("ExecuteEvent(kButton1Up, 0, 0);;")),this))})}function Z(){let t=this.getObject(),c=t.fPhimin===0&&t.fPhimax===360,o=t._typename==="TCrown";this.createAttLine({attr:t}),this.createAttFill({attr:t}),this.createG();let e=this.getAxisToSvgFunc(),a=e.x(t.fX1),f=e.y(t.fY1),d=o&&t.fR1<=0?e.x(t.fX1+t.fR2)-a:e.x(t.fX1+t.fR1)-a,n=f-e.y(t.fY1+t.fR2),h=Math.PI/180,r="";if(o&&t.fR1>0){let i=t.fYXRatio??1,s=d,x=i*n,l=i*(f-e.y(t.fY1+t.fR1)),p=e.x(t.fX1+t.fR2)-a;if(c)r=`M${-s},0A${s},${l},0,1,0,${s},0A${s},${l},0,1,0,${-s},0M${-p},0A${p},${x},0,1,0,${p},0A${p},${x},0,1,0,${-p},0`;else{let T=t.fPhimax-t.fPhimin>=180?1:0,y=t.fPhimin*h,g=t.fPhimax*h,M=Math.round(s*Math.cos(y)),w=Math.round(l*Math.sin(y)),A=Math.round(s*Math.cos(g)),P=Math.round(l*Math.sin(g)),m=Math.round(p*Math.cos(y)),$=Math.round(x*Math.sin(y)),C=Math.round(p*Math.cos(g)),N=Math.round(x*Math.sin(g));r=`M${A},${P}A${s},${l},0,${T},0,${M},${w}L${m},${$}A${p},${x},0,${T},1,${C},${N}Z`}}else if(t.fTheta===0)if(c)r=`M${-d},0A${d},${n},0,1,0,${d},0A${d},${n},0,1,0,${-d},0Z`;else{let i=Math.round(d*Math.cos(t.fPhimin*h)),s=Math.round(n*Math.sin(t.fPhimin*h)),x=Math.round(d*Math.cos(t.fPhimax*h)),l=Math.round(n*Math.sin(t.fPhimax*h));r=`M0,0L${i},${s}A${d},${n},0,1,1,${x},${l}Z`}else{let i=Math.cos(t.fTheta*h),s=Math.sin(t.fTheta*h),x=t.fPhimin*h,l=t.fPhimax*h,p=200,T=(l-x)/(p-(c?0:1)),y=0,g=0;c||(r="M0,0");for(let M=0;M<p;++M){let w=x+M*T,A=t.fR1*Math.cos(w),P=t.fR2*Math.sin(w),m=e.x(t.fX1+A*i-P*s)-a,$=e.y(t.fY1+A*s+P*i)-f;r?y===m?r+=`v${$-g}`:g===$?r+=`h${m-y}`:r+=`l${m-y},${$-g}`:r=`M${m},${$}`,y=m,g=$}r+="Z"}this.x=a,this.y=f,u(this.draw_g.append("svg:path"),a,f).attr("d",r).call(this.lineatt.func).call(this.fillatt.func),v(this),_(this),this.moveDrag=function(i,s){this.x+=i,this.y+=s,u(this.draw_g.select("path"),this.x,this.y)},this.moveEnd=function(i){if(i)return;let s=this.getObject();s.fX1=this.svgToAxis("x",this.x),s.fY1=this.svgToAxis("y",this.y),this.submitCanvExec(`SetX1(${s.fX1});;SetY1(${s.fY1});;Notify();;`)}}function G(){this.createG();let t=this.getObject(),c=t.fPieSlices.length,o=this.axisToSvg("x",t.fX),e=this.axisToSvg("y",t.fY),a=this.axisToSvg("x",t.fX+t.fRadius)-o,f=this.axisToSvg("y",t.fY+t.fRadius)-e;u(this.draw_g,o,e);let d=0,n=t.fAngularOffset*Math.PI/180,h=Math.round(a*Math.cos(n)),r=Math.round(f*Math.sin(n));for(let i=0;i<c;i++)d+=t.fPieSlices[i].fValue;for(let i=0;i<c;i++){let s=t.fPieSlices[i];this.createAttLine({attr:s}),this.createAttFill({attr:s}),n+=s.fValue/d*2*Math.PI;let x=Math.round(a*Math.cos(n)),l=Math.round(f*Math.sin(n));this.draw_g.append("svg:path").attr("d",`M0,0L${h},${r}A${a},${f},0,0,0,${x},${l}z`).call(this.lineatt.func).call(this.fillatt.func),h=x,r=l}}function z(){let t=this.getObject(),c=S(14);this.isndc=t.TestBit(c);let o=this.isndc?!1:new X(this.getDrawOpt()).check("FRAME"),e=o&&this.getFramePainter()?.swap_xy;this.createAttMarker({attr:t}),this.createG(o?"frame2d":void 0);let a=this.axisToSvg("x",t.fX,this.isndc),f=this.axisToSvg("y",t.fY,this.isndc);e&&([a,f]=[f,a]);let d=this.markeratt.create(a,f);d&&this.draw_g.append("svg:path").attr("d",d).call(this.markeratt.func),v(this),_(this),this.dx=this.dy=0,this.moveDrag=function(n,h){this.dx+=n,this.dy+=h,this.draw_g&&u(this.draw_g.select("path"),this.dx,this.dy)},this.moveEnd=function(n){if(n||!this.draw_g)return;let h=this.getObject(),r=this.svgToAxis("x",this.axisToSvg("x",h.fX,this.isndc)+this.dx,this.isndc),i=this.svgToAxis("y",this.axisToSvg("y",h.fY,this.isndc)+this.dy,this.isndc);e&&([r,i]=[i,r]),h.fX=r,h.fY=i,this.submitCanvExec(`SetX(${r});;SetY(${i});;Notify();;`),this.redraw()}}function V(){let t=this.getObject(),c=this.getAxisToSvgFunc();this.createAttMarker({attr:t}),this.createG();let o="";for(let e=0;e<=t.fLastPoint;++e)o+=this.markeratt.create(c.x(t.fX[e]),c.y(t.fY[e]));o&&this.draw_g.append("svg:path").attr("d",o).call(this.markeratt.func),v(this),_(this),this.dx=this.dy=0,this.moveDrag=function(e,a){this.dx+=e,this.dy+=a,u(this.draw_g.select("path"),this.dx,this.dy)},this.moveEnd=function(e){if(e)return;let a=this.getObject(),f=this.getAxisToSvgFunc(),d="";for(let n=0;n<=a.fLastPoint;++n){let h=this.svgToAxis("x",f.x(a.fX[n])+this.dx),r=this.svgToAxis("y",f.y(a.fY[n])+this.dy);a.fX[n]=h,a.fY[n]=r,d+=`SetPoint(${n},${h},${r});;`}this.submitCanvExec(d+"Notify();;"),this.redraw()}}function W(t,c,o){let e=new O(t),a=e.selectDom(),f=a.append("img").attr("src",c.fName).attr("title",c.fTitle||c.fName);return o&&o.indexOf("scale")>=0?f.style("width","100%").style("height","100%"):o&&o.indexOf("center")>=0&&(a.style("position","relative"),f.attr("style","margin: 0; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);")),e.setTopPainter(),e}export{Z as drawEllipse,W as drawJSImage,z as drawMarker,G as drawPie,V as drawPolyMarker,I as drawText};

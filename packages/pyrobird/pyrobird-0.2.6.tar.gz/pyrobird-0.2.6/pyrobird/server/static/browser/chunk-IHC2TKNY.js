import{a as W}from"./chunk-7MTENYBP.js";import{b as q,f as K}from"./chunk-MGNYDHM4.js";import{c as R,d as G,e as L,f as V,g as N}from"./chunk-LGENSGLC.js";import{a as Z}from"./chunk-LWQ6XHU3.js";import{H as Y,J as O,P as E,b as H}from"./chunk-FVXVO67X.js";import{db as z,fb as k,g as X,t as I,u as F}from"./chunk-KYOHYQWH.js";import{k as $}from"./chunk-KYPE3LET.js";var A=class S extends W{constructor(i,t){super(i,t),this.wheel_zoomy=!0}cleanup(){delete this.tt_handle,super.cleanup()}getDimension(){return 2}toggleProjection(i,t){(i==="Projections"||i==="Off")&&(i="");let e=t,r=t;if(X(i)&&i.indexOf("XY")===0){let h=i.length>2?i.slice(2):"";i="XY",e=r=parseInt(h)}else if(X(i)&&i.length>1){let h=i.indexOf("_");h>0&&i[0]==="X"&&i[h+1]==="Y"?(e=parseInt(i.slice(1,h))||1,r=parseInt(i.slice(h+2))||1,i="XY"):h>0&&i[0]==="Y"&&i[h+1]==="X"?(r=parseInt(i.slice(1,h))||1,e=parseInt(i.slice(h+2))||1,i="XY"):(e=r=parseInt(i.slice(1))||1,i=i[0])}if(!e&&!r&&(e=r=1),i&&this.is_projection===i)if(this.projection_widthX===e&&this.projection_widthY===r)i="";else{this.projection_widthX=e,this.projection_widthY=r;return}delete this.proj_hist;let s=this.is_projection===i?"":i;this.projection_widthX=e,this.projection_widthY=r,this.is_projection="",this.provideSpecialDrawArea(s).then(()=>(this.is_projection=s,this.redrawProjection()))}redrawProjection(){}executeMenuCommand(i,t){return super.executeMenuCommand(i,t)?!0:i.fName==="SetShowProjectionX"||i.fName==="SetShowProjectionY"?(this.toggleProjection(i.fName[17],t&&parseInt(t)?parseInt(t):1),!0):!1}fillHistContextMenu(i){if(this.getPadPainter()?.iscan){let e=this.is_projection||"";e&&(e+=this.projection_widthX),this.projection_widthX!==this.projection_widthY&&this.is_projection==="XY"&&(e=`X${this.projection_widthX}_Y${this.projection_widthY}`);let r=["X1","X2","X3","X5","X10","Y1","Y2","Y3","Y5","Y10","XY1","XY2","XY3","XY5","XY10"];e&&r.unshift("Off"),i.sub("Projections",()=>i.input("Input projection kind X1 or XY2 or X3_Y4",e,"string").then(s=>this.toggleProjection(s)));for(let s=0;s<r.length;++s)i.addchk(e===r[s],r[s],r[s],h=>this.toggleProjection(h));i.endsub()}i.add("Auto zoom-in",()=>this.autoZoom());let t=this.getSupportedDrawOptions();i.addDrawMenu("Draw with",t,e=>{if(e.indexOf(k)===0)return this.showInspector(e);this.decodeOptions(e),this.interactiveRedraw("pad","drawopt")}),this.options.Color&&this.fillPaletteMenu(i)}clickButton(i){let t=super.clickButton(i);if(t)return t;switch(i){case"ToggleColor":return this.toggleColor();case"Toggle3D":return this.toggleMode3D()}return!1}fillToolbar(){super.fillToolbar(!0);let i=this.getPadPainter();i&&(i.addPadButton("th2color","Toggle color","ToggleColor"),i.addPadButton("th2colorz","Toggle color palette","ToggleColorZ"),i.addPadButton("th2draw3d","Toggle 3D mode","Toggle3D"),i.showPadButtons())}toggleColor(){return this.options.Mode3D?(this.options.Mode3D=!1,this.options.Color=!0):this.options.Color=!this.options.Color,this.redraw()}autoZoom(){let i=this.getSelectIndex("x","left",-1),t=this.getSelectIndex("x","right",1),e=this.getSelectIndex("y","left",-1),r=this.getSelectIndex("y","right",1),s=this.getHisto(),h=this.getAxis("x"),m=this.getAxis("y");if(i===t||e===r)return;let p=s.getBinContent(i+1,e+1);for(let x=i;x<t;++x)for(let u=e;u<r;++u)p=Math.min(p,s.getBinContent(x+1,u+1));if(p>0)return;let f=t,o=i,d=r,n=e;for(let x=i;x<t;++x)for(let u=e;u<r;++u)s.getBinContent(x+1,u+1)>p&&(x<f&&(f=x),x>=o&&(o=x+1),u<d&&(d=u),u>=n&&(n=u+1));let c,y,l,a,g=!1;if(f===o-1&&f>i+1&&o<t-1&&(f--,o++),d===n-1&&d>e+1&&n<r-1&&(d--,n++),(f>i||o<t)&&f<o-1&&(c=h.GetBinCoord(f),y=h.GetBinCoord(o),g=!0),(d>e||n<r)&&d<n-1&&(l=m.GetBinCoord(d),a=m.GetBinCoord(n),g=!0),g)return this.getFramePainter().zoom(c,y,l,a)}scanContent(i){if(i&&this.nbinsx&&this.nbinsy)return;let t=this.getHisto();if(this.extractAxesProperties(2),this.isDisplayItem())this.gminbin=t.fContMin,this.gminposbin=t.fContMinPos>0?t.fContMinPos:null,this.gmaxbin=t.fContMax;else{this.gminbin=this.gmaxbin=t.getBinContent(1,1),this.gminposbin=null;for(let e=0;e<this.nbinsx;++e)for(let r=0;r<this.nbinsy;++r){let s=t.getBinContent(e+1,r+1);s<this.gminbin?this.gminbin=s:s>this.gmaxbin&&(this.gmaxbin=s),s>0&&(this.gminposbin===null||this.gminposbin>s)&&(this.gminposbin=s)}}this.zmin=this.gminbin,this.zmax=this.gmaxbin,this.gminposbin===null&&this.gmaxbin>0&&(this.gminposbin=this.gmaxbin*1e-4),this.options.Axis>0?this.draw_content=!1:this.draw_content=this.gmaxbin!==0||this.gminbin!==0}countStat(i){let t=this.getHisto(),e={name:"histo",entries:0,integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[0,0,0,0,0,0,0,0,0],xmax:0,ymax:0,wmax:null},r=this.getSelectIndex("x","left"),s=this.getSelectIndex("x","right"),h=this.getSelectIndex("y","left"),m=this.getSelectIndex("y","right"),p=this.getAxis("x"),f=this.getAxis("y"),o=0,d=0,n=0,c=0,y=0,l,a,g,x,u,b,w;for(b=1;b<=this.nbinsx;++b)for(l=b<=r+1?0:b>s+1?2:1,g=p.GetBinCoord(b-.5),w=1;w<=this.nbinsy;++w)a=w<=h+1?0:w>m+1?2:1,x=f.GetBinCoord(w-.5),u=t.getBinContent(b,w),e.entries+=u,e.matrix[a*3+l]+=u,!(l!==1||a!==1)&&(i&&!i(g,x)||((e.wmax===null||u>e.wmax)&&(e.wmax=u,e.xmax=g,e.ymax=x),o+=u,d+=g*u,n+=x*u,c+=g**2*u,y+=x**2*u));return Math.abs(o)>1e-300&&(e.meanx=d/o,e.meany=n/o,e.rmsx=Math.sqrt(Math.abs(c/o-e.meanx**2)),e.rmsy=Math.sqrt(Math.abs(y/o-e.meany**2))),e.wmax===null&&(e.wmax=0),e.integral=o,e}fillStatistic(i,t){let e=this.countStat(),r=Math.floor(t%10),s=Math.floor(t/10)%10,h=Math.floor(t/100)%10,m=Math.floor(t/1e3)%10,p=Math.floor(t/1e4)%10,f=Math.floor(t/1e5)%10,o=Math.floor(t/1e6)%10,d=Math.floor(t/1e7)%10,n=Math.floor(t/1e8)%10;if(i.clearStat(),r>0&&i.addText(e.name),s>0&&i.addText("Entries = "+i.format(e.entries,"entries")),h>0&&(i.addText("Mean x = "+i.format(e.meanx)),i.addText("Mean y = "+i.format(e.meany))),m>0&&(i.addText("Std Dev x = "+i.format(e.rmsx)),i.addText("Std Dev y = "+i.format(e.rmsy))),o>0&&i.addText("Integral = "+i.format(e.matrix[4],"entries")),d>0&&(i.addText("Skewness x = <undef>"),i.addText("Skewness y = <undef>")),n>0&&i.addText("Kurt = <undef>"),p>0||f>0){let c=e.matrix;i.addText(c[6].toFixed(0)+" | "+c[7].toFixed(0)+" | "+c[7].toFixed(0)),i.addText(c[3].toFixed(0)+" | "+c[4].toFixed(0)+" | "+c[5].toFixed(0)),i.addText(c[0].toFixed(0)+" | "+c[1].toFixed(0)+" | "+c[2].toFixed(0))}return!0}drawBinsColor(){let i=this.getHisto(),t=this.prepareDraw(),e=t.stepi,r=t.stepj,s=[],h=!0,m,p,f,o,d,n,c,y,l,a,g=()=>{a.path+=`h${c}v${a.y2-a.y}h${-c}z`,a.dy=0,a=null};for(o=t.i1;o<t.i2;o+=e){for(c=t.grx[o+e]-t.grx[o]||1,d=t.j1;d<t.j2;d+=r){if(n=i.getBinContent(o+1,d+1),m=t.palette.getContourIndex(n),n===0&&(this.options.Zero?m===null&&this._show_empty_bins&&(m=0):m=null),m===null){a&&g();continue}if(p=`M${t.grx[o]},${t.gry[d]}`,y=t.gry[d+r]-t.gry[d]||-1,l=s[m],l===void 0)l=s[m]={path:p};else if(h&&l===a){l.y2=t.gry[d]+y;continue}else f=`m${t.grx[o]-l.x},${t.gry[d]-l.y}`,l.path+=f.length<p.length?f:p;a&&g(),l.x=t.grx[o],l.y=t.gry[d],h?(l.y2=t.gry[d]+y,a=l):l.path+=`h${c}v${y}h${-c}z`}a&&g()}return s.forEach((x,u)=>{x&&this.draw_g.append("svg:path").attr("d",x.path).style("fill",t.palette.getColor(u))}),this.updatePaletteDraw(),t}drawBinsContour(i,t,e){let r=this.prepareDraw({rounding:!1,extra:100}),s=this.getFramePainter(),h=s.getHistPalette(),m=h.getContour(),p=s.getProjectionFunc(),f=(o,d,n,c,y)=>{let l="",a,g,x,u;for(let b=n;b<=c;++b){if(p?(g=p(o[b],d[b]),g.x=Math.round(i.grx(g.x)),g.y=Math.round(i.gry(g.y))):g={x:Math.round(o[b]),y:Math.round(d[b])},!l)l=`M${g.x},${g.y}`,x=g;else if(b===c&&x&&g.x===x.x&&g.y===x.y){if(!u)return"";l+="z",y=!1}else g.x!==a.x&&g.y!==a.y?(l+=`l${g.x-a.x},${g.y-a.y}`,u=!0):g.x!==a.x?(l+=`h${g.x-a.x}`,u=!0):g.y!==a.y&&(l+=`v${g.y-a.y}`,u=!0);a=g}return y&&(l+="z"),l};return this.options.Contour===14&&this.draw_g.append("svg:path").attr("d",`M0,0h${t}v${e}h${-t}z`).style("fill",h.getColor(0)),Z(this.getHisto(),r,m,h,(o,d,n,c,y)=>{let l=h.getColor(o),a=l,g;switch(this.options.Contour){case 1:break;case 11:a="none",g=this.createAttLine({color:l,std:!1});break;case 12:a="none",g=this.createAttLine({color:1,style:o%5+1,width:1,std:!1});break;case 13:a="none",g=this.lineatt;break;case 14:break}let x=f(d,n,c,y,a!=="none");if(!x)return;let u=this.draw_g.append("svg:path").attr("d",x).style("fill",a);g&&u.call(g.func)}),r.hide_only_zeros=!0,r}createPolyBin(){return""}drawBinsText(i){return $(this,null,function*(){i||(i=this.prepareDraw({rounding:!1}));let t=this.getHisto(),e=this.v7EvalFont("text",{size:20,color:"black",align:22}),r=this.options.BarOffset||0,s=this.draw_g.append("svg:g").attr("class","th2_text"),h=i.stepi,m=i.stepj,p=!1;return this.startTextDrawingAsync(e,"font",s).then(()=>{for(let f=i.i1;f<i.i2;f+=h)for(let o=i.j1;o<i.j2;o+=m){let d=t.getBinContent(f+1,o+1);if(d===0&&!this._show_empty_bins)continue;let n=i.grx[f+h]-i.grx[f],c=i.gry[o]-i.gry[o+m];p&&(d=t.getBinEntries(f+1,o+1));let y=d===Math.round(d)?d.toString():Y(d,F.fPaintTextFormat),l,a,g,x;e.angle?(l=Math.round(i.grx[f]+n*.5),a=Math.round(i.gry[o+m]+c*(.5+r)),g=x=0):(l=Math.round(i.grx[f]+n*.1),a=Math.round(i.gry[o+m]+c*(.1+r)),g=Math.round(n*.8),x=Math.round(c*.8)),this.drawText({align:22,x:l,y:a,width:g,height:x,text:y,latex:0,draw_g:s})}return i.hide_only_zeros=!0,this.finishTextDrawing(s,!0)}).then(()=>i)})}drawBinsArrow(){let i=this.getHisto(),t=this.prepareDraw({rounding:!1}),e=(t.grx[t.i2]-t.grx[t.i1])/(t.i2-t.i1+1-.03)/2,r=(t.gry[t.j2]-t.gry[t.j1])/(t.j2-t.j1+1-.03)/2,s=t.stepi,h=t.stepj,m=(j,M)=>j?M?`l${j},${M}`:`h${j}`:M?`v${M}`:"",p="",f,o,d=1e-30,n,c,y,l,a,g,x,u,b,w,_,C,B;for(let j=0;j<2;++j)for(f=t.i1;f<t.i2;f+=s)for(o=t.j1;o<t.j2;o+=h)f===t.i1?n=i.getBinContent(f+1+s,o+1)-i.getBinContent(f+1,o+1):f>=t.i2-s?n=i.getBinContent(f+1,o+1)-i.getBinContent(f+1-s,o+1):n=.5*(i.getBinContent(f+1+s,o+1)-i.getBinContent(f+1-s,o+1)),o===t.j1?c=i.getBinContent(f+1,o+1+h)-i.getBinContent(f+1,o+1):o>=t.j2-h?c=i.getBinContent(f+1,o+1)-i.getBinContent(f+1,o+1-h):c=.5*(i.getBinContent(f+1,o+1+h)-i.getBinContent(f+1,o+1-h)),j===0?d=Math.max(d,Math.abs(n),Math.abs(c)):(y=(t.grx[f]+t.grx[f+s])/2,l=(t.gry[o]+t.gry[o+h])/2,a=e*n/d,g=r*c/d,x=y-a,u=y+a,b=l-g,w=l+g,n=Math.round(u-x),c=Math.round(w-b),(n!==0||c!==0)&&(p+="M"+Math.round(x)+","+Math.round(b)+m(n,c),(Math.abs(n)>5||Math.abs(c)>5)&&(_=Math.sqrt(2/(n**2+c**2)),C=Math.round(_*(n+c)),B=Math.round(_*(n-c)),(C||B)&&(p+=`m${-C},${B}`+m(C,-B)+m(-B,-C)))));return this.draw_g.append("svg:path").attr("d",p).style("fill","none").call(this.lineatt.func),t}drawBinsBox(){let i=this.getHisto(),t=this.prepareDraw({rounding:!1}),e=this.getFramePainter();e.maxbin===e.minbin&&(e.maxbin=this.gmaxbin,e.minbin=this.gminbin,e.minposbin=this.gminposbin),e.maxbin===e.minbin&&(e.minbin=Math.min(0,e.maxbin-1));let r=Math.max(Math.abs(e.maxbin),Math.abs(e.minbin)),s=Math.max(0,e.minbin),h=t.stepi,m=t.stepj,p,f,o,d,n="",c="",y="",l="",a,g,x,u,b,w,_,C,B=!1,j=0;if(e.logz&&r>0){B=!0;let M=Math.log(r);s>0?j=Math.log(s):e.minposbin>=1&&e.minposbin<100?j=Math.log(.7):j=e.minposbin>0?Math.log(.7*e.minposbin):M-10,j>=M&&(j=M-10),C=1/(M-j)}else C=1/(r-s);for(p=t.i1;p<t.i2;p+=h)for(f=t.j1;f<t.j2;f+=m)if(o=i.getBinContent(p+1,f+1),d=Math.abs(o),!(d===0||d<s)&&(a=B?d>0?Math.log(d)-j:0:d-s,a=.5*(a<0?1:1-Math.sqrt(a*C)),a<0&&(a=0),w=t.grx[p+h]-t.grx[p],_=t.gry[f]-t.gry[f+m],g=a*w,x=a*_,u=Math.round(t.grx[p]+g),b=Math.round(t.gry[f+m]+x),w=Math.max(Math.round(w-2*g),1),_=Math.max(Math.round(_-2*x),1),n+=`M${u},${b}v${_}h${w}v${-_}z`,o<0&&this.options.BoxStyle===10&&(c+=`M${u},${b}l${w},${_}M${u+w},${b}l${-w},${_}`),this.options.BoxStyle===11&&w>5&&_>5)){let M=Math.round(w*.1),D=Math.round(_*.1),P=`M${u},${b}h${w}l${-M},${D}h${2*M-w}v${_-2*D}l${-M},${D}z`,T=`M${u+w},${b+_}v${-_}l${-M},${D}v${_-2*D}h${2*M-w}l${-M},${D}z`;l+=o<0?P:T,y+=o<0?T:P}if(n){let M=this.draw_g.append("svg:path").attr("d",n).call(this.fillatt.func);this.options.BoxStyle!==11&&this.fillatt.empty()&&M.call(this.lineatt.func)}if(y&&this.fillatt.hasColor()&&this.draw_g.append("svg:path").attr("d",y).call(this.fillatt.func).style("fill",H(this.fillatt.color).brighter(.5).formatRgb()),l&&this.draw_g.append("svg:path").attr("d",l).call(this.fillatt.func).style("fill",this.fillatt.hasColor()?H(this.fillatt.color).darker(.5).formatRgb():"red"),c){let M=this.draw_g.append("svg:path").attr("d",c).style("fill","none");this.lineatt.empty()||M.call(this.lineatt.func)}return t}drawBinsScatter(){let i=this.getHisto(),t=this.prepareDraw({rounding:!0,pixel_density:!0,scatter_plot:!0}),e=[],r=[],s=[],h=[],m=[],p=this.options.ScatCoef*(this.gmaxbin>2e3?2e3/this.gmaxbin:1),f=t.stepi,o=t.stepj,d=new O(t.sumz),n,c,y,l,a,g,x,u,b=1;if(p*t.sumz<1e5){this.createv7AttMarker(),this.markeratt.resetPos();let B="",j,M;for(l=t.i1;l<t.i2;l+=f)for(x=t.grx[l+f]-t.grx[l],a=t.j1;a<t.j2;a+=o)if(u=t.gry[a]-t.gry[a+o],g=i.getBinContent(l+1,a+1),M=Math.round(p*g),!(M<=0))for(j=0;j<M;++j)B+=this.markeratt.create(Math.round(t.grx[l]+x*d.random()),Math.round(t.gry[a+1]+u*d.random()));return this.draw_g.append("svg:path").attr("d",B).call(this.markeratt.func),t}for(this.maxbin>.7&&(b=.7/this.maxbin),l=t.i1;l<t.i2;l+=f)for(a=t.j1;a<t.j2;a+=o)g=i.getBinContent(l+1,a+1),!(g<=0||g<this.minbin)&&(x=t.grx[l+f]-t.grx[l],u=t.gry[a]-t.gry[a+o],!(x*u<=0)&&(n=t.palette.getContourIndex(g/x/u),!(n<0)&&(c=`M${t.grx[l]},${t.gry[a+o]}`,e[n]===void 0?(e[n]=c,h[n]=x,m[n]=u):(y=`m${t.grx[l]-r[n]},${t.gry[a+o]-s[n]}`,e[n]+=y.length<c.length?y:c,h[n]=Math.max(h[n],x),m[n]=Math.max(m[n],u)),r[n]=t.grx[l],s[n]=t.gry[a+o],e[n]+=`v${u}h${x}v${-u}z`)));let w=this.getFrameSvg().selectChild(".main_layer"),_=w.selectChild("def");_.empty()&&e.length>0&&(_=w.insert("svg:defs",":first-child")),this.createv7AttMarker();let C=t.palette.getContour();for(n=0;n<e.length;++n)if(e[n]!==void 0&&n<C.length){let B=(this.pad_name||"canv")+`_scatter_${n}`,j=_.selectChild(`#${B}`);j.empty()?j=_.append("svg:pattern").attr("id",B).attr("patternUnits","userSpaceOnUse"):j.selectAll("*").remove();let M=Math.round(b*C[n]*h[n]*m[n]);M<1&&(M=1);let D=new Float32Array(M),P=new Float32Array(M);if(M===1)D[0]=P[0]=.5;else for(let v=0;v<M;++v)D[v]=d.random(),P[v]=d.random();this.markeratt.resetPos();let T="";for(let v=0;v<M;++v)T+=this.markeratt.create(D[v]*h[n],P[v]*m[n]);j.attr("width",h[n]).attr("height",m[n]).append("svg:path").attr("d",T).call(this.markeratt.func),this.draw_g.append("svg:path").attr("scatter-index",n).style("fill",`url(#${B})`).attr("d",e[n])}return t}draw2DBins(){return $(this,null,function*(){if(!this.draw_content)return this.removeG(),!1;this.createHistDrawAttributes(),this.createG(!0);let i=this.getFramePainter(),t=i.getFrameRect(),e=i.getGrFuncs(this.options.second_x,this.options.second_y),r=null,s=null;return this.options.Scat?r=this.drawBinsScatter():this.options.Color?r=this.drawBinsColor():this.options.Box?r=this.drawBinsBox():this.options.Arrow?r=this.drawBinsArrow():this.options.Contour>0&&(r=this.drawBinsContour(e,t.width,t.height)),this.options.Text&&(s=this.drawBinsText(r)),!r&&!s&&(r=this.drawBinsColor()),s||(s=Promise.resolve(r)),s.then(h=>(this.tt_handle=h,this))})}getBinTooltips(i,t){let e=[],r=this.getHisto(),s=r.getBinContent(i+1,t+1),h=1,m=1;this.isDisplayItem()&&(h=r.stepx||1,m=r.stepy||1),e.push(this.getObjectHint()||"histo<2>","x = "+this.getAxisBinTip("x",i,h),"y = "+this.getAxisBinTip("y",t,m),`bin = ${i+1}, ${t+1}`),r.$baseh&&(s-=r.$baseh.getBinContent(i+1,t+1));let p="entries = "+(h>1||m>1?"~":"");return s===Math.round(s)?e.push(p+s):e.push(p+Y(s,F.fStatFormat)),e}getPolyBinTooltips(){return[]}processTooltipEvent(i){let t=this.getHisto(),e=this.tt_handle,r=this.draw_g?.selectChild(".tooltip_bin");if(!i||!this.draw_content||!this.draw_g||!e||this.options.Proj)return r?.remove(),null;if(e.poly)return null;let s,h,m=0,p=null;for(s=e.i1;s<e.i2&&!(i.x>=e.grx[s]&&i.x<=e.grx[s+1]);++s);for(h=e.j1;h<e.j2&&!(i.y>=e.gry[h+1]&&i.y<=e.gry[h]);++h);if(s<e.i2&&h<e.j2&&(m=t.getBinContent(s+1,h+1),this.is_projection?p=0:e.hide_only_zeros?p=m===0&&!this._show_empty_bins?null:0:(p=e.palette.getContourIndex(m),p===null&&m===0&&this._show_empty_bins&&(p=0))),p===null)return r.remove(),null;let f={name:"histo",title:t.fTitle||"title",x:i.x,y:i.y,color1:this.lineatt?.color??"green",color2:this.fillatt?.getFillColorAlt("blue")??"blue",lines:this.getBinTooltips(s,h),exact:!0,menu:!0};if(this.options.Color&&(f.color2=e.palette.getColor(p)),i.disabled&&!this.is_projection)r.remove(),f.changed=!0;else{r.empty()&&(r=this.draw_g.append("svg:path").attr("class","tooltip_bin").style("pointer-events","none").call(E));let o=this.getFramePainter(),d=s,n=s+1,c=h,y=h+1,l=e.grx[d],a=e.grx[n],g=e.gry[y],x=e.gry[c],u=s*1e4+h,b;if(this.is_projection){let w=this.projection_widthX||1,_=(w-1)/2;this.is_projection.indexOf("X")>=0&&w>1&&(y+_>=e.j2?(y=Math.min(Math.round(y+_),e.j2),c=Math.max(y-w,e.j1)):(c=Math.max(Math.round(c-_),e.j1),y=Math.min(c+w,e.j2)));let C=this.projection_widthY||1,B=(C-1)/2;this.is_projection.indexOf("Y")>=0&&C>1&&(n+B>=e.i2?(n=Math.min(Math.round(n+B),e.i2),d=Math.max(n-C,e.i1)):(d=Math.max(Math.round(d-B),e.i1),n=Math.min(d+C,e.i2)))}this.is_projection==="X"?(l=0,a=o.getFrameWidth(),g=e.gry[y],x=e.gry[c],u=c*777+y*333):this.is_projection==="Y"?(g=0,x=o.getFrameHeight(),l=e.grx[d],a=e.grx[n],u=d*777+n*333):this.is_projection==="XY"&&(g=e.gry[y],x=e.gry[c],l=e.grx[d],a=e.grx[n],u=d*789+n*653+c*12345+y*654321,b=`M${l},0H${a}V${g}H${o.getFrameWidth()}V${x}H${a}V${o.getFrameHeight()}H${l}V${x}H0V${g}H${l}Z`),f.changed=r.property("current_bin")!==u,f.changed&&r.attr("d",b||`M${l},${g}H${a}V${x}H${l}Z`).style("opacity","0.7").property("current_bin",u),this.is_projection&&f.changed&&this.redrawProjection(d,n,c,y)}return f.changed&&(f.user_info={obj:t,name:"histo",bin:t.getBin(s+1,h+1),cont:m,binx:s+1,biny:h+1,grx:i.x,gry:i.y}),f}canZoomInside(i,t,e){if(i==="z")return!0;let r=this.getAxis(i);return r.FindBin(e,.5)-r.FindBin(t,0)>1}draw2D(i){return $(this,null,function*(){return this.clear3DScene(),this.drawFrameAxes().then(t=>t?this.drawingBins(i):!1).then(t=>{if(t)return this.draw2DBins().then(()=>this.addInteractivity())}).then(()=>this)})}draw3D(i){return $(this,null,function*(){return console.log("3D drawing is disabled, load ./hist/RH1Painter.mjs"),this.draw2D(i)})}callDrawFunc(i){return $(this,null,function*(){let t=this.getFramePainter();return t&&t.mode3d!==this.options.Mode3D&&!this.isMainPainter()&&(this.options.Mode3D=t.mode3d),this.options.Mode3D?this.draw3D(i):this.draw2D(i)})}redraw(i){return $(this,null,function*(){return this.callDrawFunc(i)})}static _draw(i){return $(this,null,function*(){return K(i).then(()=>{i.setAsMainPainter(),i.options={Hist:!1,Error:!1,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!0,TextAngle:0,TextKind:"",BaseLine:!1,Mode3D:!1,AutoColor:0,Color:!1,Scat:!1,ScatCoef:1,Box:!1,BoxStyle:0,Arrow:!1,Contour:0,Proj:0,BarOffset:0,BarWidth:1,minimum:z,maximum:z,FrontBox:!1,BackBox:!1};let t=i.v7EvalAttr("kind",""),e=i.v7EvalAttr("sub",0),r=i.options;switch(r.Text=i.v7EvalAttr("drawtext",!1),t){case"lego":r.Lego=e>0?10+e:12,r.Mode3D=!0;break;case"surf":r.Surf=e>0?10+e:1,r.Mode3D=!0;break;case"box":r.Box=!0,r.BoxStyle=10+e;break;case"err":r.Error=!0,r.Mode3D=!0;break;case"cont":r.Contour=e>0?10+e:1;break;case"arr":r.Arrow=!0;break;case"scat":r.Scat=!0;break;case"col":r.Color=!0;break;default:r.Text||(r.Color=!0)}return i._show_empty_bins=!1,i.scanContent(),i.callDrawFunc()})})}static draw(i,t,e){return $(this,null,function*(){return S._draw(new S(i,t),e)})}};var U=class S extends A{draw3DBins(){if(this.draw_content){if(this.options.Surf)return N(this,!0);if(this.options.Error)return L(this,!0);if(this.options.Contour)return V(this,!0,!0);G(this,!0),this.updatePaletteDraw()}}draw3D(i){this.mode3d=!0;let t=this.getFramePainter(),e=this.isMainPainter(),r=Promise.resolve(this);if(i==="resize")return e&&t.resize3D()&&t.render3D(),r;let s=1+2*F.fHistTopMargin;return this.zmin=t.logz?this.gminposbin*.3:this.gminbin,this.zmax=this.gmaxbin,this.options.minimum!==z&&(this.zmin=this.options.minimum),this.options.maximum!==z&&(this.zmax=this.options.maximum,s=1),t.logz&&this.zmin<=0&&(this.zmin=this.zmax*1e-5),this.deleteAttr(),e&&(R(t),r=t.create3DScene(this.options.Render3D).then(()=>{t.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,null,this.zmin,this.zmax),t.set3DOptions(this.options),t.drawXYZ(t.toplevel,q,{zmult:s,zoom:I.Zooming,ndim:2,draw:!0,v7:!0})})),t.mode3d?r.then(()=>this.drawingBins(i)).then(()=>{let h=this.getFramePainter();return this.draw3DBins(),h.render3D(),h.addKeysHandler(),this}):r}static draw(i,t,e){return $(this,null,function*(){return S._draw(new S(i,t),e)})}};export{U as a};

import{a as wt}from"./chunk-4U5XXNS7.js";import{a as Mt,b as yt}from"./chunk-LGENSGLC.js";import{b as gt}from"./chunk-LWQ6XHU3.js";import"./chunk-YC5SGHGH.js";import{a as S,d as pt,n as V,q as xt}from"./chunk-FYXTN3X2.js";import"./chunk-D3GAWKNQ.js";import"./chunk-K2P6CES6.js";import"./chunk-Z4ZYSIRC.js";import"./chunk-3L3RRFVB.js";import{I as Xt,K as Yt,ha as mt}from"./chunk-FVXVO67X.js";import{Ra as Nt,ca as at,da as Q,db as st,eb as ct,jb as ut,kb as dt,qa as ot,t as lt}from"./chunk-KYOHYQWH.js";import{k as R}from"./chunk-KYPE3LET.js";function _t(b){let t=b[0];for(let e=1;e<b.length;++e)t=Math.max(t,b[e]);return t}function Tt(b){let t=b[0];for(let e=1;e<b.length;++e)t=Math.min(t,b[e]);return t}function zt(b,t,e){let i=new Array(b);for(let h=0;h<b;++h)i[h]={v:t[h],i:h};i.sort((h,N)=>h.v<N.v?-1:h.v>N.v?1:0);for(let h=0;h<b;++h)e[h]=i[h].i}var ft=class{constructor(t){this.fGraph2D=t,this.fX=t.fX,this.fY=t.fY,this.fZ=t.fZ,this.fNpoints=t.fNpoints,this.fZout=0,this.fNdt=0,this.fNhull=0,this.fHullPoints=null,this.fXN=null,this.fYN=null,this.fOrder=null,this.fDist=null,this.fPTried=null,this.fNTried=null,this.fMTried=null,this.fInit=!1,this.fXNmin=0,this.fXNmax=0,this.fYNmin=0,this.fYNmax=0,this.fXoffset=0,this.fYoffset=0,this.fXScaleFactor=0,this.fYScaleFactor=0,this.SetMaxIter()}Initialize(){this.fInit||(this.CreateTrianglesDataStructure(),this.FindHull(),this.fInit=!0)}ComputeZ(t,e){this.Initialize();let i=(t+this.fXoffset)*this.fXScaleFactor,h=(e+this.fYoffset)*this.fYScaleFactor,N=this.Interpolate(i,h);return N===0&&(N=this.Interpolate(i+1e-4,h)),N}CreateTrianglesDataStructure(){let t=_t(this.fGraph2D.fX),e=_t(this.fGraph2D.fY),i=Tt(this.fGraph2D.fX),h=Tt(this.fGraph2D.fY);this.fXoffset=-(t+i)/2,this.fYoffset=-(e+h)/2,this.fXScaleFactor=1/(t-i),this.fYScaleFactor=1/(e-h),this.fXNmax=(t+this.fXoffset)*this.fXScaleFactor,this.fXNmin=(i+this.fXoffset)*this.fXScaleFactor,this.fYNmax=(e+this.fYoffset)*this.fYScaleFactor,this.fYNmin=(h+this.fYoffset)*this.fYScaleFactor,this.fXN=new Array(this.fNpoints+1),this.fYN=new Array(this.fNpoints+1);for(let N=0;N<this.fNpoints;N++)this.fXN[N+1]=(this.fX[N]+this.fXoffset)*this.fXScaleFactor,this.fYN[N+1]=(this.fY[N]+this.fYoffset)*this.fYScaleFactor;this.fPTried=[],this.fNTried=[],this.fMTried=[]}Enclose(t,e,i,h){let N=[this.fXN[t],this.fXN[e],this.fXN[i],this.fXN[t]],l=[this.fYN[t],this.fYN[e],this.fYN[i],this.fYN[t]],a=this.fXN[h],n=this.fYN[h],Y=0,d=N.length-1,c=!1;for(;Y<N.length;++Y)(l[Y]<n&&l[d]>=n||l[d]<n&&l[Y]>=n)&&N[Y]+(n-l[Y])/(l[d]-l[Y])*(N[d]-N[Y])<a&&(c=!c),d=Y;return c}FileIt(t,e,i){let h,N,l=t,a=e,n=i;do h=!1,a>l&&(N=l,l=a,a=N,h=!0),n>a&&(N=a,a=n,n=N,h=!0);while(h);this.fNdt++,this.fPTried.push(l),this.fNTried.push(a),this.fMTried.push(n)}FindAllTriangles(){if(this.fAllTri)return;this.fAllTri=!0;let t,e,i,h,N,l,a,n,Y,d,c,m,s,r,g,f,o,y,p,_,M,u,w,X=0,z=0,x,Z,k=0,P=[!1,!1,!1],F=1e-4;for(this.Initialize(),t=0,e=0,Z=1;Z<=this.fNhull;Z++)t+=this.fXN[this.fHullPoints[Z-1]],e+=this.fYN[this.fHullPoints[Z-1]];for(t=t/this.fNhull+F,e=e/this.fNhull+F,this.Interpolate(t,e),f=1;f<=this.fNdt;){for(y=this.fPTried[f-1],p=this.fNTried[f-1],_=this.fMTried[f-1],P[0]=!1,P[1]=!1,P[2]=!1,o=1;o<=this.fNdt;o++)o!==f&&(M=this.fPTried[o-1],u=this.fNTried[o-1],w=this.fMTried[o-1],y===M&&p===u||y===M&&p===w||y===u&&p===w?P[0]=!0:y===M&&_===u||y===M&&_===w||y===u&&_===w?P[1]=!0:(p===M&&_===u||p===M&&_===w||p===u&&_===w)&&(P[2]=!0)),P[0]&&P[1]&&P[2];for(x=1;x<=3;x++)P[x-1]||(x===1?(X=y,z=p,k=_):x===2?(X=y,z=_,k=p):x===3&&(X=p,z=_,k=y),i=(this.fXN[X]+this.fXN[z])/2,h=(this.fYN[X]+this.fYN[z])/2,a=this.fXN[X]-this.fXN[z],n=this.fYN[X]-this.fYN[z],Y=n,d=-a,r=Math.sqrt(Y*Y+d*d),Y/=r,d/=r,c=this.fXN[k]-i,m=this.fYN[k]-h,s=c*Y+m*d,s>0&&(Y=-Y,d=-d),g=Math.abs(Math.max(F*i,F*h)),N=i+Y*g,l=h+d*g,this.Interpolate(N,l));f++}}FindHull(){this.fHullPoints||(this.fHullPoints=new Array(this.fNpoints));let t=0;for(let e=1;e<=this.fNpoints;e++)this.InHull(e,e)||(t++,this.fHullPoints[t-1]=e);this.fNhull=t}InHull(t,e){let i,h,N,l,a,n,Y,d,c,m,s,r,g,f,o,y,p,_,M,u,w,X=!1,z=this.fXN[t],x=this.fYN[t];for(this.fNhull>0?a=this.fNhull:a=this.fNpoints,i=1,h=2,i===e?(i=h,h++):h===e&&h++,c=z-this.fXN[i],r=x-this.fYN[i],m=z-this.fXN[h],g=x-this.fYN[h],M=Math.atan2(r,c),u=Math.atan2(g,m),w=M-u-Math.floor((M-u)/(Math.PI*2))*Math.PI*2,w<0&&(w+=Math.PI*2),n=w,N=1;N<=a;N++)if(this.fNhull>0?l=this.fHullPoints[N-1]:l=N,l!==i&&l!==h&&l!==e&&(c=z-this.fXN[i],r=x-this.fYN[i],m=z-this.fXN[h],g=x-this.fYN[h],s=z-this.fXN[l],f=x-this.fYN[l],Y=m*r-c*g,d=c*g-m*r,Y*d!==0&&(o=(m*f-s*g)/Y,y=(c*f-s*r)/d,o<0||y<0))){if(p=(c*s+r*f)/Math.sqrt(c*c+r*r),_=(m*s+g*f)/Math.sqrt(m*m+g*g),p>_?(i=l,M=Math.atan2(f,s),u=Math.atan2(g,m)):(h=l,M=Math.atan2(r,c),u=Math.atan2(f,s)),w=M-u-Math.floor((M-u)/(Math.PI*2))*Math.PI*2,w<0&&(w+=Math.PI*2),(w-Math.PI)*(n-Math.PI)<0)return X=!0,X;n=w}return X}InterpolateOnPlane(t,e,i,h){let N,l,a=t,n=e,Y=i;do l=!1,n>a&&(N=a,a=n,n=N,l=!0),Y>n&&(N=n,n=Y,Y=N,l=!0);while(l);let d=this.fXN[a],c=this.fXN[n],m=this.fXN[Y],s=this.fYN[a],r=this.fYN[n],g=this.fYN[Y],f=this.fZ[a-1],o=this.fZ[n-1],y=this.fZ[Y-1],p=(f*(r-g)+o*(g-s)+y*(s-r))/(d*(r-g)+c*(g-s)+m*(s-r)),_=(f*(c-m)+o*(m-d)+y*(d-c))/(s*(c-m)+r*(m-d)+g*(d-c)),M=f-p*d-_*s;return p*this.fXN[h]+_*this.fYN[h]+M}Interpolate(t,e){let i,h,N,l,a,n,Y,d,c,m,s,r,g,f,o,y,p,_,M,u,w=0,X=0,z=0,x=0,Z=0,k,P,F,E,H,O,I,A,q,G,v,D,L,C,T,W,U,tt,J,K,it,ht,rt,$=[0,0,0],B=[0,0,0];if(this.Initialize(),this.fOrder||(this.fOrder=new Array(this.fNpoints),this.fDist=new Array(this.fNpoints)),this.fXN[0]=t,this.fYN[0]=e,i=this.fZout,N=0,t>this.fXNmax||t<this.fXNmin||e>this.fYNmax||e<this.fYNmin)return i;for(h=1;h<=this.fNdt;h++)if(l=this.fPTried[h-1],a=this.fNTried[h-1],n=this.fMTried[h-1],this.Enclose(l,a,n,0))return i=this.InterpolateOnPlane(l,a,n,0),i;let nt=this.InHull(0,-1);if(!nt)return i;for(h=1;h<=this.fNpoints;h++)k=this.fXN[h],P=this.fYN[h],this.fDist[h-1]=Math.sqrt((t-k)*(t-k)+(e-P)*(e-P));for(zt(this.fNpoints,this.fDist,this.fOrder),h=0;h<this.fNpoints;h++)this.fOrder[h]++;for(c=3;c<=this.fNpoints;c++)for(n=this.fOrder[c-1],d=2;d<=c-1;d++)for(a=this.fOrder[d-1],Y=1;Y<=d-1;Y++){let j=!1;if(l=this.fOrder[Y-1],N>this.fMaxIter)return i;if(N++,F=Math.sqrt((this.fXN[l]-this.fXN[a])**2+(this.fYN[l]-this.fYN[a])**2),E=Math.sqrt((this.fXN[l]-this.fXN[n])**2+(this.fYN[l]-this.fYN[n])**2),H=Math.sqrt((this.fXN[a]-this.fXN[n])**2+(this.fYN[a]-this.fYN[n])**2),!(F+E<=H||F+H<=E||E+H<=F)&&this.Enclose(l,a,n,0)){for(w=0,s=1;s<=this.fNpoints;s++)if(!(s===l||s===a||s===n)){for(m=1;m<=this.fNpoints;m++)if(this.fOrder[m-1]===s)if(m<Y||m<d||m<c){if(this.Enclose(l,a,n,s)){j=!0;break}}else break;if(j)break;if((this.fXN[l]-this.fXN[s])*(this.fYN[l]-this.fYN[a])===(this.fYN[l]-this.fYN[s])*(this.fXN[l]-this.fXN[a])?(y=l,p=a):(this.fXN[l]-this.fXN[s])*(this.fYN[l]-this.fYN[n])===(this.fYN[l]-this.fYN[s])*(this.fXN[l]-this.fXN[n])?(y=l,p=n):(this.fXN[a]-this.fXN[s])*(this.fYN[a]-this.fYN[n])===(this.fYN[a]-this.fYN[s])*(this.fXN[a]-this.fXN[n])?(y=a,p=n):(y=0,p=0),y!==0){if(this.fXN[y]!==this.fXN[p])if((this.fXN[s]-this.fXN[y])*(this.fXN[s]-this.fXN[p])<0){j=!0;break}else(this.fXN[s]-this.fXN[y])*(this.fXN[s]-this.fXN[p])===0&&console.warn(`Interpolate Two of these three points are coincident ${y} ${p} ${s}`);else if((this.fYN[s]-this.fYN[y])*(this.fYN[s]-this.fYN[p])<0){j=!0;break}else(this.fYN[s]-this.fYN[y])*(this.fYN[s]-this.fYN[p])===0&&console.warn(`Interpolate Two of these three points are coincident ${y} ${p} ${s}`);continue}if(j)break;for(r=n,f=l,o=a,$[0]=this.fXN[l]-this.fXN[s],B[0]=this.fYN[l]-this.fYN[s],$[1]=this.fXN[a]-this.fXN[s],B[1]=this.fYN[a]-this.fYN[s],$[2]=this.fXN[n]-this.fXN[s],B[2]=this.fYN[n]-this.fYN[s],m=1;m<=3;m++)if(W=$[m-1],U=$[m%3],tt=$[(m+1)%3],J=B[m-1],K=B[m%3],it=B[(m+1)%3],ht=(it*U-tt*K)*(J*U-W*K),rt=(it*W-tt*J)*(K*W-U*J),ht>=0&&rt>=0){m===1?(r=n,f=l,o=a):m===2?(r=l,f=a,o=n):(r=a,f=n,o=l);break}if(L=((this.fXN[r]-this.fXN[f])*(this.fXN[s]-this.fXN[f])+(this.fYN[r]-this.fYN[f])*(this.fYN[s]-this.fYN[f]))/Math.sqrt(((this.fXN[r]-this.fXN[f])*(this.fXN[r]-this.fXN[f])+(this.fYN[r]-this.fYN[f])*(this.fYN[r]-this.fYN[f]))*((this.fXN[s]-this.fXN[f])*(this.fXN[s]-this.fXN[f])+(this.fYN[s]-this.fYN[f])*(this.fYN[s]-this.fYN[f]))),C=((this.fXN[o]-this.fXN[f])*(this.fXN[s]-this.fXN[f])+(this.fYN[o]-this.fYN[f])*(this.fYN[s]-this.fYN[f]))/Math.sqrt(((this.fXN[o]-this.fXN[f])*(this.fXN[o]-this.fXN[f])+(this.fYN[o]-this.fYN[f])*(this.fYN[o]-this.fYN[f]))*((this.fXN[s]-this.fXN[f])*(this.fXN[s]-this.fXN[f])+(this.fYN[s]-this.fYN[f])*(this.fYN[s]-this.fYN[f]))),T=((this.fXN[o]-this.fXN[f])*(this.fXN[r]-this.fXN[f])+(this.fYN[o]-this.fYN[f])*(this.fYN[r]-this.fYN[f]))/Math.sqrt(((this.fXN[o]-this.fXN[f])*(this.fXN[o]-this.fXN[f])+(this.fYN[o]-this.fYN[f])*(this.fYN[o]-this.fYN[f]))*((this.fXN[r]-this.fXN[f])*(this.fXN[r]-this.fXN[f])+(this.fYN[r]-this.fYN[f])*(this.fYN[r]-this.fYN[f]))),!(L>C||L>T))if(A=Math.sqrt((this.fXN[s]-this.fXN[f])*(this.fXN[s]-this.fXN[f])+(this.fYN[s]-this.fYN[f])*(this.fYN[s]-this.fYN[f])),q=Math.sqrt((this.fXN[s]-this.fXN[o])*(this.fXN[s]-this.fXN[o])+(this.fYN[s]-this.fYN[o])*(this.fYN[s]-this.fYN[o])),G=Math.sqrt((this.fXN[r]-this.fXN[f])*(this.fXN[r]-this.fXN[f])+(this.fYN[r]-this.fYN[f])*(this.fYN[r]-this.fYN[f])),v=Math.sqrt((this.fXN[r]-this.fXN[o])*(this.fXN[r]-this.fXN[o])+(this.fYN[r]-this.fYN[o])*(this.fYN[r]-this.fYN[o])),O=((this.fXN[s]-this.fXN[f])*(this.fXN[s]-this.fXN[o])+(this.fYN[s]-this.fYN[f])*(this.fYN[s]-this.fYN[o]))/A/q,I=((this.fXN[r]-this.fXN[f])*(this.fXN[r]-this.fXN[o])+(this.fYN[r]-this.fYN[f])*(this.fYN[r]-this.fYN[o]))/G/v,D=O*Math.sqrt(1-I*I)+I*Math.sqrt(1-O*O),D<-1e-6){j=!0;break}else Math.abs(D)<=1e-6&&(w++,X=s,z=r,x=f,Z=o)}if(!j)return w>0?(g=X,r=z,f=x,o=Z,this.fZ[f-1]+this.fZ[o-1]>this.fZ[g-1]+this.fZ[r-1]?(_=l,M=a,u=n,this.FileIt(l,a,n),this.FileIt(g,f,o)):(_=r,M=g,this.Enclose(r,g,f,0)?u=f:u=o,this.FileIt(r,g,f),this.FileIt(r,g,o))):(this.FileIt(l,a,n),_=l,M=a,u=n),i=this.InterpolateOnPlane(_,M,u,0),i}}return nt&&console.error(`Interpolate Point outside hull when expected inside: this point could be dodgy ${t}  ${e} ${N}`),i}SetMaxIter(t=1e5){this.fAllTri=!1,this.fMaxIter=t}SetMarginBinsContent(t){this.fZout=t}GetContourList(t){if(!this.fNdt)return null;let e,i,h,N,l,a,n,Y,d,c,m,s,r,g,f,o,y,p,_,M,u=0,w,X,z,x,Z=[0,0,0],k=new Array(this.fNdt).fill(0),P=new Array(this.fNdt).fill(0),F=new Array(this.fNdt).fill(0),E=new Array(this.fNdt).fill(0);for(y=0;y<this.fNdt;y++){if(Z[0]=this.fPTried[y],Z[1]=this.fNTried[y],Z[2]=this.fMTried[y],l=Z[0]-1,a=Z[1]-1,n=Z[2]-1,Y=this.fX[l],g=this.fX[l],d=this.fY[l],f=this.fY[l],c=this.fZ[l],o=this.fZ[l],p=_=M=0,this.fZ[a]<=c&&(c=this.fZ[a],Y=this.fX[a],d=this.fY[a],p=1),this.fZ[a]>o&&(o=this.fZ[a],g=this.fX[a],f=this.fY[a],M=1),this.fZ[n]<=c&&(c=this.fZ[n],Y=this.fX[n],d=this.fY[n],p=2),this.fZ[n]>o&&(o=this.fZ[n],g=this.fX[n],f=this.fY[n],M=2),p===0&&M===0)return console.error("GetContourList: wrong vertices ordering"),null;_=3-M-p,m=this.fX[Z[_]-1],s=this.fY[Z[_]-1],r=this.fZ[Z[_]-1],t>=c&&t<=o&&(h=(t-c)/(o-c),w=h*(g-Y)+Y,X=h*(f-d)+d,t>=r&&t<=o?(i=(t-r)/(o-r),z=i*(g-m)+m,x=i*(f-s)+s):(N=(t-c)/(r-c),z=N*(m-Y)+Y,x=N*(s-d)+d),(w!==z||X!==x)&&(u++,k[u-1]=w,P[u-1]=X,F[u-1]=z,E[u-1]=x))}let H=[],O=new Array(this.fNdt).fill(!1),I=0,A=0,q=0,G=0,v,D,L,C,T;for(C=0;C<u;C++)if(!O[C]){for(D=L=!1,T=0;T<u;T++)C!==T&&(k[C]===k[T]&&P[C]===P[T]&&(D=!0),k[C]===F[T]&&P[C]===E[T]&&(D=!0),F[C]===k[T]&&E[C]===P[T]&&(L=!0),F[C]===F[T]&&E[C]===E[T]&&(L=!0));if(!D&&!L){e=[],e.push(k[C],P[C]),e.push(F[C],E[C]),O[C]=!0,H.push(e);continue}if(!D||!L){for(e=[],D&&(I=k[C],A=P[C],q=F[C],G=E[C]),L&&(I=F[C],A=E[C],q=k[C],G=P[C]),e.push(q,G),O[C]=!0,T=0;;){for(v=!1;T<u&&O[T];)T++;if(I===k[T]&&A===P[T]?(I=F[T],A=E[T],v=!0):I===F[T]&&A===E[T]&&(I=k[T],A=P[T],v=!0),v)O[T]=!0,e.push(I,A),T=0;else if(++T>=u)break}H.push(e)}}for(C=0;C<u;C++)if(!O[C]){for(e=[],O[C]=!0,I=k[C],A=P[C],T=0,e.push(I,A);;){for(;T<u&&O[T];)T++;if(v=!1,I===k[T]&&A===P[T]?(I=F[T],A=E[T],v=!0):I===F[T]&&A===E[T]&&(I=k[T],A=P[T],v=!0),v)O[T]=!0,e.push(I,A),T=0;else if(++T>=u)break}e.push(k[C],P[C]),H.push(e)}return H}};function et(b){let t=Math.floor(b.index/this.nvertex);if(t<0||t>=this.index.length)return null;let e=n=>n*n;t=this.index[t];let i=this.fp,h=this.graph,N=i.grx(h.fX[t]),l=i.gry(h.fY[t]),a=i.grz(h.fZ[t]);if(this.check_next&&t+1<h.fX.length){let n=b.point,Y=i.grx(h.fX[t+1]),d=i.gry(h.fY[t+1]),c=i.grz(h.fZ[t+1]);e(n.x-Y)+e(n.y-d)+e(n.z-c)<e(n.x-N)+e(n.y-l)+e(n.z-a)&&(N=Y,l=d,a=c,t++)}return{x1:N-this.scale0,x2:N+this.scale0,y1:l-this.scale0,y2:l+this.scale0,z1:a-this.scale0,z2:a+this.scale0,color:this.tip_color,lines:[this.tip_name,"pnt: "+t,"x: "+i.axisAsText("x",h.fX[t]),"y: "+i.axisAsText("y",h.fY[t]),"z: "+i.axisAsText("z",h.fZ[t])]}}var Ct=class b extends mt{decodeOptions(t){let e=new Xt(t);this.options||(this.options={});let i=this.options,h=this.getObject();e.check("FILL_","color")&&h&&(h.fFillColor=e.color),e.check("LINE_","color")&&h&&(h.fLineColor=e.color),e.check("SAME"),e.check("CONT5")?i.Contour=15:e.check("TRI1")?i.Triangles=11:e.check("TRI2")?i.Triangles=10:e.check("TRIW")?i.Triangles=1:e.check("TRI")?i.Triangles=2:i.Triangles=0,i.Line=e.check("LINE"),i.Error=e.check("ERR")&&(this.matchObjectType(at)||this.matchObjectType(Q)),e.check("P0COL")?i.Color=i.Circles=i.Markers=!0:(i.Color=e.check("COL"),i.Circles=e.check("P0"),i.Markers=e.check("P")),i.Markers||(i.Color=!1),(i.Color||i.Triangles>=10||i.Contour)&&(i.Zscale=e.check("Z")),i.isAny=function(){return this.Markers||this.Error||this.Circles||this.Line||this.Triangles||i.Contour},i.Contour?i.Axis="":i.isAny()?(i.Axis="lego2",i.Zscale&&(i.Axis+="z")):i.Axis=t,this.storeDrawOpt(t)}createHistogram(){let t=this.getObject(),e=this.matchObjectType(Q),i=t.fX[0],h=i,N=t.fY[0],l=N,a=t.fZ[0],n=a;for(let M=0;M<t.fNpoints;++M){let u=t.fX[M],w=t.fY[M],X=t.fZ[M];this.options.Error?(i=Math.min(i,u-(e?t.fEXlow[M]:t.fEX[M])),h=Math.max(h,u+(e?t.fEXhigh[M]:t.fEX[M])),N=Math.min(N,w-(e?t.fEYlow[M]:t.fEY[M])),l=Math.max(l,w+(e?t.fEYhigh[M]:t.fEY[M])),a=Math.min(a,X-(e?t.fEZlow[M]:t.fEZ[M])),n=Math.max(n,X+(e?t.fEZhigh[M]:t.fEZ[M]))):(i=Math.min(i,u),h=Math.max(h,u),N=Math.min(N,w),l=Math.max(l,w),a=Math.min(a,X),n=Math.max(n,X))}function Y(M,u,w){return M<u?w*(u-M):Math.abs(M)<1e5?.02:.02*Math.abs(M)}let d=Y(i,h,t.fMargin),c=Y(N,l,t.fMargin),m=Y(a,n,0),s=i-d,r=h+d,g=N-c,f=l+c,o=a-m,y=n+m;s<0&&i>=0&&(s=i*.98),r>0&&h<=0&&(r=0),g<0&&N>=0&&(g=N*.98),f>0&&l<=0&&(f=0),o<0&&a>=0&&(o=a*.98),y>0&&n<=0&&(y=0);let p=this.getObject();p.fMinimum!==st&&(o=p.fMinimum),p.fMaximum!==st&&(y=p.fMaximum),this._own_histogram=!0;let _=ut(Nt,p.fNpx,p.fNpy);if(_.fName=p.fName+"_h",dt(_,p.fTitle),_.fXaxis.fXmin=s,_.fXaxis.fXmax=r,_.fYaxis.fXmin=g,_.fYaxis.fXmax=f,_.fZaxis.fXmin=o,_.fZaxis.fXmax=y,_.fMinimum=o,_.fMaximum=y,_.fBits|=ct,!this.options.isAny()){let M=this.buildDelaunay(p);if(M)for(let u=0;u<p.fNpx;++u){let w=s+(u+.5)/p.fNpx*(r-s);for(let X=0;X<p.fNpy;++X){let z=g+(X+.5)/p.fNpy*(f-g),x=M.ComputeZ(w,z);_.fArray[_.getBin(u+1,X+1)]=x}}}return _}buildDelaunay(t){return this._delaunay||(this._delaunay=new ft(t),this._delaunay.FindAllTriangles(),this._delaunay.fNdt||delete this._delaunay),this._delaunay}drawTriangles(t,e,i,h){let N=this.buildDelaunay(e);if(!N)return;let l=t.logz?c=>c<t.scale_zmin?-.1:t.grz(c):t.grz,a=this.options.Triangles===2,n=this.options.Triangles>=10||a,Y=this.options.Triangles%10===1||a&&e.fLineColor!==e.fFillColor,d=new gt(i,l,0,2*t.size_z3d,Y);for(d.loop=0;d.loop<2;++d.loop){d.createBuffers();for(let c=0;c<N.fNdt;++c){let m=[N.fPTried[c],N.fNTried[c],N.fMTried[c]],s=[],r=!0;for(let g=0;g<3;++g){let f=m[g]-1;s.push(t.grx(e.fX[f]),t.gry(e.fY[f]),l(e.fZ[f])),(e.fX[f]<t.scale_xmin||e.fX[f]>t.scale_xmax||e.fY[f]<t.scale_ymin||e.fY[f]>t.scale_ymax)&&(r=!1)}n&&r&&d.addMainTriangle(...s),Y&&r&&(d.addLineSegment(s[0],s[1],s[2],s[3],s[4],s[5]),d.addLineSegment(s[3],s[4],s[5],s[6],s[7],s[8]),d.addLineSegment(s[6],s[7],s[8],s[0],s[1],s[2]))}}d.callFuncs((c,m)=>{let s=yt(this.getMainPainter(),m,null,100,100),r=a?this.getColor(e.fFillColor):h.calcColor(c,i.length),g=new S.MeshBasicMaterial(pt(r,{side:S.DoubleSide,vertexColors:!1})),f=new S.Mesh(s,g);t.add3DMesh(f,this),f.painter=this},(c,m)=>{let s=this.getColor(e.fLineColor),r=new S.LineBasicMaterial({color:new S.Color(s),linewidth:e.fLineWidth}),g=V(Mt(this.getMainPainter(),m,100,100),r);t.add3DMesh(g,this)})}updateObject(t,e){if(!this.matchObjectType(t))return!1;if(e&&e!==this.options.original&&this.decodeOptions(e,t),Object.assign(this.getObject(),t),delete this._delaunay,delete this.$redraw_hist,this.axes_draw){let i=this.getMainPainter();i?.updateObject(this.createHistogram(),this.options.Axis),this.$redraw_hist=i}return!0}redraw(){return R(this,null,function*(){let t=Promise.resolve(!0);return this.$redraw_hist&&(t=this.$redraw_hist.redraw(),delete this.$redraw_hist),t.then(()=>this.drawGraph2D())})}drawContour(t,e,i){return R(this,null,function*(){let h=this.buildDelaunay(i);if(!h)return this;let N=e.getContour(),l=e.getHistPalette(),a=N.getLevels(),n=t.getGrFuncs();this.createG(!0),this.createAttLine({attr:i,nocolor:!0});for(let Y=0;Y<a.length;++Y){let d=h.GetContourList(a[Y]),c=N.getPaletteColor(l,a[Y]),m="";for(let s=0;s<d.length;++s){let r=d[s],g=[];for(let f=0;f<r.length;f+=2)g.push({grx:n.grx(r[f]),gry:n.gry(r[f+1])});m+=Yt(g,{cmd:"M",line:!0})}this.lineatt.color=c,this.draw_g.append("svg:path").attr("d",m).style("fill","none").call(this.lineatt.func)}return this})}drawGraph2D(){return R(this,null,function*(){let t=this.getFramePainter(),e=this.getMainPainter(),i=this.getObject();if(!i||!e||!t)return this;if(this.options.Contour)return this.drawContour(t,e,i);if(!t.mode3d)return this;if(t.remove3DMeshes(this),!this.options.isAny()){if(e.draw_content)return this;i.fMarkerSize===1&&i.fMarkerStyle===1?this.options.Circles=!0:this.options.Markers=!0}let h=(c,m)=>{let s=0;for(let r=0;r<i.fNpoints;++r)i.fX[r]>=t.scale_xmin&&i.fX[r]<=t.scale_xmax&&i.fY[r]>=t.scale_ymin&&i.fY[r]<=t.scale_ymax&&i.fZ[r]>=c&&i.fZ[r]<m&&++s;return s},N=1;if(lt.OptimizeDraw>0&&!t.webgl){let c=h(t.scale_zmin,t.scale_zmax),m=5e4;c>m&&(N=Math.floor(c/m),N<=2&&(N=2))}let l=this.createAttMarker({attr:i,std:!1}),a=[],n=null,Y=[t.scale_zmin,t.scale_zmax],d=t.size_x3d/100*l.getFullSize();this.options.Circles&&(d=.06*t.size_x3d),t.usesvg&&(d*=.3),d*=7*Math.max(t.size_x3d/t.getFrameWidth(),t.size_z3d/t.getFrameHeight()),(this.options.Color||this.options.Triangles>=10)&&(Y=e.getContourLevels(!0),n=e.getHistPalette()),this.options.Triangles&&this.drawTriangles(t,i,Y,n);for(let c=0;c<Y.length-1;++c){let m=Math.max(Y[c],t.scale_zmin),s=Math.min(Y[c+1],t.scale_zmax);if(m>=s)continue;let r=Math.floor(h(m,s)/N),g=new Int32Array(r),f=this.options.Markers||this.options.Circles?new xt(r,t.webgl,d/3):null,o=this.options.Error?new Float32Array(r*6*3):null,y=o&&this.matchObjectType(Q),p=this.options.Line?new Float32Array((r-1)*6):null,_=0,M=0,u=0,w=0;for(let X=0;X<i.fNpoints;++X){if(i.fX[X]<t.scale_xmin||i.fX[X]>t.scale_xmax||i.fY[X]<t.scale_ymin||i.fY[X]>t.scale_ymax||i.fZ[X]<m||i.fZ[X]>=s||N>1&&(_=(_+1)%N,_!==0))continue;g[M++]=X;let z=t.grx(i.fX[X]),x=t.gry(i.fY[X]),Z=t.grz(i.fZ[X]);f?.addPoint(z,x,Z),o&&(o[u]=t.grx(i.fX[X]-(y?i.fEXlow[X]:i.fEX[X])),o[u+1]=x,o[u+2]=Z,o[u+3]=t.grx(i.fX[X]+(y?i.fEXhigh[X]:i.fEX[X])),o[u+4]=x,o[u+5]=Z,u+=6,o[u]=z,o[u+1]=t.gry(i.fY[X]-(y?i.fEYlow[X]:i.fEY[X])),o[u+2]=Z,o[u+3]=z,o[u+4]=t.gry(i.fY[X]+(y?i.fEYhigh[X]:i.fEY[X])),o[u+5]=Z,u+=6,o[u]=z,o[u+1]=x,o[u+2]=t.grz(i.fZ[X]-(y?i.fEZlow[X]:i.fEZ[X])),o[u+3]=z,o[u+4]=x,o[u+5]=t.grz(i.fZ[X]+(y?i.fEZhigh[X]:i.fEZ[X])),u+=6),p&&(w>=6&&(p[w]=p[w-3],p[w+1]=p[w-2],p[w+2]=p[w-1],w+=3),p[w]=z,p[w+1]=x,p[w+2]=Z,w+=3)}if(p&&w>3&&p.length===w){let X=this.getColor(i.fLineColor),z=new S.LineBasicMaterial({color:new S.Color(X),linewidth:i.fLineWidth}),x=V(p,z);t.add3DMesh(x,this),x.graph=i,x.index=g,x.fp=t,x.scale0=.7*d,x.tip_name=this.getObjectHint(),x.tip_color=i.fMarkerColor===3?16711680:65280,x.nvertex=2,x.check_next=!0,x.tooltip=et}if(o){let X=this.getColor(i.fLineColor),z=new S.LineBasicMaterial({color:new S.Color(X),linewidth:i.fLineWidth}),x=V(o,z);t.add3DMesh(x,this),x.graph=i,x.index=g,x.fp=t,x.scale0=.7*d,x.tip_name=this.getObjectHint(),x.tip_color=i.fMarkerColor===3?16711680:65280,x.nvertex=6,x.tooltip=et}if(f){let X="blue";(!this.options.Circles||this.options.Color)&&(X=n?.calcColor(c,Y.length)??this.getColor(i.fMarkerColor));let z=f.createPoints({color:X,fill:this.options.Circles?"white":void 0,style:this.options.Circles?4:i.fMarkerStyle}).then(x=>{x.graph=i,x.fp=t,x.tip_color=i.fMarkerColor===3?16711680:65280,x.scale0=.3*d,x.index=g,x.tip_name=this.getObjectHint(),x.tooltip=et,t.add3DMesh(x,this)});a.push(z)}}return Promise.all(a).then(()=>{let c=this.getMainPainter();if(!(this.axes_draw||c?.draw_content===!1))return;let s=c?.findFunction(ot),r=this.getPadPainter()?.findPainterFor(s);if(r){if(r.Enabled=this.options.Zscale,this.options.Zscale)return r.drawPave();r.removeG()}}).then(()=>(t.render3D(100),this))})}static draw(t,e,i){return R(this,null,function*(){let h=new b(t,e);h.decodeOptions(i,e);let N=Promise.resolve(null);return h.getMainPainter()||(N=wt.draw(t,h.createHistogram(),h.options.Axis),h.axes_draw=!0),N.then(()=>(h.addToPadPrimitives(),h.drawGraph2D()))})}};export{Ct as TGraph2DPainter};

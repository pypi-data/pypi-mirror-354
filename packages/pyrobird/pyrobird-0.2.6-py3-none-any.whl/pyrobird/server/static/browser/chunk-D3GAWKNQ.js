import{c as kt}from"./chunk-K2P6CES6.js";import{b as It}from"./chunk-Z4ZYSIRC.js";import{c as Et,e as Ht}from"./chunk-3L3RRFVB.js";import{Da as Rt,H as dt,Ia as Bt,L as Ot,O as tt,P as Xt,Q as Ft,aa as Lt,b as Yt,e as j,f as ht,ha as At,pa as Ct}from"./chunk-FVXVO67X.js";import{cb as bt,e as Mt,f as E,g as H,gb as _t,ha as mt,ia as K,ja as J,ka as rt,la as ot,ma as lt,n as vt,na as st,oa as Q,q as $t,qa as Z,sa as U,t as G,u as p,ua as ft,x as yt,y as gt,ya as Pt,za as zt}from"./chunk-KYOHYQWH.js";import{k as V}from"./chunk-KYPE3LET.js";var Wt=yt(17),jt="postitle",Vt="autoplace",Gt="brNDC";function qt(q){let e=(t,i)=>Math.abs(t-i)<.001;return e(q.fX1NDC,p.fStatX-p.fStatW)&&e(q.fY1NDC,p.fStatY-p.fStatH)&&e(q.fX2NDC,p.fStatX)&&e(q.fY2NDC,p.fStatY)}var Zt=class q extends At{constructor(e,t,i){super(e,t,i),this.Enabled=!0,this.UseContextMenu=!0}autoPlaceLegend(e,t,i){return V(this,null,function*(){let s=this.getFrameSvg().selectChild(".main_layer").node().outerHTML;s=Ot(s),s=`<svg xmlns="${bt}"`+s.slice(4);let n=t?.fLeftMargin??p.fPadLeftMargin,f=t?.fRightMargin??p.fPadRightMargin,h=t?.fTopMargin??p.fPadTopMargin,a=t?.fBottomMargin??p.fPadBottomMargin;return Ft(s).then(r=>{if(!r)return!1;let d=100,u=100,g=r.getContext("2d"),l=g.getImageData(0,0,r.width,r.height).data,T=Math.floor(r.width/d),z=Math.floor(r.height/u),x=new Array(d*u);l.length!==r.width*r.height*4&&(console.log(`Image size missmatch in TLegend autoplace ${l.length} expected ${r.width*r.height*4}`),d=u=0);for(let c=0;c<d;++c){let D=c*T,m=D+T;for(let w=0;w<u;++w){let $=w*z,N=$+z,y=0;for(let S=D;S<m&&!y;++S)for(let C=$;C<N;++C){let b=(C*r.width+S)*4;if(l[b]||l[b+1]||l[b+2]||l[b+3]){y=1;break}}x[w*d+c]=y}}let M=.3/Math.max(.2,1-n-f),v=Math.min(.5,Math.max(.1,e.fPrimitives.arr.length*.05))/Math.max(.2,1-h-a),Y=Math.round(M*d),F=Math.round(v*u),_=(c,D)=>{for(let m=c;m<c+Y;++m)for(let w=D;w<D+F;++w)if(x[w*d+m])return!1;return!0};for(let c=0;c<d-Y;++c)for(let D=u-F-1;D>=0;--D)if(_(c,D))return e.fX1NDC=n+c/d*(1-n-f),e.fX2NDC=e.fX1NDC+M*(1-n-f),e.fY2NDC=1-h-D/u*(1-a-h),e.fY1NDC=e.fY2NDC-v*(1-a-h),!0}).then(r=>{if(r||i)return r;e.fX1NDC=Math.max(n??0,e.fX2NDC-.3),e.fX2NDC=Math.min(e.fX1NDC+.3,1-f);let d=Math.max(e.fPrimitives?e.fPrimitives.arr.length*.05:0,.2);return e.fY2NDC=Math.min(1-h,e.fY1NDC+d),e.fY1NDC=Math.max(e.fY2NDC-d,a),!0})})}getPaveDrawOption(){let e=this.getDrawOpt();return(this.isStats()||!e)&&(e=this.getObject()?.fOption),e||Gt}setPaveDrawOption(e){this.isStats()?this.getObject().fOption=e:this.storeDrawOpt(e)}drawPave(e){return V(this,null,function*(){if(!this.Enabled)return this.removeG(),this;let t=this.getObject(),i=this.getPaveDrawOption().toUpperCase(),o=this.getFramePainter(),s=this.getPadPainter(),n=s.getRootPad(!0),f,h,a;t.fInit===0&&(this.stored=Object.assign({},t),t.fInit=1,t._typename===Z&&!t.fX1&&!t.fX2&&!t.fY1&&!t.fY2?o?(t.fX1NDC=o.fX2NDC+.01,t.fX2NDC=Math.min(.96,o.fX2NDC+.06),t.fY1NDC=o.fY1NDC,t.fY2NDC=o.fY2NDC):(t.fX2NDC=.8,t.fX1NDC=.9,t.fY1NDC=.1,t.fY2NDC=.9):t.fOption.indexOf("NDC")>=0?(t.fX1NDC<1e-20&&t.fX2NDC<1e-20&&(t.fX1NDC=t.fX1,t.fX2NDC=t.fX2),t.fY1NDC<1e-20&&t.fY2NDC<1e-20&&(t.fY1NDC=t.fY1,t.fY2NDC=t.fY2)):n&&n.fX1===0&&n.fX2===1&&n.fY1===0&&n.fY2===1&&H(e)&&e.indexOf("postpone")>=0?(t.fInit=0,t.fX1NDC=t.fY1NDC=.99,t.fX2NDC=t.fY2NDC=1):n?(n.fLogx&&(t.fX1>0&&(t.fX1=Math.log10(t.fX1)),t.fX2>0&&(t.fX2=Math.log10(t.fX2))),n.fLogy&&(t.fY1>0&&(t.fY1=Math.log10(t.fY1)),t.fY2>0&&(t.fY2=Math.log10(t.fY2))),t.fX1NDC=(t.fX1-n.fX1)/(n.fX2-n.fX1),t.fY1NDC=(t.fY1-n.fY1)/(n.fY2-n.fY1),t.fX2NDC=(t.fX2-n.fX1)/(n.fX2-n.fX1),t.fY2NDC=(t.fY2-n.fY1)/(n.fY2-n.fY1)):(t.fX1NDC=t.fY1NDC=.1,t.fX2NDC=t.fY2NDC=.9));let r=Promise.resolve(!0);return t._typename===Q&&(this.AutoPlace||t.fX1NDC===t.fX2NDC&&t.fY1NDC===t.fY2NDC)&&(r=this.autoPlaceLegend(t,n).then(d=>(delete this.AutoPlace,d||(t.fX1NDC=o.fX2NDC-.2,t.fX2NDC=o.fX2NDC,t.fY1NDC=o.fY2NDC-.1,t.fY2NDC=o.fY2NDC),d))),r.then(()=>{if(this.isStats()&&!this.NoFillStats&&!s._fast_drawing){let x=t.$main_painter||this.getMainPainter();if(E(x?.fillStatistic)){let M=t.fOptStat,v=t.fOptFit;if((t.TestBit(Wt)||!Number.isInteger(M))&&(M=p.fOptStat),(t.TestBit(Wt)||!Number.isInteger(v))&&(v=p.fOptFit),x.fillStatistic(this,M,v)){let Y=t.fLines?.arr.length||0,F=Y>0&&!this.moved_interactive&&qt(t),_=this._has_fit&&this._fit_dim>1?p.fStatH:0;_&&(Y-=this._fit_cnt);let c=p.fStatH,D=p.fStatW;this._has_fit&&(D=1.8*p.fStatW),p.fStatFontSize<=0||p.fStatFont%10===3?c=Y*.25*p.fStatH:p.fStatFontSize<1&&(c=Y*p.fStatFontSize),F?(t.fX1NDC=Math.max(.005,t.fX2NDC-D),t.fY1NDC=Math.max(.005,t.fY2NDC-c-_)):(t.fY1NDC>t.fY2NDC&&(t.fY2NDC=Math.min(.995,t.fY1NDC+c+_)),t.fX1NDC>t.fX2NDC&&(t.fY2NDC=Math.min(.995,t.fX1NDC+D)))}}}let d=s.getPadRect(),u=t.fBorderSize,g=i.indexOf("NB")>=0,l=i.indexOf("L")>=0?-1:i.indexOf("R")>=0?1:0,T=i.indexOf("T")>=0?-1:i.indexOf("B")>=0?1:0;this.createG(),this._pave_x=Math.round(t.fX1NDC*d.width),this._pave_y=Math.round((1-t.fY2NDC)*d.height),h=Math.round((t.fX2NDC-t.fX1NDC)*d.width),a=Math.round((t.fY2NDC-t.fY1NDC)*d.height);let z=i.indexOf("ARC")>=0&&t.fCornerRadius>0?Math.round(Math.min(h,a)*t.fCornerRadius):0;if(tt(this.draw_g,this._pave_x,this._pave_y),this.createAttLine({attr:t,width:u>0?t.fLineWidth:0}),this.createAttFill({attr:t}),this.fillatt.empty()&&z&&this.fillatt.setSolidColor(this.getColor(t.fFillColor)||"white"),t._typename===st){let x=Math.round(a/2),M=Math.round(h/2),v=`l${M},${-x}l${M},${x}l${-M},${x}z`;this.fillatt.empty()||this.drawBorder(this.draw_g,h,a,0,v),f=this.draw_g.append("svg:path").attr("d","M0,"+x+v).call(this.fillatt.func).call(this.lineatt.func);let Y=this.draw_g.append("svg:g");return tt(Y,Math.round(h/4),Math.round(a/4)),this.drawPaveText(M,x,e,Y)}if(t.fNpaves)for(let x=t.fNpaves-1;x>0;--x)this.draw_g.append("svg:path").attr("d",`M${l*4*x},${T*4*x}h${h}v${a}h${-h}z`).call(this.fillatt.func).call(this.lineatt.func);else this.drawBorder(this.draw_g,h,a,z);return(!this.isBatchMode()||!this.fillatt.empty()||!this.lineatt.empty()&&!g)&&(z?f=this.draw_g.append("svg:rect").attr("width",h).attr("height",a).attr("rx",z):f=this.draw_g.append("svg:path").attr("d",`M0,0H${h}V${a}H0Z`),f.call(this.fillatt.func),g||f.call(this.lineatt.func)),E(this.paveDrawFunc)?this.paveDrawFunc(h,a,e):!0}).then(()=>this.isBatchMode()||t._typename===mt?this:(f?.style("pointer-events","visibleFill").on("mouseenter",()=>this.showObjectStatus()),Ht(this,{obj:t,x:this._pave_x,y:this._pave_y,width:h,height:a,minwidth:10,minheight:20,canselect:!0,redraw:()=>{this.moved_interactive=!0,this.interactiveRedraw(!1,"pave_moved"),this.drawPave()},ctxmenu:$t.touches&&G.ContextMenu&&this.UseContextMenu}),this.UseContextMenu&&G.ContextMenu&&this.draw_g.on("contextmenu",d=>this.paveContextMenu(d)),this.isPalette()&&this.interactivePaletteAxis(h,a),this))})}drawBorder(e,t,i,o,s){let n=this.getObject(),f=this.getPaveDrawOption().toUpperCase().replaceAll("ARC","").replaceAll("NDC",""),h=this.isPalette()||f.indexOf("NB")>=0,a=f.indexOf("L")>=0?-1:f.indexOf("R")>=0?1:0,r=f.indexOf("T")>=0?-1:f.indexOf("B")>=0?1:0;if(n.fBorderSize<2||n.fShadowColor===0||!a&&!r||h)return;let d=this.getColor(n.fShadowColor),u=n.fBorderSize,g=!this.lineatt.empty()&&this.lineatt.width>2?`${this.lineatt.width-1}px`:"1px";if(s)e.append("svg:path").attr("d",`M0,${Math.round(i/2)+u}${s}`).style("fill",d).style("stroke",d).style("stroke-width",g);else if(o)e.append("svg:rect").attr("width",t).attr("height",i).attr("rx",o).attr("x",a*u).attr("y",r*u).style("fill",d).style("stroke",d).style("stroke-width",g);else{let l;a<0&&r<0?l=`M0,0v${i-u-1}h${-u+1}v${-i+2}h${t-2}v${u-1}z`:a<0&&r>0?l=`M0,${i}v${u+1-i}h${-u+1}v${i-2}h${t-2}v${-u+1}z`:a>0&&r<0?l=`M${u+1},0v${-u+1}h${t-2}v${i-2}h${-u+1}v${u+1-i}z`:l=`M${t},${u+1}h${u-1}v${i-2}h${-t+2}v${-u+1}h${t-u-2}z`,e.append("svg:path").attr("d",l).style("fill",d).style("stroke",d).style("stroke-width",g)}}fillWebObjectOptions(e){let t=this.getObject();return t?.fInit&&(e.fcust="pave",e.fopt=[t.fX1NDC,t.fY1NDC,t.fX2NDC,t.fY2NDC],t.fName==="stats"&&this.isStats()&&t.fLines.arr.forEach(i=>{(i._typename===U||i._typename===ft)&&(e.fcust+=`;;${i.fTitle}`)})),e}drawPaveLabel(e,t){return V(this,null,function*(){let i=this.getObject();return!i.fLabel||!i.fLabel.trim()?this:(this.createAttText({attr:i,can_rotate:!1}),this.startTextDrawingAsync(this.textatt.font,t/1.2).then(()=>this.drawText(this.textatt.createArg({width:e,height:t,text:i.fLabel,norotate:!0}))).then(()=>this.finishTextDrawing()))})}drawPaveStats(e,t){let i=this.getObject(),o=[],s=[],n=0,f=0,h=0;for(let g=0;g<i.fLines.arr.length;++g){let l=i.fLines.arr[g];(l._typename===U||l._typename===ft)&&(o.push(l.fTitle),s.push(l.fTextColor))}let a=o.length;for(let g=0;g<a;++g){let l=o[g];if(g>0&&(h=Math.max(h,l.length)),g===0||l.indexOf("|")<0)continue;n===0&&(n=g);let T=l.split("|");T.length>f&&(f=T.length)}let r=t/a,d=i.fMargin*e,u=!1;return this.createAttText({attr:i,can_rotate:!1}),this.startTextDrawingAsync(this.textatt.font,t/(a*1.2)).then(()=>{if(a===1)this.drawText(this.textatt.createArg({width:e,height:t,text:o[0],latex:1,norotate:!0}));else for(let l=0;l<a;++l){let T=l*r,z=s[l]>1?this.getColor(s[l]):this.textatt.color;if(n&&l>=n){let x=o[l].split("|");for(let M=0;M<x.length;++M)this.drawText({align:"middle",x:e*M/f,y:T,latex:0,width:e/f,height:r,text:x[M],color:z})}else if(o[l].indexOf("=")<0){if(l===0){u=!0;let x=Math.max(h,Math.round((e-2*d)/r/.65));o[l].length>x+5&&(o[l]=o[l].slice(0,x+2)+"...")}this.drawText({align:l===0?"middle":"start",x:d,y:T,width:e-2*d,height:r,text:o[l],color:z})}else{let x=o[l].split("="),M=[];for(let v=0;v<2;++v){let Y={align:v===0?"start":"end",x:d,y:T,width:e-2*d,height:r,text:v>0?x[v].trimStart():x[v].trimEnd(),color:z,_expected_width:e-2*d,_args:M,post_process(F){this._args[0].ready&&this._args[1].ready&&F.scaleTextDrawing(1.05*(this._args[0].result_width+this._args[1].result_width)/this._expected_width,F.draw_g)}};M.push(Y)}for(let v=0;v<2;++v)this.drawText(M[v])}}let g="";if(i.fBorderSize>0&&u&&(g+=`M0,${Math.round(r)}h${e}`),n>0&&f>1){for(let l=n;l<a;++l)g+=`M0,${Math.round(l*r)}h${e}`;for(let l=0;l<f-1;++l)g+=`M${Math.round(e/f*(l+1))},${Math.round(n*r)}V${t}`}return g&&this.draw_g.append("svg:path").attr("d",g).call(this.lineatt.func),this.finishTextDrawing(void 0,a>1)})}drawPaveText(e,t,i,o){return V(this,null,function*(){let s=this.getObject(),n=s.fLines?.arr||[],f=n.length,h=this.getPadPainter(),a=h.getPadHeight(),r=s.fLabel.length>0,d=[],u=s.fMargin*e,g=t/(f||1),l=.85*g,T=0;this.createAttText({attr:s,can_rotate:!1}),f===1&&this.textatt.size>0&&(T=Math.max(3,this.textatt.getSize(h))),o||(o=this.draw_g);let z=f===1&&h._fast_drawing,x=0,M=0,v=0,Y=0;return n.forEach(_=>{_._typename!==U&&_._typename!==ft||!_.fTitle?.trim()||(x++,(_.fX||_.fY||_.fTextSize)&&M++,!_.fTextSize&&!this.textatt.size&&(v=Math.max(v,Lt(_.fTitle,this.textatt.font,l))))}),v&&(Y=l,v>.92*e&&(Y*=.92*e/v),Y=Math.round(Y)),(x>M?this.startTextDrawingAsync(this.textatt.font,this.$postitle?this.textatt.getSize(h,1,.05):l,o,T):Promise.resolve()).then(()=>{for(let _=0;_<f;++_){let c=n[_],D=_*g;switch(c._typename){case U:case ft:{if(!c.fTitle||!c.fTitle.trim())continue;let m=c.fTextColor?this.getColor(c.fTextColor):"";m||(m=this.textatt.color);let w=c.fTextAlign||this.textatt.align,$=w%10,N=(w-$)/10;if(c.fX||c.fY||c.fTextSize){let y=c.fX?c.fX*e:N===1?u:N===2?e/2:e-u,S=c.fY?(1-c.fY)*t:D+($===2?g/2:$===3?g:0),C=o.append("svg:g");d.push(this.startTextDrawingAsync(this.textatt.font,this.textatt.getAltSize(c.fTextSize,h)||Y,C).then(()=>this.drawText({align:w,x:y,y:S,text:c.fTitle,color:m,latex:c._typename===U?0:1,draw_g:C,fast:z})).then(()=>this.finishTextDrawing(C)))}else{let y={x:0,y:D,draw_g:o,latex:c._typename===U?0:1,text:c.fTitle,color:m,fast:z};this.$postitle?y.post_process=function(S){S.$titlebox=this.box}:(y.align=w,y.x=N===1?u:0,y.width=N===2?e:e-u,y.y=D+.05*g,y.height=.9*g),this.drawText(y)}break}case Pt:{let m=c.fX1?Math.round(c.fX1*e):0,w=c.fX2?Math.round(c.fX2*e):e,$=c.fY1?Math.round((1-c.fY1)*t):Math.round(D+g*.5),N=c.fY2?Math.round((1-c.fY2)*t):Math.round(D+g*.5),y=this.createAttLine(c);o.append("svg:path").attr("d",`M${m},${$}L${w},${N}`).call(y.func);break}case zt:{let m=c.fX1?Math.round(c.fX1*e):0,w=c.fX2?Math.round(c.fX2*e):e,$=c.fY1?Math.round((1-c.fY1)*t):Math.round(D),N=c.fY2?Math.round((1-c.fY2)*t):Math.round(D+g),y=this.createAttFill(c);o.append("svg:path").attr("d",`M${m},${$}H${w}V${N}H${m}Z`).call(y.func);break}}}return x>M&&d.push(this.finishTextDrawing(o,x>M+1)),this.isTitle()&&this.draw_g.style("display",x?null:"none"),Promise.all(d).then(()=>this)}).then(()=>{if(!r)return;let _=Math.round(e*.5),c=Math.round(a*.04),D=o.append("svg:g");return tt(D,Math.round(e*.25),Math.round(-a*.02)),this.drawBorder(D,_,c),D.append("svg:path").attr("d",`M0,0h${_}v${c}h${-_}z`).call(this.fillatt.func).call(this.lineatt.func),this.startTextDrawingAsync(this.textatt.font,.9*c,D).then(()=>this.drawText({align:22,x:0,y:0,width:_,height:c,text:s.fLabel,color:this.textatt.color,draw_g:D})).then(()=>d.push(this.finishTextDrawing(D)))}).then(()=>this)})}format(e,t){t||(t="stat");let i=this.getObject();switch(t){case"stat":t=i.fStatFormat||p.fStatFormat;break;case"fit":t=i.fFitFormat||p.fFitFormat;break;case"entries":if(Math.abs(e)<1e9&&Math.round(e)===e)return e.toFixed(0);t="14.7g";break}return dt(e,t||"6.4g")}drawLegend(e,t){let i=this.getObject(),o=i.fPrimitives.arr.length,s=Math.max(1,i.fNColumns),n=Math.round(o/s),f=!1,h=!1;n*s<o&&n++;let a=m=>!m.fObject&&!m.fOption&&(!m.fLabel||!m.fLabel.trim());for(let m=0;m<o;++m){let w=i.fPrimitives.arr[m];a(w)?s===1&&n--:w.fLabel&&(f=!0,(w.fTextFont&&w.fTextFont!==i.fTextFont||w.fTextSize&&w.fTextSize!==i.fTextSize)&&(h=!0))}n<1&&(n=1);let r=Math.round(.03*e/s),d=Math.round(.03*t),u=(t-2*d)/(n+(n-1)*i.fEntrySeparation),g=u*i.fEntrySeparation,l=r,T=(e-2*r-(s-1)*l)/s;i.fColumnSeparation&&(T=(e-2*r)/(s+(s-1)*i.fColumnSeparation),l=T*i.fColumnSeparation);let z=new Array(s+1).fill(r),x=T*i.fMargin;if(s>1){let m=new Array(s).fill(1),w=e-2*r-(s-1)*l-s*x;for(let N=0;N<o;++N){let y=i.fPrimitives.arr[N];if(a(y))continue;let S=N%s;m[S]=Math.max(m[S],y.fLabel.length)}let $=0;for(let N=0;N<s;++N)$+=m[N];for(let N=0;N<s-1;++N)z[N+1]=z[N]+x+m[N]/$*w+l}z[s]=e-r;let M=u,v=0,Y=!1;this.createAttText({attr:i,can_rotate:!1});let F=this.getPadPainter(),_=this.textatt.getSize(F);_&&_<M&&(M=v=_);let c=[];return(f&&!h?this.startTextDrawingAsync(this.textatt.font,M,this.draw_g,v):Promise.resolve()).then(()=>{for(let m=0,w=-1;m<o;++m){let $=i.fPrimitives.arr[m];if(a($))continue;s===1?++w:w=m;let N=$.fOption.toLowerCase(),y=w%s,S=(w-y)/s,C=Math.round(z[y]),b=Math.round(d+S*(u+g)),B=Math.round(C+x),A=Math.round(C+(x-r)/2),I=Math.round(b+u*.1),W=Math.round(u*.8),Dt=Math.round(b+u*.5),R=$.fObject,Ut=N.indexOf("f")!==-1,ct=N.indexOf("l")!==-1,pt=N.indexOf("e")!==-1,wt=N.indexOf("p")!==-1,St=$,Nt=$,ut=$,X=null,nt=!1;if(Mt(R)&&("fLineColor"in R&&(ut=R),"fFillColor"in R&&(St=R),"fMarkerColor"in R&&(Nt=R),X=F.findPainterFor(R)),Ut){let L=X?.fillatt?.used?X.fillatt:this.createAttFill(St),O;!ct&&!pt&&!wt&&(O=X?.lineatt?.used?X.lineatt:this.createAttLine(ut),O.empty()&&(O=null)),(!L.empty()||O)&&(nt=!0,this.draw_g.append("svg:path").attr("d",`M${C},${I}v${W}h${B-r-C}v${-W}z`).call(L.func).call(O?O.func:()=>{}))}if(ct||pt){let L=X?.lineatt?.used?X.lineatt:this.createAttLine(ut);if(!L.empty()&&(nt=!0,ct&&this.draw_g.append("svg:path").attr("d",`M${C},${Dt}h${B-r-C}`).call(L.func),pt)){let O=0,P=u*.05;E(X?.getHisto)&&X.options?.ErrorKind===1?O=1:E(X?.getGraph)&&R?.fLineWidth!==void 0&&R?.fMarkerSize!==void 0&&(O=X.options?.Ends??1,P=R.fLineWidth+p.fEndErrorSize,O>1&&(P=Math.max(P,R.fMarkerSize*8*.66)));let Tt=O===3?.2:0,et=Math.round(b+u*Tt),it=Math.round(b+u*(1-Tt)),k=Math.round(P*.66);P=Math.round(P);let at=`M${A},${et}V${it}`;switch(O){case 1:at+=`M${A-P},${et}h${2*P}M${A-P},${it}h${2*P}`;break;case 2:at+=`M${A-P},${et+k}v${-k}h${2*P}v${k}M${A-P},${it-k}v${k}h${2*P}v${-k}`;break;case 3:at+=`M${A-P},${et}h${2*P}l${-P},${-k}zM${A-P},${it}h${2*P}l${-P},${k}z`;break;case 4:at+=`M${A-P},${et+k}l${P},${-k}l${P},${k}M${A-P},${it-k}l${P},${k}l${P},${-k}`;break}this.draw_g.append("svg:path").attr("d",at).call(L.func).style("fill",O>1?"none":null)}}if(wt){let L=X?.markeratt?.used?X.markeratt:this.createAttMarker(Nt);L.empty()||(nt=!0,this.draw_g.append("svg:path").attr("d",L.create(A,Dt)).call(L.func))}!nt&&X?.lineatt&&!X.lineatt.empty()&&this.draw_g.append("svg:path").attr("d",`M${C},${I}v${W}h${B-r-C}v${-W}z`).style("fill","none").call(X.lineatt.func);let xt=B;if(H(N)&&N.toLowerCase()!=="h"?Y=!0:Y||(xt=C),$.fLabel){let L=this.createAttText({attr:$,std:!1,attr_alt:i}),O={draw_g:this.draw_g,align:L.align,x:xt,width:Math.round(z[y+1]-xt),y:b,height:Math.round(u),scale:h&&!$.fTextSize||!i.fTextSize,text:$.fLabel,color:L.color};h?(O.draw_g=this.draw_g.append("svg:g"),c.push(this.startTextDrawingAsync(L.font,L.getSize(F),O.draw_g,v).then(()=>this.drawText(O)).then(()=>this.finishTextDrawing(O.draw_g)))):this.drawText(O)}}return f&&!h&&c.push(this.finishTextDrawing()),Promise.all(c)})}drawPaletteAxis(e,t,i){let o=this.getObject(),s=o.fAxis,n=H(i)&&i.indexOf("can_move")>=0,f=H(i)&&i.indexOf("postpone")>=0,h=H(i)&&i.indexOf("cjust")>=0,a=H(i)&&i.indexOf("bring_stats_front")>=0,r=this.getPadPainter(),d=r.getPadWidth(),u=r.getPadHeight(),g=r.getRootPad(!0),l=o.$main_painter||this.getMainPainter(),T=this.getFramePainter(),z=l.fContour,x=z?.getLevels(),M=E(l.getDimension)&&l.getDimension()===3,v=E(l.getZaxis),Y=g?.fLogv??(M?!1:g?.fLogz),F=l._color_palette,_=v?l.getZaxis():l.getObject()?.fZaxis,c=g?.fTickz?.35:.7,D=0,m=100,w,$,N,y=0;if(this._palette_vertical=o.fX2NDC-o.fX1NDC<o.fY2NDC-o.fY1NDC,s.fTickSize=.03,typeof _?.fLabelOffset<"u"&&!M&&(s.fBits=_.fBits&~Ct.kTickMinus&~Ct.kTickPlus,s.fTitle=_.fTitle,s.fTickSize=_.fTickLength,s.fTitleSize=_.fTitleSize,s.fTitleOffset=_.fTitleOffset,s.fTextColor=_.fTitleColor,s.fTextFont=_.fTitleFont,s.fLineColor=_.fAxisColor,s.fLabelSize=_.fLabelSize,s.fLabelColor=_.fLabelColor,s.fLabelFont=_.fLabelFont,s.fLabelOffset=_.fLabelOffset,this.z_handle.setHistPainter(l,v?"hist#z":"z"),this.z_handle.source_axis=_),z&&T&&!M?T.zmin!==void 0&&T.zmax!==void 0&&T.zmin!==T.zmax?(w=T.zmin,$=T.zmax,D=T.zoom_zmin,m=T.zoom_zmax,D===m&&(D=w,m=$)):(D=x.at(0),m=x.at(-1)):l.gmaxbin!==void 0&&l.gminbin!==void 0?(D=l.gminbin,m=l.gmaxbin):l.hmin!==void 0&&l.hmax!==void 0&&(D=l.hmin,m=l.hmax),this.draw_g.selectAll("rect").style("fill","white"),(w===void 0||$===void 0||w===$)&&(w=D,$=m),this._palette_vertical?(this._swap_side=o.fX2NDC<.5,s.fChopt="S+"+(this._swap_side?"R":"L"),this.z_handle.configureAxis("zaxis",w,$,D,m,!0,[0,t],{log:Y,fixed_ticks:h?x:null,maxTickSize:Math.round(e*c),swap_side:this._swap_side,minposbin:l.gminposbin}),N=this._swap_side?null:`translate(${e})`,g?.fTickz&&(y=this._swap_side?e:-e)):(this._swap_side=o.fY1NDC>.5,s.fChopt="S+",this.z_handle.configureAxis("zaxis",w,$,D,m,!1,[0,e],{log:Y,fixed_ticks:h?x:null,maxTickSize:Math.round(t*c),swap_side:this._swap_side,minposbin:l.gminposbin}),N=this._swap_side?null:`translate(0,${t})`,g?.fTickz&&(y=this._swap_side?t:-t)),!z||!F||f)this.draw_g.append("svg:path").attr("d",`M0,0H${e}V${t}H0Z`).style("fill","white");else for(let S=0;S<x.length-1;++S){let C=Math.round(this.z_handle.gr(x[S])),b=Math.round(this.z_handle.gr(x[S+1])),B=(x[S]+x[S+1])*.5,A;if(this._palette_vertical){if(b>=t||C<0)continue;C+=1,C>t?(C=t,B=x[S]*.001+x[S+1]*.999,b<0&&(b=0)):b<0&&(b=0,B=x[S]*.999+x[S+1]*.001),A=`M0,${b}H${e}V${C}H0Z`}else{if(C>=e||b<0)continue;b+=1,b>e?(b=e,B=x[S]*.999+x[S+1]*.001,C<0&&(C=0)):C<0&&(C=0,B=x[S]*.001+x[S+1]*.999),A=`M${C},0V${t}H${b}V0Z`}let I=z.getPaletteColor(F,B);if(!I)continue;let W=this.draw_g.append("svg:path").attr("d",A).style("fill",I).property("fill0",I).property("fill1",Yt(I).darker(.5).formatRgb());this.isBatchMode()||(this.isTooltipAllowed()&&W.on("mouseover",function(){j(this).transition().duration(100).style("fill",j(this).property("fill1"))}).on("mouseout",function(){j(this).transition().duration(100).style("fill",j(this).property("fill0"))}).append("svg:title").text(this.z_handle.axisAsText(x[S])+" - "+this.z_handle.axisAsText(x[S+1])),G.Zooming&&W.on("dblclick",()=>this.getFramePainter().unzoomSingle("z")))}return a&&this.getPadPainter()?.findPainterFor(null,"",J)?.bringToFront(),this.z_handle.drawAxis(this.draw_g,e,t,N,y).then(()=>{let S;if(n)if(G.ApproxTextSize||vt()){S={x:this._pave_x,y:this._pave_y,width:e,height:t};let C=this.z_handle.labelsFont?.size||14;if(this._palette_vertical){let b=(this.z_handle._maxlbllen||3)*.6*C;S.width+=b,this._swap_side&&(S.x-=b)}else S.height+=C,this._swap_side&&(S.y-=C)}else"getBoundingClientRect"in this.draw_g.node()&&(S=this.draw_g.node().getBoundingClientRect());if(!S)return this;if(this._palette_vertical){let C=this._pave_x+parseInt(S.width)-Math.round(.995*d)+3;C>0&&(this._pave_x-=C,tt(this.draw_g,this._pave_x,this._pave_y),o.fX1NDC-=C/d,o.fX2NDC-=C/d)}else{let C=Math.round((1.05-p.fTitleY)*u)-S.y;C>0&&(this._pave_y+=C,tt(this.draw_g,this._pave_x,this._pave_y),o.fY1NDC-=C/u,o.fY2NDC-=C/u)}return this})}interactivePaletteAxis(e,t){let i=!1,o=0,s=0,n=null,f=r=>{if(!i)return;r.preventDefault();let d=ht(r,this.draw_g.node());this._palette_vertical?(s=Math.min(Math.max(d[1],0),t),n.attr("y",Math.min(o,s)).attr("height",Math.abs(s-o))):(s=Math.min(Math.max(d[0],0),e),n.attr("x",Math.min(o,s)).attr("width",Math.abs(s-o)))},h=r=>{if(!i)return;r.preventDefault(),j(window).on("mousemove.colzoomRect",null).on("mouseup.colzoomRect",null),n.remove(),n=null,i=!1;let d=this.z_handle.revertPoint(o),u=this.z_handle.revertPoint(s);this.getFramePainter().zoomSingle("z",Math.min(d,u),Math.max(d,u),!0)},a=r=>{if(i)return;i=!0,r.preventDefault(),r.stopPropagation();let d=ht(r,this.draw_g.node());n=this.draw_g.append("svg:rect").attr("id","colzoomRect").call(Xt,!0),this._palette_vertical?(o=s=d[1],n.attr("x","0").attr("width",e).attr("y",o).attr("height",1)):(o=s=d[0],n.attr("x",o).attr("width",1).attr("y",0).attr("height",t)),j(window).on("mousemove.colzoomRect",f).on("mouseup.colzoomRect",h,!0)};G.Zooming&&this.draw_g.selectAll(".axis_zoom").on("mousedown",a).on("dblclick",()=>this.getFramePainter().zoomSingle("z",0,0,!0)),G.ZoomWheel&&this.draw_g.on("wheel",r=>{let d=ht(r,this.draw_g.node()),u=this._palette_vertical?1-d[1]/t:d[0]/e,g=this.z_handle.analyzeWheelEvent(r,u);g?.changed&&this.getFramePainter().zoomSingle("z",g.min,g.max,!0)})}fillContextMenuItems(e){let t=this.getObject(),i=this.isStats()?"SetOption":"SetDrawOption";e.sub("Shadow"),e.addSizeMenu("size",0,12,1,t.fBorderSize,a=>{t.fBorderSize=a,this.interactiveRedraw(!0,`exec:SetBorderSize(${a})`)}),e.addColorMenu("color",t.fShadowColor,a=>{t.fShadowColor=a,this.interactiveRedraw(!0,Rt(a,"SetShadowColor"))});let o=["nb","tr","tl","br","bl"],s="",n=this.getPaveDrawOption(),f=n;o.forEach(a=>{let r=f.indexOf(a);r>=0&&!s&&(s=a,f=f.slice(0,r)+f.slice(r+a.length))}),e.addSelectMenu("positon",o,s||"nb",a=>{a+=f,this.setPaveDrawOption(a),this.interactiveRedraw(!0,`exec:${i}("${a}")`)},"Direction of pave shadow or nb - off"),e.endsub(),e.sub("Corner");let h=n.toLowerCase().indexOf("arc");if(e.addchk(h>=0,"arc",a=>{a?n+=" arc":n=n.slice(0,h)+n.slice(h+3),this.setPaveDrawOption(n),this.interactiveRedraw(!0,`exec:${i}("${n}")`)},"Usage of ARC draw option"),e.addSizeMenu("radius",0,.2,.02,t.fCornerRadius,a=>{t.fCornerRadius=a,this.interactiveRedraw(!0,`exec:SetCornerRadius(${a})`)},"Corner radius when ARC is enabled"),e.endsub(),(this.isStats()||this.isPaveText()||this.isPavesText())&&(e.add("Label",()=>e.input("Enter new label",t.fLabel).then(a=>{t.fLabel=a,this.interactiveRedraw("pad",`exec:SetLabel("${a}")`)})),e.addSizeMenu("Margin",0,.2,.02,t.fMargin,a=>{t.fMargin=a,this.interactiveRedraw(!0,`exec:SetMargin(${a})`)})),this.isStats()){e.add("Default position",()=>{t.fX2NDC=p.fStatX,t.fX1NDC=t.fX2NDC-p.fStatW,t.fY2NDC=p.fStatY,t.fY1NDC=t.fY2NDC-p.fStatH,t.fInit=1,this.interactiveRedraw(!0,"pave_moved")}),e.add("Save to gStyle",()=>{p.fStatX=t.fX2NDC,p.fStatW=t.fX2NDC-t.fX1NDC,p.fStatY=t.fY2NDC,p.fStatH=t.fY2NDC-t.fY1NDC,this.fillatt?.saveToStyle("fStatColor","fStatStyle"),p.fStatTextColor=t.fTextColor,p.fStatFontSize=t.fTextSize,p.fStatFont=t.fTextFont,p.fFitFormat=t.fFitFormat,p.fStatFormat=t.fStatFormat,p.fOptStat=t.fOptStat,p.fOptFit=t.fOptFit},"Store stats attributes to gStyle"),e.separator(),e.add("SetStatFormat",()=>{e.input("Enter StatFormat",t.fStatFormat).then(r=>{r&&(t.fStatFormat=r,this.interactiveRedraw(!0,`exec:SetStatFormat("${r}")`))})}),e.add("SetFitFormat",()=>{e.input("Enter FitFormat",t.fFitFormat).then(r=>{r&&(t.fFitFormat=r,this.interactiveRedraw(!0,`exec:SetFitFormat("${r}")`))})}),e.sub("SetOptStat",()=>{e.input("Enter OptStat",t.fOptStat,"int").then(r=>{t.fOptStat=r,this.interactiveRedraw(!0,`exec:SetOptStat(${r})`)})});let a=(r,d)=>{let u=r<10?t.fOptStat:t.fOptFit;u=parseInt(parseInt(u)/parseInt(Math.pow(10,r%10)))%10,e.addchk(u,d,u*100+r,g=>{let l=parseInt(g/100),T=g%100<10?t.fOptStat:t.fOptFit;T-=(l>0?l:-1)*parseInt(Math.pow(10,g%10)),g%100<10?(t.fOptStat=T,this.interactiveRedraw(!0,`exec:SetOptStat(${T})`)):(t.fOptFit=T,this.interactiveRedraw(!0,`exec:SetOptFit(${T})`))})};a(0,"Histogram name"),a(1,"Entries"),a(2,"Mean"),a(3,"Std Dev"),a(4,"Underflow"),a(5,"Overflow"),a(6,"Integral"),a(7,"Skewness"),a(8,"Kurtosis"),e.endsub(),e.sub("SetOptFit",()=>{e.input("Enter OptStat",t.fOptFit,"int").then(r=>{t.fOptFit=r,this.interactiveRedraw(!0,`exec:SetOptFit(${r})`)})}),a(10,"Fit parameters"),a(11,"Par errors"),a(12,"Chi square / NDF"),a(13,"Probability"),e.endsub(),e.separator()}else this.isPaveText()||this.isPavesText()?(this.isPavesText()&&e.addSizeMenu("Paves",1,10,1,t.fNpaves,a=>{t.fNpaves=a,this.interactiveRedraw(!0,`exec:SetNpaves(${a})`)}),this.isTitle()&&(e.add("Default position",()=>{t.fX1NDC=p.fTitleW>0?p.fTitleX-p.fTitleW/2:p.fPadLeftMargin,t.fY1NDC=p.fTitleY-Math.min(p.fTitleFontSize*1.1,.06),t.fX2NDC=p.fTitleW>0?p.fTitleX+p.fTitleW/2:1-p.fPadRightMargin,t.fY2NDC=p.fTitleY,t.fInit=1,this.interactiveRedraw(!0,"pave_moved")}),e.add("Save to gStyle",()=>{p.fTitleX=(t.fX2NDC+t.fX1NDC)/2,p.fTitleY=t.fY2NDC,this.fillatt?.saveToStyle("fTitleColor","fTitleStyle"),p.fTitleTextColor=t.fTextColor,p.fTitleFontSize=t.fTextSize,p.fTitleFont=t.fTextFont},"Store title position and graphical attributes to gStyle"))):t._typename===Q&&(e.sub("Legend"),e.add("Autoplace",()=>{this.autoPlaceLegend(t,this.getPadPainter()?.getRootPad(!0),!0).then(a=>{a&&this.interactiveRedraw(!0,"pave_moved")})}),e.addSizeMenu("Entry separation",0,1,.1,t.fEntrySeparation,a=>{t.fEntrySeparation=a,this.interactiveRedraw(!0,`exec:SetEntrySeparation(${a})`)},"Vertical entries separation, meaningful values between 0 and 1"),e.addSizeMenu("Columns separation",0,1,.1,t.fColumnSeparation,a=>{t.fColumnSeparation=a,this.interactiveRedraw(!0,`exec:SetColumnSeparation(${a})`)},"Horizontal columns separation, meaningful values between 0 and 1"),e.addSizeMenu("Num columns",1,7,1,t.fNColumns,a=>{t.fNColumns=a,this.interactiveRedraw(!0,`exec:SetNColumns(${a})`)},"Number of columns in the legend"),e.endsub())}paveContextMenu(e){if(this.z_handle){let t=this.getFramePainter();E(t?.showContextMenu)&&t.showContextMenu("pal",e)}else Bt(e,this)}isStats(){return this.matchObjectType(J)}isPaveText(){return this.matchObjectType(K)}isPavesText(){return this.matchObjectType(rt)}isPalette(){return this.matchObjectType(Z)}isTitle(){return this.isPaveText()&&this.getObject()?.fName===_t}clearPave(){this.getObject().Clear()}addText(e){this.getObject().AddText(e)}getBestFormat(e,t){let i=e.indexOf("e"),o=e.indexOf(".");return i>=0?e.indexOf("+")<0||t>=1?`.${i-o-1}e`:".1f":o<0?".1f":`.${e.length-o-1}f`}fillFunctionStat(e,t,i=1){if(this._has_fit=!1,!t||!e)return!1;this._has_fit=!0,this._fit_dim=i,this._fit_cnt=0;let o=i===1?t%10:1,s=i===1?Math.floor(t/10)%10:1,n=i===1?Math.floor(t/100)%10:1,f=i===1?Math.floor(t/1e3)%10:0;if(n&&(this.addText("#chi^{2} / ndf = "+this.format(e.fChisquare,"fit")+" / "+e.fNDF),this._fit_cnt++),f&&(this.addText("Prob = "+this.format(kt(e.fChisquare,e.fNDF))),this._fit_cnt++),o)for(let h=0;h<e.GetNumPars();++h){let a=e.GetParName(h),r=e.GetParValue(h),d=e.GetParError(h);r===void 0?(r="<not avail>",d=null):(r=this.format(Number(r),"fit"),s&&d!==void 0&&(d=dt(d,this.getBestFormat(r,d)),Number(d)===0&&e.GetParError(h)!==0&&(d=dt(e.GetParError(h),"4.2g")))),s&&d?this.addText(`${a} = ${r} #pm ${d}`):this.addText(`${a} = ${r}`),this._fit_cnt++}return!0}isDummyPos(e){return e?!e.fInit&&!e.fX1&&!e.fX2&&!e.fY1&&!e.fY2&&!e.fX1NDC&&!e.fX2NDC&&!e.fY1NDC&&!e.fY2NDC:!0}updateObject(e,t){if(!this.matchObjectType(e))return!1;let i=this.getObject(),o=t===Vt;switch(!i.$modifiedNDC&&!this.isDummyPos(e)&&(this.stored&&!e.fInit&&this.stored.fX1===e.fX1&&this.stored.fX2===e.fX2&&this.stored.fY1===e.fY1&&this.stored.fY2===e.fY2?(this.stored.fX1NDC!==e.fX1NDC&&(i.fX1NDC=e.fX1NDC),this.stored.fX2NDC!==e.fX2NDC&&(i.fX2NDC=e.fX2NDC),this.stored.fY1NDC!==e.fY1NDC&&(i.fY1NDC=e.fY1NDC),this.stored.fY2NDC!==e.fY2NDC&&(i.fY2NDC=e.fY2NDC)):(i.fInit=e.fInit,i.fX1=e.fX1,i.fX2=e.fX2,i.fY1=e.fY1,i.fY2=e.fY2,i.fX1NDC=e.fX1NDC,i.fX2NDC=e.fX2NDC,i.fY1NDC=e.fY1NDC,i.fY2NDC=e.fY2NDC),this.stored=Object.assign({},e)),i.fOption=e.fOption,i.fBorderSize=e.fBorderSize,i.fTextColor!==void 0&&e.fTextColor!==void 0&&(i.fTextAngle=e.fTextAngle,i.fTextSize=e.fTextSize,i.fTextAlign=e.fTextAlign,i.fTextColor=e.fTextColor,i.fTextFont=e.fTextFont),e._typename){case st:case K:i.fLines=gt(e.fLines);break;case rt:i.fLines=gt(e.fLines),i.fNpaves=e.fNpaves;break;case ot:case lt:i.fLabel=e.fLabel;break;case J:i.fOptStat=e.fOptStat,i.fOptFit=e.fOptFit;break;case Q:{let s=i.fPrimitives;if(i.fPrimitives=e.fPrimitives,i.fNColumns=e.fNColumns,this.AutoPlace=o,s?.arr?.length&&s?.arr?.length===i.fPrimitives?.arr?.length)for(let n=0;n<s.arr.length;++n){let f=s.arr[n].fObject,h=i.fPrimitives.arr[n].fObject;f&&h&&f._typename===h._typename&&f.fName===h.fName&&(i.fPrimitives.arr[n].fObject=f)}return!0}case Z:i.fBorderSize=1,i.fShadowColor=0;break;default:return!1}return this.storeDrawOpt(o?Gt:t),!0}redraw(){return V(this,null,function*(){return this.drawPave()})}cleanup(){this.z_handle?.cleanup(),delete this.z_handle;let e=this.getObject();e&&delete e.$main_painter,super.cleanup()}setTitlePosition(e,t,i){let o=p.fTitleX,s=p.fTitleY,n=p.fTitleAlign%10,f=(p.fTitleAlign-n)/10,h=p.fTitleW,a=p.fTitleH,r=!1;return a<=0&&(i?a=1.1*i/this.getPadPainter().getPadHeight():(a=.05,r=!0)),h<=0&&(t?h=Math.min(.7,.02+t/this.getPadPainter().getPadWidth()):(h=.5,r=!0)),e.fX1NDC=f<2?o:f>2?o-h:o-h/2,e.fY1NDC=n<2?s:n>2?s-a:s-a/2,e.fX2NDC=e.fX1NDC+h,e.fY2NDC=e.fY1NDC+a,e.fInit=1,r}static canDraw(e){let t=e?._typename;return t===mt||t===ot||t===lt||t===J||t===K||t===rt||t===st||t===Q||t===Z}static draw(e,t,i){return V(this,null,function*(){let o=i,s=i===jt,n=i===Vt;(s||n||H(i)&&i.indexOf(";")>=0)&&(i="");let f=new q(e,t,i);return It(f,!1).then(()=>{if(f.isTitle()){let h=f.getPadPainter().findPainterFor(null,_t,K);h&&h!==f?(h.removeFromPadPrimitives(),h.cleanup()):(s||f.isDummyPos(t))&&f.setTitlePosition(t)&&(f.$postitle=!0)}else t._typename===Z&&(t.fBorderSize=1,t.fShadowColor=0,t.fAxis&&(t.fAxis.fChopt||(t.fAxis.fChopt="+"),t.fAxis.fNdiv||(t.fAxis.fNdiv=12),t.fAxis.fLabelOffset||(t.fAxis.fLabelOffset=.005)),f.z_handle=new Et(f.getPadPainter(),t.fAxis,!0),f.UseContextMenu=!0);switch(f.NoFillStats=t.fName!=="stats",t._typename){case ot:case lt:f.paveDrawFunc=f.drawPaveLabel;break;case J:f.paveDrawFunc=f.drawPaveStats;break;case K:case rt:case st:f.paveDrawFunc=f.drawPaveText;break;case Q:f.AutoPlace=n,f.paveDrawFunc=f.drawLegend;break;case Z:f.paveDrawFunc=f.drawPaletteAxis;break}return f.drawPave(o).then(()=>{let h=f.$postitle&&f.$titlebox;return h&&f.setTitlePosition(t,f.$titlebox.width,f.$titlebox.height),delete f.$postitle,delete f.$titlebox,h?f.drawPave(o):f})})})}};export{jt as a,Zt as b};

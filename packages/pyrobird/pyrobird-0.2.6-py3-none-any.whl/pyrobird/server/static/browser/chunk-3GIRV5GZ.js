import{a as ht,b as lt}from"./chunk-O2YOIZWS.js";import{g as Z}from"./chunk-YC5SGHGH.js";import{Aa as rt,Ea as at,I as Y,Ja as nt,K as $,O as R,P as D,e as S,ha as st,p as et,q as C,ra as I}from"./chunk-FVXVO67X.js";import{Da as K,Ma as tt,Qa as it,Ta as L,Va as z,ba as J,db as X,eb as O,f as T,g as V,ib as H,ja as P,jb as N,kb as q,t as F,u as A,x as G}from"./chunk-KYOHYQWH.js";import{k as v}from"./chunk-KYPE3LET.js";var W=G(18),j="TGraphErrors",ot="TGraphAsymmErrors",ft="TGraphBentErrors",Q="TGraphMultiErrors",ct=class U extends st{constructor(t,i){super(t,i),this.axes_draw=!1,this.bins=null,this.xmin=this.ymin=this.xmax=this.ymax=0,this.wheel_zoomy=!0,this.is_bent=i._typename===ft,this.has_errors=i._typename===j||i._typename===Q||i._typename===ot||this.is_bent||i._typename.match(/^RooHist/)}getGraph(){return this.getObject()}getHistogram(){return this.getObject()?.fHistogram}setHistogram(t){let i=this.getObject();i&&(i.fHistogram=t)}redraw(){return v(this,null,function*(){let t=Promise.resolve(!0);if(this.$redraw_hist){delete this.$redraw_hist;let i=this.getMainPainter();i?.isSecondary(this)&&this.axes_draw&&(t=i.redraw())}return t.then(()=>this.drawGraph()).then(()=>{let i=this._funcHandler?.drawNext(0)??this;return delete this._funcHandler,i})})}cleanup(){delete this.interactive_bin,delete this.bins,super.cleanup()}get_gme(){let t=this.getGraph();return t?._typename===Q?t:null}decodeOptions(t,i){V(t)&&t.indexOf("same ")===0&&(t=t.slice(5));let e=this.getGraph(),a=!!this.get_gme(),n=i?!!this.getMainPainter():!this.axes_draw,h=[];this.options||(this.options={});let f=(l,o)=>{Object.assign(o,{Line:0,Curve:0,Rect:0,Mark:0,Bar:0,OutRange:0,EF:0,Fill:0,MainError:1,Ends:1,ScaleErrX:1}),a&&l.check("S=",!0)&&(o.ScaleErrX=l.partAsFloat()),l.check("L")&&(o.Line=1),l.check("F")&&(o.Fill=1),l.check("CC")&&(o.Curve=2),l.check("C")&&(o.Curve=1),l.check("*")&&(o.Mark=103),l.check("P0")&&(o.Mark=104),l.check("P")&&(o.Mark=1),l.check("B")&&(o.Bar=1,o.Errors=0),l.check("Z")&&(o.Errors=1,o.Ends=0),l.check("||")&&(o.Errors=1,o.MainError=0,o.Ends=1),l.check("[]")&&(o.Errors=1,o.MainError=0,o.Ends=2),l.check("|>")&&(o.Errors=1,o.Ends=3),l.check(">")&&(o.Errors=1,o.Ends=4),l.check("0")&&(o.Mark=1,o.Errors=1,o.OutRange=1),l.check("1")&&o.Bar===1&&(o.Bar=2),l.check("2")&&(o.Rect=1,o.Errors=0),l.check("3")&&(o.EF=1,o.Errors=0),l.check("4")&&(o.EF=2,o.Errors=0),l.check("5")&&(o.Rect=2,o.Errors=0),l.check("X")&&(o.Errors=0)};Object.assign(this.options,{Axis:"",NoOpt:0,PadStats:!1,PadPalette:!1,original:t,second_x:!1,second_y:!1,individual_styles:!1}),a&&t&&(t.indexOf(";")>0?(h=t.split(";"),t=h.shift()):t.indexOf("_")>0&&(h=t.split("_"),t=h.shift()));let r=this.options,x=new Y(t),y="";if(ht.forEach(l=>{x.check(l)&&(y+=";"+l)}),x.check("XAXIS_",!0)&&(y+=";XAXIS_"+x.part),x.check("YAXIS_",!0)&&(y+=";YAXIS_"+x.part),x.empty()&&(r.original=n?"lp":"alp",x=new Y(r.original)),x.check("NOOPT")&&(r.NoOpt=1),x.check("POS3D_",!0)&&(r.pos3d=x.partAsInt()-.5),x.check("PFC")&&!r._pfc&&(r._pfc=2),x.check("PLC")&&!r._plc&&(r._plc=2),x.check("PMC")&&!r._pmc&&(r._pmc=2),x.check("A")&&(r.Axis=x.check("I")?"A;":" "),x.check("X+")&&(r.Axis+="X+",r.second_x=n),x.check("Y+")&&(r.Axis+="Y+",r.second_y=n),x.check("RX")&&(r.Axis+="RX"),x.check("RY")&&(r.Axis+="RY"),a&&(r.blocks=[],r.skip_errors_x0=r.skip_errors_y0=!1,x.check("X0")&&(r.skip_errors_x0=!0),x.check("Y0")&&(r.skip_errors_y0=!0)),f(x,r),a&&x.check("S")&&(r.individual_styles=!0),r.Errors===void 0&&(r.Errors=this.has_errors&&(!a||!h.length)?1:0),r.Mark===1&&e.fMarkerStyle===1&&(r.Mark=101),r.Line+r.Fill+r.Curve+r.Mark+r.Bar+r.EF+r.Rect+r.Errors===0&&x.empty()&&(r.Line=1),this.matchObjectType(j)){let l=e.fEX.length,o=0;for(let g=0;g<l;++g)o=Math.max(o,e.fEX[g],e.fEY[g]);o<1e-100&&(r.Errors=0)}if(this._cutg=this.matchObjectType(J),this._cutg_lastsame=this._cutg&&e.fNpoints>3&&e.fX[0]===e.fX[e.fNpoints-1]&&e.fY[0]===e.fY[e.fNpoints-1],!r.Axis){let l=this.getPadPainter()?.getRootPad(!0);(!l||l?.fPrimitives?.arr[0]===this.getObject())&&(r.Axis=" ")}r.Axis+=y;for(let l=0;l<h.length;++l){let o=new Y(h[l]),g={};f(o,g),g.skip_errors_x0=r.skip_errors_x0,g.skip_errors_y0=r.skip_errors_y0,r.blocks.push(g)}}extractGmeErrors(t){if(!this.bins)return;let i=this.getGraph();this.bins.forEach(e=>{e.eylow=i.fEyL[t][e.indx],e.eyhigh=i.fEyH[t][e.indx]})}createBins(){let t=this.getGraph();if(!t)return;let i=0,e=t.fNpoints;this._cutg&&this._cutg_lastsame&&e--,t._typename===j?i=1:t._typename===Q?i=2:(t._typename===ot||t._typename===ft||t._typename.match(/^RooHist/))&&(i=3),this.bins=new Array(e);for(let a=0;a<e;++a){let n=this.bins[a]={x:t.fX[a],y:t.fY[a],indx:a};switch(i){case 1:n.exlow=n.exhigh=t.fEX[a],n.eylow=n.eyhigh=t.fEY[a];break;case 2:n.exlow=t.fExL[a],n.exhigh=t.fExH[a],n.eylow=t.fEyL[0][a],n.eyhigh=t.fEyH[0][a];break;case 3:n.exlow=t.fEXlow[a],n.exhigh=t.fEXhigh[a],n.eylow=t.fEYlow[a],n.eyhigh=t.fEYhigh[a];break}a===0&&(this.xmin=this.xmax=n.x,this.ymin=this.ymax=n.y),i>0?(this.xmin=Math.min(this.xmin,n.x-n.exlow,n.x+n.exhigh),this.xmax=Math.max(this.xmax,n.x-n.exlow,n.x+n.exhigh),this.ymin=Math.min(this.ymin,n.y-n.eylow,n.y+n.eyhigh),this.ymax=Math.max(this.ymax,n.y-n.eylow,n.y+n.eyhigh)):(this.xmin=Math.min(this.xmin,n.x),this.xmax=Math.max(this.xmax,n.x),this.ymin=Math.min(this.ymin,n.y),this.ymax=Math.max(this.ymax,n.y))}this._frame_layer=!0,this.xmin===0&&this.ymin===0&&e>0&&this.bins[0].x===0&&this.bins[0].y===0&&this.options.Mark&&!this.options.Line&&!this.options.Curve&&!this.options.Fill&&(this._frame_layer="upper_layer")}getHistRangeMargin(){return .1}createHistogram(t=!0,i=!0){let e=this.getGraph(),a=this.xmin,n=this.getHistRangeMargin(),h=this.xmax,f=this.ymin,r=this.ymax;a>=h&&(h=a+1),f>=r&&(r=f+1);let x=(h-a)*n,y=(r-f)*n,l=a-x,o=h+x,g=f-y,s=r+y;f>0&&g<=0&&(g=(1-n)*f),r<0&&s>=0&&(s=(1-n)*r);let _=g,m=s,c=this.getHistogram();if(!this._not_adjust_hrange&&!c?.fXaxis.fTimeDisplay){let d=this.getPadPainter()?.getPadLog("x");l<0&&a>=0&&(l=d?a*(1-n):0),o>0&&h<=0&&(o=d?(1+n)*h:0)}return c?c.fMaximum!==X&&c.fMinimum!==X&&(g=c.fMinimum,s=c.fMaximum):(c=this._is_scatter?N(it,30,30):N(tt,100),c.fName=e.fName+"_h",c.fBits|=O,this._own_histogram=!0,this.setHistogram(c)),e.fMinimum!==X&&(g=f=e.fMinimum),e.fMaximum!==X&&(s=e.fMaximum),g<0&&f>=0&&(g=(1-n)*f),r<0&&s>=0&&(s=(1-n)*r),q(c,this.getObject().fTitle),t&&!c.fXaxis.fLabels&&(c.fXaxis.fXmin=l,c.fXaxis.fXmax=o),i&&!c.fYaxis.fLabels&&(c.fYaxis.fXmin=Math.min(_,g),c.fYaxis.fXmax=Math.max(m,s),this._is_scatter||(c.fMinimum=g,c.fMaximum=s)),c.$xmin_nz=a>0?a:void 0,c.$ymin_nz=f>0?f:void 0,c}unzoomUserRange(t,i){let e=this.getGraph();if(this._own_histogram||!e)return!1;let a=this.getHistogram();return t=t&&a&&(a.fXaxis.fXmin>this.xmin||a.fXaxis.fXmax<this.xmax),i=i&&a&&(a.fYaxis.fXmin>this.ymin||a.fYaxis.fXmax<this.ymax),!t&&!i?!1:(this.createHistogram(t,i),this.getMainPainter()?.extractAxesProperties(1),!0)}canOptimize(){return F.OptimizeDraw>0&&!this.options.NoOpt}optimizeBins(t,i){if(this.bins.length<30&&!i)return this.bins;let e=null;if(T(i))for(let h=0;h<this.bins.length;++h)i(this.bins[h],h)?e||(e=h===0?[]:this.bins.slice(0,h)):e&&e.push(this.bins[h]);if(e||(e=this.bins),t||(t=5e5),e.length<t||!this.canOptimize())return e;let a=Math.floor(e.length/t);a<2&&(a=2);let n=[];for(let h=0;h<e.length;h+=a)n.push(e[h]);return n}needDrawFunc(t,i){return i._typename===P?i.fName!=="stats"||!t.TestBit(O):i._typename===L||i._typename===z?!i.TestBit(G(9)):!0}getTooltips(t){let i=this.get_main(),e=[],a=i.getGrFuncs(this.options.second_x,this.options.second_y),n=this.get_gme();if(e.push(this.getObjectHint()),t&&a)if(t.indx!==void 0&&e.push("p = "+t.indx),e.push("x = "+a.axisAsText("x",t.x),"y = "+a.axisAsText("y",t.y)),n?e.push("error x = -"+a.axisAsText("x",n.fExL[t.indx])+"/+"+a.axisAsText("x",n.fExH[t.indx])):this.options.Errors&&a.x_handle.kind===I&&(t.exlow||t.exhigh)&&e.push("error x = -"+a.axisAsText("x",t.exlow)+"/+"+a.axisAsText("x",t.exhigh)),n)for(let h=0;h<n.fNYErrors;++h)e.push(`error y${h} = -${a.axisAsText("y",n.fEyL[h][t.indx])}/+${a.axisAsText("y",n.fEyH[h][t.indx])}`);else(this.options.Errors||this.options.EF>0)&&a.y_handle.kind===I&&(t.eylow||t.eyhigh)&&e.push("error y = -"+a.axisAsText("y",t.eylow)+"/+"+a.axisAsText("y",t.eyhigh));return e}get_main(){let t=this.getFramePainter();if(t?.grx&&t?.gry)return t;let i=this.getPadPainter(),e=i?.getPadRect()||{width:800,height:600};return t={pad_layer:!0,pad:i?.getRootPad(!0)??H(K),pw:e.width,ph:e.height,fX1NDC:.1,fX2NDC:.9,fY1NDC:.1,fY2NDC:.9,getFrameWidth(){return this.pw},getFrameHeight(){return this.ph},grx(a){return this.pad.fLogx?a=a>0?Math.log10(a):this.pad.fUxmin:a=(a-this.pad.fX1)/(this.pad.fX2-this.pad.fX1),a*this.pw},gry(a){return this.pad.fLogv??this.pad.fLogy?a=a>0?Math.log10(a):this.pad.fUymin:a=(a-this.pad.fY1)/(this.pad.fY2-this.pad.fY1),(1-a)*this.ph},revertAxis(a,n){return a==="x"?n/this.pw*(this.pad.fX2-this.pad.fX1)+this.pad.fX1:a==="y"?(1-n/this.ph)*(this.pad.fY2-this.pad.fY1)+this.pad.fY1:n},getGrFuncs(){return this}},t.pad?t:null}appendExclusion(t,i,e,a){let n=[];for(let f=e.length-1;f>=0;--f){let r=e[f],x=Math.sqrt(r.dgrx**2+r.dgry**2);x>1e-10&&(r.grx+=a*r.dgry/x,r.gry-=a*r.dgrx/x),n.push(r)}let h=$(n,{cmd:"L",line:!t});this.draw_g.append("svg:path").attr("d",i+h+"Z").call(this.fillatt.func).style("opacity",.75)}drawBins(t,i,e,a,n,h,f,r){let x=this.getGraph();if(!x?.fNpoints)return;let y=0,l=null,o=!this.isBatchMode()&&(i.Line||i.Errors)?"none":null;if(r&&h.excl_side&&(y=h.excl_width,h.width>0&&!i.Line&&!i.Curve&&(i.Line=1)),i.EF){l=this.optimizeBins(i.EF>1?2e4:0);for(let d=0;d<l.length;++d){let p=l[d];p.grx=t.grx(p.x),p.gry=t.gry(p.y-p.eylow)}let s=$(l,{line:i.EF<2,qubic:!0}),_=[];for(let d=l.length-1;d>=0;--d){let p=l[d];p.gry=t.gry(p.y+p.eyhigh),_.push(p)}let m=$(_,{line:i.EF<2,cmd:"L",qubic:!0}),c=e.append("svg:path").attr("d",s+m+"Z").call(f.func);f.empty()&&f.colorindx&&c.style("stroke",this.getColor(f.colorindx)),r&&(this.draw_kind="lines")}if(i.Line||i.Fill){let s="";this._cutg&&(s="Z",i.original||(i.Fill=1)),i.Fill&&(s="Z",y=0),l||(l=this.optimizeBins(0));for(let c=0;c<l.length;++c){let d=l[c];d.grx=t.grx(d.x),d.gry=t.gry(d.y)}let _=$(l,{line:!0,calc:y});y&&this.appendExclusion(!1,_,l,y);let m=e.append("svg:path").attr("d",_+s).style("pointer-events",o);i.Line&&m.call(h.func),i.Fill?m.call(f.func):m.style("fill","none"),r&&(this.draw_kind="lines")}if(i.Curve){let s=l;if(this.draw_kind!=="lines"||!s||i.Curve===1&&s.length>2e4){s=this.optimizeBins(i.Curve===1?2e4:0);for(let m=0;m<s.length;++m){let c=s[m];c.grx=t.grx(c.x),c.gry=t.gry(c.y)}}let _=$(s,{qubic:!y});y&&this.appendExclusion(!0,_,s,y),e.append("svg:path").attr("d",_).call(h.func).style("fill","none").style("pointer-events",o),r&&(this.draw_kind="lines")}let g=null;if((i.Errors||i.Rect||i.Bar)&&(l=this.optimizeBins(5e3,(s,_)=>{let m=t.grx(s.x);if(!i.Bar&&(m<0||m>a))return!0;let c=t.gry(s.y);return!i.Bar&&!i.OutRange&&(c<0||c>n)?!0:(s.grx1=Math.round(m),s.gry1=Math.round(c),this.has_errors&&(s.grx0=Math.round(t.grx(s.x-i.ScaleErrX*s.exlow)-m),s.grx2=Math.round(t.grx(s.x+i.ScaleErrX*s.exhigh)-m),s.gry0=Math.round(t.gry(s.y-s.eylow)-c),s.gry2=Math.round(t.gry(s.y+s.eyhigh)-c),this.is_bent?(s.grdx0=Math.round(t.gry(s.y+x.fEXlowd[_])-c),s.grdx2=Math.round(t.gry(s.y+x.fEXhighd[_])-c),s.grdy0=Math.round(t.grx(s.x+x.fEYlowd[_])-m),s.grdy2=Math.round(t.grx(s.x+x.fEYhighd[_])-m)):s.grdx0=s.grdx2=s.grdy0=s.grdy2=0),!1)}),r&&(this.draw_kind="nodes"),g=e.selectAll(".grpoint").data(l).enter().append("svg:g").attr("class","grpoint").attr("transform",s=>R(s.grx1,s.gry1))),i.Bar){let s=0,_=0;for(let d=0;d<l.length;++d)d===0?s=_=l[d].grx1:(s=Math.min(s,l[d].grx1),_=Math.max(_,l[d].grx1));if(l.length===1)l[0].width=a/4;else for(let d=0;d<l.length;++d)l[d].width=(_-s)/l.length*A.fBarWidth;let m=Math.round(t.gry(0)),c=f;if(r){let d=this.getFramePainter(),p=d?.fillatt?.empty()?-1:d.fillatt.getFillColor();p===f.getFillColor()&&(c=this.createAttFill({color:p==="white"?C:et,pattern:1001,std:!1}))}g.append("svg:path").attr("d",d=>{d.bar=!0;let p=d.width>1?Math.round(-d.width/2):0,w=d.width>1?Math.round(d.width):1,u=i.Bar!==1?0:d.gry1>m?m-d.gry1:0,b=i.Bar!==1?n>d.gry1?n-d.gry1:0:Math.abs(m-d.gry1);return`M${p},${u}h${w}v${b}h${-w}z`}).call(c.func)}if(i.Rect&&g.filter(s=>s.exlow>0&&s.exhigh>0&&s.eylow>0&&s.eyhigh>0).append("svg:path").attr("d",s=>(s.rect=!0,`M${s.grx0},${s.gry0}H${s.grx2}V${s.gry2}H${s.grx0}Z`)).call(f.func).call(i.Rect===2?h.func:()=>{}),this.error_size=0,i.Errors){let s=h.width+A.fEndErrorSize,_=i.Ends?`m0,${s}v${-2*s}`:"",m=i.Ends?`m${s},0h${-2*s}`:"",c=_,d=_,p=m,w=m,u,b=(M,E)=>{if(!i.MainError)return`M${M},${E}`;let B="M0,0";return M?B+(E?`L${M},${E}`:`H${M}`):E?B+`V${E}`:B};switch(i.Ends){case 2:u=Math.max(h.width+1,Math.round(s*.66)),c=`m${u},${s}h${-u}v${-2*s}h${u}`,d=`m${-u},${s}h${u}v${-2*s}h${-u}`,p=`m${-s},${u}v${-u}h${2*s}v${u}`,w=`m${-s},${-u}v${u}h${2*s}v${-u}`;break;case 3:s=Math.max(s,Math.round(x.fMarkerSize*8*.66)),u=Math.max(h.width+1,Math.round(s*.66)),c=`l${u},${s}v${-2*s}l${-u},${s}`,d=`l${-u},${s}v${-2*s}l${u},${s}`,p=`l${-s},${u}h${2*s}l${-s},${-u}`,w=`l${-s},${-u}h${2*s}l${-s},${u}`;break;case 4:s=Math.max(s,Math.round(x.fMarkerSize*8*.66)),u=Math.max(h.width+1,Math.round(s*.66)),c=`l${u},${s}m0,${-2*s}l${-u},${s}`,d=`l${-u},${s}m0,${-2*s}l${u},${s}`,p=`l${-s},${u}m${2*s},0l${-s},${-u}`,w=`l${-s},${-u}m${2*s},0l${-s},${u}`;break}this.error_size=s,s=Math.floor((h.width-1)/2);let k=g.filter(M=>M.exlow>0||M.exhigh>0||M.eylow>0||M.eyhigh>0);(i.skip_errors_x0||i.skip_errors_y0)&&(k=k.filter(M=>(M.x!==0||!i.skip_errors_x0)&&(M.y!==0||!i.skip_errors_y0))),!this.isBatchMode()&&F.Tooltip&&r&&k.append("svg:path").attr("d",M=>`M${M.grx0},${M.gry0}h${M.grx2-M.grx0}v${M.gry2-M.gry0}h${M.grx0-M.grx2}z`).style("fill","none").style("pointer-events","visibleFill"),k.append("svg:path").attr("d",M=>(M.error=!0,(M.exlow>0?b(M.grx0+s,M.grdx0)+c:"")+(M.exhigh>0?b(M.grx2-s,M.grdx2)+d:"")+(M.eylow>0?b(M.grdy0,M.gry0-s)+w:"")+(M.eyhigh>0?b(M.grdy2,M.gry2+s)+p:""))).style("fill","none").call(h.func)}if(i.Mark){this.createAttMarker({attr:x,style:i.Mark-100}),this.marker_size=this.markeratt.getFullSize(),this.markeratt.resetPos();let s=!this.isBatchMode()&&F.Tooltip&&(!this.markeratt.fill||this.marker_size<7)&&!g&&r,_=Math.max(5,Math.round(this.marker_size*.7)),m=1e6/(this.markeratt.getMarkerLength()+7),c="",d,p,w,u="",b=1;l?this.canOptimize()&&l.length>1.5*m&&(b=Math.min(2,Math.round(l.length/m))):l=this.optimizeBins(m);for(let k=0;k<l.length;k+=b)d=l[k],p=t.grx(d.x),p>-this.marker_size&&p<a+this.marker_size&&(w=t.gry(d.y),w>-this.marker_size&&w<n+this.marker_size&&(c+=this.markeratt.create(p,w),s&&(u+=`M${p-_},${w-_}h${2*_}v${2*_}h${-2*_}z`)));c&&(e.append("svg:path").attr("d",c).call(this.markeratt.func),g===null&&this.draw_kind==="none"&&r&&(this.draw_kind=i.Mark===101?"path":"mark")),s&&u&&e.append("svg:path").attr("d",u).style("fill","none").style("pointer-events","visibleFill")}}appendQQ(t,i){let e=Math.max(t.scale_xmin,i.fXq1),a=Math.min(t.scale_xmax,i.fXq2),n=Math.max(t.scale_ymin,i.fYq1),h=Math.min(t.scale_ymax,i.fYq2),f=(g,s,_,m)=>`M${t.grx(g)},${t.gry(s)}L${t.grx(_)},${t.gry(m)}`,r=(i.fYq2-i.fYq1)*(t.scale_xmin-i.fXq1)/(i.fXq2-i.fXq1)+i.fYq1,x=(i.fYq2-i.fYq1)*(t.scale_xmax-i.fXq1)/(i.fXq2-i.fXq1)+i.fYq1,y;if(r<t.scale_ymin){let g=(i.fXq2-i.fXq1)*(t.scale_ymin-i.fYq1)/(i.fYq2-i.fYq1)+i.fXq1;y=f(g,t.scale_ymin,e,n)}else y=f(t.scale_xmin,r,e,n);if(x>t.scale_ymax){let g=(i.fXq2-i.fXq1)*(t.scale_ymax-i.fYq1)/(i.fYq2-i.fYq1)+i.fXq1;y+=f(a,h,g,t.scale_ymax)}else y+=f(a,h,t.scale_xmax,x);let l=this.createAttLine({style:1,width:1,color:C,std:!1}),o=this.createAttLine({style:2,width:1,color:C,std:!1});this.draw_g.append("path").attr("d",f(e,n,a,h)).call(l.func).style("fill","none"),this.draw_g.append("path").attr("d",y).call(o.func).style("fill","none")}drawBins3D(){console.log("Load ./hist/TGraphPainter.mjs to draw graph in 3D")}createGraphDrawAttributes(t){let i=this.getGraph(),e=this.options;if(e._pfc>1||e._plc>1||e._pmc>1){let a=this.getPadPainter();if(T(a?.getAutoColor)){let n=a.getAutoColor(i.$num_graphs);this._auto_exec="",e._pfc>1&&(e._pfc=1,i.fFillColor=n,this._auto_exec+=`SetFillColor(${n});;`,delete this.fillatt),e._plc>1&&(e._plc=1,i.fLineColor=n,this._auto_exec+=`SetLineColor(${n});;`,delete this.lineatt),e._pmc>1&&(e._pmc=1,i.fMarkerColor=n,this._auto_exec+=`SetMarkerColor(${n});;`,delete this.markeratt)}}t?this.deleteAttr():(this.createAttLine({attr:i,can_excl:!0}),this.createAttFill({attr:i}))}drawGraph(){let t=this.get_main(),i=this.getGraph();if(!t||!this.options)return;if(this.options.pos3d)return this.drawBins3D(t,i);let e=!!this.get_gme(),a=t.getGrFuncs(this.options.second_x,this.options.second_y),n=t.getFrameWidth(),h=t.getFrameHeight();this.createG(t.pad_layer?!1:this._frame_layer),this.createGraphDrawAttributes(),this.fillatt.used=!1,this.draw_kind="none",this.marker_size=0;let f=e?this.draw_g.append("svg:g"):this.draw_g;if(this.drawBins(a,this.options,f,n,h,this.lineatt,this.fillatt,!0),i._typename==="TGraphQQ"&&this.appendQQ(a,i),e){for(let r=0;r<i.fNYErrors;++r){let x=this.lineatt,y=this.fillatt;this.options.individual_styles&&(x=this.createAttLine({attr:i.fAttLine[r],std:!1}),y=this.createAttFill({attr:i.fAttFill[r],std:!1}));let l=this.draw_g.append("svg:g"),o=r<this.options.blocks.length?this.options.blocks[r]:this.options;this.extractGmeErrors(r),this.drawBins(a,o,l,n,h,x,y)}this.extractGmeErrors(0)}this.isBatchMode()||(rt(this,this.testEditable()),nt(this,at))}extractTooltip(t){if(!t)return null;if(this.draw_kind==="lines"||this.draw_kind==="path"||this.draw_kind==="mark")return this.extractTooltipForPath(t);if(this.draw_kind!=="nodes")return null;let i=this.get_main(),e=i.getFrameHeight(),a=this.error_size,n=this.options.Bar===1,h=n?i.getGrFuncs(this.options.second_x,this.options.second_y):null,f=this.marker_size?Math.round(this.marker_size/2+1.5):0,r=null,x=1e10,y=null;if(this.draw_g.selectAll(".grpoint").each(function(){let s=S(this).datum();if(s===void 0)return;let _=(t.x-s.grx1)**2;if(t.nproc===1&&(_+=(t.y-s.gry1)**2),_>=x)return;let m;if(s.error||s.rect||s.marker)m={x1:Math.min(-a,s.grx0,-f),x2:Math.max(a,s.grx2,f),y1:Math.min(-a,s.gry2,-f),y2:Math.max(a,s.gry0,f)};else if(s.bar){if(m={x1:-s.width/2,x2:s.width/2,y1:0,y2:e-s.gry1},n){let p=h.gry(0);m.y1=s.gry1>p?p-s.gry1:0,m.y2=s.gry1>p?0:p-s.gry1}}else m={x1:-5,x2:5,y1:-5,y2:5};let c=t.x>=s.grx1+m.x1&&t.x<=s.grx1+m.x2,d=t.y>=s.gry1+m.y1&&t.y<=s.gry1+m.y2;c&&(d||t.nproc>1)&&(x=_,r=this,y=m,y.exact=d)}),r===null)return null;let l=S(r).datum(),o=this.getGraph(),g={name:o.fName,title:o.fTitle,x:l.grx1,y:l.gry1,color1:this.lineatt.color,lines:this.getTooltips(l),rect:y,d3bin:r};return g.user_info={obj:o,name:o.fName,bin:l.indx,cont:l.y,grx:l.grx1,gry:l.gry1},this.fillatt?.used&&!this.fillatt?.empty()&&(g.color2=this.fillatt.getFillColor()),y.exact&&(g.exact=!0),g.menu=g.exact,g.menu_dist=3,g.bin=l,g.binindx=l.indx,g}showTooltip(t){let i=this.draw_g?.selectChild(".tooltip_bin");if(!t||!this.draw_g){i?.remove();return}if(t.usepath)return this.showTooltipForPath(t);let e=S(t.d3bin).datum();i.empty()&&(i=this.draw_g.append("svg:rect").attr("class","tooltip_bin").style("pointer-events","none").call(D)),t.changed=i.property("current_bin")!==t.d3bin,t.changed&&i.attr("x",e.grx1+t.rect.x1).attr("width",t.rect.x2-t.rect.x1).attr("y",e.gry1+t.rect.y1).attr("height",t.rect.y2-t.rect.y1).style("opacity","0.3").property("current_bin",t.d3bin)}processTooltipEvent(t){let i=this.extractTooltip(t);return(!t||!t.disabled)&&this.showTooltip(i),i}findBestBin(t){if(!this.bins)return null;let i=this.draw_kind==="lines",e=this.get_main().getGrFuncs(this.options.second_x,this.options.second_y),a=-1,n=null,h=1e10,f,r,x,y,l;for(y=0;y<this.bins.length;++y)l=this.bins[y],r=e.grx(l.x),x=e.gry(l.y),f=(t.x-r)**2+(t.y-x)**2,f<h&&(h=f,n=l,a=y);h>100&&i&&(n=null);let o=Math.max(this.lineatt.width+3,4);this.marker_size>0&&(o=Math.max(this.marker_size,o)),n&&(h=Math.sqrt((t.x-e.grx(n.x))**2+(t.y-e.gry(n.y))**2)),!i&&h>o&&(n=null),n||(a=-1);let g={bin:n,indx:a,dist:h,radius:Math.round(o)};if(!n&&i){h=1e10;let s=(p,w,u)=>w>=p&&p>=u||w<=p&&p<=u,_=this.bins[0],m=e.grx(_.x),c,d;for(y=1;y<this.bins.length;++y)l=this.bins[y],r=e.grx(l.x),s(t.x,m,r)&&(c=e.gry(_.y),x=e.gry(l.y),Math.abs(r-m)<1?(d=t.y,f=s(t.y,c,x)?0:Math.min(Math.abs(t.y-c),Math.abs(t.y-x))):(d=c+(t.x-m)/(r-m)*(x-c),f=Math.abs(d-t.y)),f<h&&(h=f,g.linex=t.x,g.liney=d)),_=l,m=r;h<o*.5&&(g.linedist=h,g.closeline=!0)}return g}testEditable(t){let i=this.getGraph();return i?((t==="toggle"||t!==void 0)&&i.SetBit(W,!t),!i.TestBit(W)):!1}extractTooltipForPath(t){if(this.bins===null)return null;let i=this.findBestBin(t);if(!i||!i.bin&&!i.closeline)return null;let e=this.draw_kind==="lines",a=this.draw_kind==="mark",n=this.get_main(),h=n.getGrFuncs(this.options.second_x,this.options.second_y),f=this.getGraph(),r={name:f.fName,title:f.fTitle,x:i.bin?h.grx(i.bin.x):i.linex,y:i.bin?h.gry(i.bin.y):i.liney,color1:this.lineatt.color,lines:this.getTooltips(i.bin),usepath:!0};return r.user_info={obj:f,name:f.fName,bin:0,cont:0,grx:r.x,gry:r.y},r.ismark=a,r.islines=e,i.closeline?(r.menu=r.exact=!0,r.menu_dist=i.linedist):i.bin&&(this.options.EF&&e?(r.gry1=h.gry(i.bin.y-i.bin.eylow),r.gry2=h.gry(i.bin.y+i.bin.eyhigh)):r.gry1=r.gry2=h.gry(i.bin.y),r.binindx=i.indx,r.bin=i.bin,r.radius=i.radius,r.user_info.bin=i.indx,r.user_info.cont=i.bin.y,r.exact=Math.abs(t.x-r.x)<=i.radius&&(Math.abs(t.y-r.gry1)<=i.radius||Math.abs(t.y-r.gry2)<=i.radius),r.menu=r.exact,r.menu_dist=Math.sqrt((t.x-r.x)**2+Math.min(Math.abs(t.y-r.gry1),Math.abs(t.y-r.gry2))**2)),this.fillatt?.used&&!this.fillatt?.empty()&&(r.color2=this.fillatt.getFillColor()),e||(r.color1=this.getColor(f.fMarkerColor),r.color2||(r.color2=r.color1)),r}showTooltipForPath(t){let i=this.draw_g?.selectChild(".tooltip_bin");if(!t?.bin||!this.draw_g){i?.remove();return}if(i.empty()&&(i=this.draw_g.append("svg:g").attr("class","tooltip_bin")),t.changed=i.property("current_bin")!==t.bin,t.changed)if(i.selectAll("*").remove(),i.property("current_bin",t.bin),t.ismark)i.append("svg:rect").style("pointer-events","none").call(D).style("opacity","0.3").attr("x",Math.round(t.x-t.radius)).attr("y",Math.round(t.y-t.radius)).attr("width",2*t.radius).attr("height",2*t.radius);else{i.append("svg:circle").attr("cy",Math.round(t.gry1)),Math.abs(t.gry1-t.gry2)>1&&i.append("svg:circle").attr("cy",Math.round(t.gry2));let e=i.selectAll("circle").attr("r",t.radius).attr("cx",Math.round(t.x));t.islines?(this.options.Line||this.options.Curve?e.call(this.lineatt.func):e.style("stroke","black"),this.options.Fill?e.call(this.fillatt.func):e.style("fill","none")):e.style("stroke",t.color1==="black"?"green":"black").style("fill","none")}}moveEnabled(){return this.testEditable()}moveStart(t,i){this.pos_dx=this.pos_dy=0,this.move_funcs=this.get_main().getGrFuncs(this.options.second_x,this.options.second_y);let e=this.extractTooltip({x:t,y:i});e&&e.exact&&e.binindx!==void 0?(this.move_binindx=e.binindx,this.move_bin=e.bin,this.move_x0=this.move_funcs.grx(this.move_bin.x),this.move_y0=this.move_funcs.gry(this.move_bin.y)):delete this.move_binindx}moveDrag(t,i){this.pos_dx+=t,this.pos_dy+=i,this.move_binindx===void 0?R(this.draw_g,this.pos_dx,this.pos_dy):this.move_funcs&&this.move_bin&&(this.move_bin.x=this.move_funcs.revertAxis("x",this.move_x0+this.pos_dx),this.move_bin.y=this.move_funcs.revertAxis("y",this.move_y0+this.pos_dy),this.drawGraph())}moveEnd(t){let i=this.getGraph(),e=i?.fNpoints-1,a="",n=h=>{a+=`SetPoint(${h.indx},${h.x},${h.y});;`,i.fX[h.indx]=h.x,i.fY[h.indx]=h.y,h.indx===0&&this._cutg_lastsame&&(a+=`SetPoint(${e},${h.x},${h.y});;`,i.fX[e]=h.x,i.fY[e]=h.y)};if(this.move_binindx===void 0){if(this.draw_g.attr("transform",null),this.move_funcs&&this.bins&&!t){for(let h=0;h<this.bins.length;++h){let f=this.bins[h];f.x=this.move_funcs.revertAxis("x",this.move_funcs.grx(f.x)+this.pos_dx),f.y=this.move_funcs.revertAxis("y",this.move_funcs.gry(f.y)+this.pos_dy),n(f)}i.$redraw_pad?this.redrawPad():this.drawGraph()}}else n(this.move_bin),delete this.move_binindx,i.$redraw_pad&&this.redrawPad();delete this.move_funcs,a&&!t&&this.submitCanvExec(a)}fillWebObjectOptions(t){this._auto_exec&&t&&(t.fcust="auto_exec:"+this._auto_exec,delete this._auto_exec)}fillContextMenuItems(t){this.snapid||(t.addchk(this.testEditable(),"Editable",()=>{this.testEditable("toggle"),this.drawGraph()}),this.axes_draw&&t.add("Title",()=>t.input("Enter graph title",this.getObject().fTitle).then(i=>{this.getObject().fTitle=i;let e=this.getMainPainter();e?.isSecondary(this)&&(q(e.getHisto(),i),this.interactiveRedraw("pad"))})),t.addRedrawMenu(this.getPrimary()))}executeMenuCommand(t,i){if(super.executeMenuCommand(t,i))return!0;let e=this.getCanvPainter(),a=this.get_main();if(t.fName==="RemovePoint"||t.fName==="InsertPoint"){if(!e||e._readonly)return!0;let n=T(a?.getLastEventPos)?a.getLastEventPos():null,h=this.extractTooltip(n);if(t.fName==="InsertPoint"){if(n){let f=a.getGrFuncs(this.options.second_x,this.options.second_y),r=f.revertAxis("x",n.x)??0,x=f.revertAxis("y",n.y)??0;this.submitCanvExec(`AddPoint(${r.toFixed(3)}, ${x.toFixed(3)})`,t.$execid)}}else t.$execid&&h?.binindx!==void 0&&this.submitCanvExec(`RemovePoint(${h.binindx})`,t.$execid);return!0}return!1}_updateMembers(t,i){t.fBits=i.fBits,t.fTitle=i.fTitle,t.fX=i.fX,t.fY=i.fY,["fEX","fEY","fExL","fExH","fEXlow","fEXhigh","fEYlow","fEYhigh","fEXlowd","fEXhighd","fEYlowd","fEYhighd"].forEach(a=>{i[a]!==void 0&&(t[a]=i[a])}),t.fNpoints=i.fNpoints,t.fMinimum=i.fMinimum,t.fMaximum=i.fMaximum;let e=this.options;return this.snapid!==void 0&&(e._pfc=e._plc=e._pmc=0),e._pfc||(t.fFillColor=i.fFillColor),t.fFillStyle=i.fFillStyle,e._plc||(t.fLineColor=i.fLineColor),t.fLineStyle=i.fLineStyle,t.fLineWidth=i.fLineWidth,e._pmc||(t.fMarkerColor=i.fMarkerColor),t.fMarkerSize=i.fMarkerSize,t.fMarkerStyle=i.fMarkerStyle,i.fFunctions}updateObject(t,i){if(!this.matchObjectType(t))return!1;i&&i!==this.options.original&&this.decodeOptions(i);let e=this._updateMembers(this.getObject(),t);if(this.createBins(),delete this.$redraw_hist,this.axes_draw){let a=this.createHistogram(),n=this.getMainPainter();n?.isSecondary(this)&&(n.updateObject(a,this.options.Axis),this.$redraw_hist=!0)}return this._funcHandler=new Z(this,this.getPadPainter(),e),!0}canZoomInside(t,i,e){let a=this.getGraph();if(!a||t!=="x"&&t!=="y")return!1;let n=a.fX;if(this._is_scatter)n=t==="x"?a.fX:a.fY;else if(t!==(this.options.pos3d?"y":"x"))return!1;for(let h=0;h<a.fNpoints;++h)if(i<n[h]&&n[h]<e)return!0;return!1}clickButton(t){return t!=="ToggleZoom"||this.xmin===this.xmax&&this.ymin===this.ymax?!1:this.getFramePainter()?.zoom(this.xmin,this.xmax,this.ymin,this.ymax)}findFunc(){return this.getGraph()?.fFunctions?.arr?.find(t=>t._typename===L||t._typename===z)}findStat(){return this.getGraph()?.fFunctions?.arr?.find(t=>t._typename===P&&t.fName==="stats")}createStat(){let t=this.findFunc();if(!t)return null;let i=this.findStat();if(i)return i;let e=A;return!e.fOptFit||this.getCanvPainter()?.normal_canvas?null:(this.create_stats=!0,i=H(P),Object.assign(i,{fName:"stats",fOptStat:0,fOptFit:e.fOptFit,fBorderSize:1,fX1NDC:e.fStatX-e.fStatW,fY1NDC:e.fStatY-e.fStatH,fX2NDC:e.fStatX,fY2NDC:e.fStatY,fFillColor:e.fStatColor,fFillStyle:e.fStatStyle}),i.fTextAngle=0,i.fTextSize=e.fStatFontSize,i.fTextAlign=12,i.fTextColor=e.fStatTextColor,i.fTextFont=e.fStatFont,i.AddText(t.fName),this.getGraph().fFunctions.Add(i),i)}fillStatistic(t,i,e){let a=this.findFunc();return!a||!e?!1:(t.clearPave(),t.fillFunctionStat(a,e===1?111:e,1),!0)}drawAxisHisto(){return v(this,null,function*(){let t=!this.getHistogram(),i=this.createHistogram(t,t);return lt.draw(this.getDrawDom(),i,this.options.Axis)})}static _drawGraph(t,i){return v(this,null,function*(){t.decodeOptions(i,!0),t.createBins(),t.createStat();let e=t.getGraph();F.DragGraphs||e?.SetBit(W,!0);let a=Promise.resolve();return(!t.getMainPainter()||t.options.second_x||t.options.second_y)&&t.options.Axis&&(a=t.drawAxisHisto().then(n=>{n?.setSecondaryId(t,"hist"),t.axes_draw=!!n})),a.then(()=>(t.addToPadPrimitives(),t.drawGraph())).then(()=>new Z(t,t.getPadPainter(),e.fFunctions,!0).drawNext(0))})}static draw(t,i,e){return v(this,null,function*(){return U._drawGraph(new U(t,i),e)})}};export{ot as a,ct as b};

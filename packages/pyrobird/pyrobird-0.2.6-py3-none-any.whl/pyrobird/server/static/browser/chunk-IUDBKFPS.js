import{a as _t}from"./chunk-7MTENYBP.js";import{b as wt,f as Mt}from"./chunk-MGNYDHM4.js";import{c as pt,d as yt}from"./chunk-LGENSGLC.js";import{H as ot,I as gt,K as lt,P as mt,b as at}from"./chunk-FVXVO67X.js";import{fb as ct,s as ut,t as tt,u as Z}from"./chunk-KYOHYQWH.js";import{k}from"./chunk-KYPE3LET.js";var it=class q extends _t{constructor(t,i){super(t,i),this.wheel_zoomy=!1}scanContent(t){let i=this.getHisto();if(!i)return;!this.nbinsx&&t&&(t=!1),t||this.extractAxesProperties(1);let e=0,r=0,n=0,f=0;if(this.isDisplayItem())e=i.fContMin,r=i.fContMinPos,n=i.fContMax,f=n;else{let s=this.getSelectIndex("x","left"),y=this.getSelectIndex("x","right");if(t&&s===this.scan_xleft&&y===this.scan_xright)return;this.scan_xleft=s,this.scan_xright=y;let w=!0,g,c;for(let a=0;a<this.nbinsx;++a)g=i.getBinContent(a+1),f+=g,!(a<s||a>=y)&&(g>0&&(r===0||g<r)&&(r=g),w&&(e=n=g,w=!1),c=0,e=Math.min(e,g-c),n=Math.max(n,g+c))}if(this.stat_entries=f,this.hmin=e,this.hmax=n,this.ymin_nz=r,this.nbinsx===0||Math.abs(e)<1e-300&&Math.abs(n)<1e-300?this.draw_content=!1:this.draw_content=!0,this.draw_content)if(e>=n)e===0?(this.ymin=0,this.ymax=1):e<0?(this.ymin=2*e,this.ymax=0):(this.ymin=0,this.ymax=e*2);else{let s=(n-e)*.05;this.ymin=e-s,this.ymin<0&&e>=0&&(this.ymin=0),this.ymax=n+s}}countStat(t){let i=this.getHisto(),e=this.getAxis("x"),r=this.getSelectIndex("x","left"),n=this.getSelectIndex("x","right"),f=0,s=0,y={name:"histo",meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:this.stat_entries,xmax:0,wmax:0},w=0,g=0,c=0,a,m=null,l=null;for(a=r;a<n;++a){let d=e.GetBinCoord(a+.5);if(t&&!t(d))continue;let v=i.getBinContent(a+1);(m===null||v>l)&&(m=d,l=v),w+=v,g+=v*d,c+=v*d**2}return y.integral=w,Math.abs(w)>1e-300&&(y.meanx=g/w,y.meany=f/w,y.rmsx=Math.sqrt(Math.abs(c/w-y.meanx**2)),y.rmsy=Math.sqrt(Math.abs(s/w-y.meany**2))),m!==null&&(y.xmax=m,y.wmax=l),y}fillStatistic(t,i){let e=this.getHisto(),r=this.countStat(),n=i%10,f=Math.floor(i/10)%10,s=Math.floor(i/100)%10,y=Math.floor(i/1e3)%10,w=Math.floor(i/1e4)%10,g=Math.floor(i/1e5)%10,c=Math.floor(i/1e6)%10,a=Math.floor(i/1e7)%10,m=Math.floor(i/1e8)%10;return t.clearStat(),n>0&&t.addText(r.name),f>0&&t.addText("Entries = "+t.format(r.entries,"entries")),s>0&&t.addText("Mean = "+t.format(r.meanx)),y>0&&t.addText("Std Dev = "+t.format(r.rmsx)),w>0&&t.addText("Underflow = "+t.format(e.getBinContent(0),"entries")),g>0&&t.addText("Overflow = "+t.format(e.getBinContent(this.nbinsx+1),"entries")),c>0&&t.addText("Integral = "+t.format(r.integral,"entries")),a>0&&t.addText("Skew = <not avail>"),m>0&&t.addText("Kurt = <not avail>"),!0}getBarBaseline(t,i){let e=t.swap_xy?0:i;return Number.isFinite(this.options.BaseLine)&&this.options.BaseLine>=t.scale_ymin&&(e=Math.round(t.gry(this.options.BaseLine))),e}drawBars(t,i,e,r){return k(this,null,function*(){this.createG(!0);let n=t.i1,f=t.i2,s=t.stepi,y=this.getFramePainter(),w=this.getHisto(),g=this.getAxis("x"),c,a,m,l,d,v,o,u,C="",b="",_="",M=this.getBarBaseline(i,r);for(c=n;c<f;c+=s)a=g.GetBinCoord(c),m=g.GetBinCoord(c+s),!(i.logx&&m<=0)&&(l=Math.round(i.grx(a)),d=Math.round(i.grx(m)),v=w.getBinContent(c+1),!(i.logy&&v<i.scale_ymin)&&(o=Math.round(i.gry(v)),u=d-l,l+=Math.round(this.options.BarOffset*u),u=Math.round(this.options.BarWidth*u),y.swap_xy?C+=`M${M},${l}h${o-M}v${u}h${M-o}z`:C+=`M${l},${o}h${u}v${M-o}h${-u}z`,this.options.BarStyle>0&&(d=l+u,u=Math.round(u/10),y.swap_xy?(b+=`M${M},${l}h${o-M}v${u}h${M-o}z`,_+=`M${M},${d}h${o-M}v${-u}h${M-o}z`):(b+=`M${l},${o}h${u}v${M-o}h${-u}z`,_+=`M${d},${o}h${-u}v${M-o}h${u}z`))));return this.fillatt.empty()&&this.fillatt.setSolidColor("blue"),C&&this.draw_g.append("svg:path").attr("d",C).call(this.fillatt.func),b&&this.draw_g.append("svg:path").attr("d",b).call(this.fillatt.func).style("fill",at(this.fillatt.color).brighter(.5).formatRgb()),_&&this.draw_g.append("svg:path").attr("d",_).call(this.fillatt.func).style("fill",at(this.fillatt.color).darker(.5).formatRgb()),!0})}drawFilledErrors(t,i){return k(this,null,function*(){this.createG(!0);let e=t.i1,r=t.i2,n=t.stepi,f=this.getHisto(),s=this.getAxis("x"),y=[],w=[],g,c,a,m,l,d;for(g=e;g<r;g+=n)c=s.GetBinCoord(g+.5),!(i.logx&&c<=0)&&(a=Math.round(i.grx(c)),m=f.getBinContent(g+1),l=f.getBinError(g+1),!(i.logy&&m-l<i.scale_ymin)&&(d=Math.round(i.gry(m+l)),y.push({grx:a,gry:d}),d=Math.round(i.gry(m-l)),w.unshift({grx:a,gry:d})));let v=lt(y,{line:this.options.ErrorKind!==4}),o=lt(w,{line:this.options.ErrorKind!==4,cmd:"L"});return this.fillatt.empty()&&this.fillatt.setSolidColor("blue"),this.draw_g.append("svg:path").attr("d",v+o+"Z").call(this.fillatt.func),!0})}draw1DBins(){return k(this,null,function*(){let t=this.getFramePainter(),i=t.getFrameRect();if(!this.draw_content||i.width<=0||i.height<=0)return this.removeG(),!1;this.createHistDrawAttributes();let e=this.prepareDraw({extra:1,only_indexes:!0}),r=t.getGrFuncs(this.options.second_x,this.options.second_y);return this.options.Bar?this.drawBars(e,r,i.width,i.height):this.options.ErrorKind===3||this.options.ErrorKind===4?this.drawFilledErrors(e,r,i.width,i.height):this.drawHistBins(e,r,i.width,i.height)})}drawHistBins(t,i,e,r){return k(this,null,function*(){this.createG(!0);let n=this.options,f=t.i1,s=t.i2,y=t.stepi,w=this.getHisto(),g=!this.isBatchMode()&&tt.Tooltip,c=this.getAxis("x"),a=!n.Zero,m=n.Error,l=n.Line,d=n.Text,v=n.Mark,o="",u=!1,C,b,_,M,x,E,$,p,h,B,F,S,I,R,Y=null,X=null,N=null,K=null,U=null,et="",rt="",J=0,A,H,W,T,st,P,O,L,z,ht=Promise.resolve();if(m&&!v&&this.v7EvalAttr("marker_style",1)>1&&(v=!0),n.ErrorKind===2?this.fillatt.empty()?v=!0:Y="":n.Error&&(X="",U=g?"":null),l&&(K=""),v&&(this.createv7AttMarker(),this.markeratt.size>0?(N="",this.markeratt.resetPos()):v=!1),d){if(z=this.v7EvalFont("text",{size:20,color:"black",align:22}),!z.angle&&!n.TextKind){let Q=e/(s-f+1);Q<3*z.size&&(z.setAngle(270),z.setSize(Math.round(Q*.7)))}ht=this.startTextDrawingAsync(z,"font")}return ht.then(()=>{let Q=s-f>3*e;if(n.ErrorKind===1){let D=this.lineatt.width+Z.fEndErrorSize;et=`m0,${D}v${-2*D}m0,${D}`,rt=`m${D},0h${-2*D}m${D},0`,J=Math.floor((this.lineatt.width-1)/2)}let j=m||v;(j||d||l)&&(Q=!0);let V=D=>{if(T=w.getBinContent(D+1),!a||T!==0){if(P=Math.round(i.grx(c.GetBinCoord(D))),O=Math.round(i.grx(c.GetBinCoord(D+y))),L=Math.round((P+O)/2),A=Math.round(i.gry(T)),H=W=20,m&&(st=w.getBinError(D+1),H=Math.round(A-i.gry(T+st)),W=Math.round(i.gry(T-st)-A)),d&&T!==0){let G=T===Math.round(T)?T.toString():ot(T,Z.fPaintTextFormat);z.angle?this.drawText({align:12,x:L,y:Math.round(A-2-z.size/5),text:G,latex:0}):this.drawText({x:Math.round(P+(O-P)*.1),y:Math.round(A-2-z.size),width:Math.round((O-P)*.8),height:z.size,text:G,latex:0})}if(l&&K!==null&&(K+=(K.length===0?"M":"L")+L+","+A),j&&A>=-H&&A<=r+W&&(Y!==null&&(Y+=`M${P},${A-H}h${O-P}v${H+W+1}h${P-O}z`),N!==null&&(N+=this.markeratt.create(L,A)),X!==null)){let G=5;if(this.options.errorX>0){G=Math.round((O-P)*this.options.errorX);let xt=L-G,vt=L+G;X+=`M${xt+J},${A}${et}h${vt-xt-2*J}${et}`}X+=`M${L},${A-H+J}${rt}v${H+W-2*J}${rt}`,U!==null&&(U+=`M${L-G},${A-H}h${2*G}v${H+W}h${-2*G}z`)}}};for(S=f;S<=s;S+=y)M=c.GetBinCoord(S),!(i.logx&&M<=0)&&(x=Math.round(i.grx(M)),u=S>s-y,u&&f<s?$=_:(E=w.getBinContent(S+1),$=Math.round(i.gry(E))),o.length===0?(I=R=S,F=C=b=x,B=p=h=_=$,o="M"+b+","+_):Q?x===b&&!u?($<p?R=S:$>h&&(I=S),p=Math.min(p,$),h=Math.max(h,$),_=$):((j||d||l)&&(I===R?V(I):I<R?(V(I),V(R)):(V(R),V(I))),!j&&(p!==h||B!==p)&&(F!==b&&(o+="h"+(b-F)),_===p?(h!==B&&(o+="v"+(h-B)),p!==h&&(o+="v"+(p-h))):(p!==B&&(o+="v"+(p-B)),h!==p&&(o+="v"+(h-p)),_!==h&&(o+="v"+(_-h))),F=b,B=_),u&&F!==x&&(o+="h"+(x-F)),I=R=S,p=h=_=$,b=x):($!==_||u)&&(x!==b&&(o+="h"+(x-b)),$!==_&&(o+="v"+($-_)),_=$,b=x));let ft=!this.isBatchMode()&&this.fillatt.empty()&&n.Hist&&tt.Tooltip&&!j&&!l,nt=r+3;if(!ft){let D=Math.round(i.gry(0));D<=0?nt=-3:D<r&&(nt=D)}let dt=`L${b},${nt}H${C}Z`;return j||l?(Y&&this.draw_g.append("svg:path").attr("d",Y).call(this.fillatt.func),X&&this.draw_g.append("svg:path").attr("d",X).call(this.lineatt.func),U&&this.draw_g.append("svg:path").attr("d",U).style("fill","none").style("pointer-events",this.isBatchMode()?null:"visibleFill"),K&&(!this.fillatt.empty()&&!n.Hist&&this.draw_g.append("svg:path").attr("d",K+dt).call(this.fillatt.func),this.draw_g.append("svg:path").attr("d",K).style("fill","none").call(this.lineatt.func)),N&&this.draw_g.append("svg:path").attr("d",N).call(this.markeratt.func)):o&&n.Hist&&this.draw_g.append("svg:path").attr("d",o+(!this.fillatt.empty()||ft?dt:"")).style("stroke-linejoin","miter").call(this.lineatt.func).call(this.fillatt.func),d?this.finishTextDrawing():!0})})}getBinTooltips(t){let i=[],e=this.getObjectHint(),r=this.getFramePainter(),n=this.getHisto(),f=this.getAxis("x"),s=this.isDisplayItem()?n.stepx:1,y=f.GetBinCoord(t),w=f.GetBinCoord(t+s),g=this.getAxisBinTip("x",t,s),c=n.getBinContent(t+1);if(e&&i.push(e),this.options.Error||this.options.Mark)i.push(`x = ${g}`,`y = ${r.axisAsText("y",c)}`),this.options.Error&&(g[0]==="["&&i.push("error x = "+((w-y)/2).toPrecision(4)),i.push("error y = "+n.getBinError(t+1).toPrecision(4)));else{i.push(`bin = ${t+1}`,`x = ${g}`),n.$baseh&&(c-=n.$baseh.getBinContent(t+1));let a="entries = "+(s>1?"~":"");c===Math.round(c)?i.push(a+c):i.push(a+ot(c,Z.fStatFormat))}return i}processTooltipEvent(t){let i=this.draw_g?.selectChild(".tooltip_bin");if(!t||!this.draw_content||this.options.Mode3D||!this.draw_g)return i?.remove(),null;let e=this.getFramePainter(),r=e.getGrFuncs(this.options.second_x,this.options.second_y),n=e.getFrameWidth(),f=e.getFrameHeight(),s=this.getHisto(),y=this.getAxis("x"),w=this.getSelectIndex("x","left",-1),g=this.getSelectIndex("x","right",2),c,a,m,l,d,v=2,o=w,u=g;function C(h){let B=y.GetBinCoord(h);return r.logx&&B<=0?null:r.grx(B)}function b(h){let B=s.getBinContent(h+1);return r.logy&&B<r.scale_ymin?r.swap_xy?-1e3:10*f:Math.round(r.gry(B))}let _=r.swap_xy?t.y:t.x,M=r.swap_xy?t.x:t.y;for(;o<u-1;){let h=Math.round((o+u)*.5),B=C(h);B===null||B<_-.5?r.swap_xy?u=h:o=h:B>_+.5?r.swap_xy?o=h:u=h:(o++,u--)}let x=u=o;if(a=C(x),r.swap_xy){for(;o>w&&C(o-1)<a+2;)--o;for(;u<g&&C(u+1)>a-2;)++u}else{for(;o>w&&C(o-1)>a-2;)--o;for(;u<g&&C(u+1)<a+2;)++u}if(o<u){let h=f;for(let B=o;B<=u;B++){let F=Math.abs(b(B)-M);F<h&&(h=F,x=B)}h>f/10&&(x=Math.round(o+(u-o)/f*M)),a=C(x)}if(a=Math.round(a),m=Math.round(C(x+1)),this.options.Bar){let h=m-a;a+=Math.round(this.options.BarOffset*h),m=a+Math.round(this.options.BarWidth*h)}if(a>m&&([a,m]=[m,a]),this.isDisplayItem()&&(x<=s.dx||x>=s.dx+s.nx))return i.remove(),null;let E=Math.round((a+m)/2),$=l=d=b(x);if(this.options.Bar)c=!0,v=0,l=this.getBarBaseline(r,f),l>d&&([l,d]=[d,l]),!t.touch&&t.nproc===1&&(M<l||M>d)&&(x=null);else if(this.options.Error||this.options.Mark){c=!0;let h=3;if(this.markeratt&&(h=Math.max(h,this.markeratt.getFullSize())),this.options.Error){let B=s.getBinContent(x+1),F=s.getBinError(x+1);l=Math.round(r.gry(B+F)),d=Math.round(r.gry(B-F));let S=(m-a)*this.options.errorX;a=Math.round(E-S),m=Math.round(E+S)}m-a<2*h&&(a=E-h,m=E+h),l=Math.min(l,$-h),d=Math.max(d,$+h),!t.touch&&t.nproc===1&&(M<l||M>d)&&(x=null)}else this.options.Line?c=!1:(c=t.nproc===1&&g-w<n,c&&(d=f,this.fillatt.empty()||(d=Math.min(f,Math.max(0,Math.round(r.gry(0)))),d<l&&([l,d]=[d,l])),(t.y<l||t.y>d)&&!t.touch&&(x=null)));if(x!==null&&(x===w&&a>_+v||x===g-1&&m<_-v||_<a-v||_>m+v||!this.options.Zero&&s.getBinContent(x+1)===0)&&(x=null),x===null||d<=0||l>=f)return i.remove(),null;let p={name:"histo",title:s.fTitle,x:E,y:$,exact:!0,color1:this.lineatt?.color??"green",color2:this.fillatt?.getFillColorAlt("blue")??"blue",lines:this.getBinTooltips(x)};if(t.disabled)i.remove(),p.changed=!0;else if(c)i.empty()&&(i=this.draw_g.append("svg:rect").attr("class","tooltip_bin").style("pointer-events","none").call(mt)),p.changed=i.property("current_bin")!==x,p.changed&&i.attr("x",e.swap_xy?l:a).attr("width",e.swap_xy?d-l:m-a).attr("y",e.swap_xy?a:l).attr("height",e.swap_xy?m-a:d-l).style("opacity","0.3").property("current_bin",x),p.exact=Math.abs($-M)<=5||M>=l&&M<=d,p.menu=p.exact,p.menu_dist=Math.sqrt((E-_)**2+($-M)**2);else{let h=this.lineatt.width+3;i.empty()&&(i=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",h).call(this.lineatt.func).call(this.fillatt.func)),p.exact=Math.abs(E-t.x)<=h&&Math.abs($-t.y)<=h,p.menu=p.exact,p.menu_dist=Math.sqrt((E-t.x)**2+($-t.y)**2),p.changed=i.property("current_bin")!==x,p.changed&&i.attr("cx",E).attr("cy",$).property("current_bin",x)}return p.changed&&(p.user_info={obj:s,name:"histo",bin:x,cont:s.getBinContent(x+1),grx:E,gry:$}),p}fillHistContextMenu(t){t.add("Auto zoom-in",()=>this.autoZoom());let i=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",i,e=>{if(e.indexOf(ct)===0)return this.showInspector(e);this.decodeOptions(e),this.options.need_fillcol&&this.fillatt?.empty()&&this.fillatt.change(5,1001),this.interactiveRedraw("pad","drawopt")})}autoZoom(){let t=this.getSelectIndex("x","left",-1),i=this.getSelectIndex("x","right",1),e=i-t,r=this.getHisto(),n=this.getAxis("x");if(e===0)return;let f=r.getBinContent(t+1);for(let s=t;s<i;++s)f=Math.min(f,r.getBinContent(s+1));if(!(f>0)){for(;t<i&&r.getBinContent(t+1)<=f;)++t;for(;t<i&&r.getBinContent(i)<=f;)--i;if(t===i-1&&t>2&&i<this.nbinsx-2&&(--t,++i),i-t<e&&t<i)return this.getFramePainter().zoom(n.GetBinCoord(t),n.GetBinCoord(i))}}canZoomInside(t,i,e){let r=this.getAxis("x");return t==="x"&&r.FindBin(e,.5)-r.FindBin(i,0)>1||t==="y"&&Math.abs(e-i)>Math.abs(this.ymax-this.ymin)*1e-6}callDrawFunc(t){return k(this,null,function*(){let i=this.getFramePainter();return i&&i.mode3d!==this.options.Mode3D&&!this.isMainPainter()&&(this.options.Mode3D=i.mode3d),this.options.Mode3D?this.draw3D(t):this.draw2D(t)})}draw2D(t){return k(this,null,function*(){return this.clear3DScene(),this.drawFrameAxes().then(i=>i?this.drawingBins(t):!1).then(i=>{if(i)return this.draw1DBins().then(()=>this.addInteractivity())}).then(()=>this)})}draw3D(t){return k(this,null,function*(){return console.log("3D drawing is disabled, load ./hist/RH1Painter.mjs"),this.draw2D(t)})}redraw(t){return k(this,null,function*(){return this.callDrawFunc(t)})}static _draw(t,i){return k(this,null,function*(){return Mt(t).then(()=>{t.setAsMainPainter(),t.options={Hist:!1,Bar:!1,BarStyle:0,Error:!1,ErrorKind:-1,errorX:Z.fErrorX,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!1,TextAngle:0,TextKind:"",AutoColor:0,BarOffset:0,BarWidth:1,BaseLine:!1,Mode3D:!1,FrontBox:!1,BackBox:!1};let e=new gt(i);e.check("R3D_",!0)&&(t.options.Render3D=ut.Render3D.fromString(e.part.toLowerCase()));let r=t.v7EvalAttr("kind","hist"),n=t.v7EvalAttr("sub",0),f=!!t.getMainPainter(),s=t.options;switch(s.Text=t.v7EvalAttr("drawtext",!1),s.BarOffset=t.v7EvalAttr("baroffset",0),s.BarWidth=t.v7EvalAttr("barwidth",1),s.second_x=f&&t.v7EvalAttr("secondx",!1),s.second_y=f&&t.v7EvalAttr("secondy",!1),r){case"bar":s.Bar=!0,s.BarStyle=n;break;case"err":s.Error=!0,s.ErrorKind=n;break;case"p":s.Mark=!0;break;case"l":s.Line=!0;break;case"lego":s.Lego=n>0?10+n:12,s.Mode3D=!0;break;default:s.Hist=!0}return t.scanContent(),t.callDrawFunc()})})}static draw(t,i,e){return k(this,null,function*(){return q._draw(new q(t,i),e)})}};var Bt=class q extends it{draw3D(t){this.mode3d=!0;let i=this.getFramePainter(),e=this.isMainPainter(),r=1+2*Z.fHistTopMargin,n=Promise.resolve(this);return t==="resize"?(e&&i.resize3D()&&i.render3D(),n):(this.deleteAttr(),this.scanContent(!0),e&&(pt(i),n=i.create3DScene(this.options.Render3D).then(()=>{i.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,null,this.ymin,this.ymax,null,0,0),i.set3DOptions(this.options),i.drawXYZ(i.toplevel,wt,{use_y_for_z:!0,zmult:r,zoom:tt.Zooming,ndim:1,draw:!0,v7:!0})})),i.mode3d?n.then(()=>this.drawingBins(t)).then(()=>{let f=this.getFramePainter();return yt(this,!0),this.updatePaletteDraw(),f.render3D(),f.addKeysHandler(),this}):n)}static draw(t,i,e){return k(this,null,function*(){return q._draw(new q(t,i),e)})}};export{Bt as a};

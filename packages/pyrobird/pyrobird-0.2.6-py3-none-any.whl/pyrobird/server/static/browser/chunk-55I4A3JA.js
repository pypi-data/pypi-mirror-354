import{a as C}from"./chunk-PYODGWPU.js";import{b as B}from"./chunk-3GIRV5GZ.js";import"./chunk-TDJROOWO.js";import{a as A,b as w}from"./chunk-O2YOIZWS.js";import"./chunk-C4APR3G7.js";import{a as I}from"./chunk-4U5XXNS7.js";import"./chunk-LGENSGLC.js";import"./chunk-LWQ6XHU3.js";import{g as H}from"./chunk-YC5SGHGH.js";import"./chunk-FYXTN3X2.js";import"./chunk-D3GAWKNQ.js";import"./chunk-K2P6CES6.js";import{b as Y}from"./chunk-Z4ZYSIRC.js";import"./chunk-3L3RRFVB.js";import{I as S,ha as R}from"./chunk-FVXVO67X.js";import{Ma as k,O as D,Qa as j,S as L,db as y,eb as F,ib as M,jb as G,x as v}from"./chunk-KYOHYQWH.js";import{k as c}from"./chunk-KYPE3LET.js";var Z=v(17),P=class _ extends R{constructor(r,i){super(r,i),this.firstpainter=null,this.painters=[]}cleanup(){this.painters=[],super.cleanup()}updateObject(r){if(!this.matchObjectType(r))return!1;let i=this.getObject(),e=r.fGraphs,n=this.getPadPainter();i.fTitle=r.fTitle;let h=!1;if(this.firstpainter){let m=this.scanGraphsRange(e,r.fHistogram,n?.getRootPad(!0),!0);this.firstpainter.updateObject(m)&&(h=!0)}let t=Math.min(e.arr.length,this.painters.length);for(let m=0;m<t;++m)this.painters[m].updateObject(e.arr[m],(e.opt[m]||this._restopt)+this._auto)&&(h=!0);return this._funcHandler=new H(this,n,r.fFunctions),h}redraw(r){return c(this,null,function*(){let i=this.firstpainter?.redraw(r)??Promise.resolve(!0),e=n=>c(this,null,function*(){return n>=this.painters.length?this:this.painters[n].redraw(r).then(()=>e(n+1))});return i.then(()=>e(0)).then(()=>{let n=this._funcHandler?.drawNext(0)??this;return delete this._funcHandler,n})})}scanGraphsRange(r,i,e,n){let h=this.getObject(),t={xmin:0,xmax:0,ymin:0,ymax:0,first:!0},m=(s,x)=>Math.abs(x-s)<1e-6,a,f,g=!1,d=!1,l,X=!1;e&&(g=e.fLogx,d=e.fLogv??e.fLogy),this._3d&&i&&!i.fXaxis.fLabels&&(i=null),i?(X=m(i.fMinimum,-.05)&&m(i.fMaximum,1.05)&&m(i.fXaxis.fXmin,-.05)&&m(i.fXaxis.fXmax,1.05),l=i):l=r.arr[0]?.fHistogram,r.arr.forEach(s=>{if(s.fNpoints!==0){s.TestBit(Z)&&(n=!0),t.first&&(t.xmin=t.xmax=s.fX[0],t.ymin=t.ymax=s.fY[0],t.first=!1);for(let x=0;x<s.fNpoints;++x)t.xmin=Math.min(t.xmin,s.fX[x]),t.xmax=Math.max(t.xmax,s.fX[x]),t.ymin=Math.min(t.ymin,s.fY[x]),t.ymax=Math.max(t.ymax,s.fY[x])}}),t.xmin===t.xmax&&(t.xmax+=1),t.ymin===t.ymax&&(t.ymax+=1);let b=.05*(t.xmax-t.xmin),O=.05*(t.ymax-t.ymin),o=t.xmin-b,p=t.xmax+b;d?(t.ymin<=0&&(t.ymin=.001*t.ymax),f=t.ymin/(1+.5*Math.log10(t.ymax/t.ymin)),a=t.ymax*(1+.2*Math.log10(t.ymax/t.ymin))):(f=t.ymin-O,a=t.ymax+O),f<0&&t.ymin>=0&&(f=0),a>0&&t.ymax<=0&&(a=0);let $=f,W=a;if(o<0&&t.xmin>=0&&(o=g?.9*t.xmin:0),p>0&&t.xmax<=0&&(p=g?1.1*t.xmax:0),h.fMinimum!==y&&(t.ymin=f=h.fMinimum),h.fMaximum!==y&&(t.ymax=a=h.fMaximum),f<0&&t.ymin>=0&&d&&(f=.9*t.ymin),a>0&&t.ymax<=0&&d&&(a=1.1*t.ymax),f<=0&&d&&(f=.001*a),!d&&f>0&&f<.05*a&&(f=0),o<=0&&g&&(o=p>1e3?1:.001*p),!i||n||X){let s,x;if(this._3d){i=G(j,r.arr.length,10),s=i.fXaxis,s.fXmin=0,s.fXmax=r.arr.length,s.fLabels=M(L);for(let u=0;u<r.arr.length;u++){let T=M(D);T.fString=r.arr[u].fTitle||`gr${u}`,T.fUniqueID=r.arr.length-u,s.fLabels.Add(T,"")}s=i.fYaxis,x=i.fZaxis}else i=G(l?._typename??k,l?.fXaxis.fNbins??10),s=i.fXaxis,x=i.fYaxis;if(l&&(Object.assign(s,l.fXaxis),x.fTitle=l.fYaxis.fTitle),i.fTitle=h.fTitle,i.fTitle.indexOf(";")>=0){let u=i.fTitle.split(";");i.fTitle=u[0],u[1]&&(s.fTitle=u[1]),u[2]&&(x.fTitle=u[2])}s.fLabels||(s.fXmin=o,s.fXmax=p)}let N=this._3d?i.fZaxis:i.fYaxis;return N.fXmin=Math.min(f,$),N.fXmax=Math.max(a,W),i.fMinimum===y&&(i.fMinimum=f),i.fMaximum===y&&(i.fMaximum=a),i.fBits|=F,i}drawAxisHist(r,i){return c(this,null,function*(){return w.draw(this.getDrawDom(),r,i)})}drawGraph(r,i,e){return c(this,null,function*(){return B.draw(r,i,e)})}drawNextGraph(r,i){return c(this,null,function*(){let e=this.getObject().fGraphs;if(r>=e.arr.length)return this;let n=e.arr[r],h=(e.opt[r]||this._restopt)+this._auto,t=e.arr.length-r,m=`graphs_${r}`;if(i){let a=i.getSubPadPainter(r+1);return a?(a.cleanPrimitives(!0),this.drawGraph(a,n,h,t).then(f=>(f&&(f.setSecondaryId(this,m),this.painters.push(f)),this.drawNextGraph(r+1,i)))):this}return this._auto&&(n.$num_graphs=e.arr.length),this.drawGraph(this.getPadPainter(),n,h,t).then(a=>(a&&(a.setSecondaryId(this,m),this.painters.push(a)),this.drawNextGraph(r+1)))})}fillContextMenuItems(r){r.addRedrawMenu(this)}redrawWith(r,i){return c(this,null,function*(){if(!i){this.firstpainter=null,this.painters=[];let a=this.getPadPainter();a?.removePrimitive(this,!0),this._pads&&a?.divide(0,0)}let e=new S(r),n=this.getObject();this._3d=e.check("3D"),this._auto="",this._pads=e.check("PADS"),["PFC","PLC","PMC"].forEach(a=>{e.check(a)&&(this._auto+=" "+a)});let h="",t=null;e.check("FB")&&this._3d&&(h+="FB"),A.forEach(a=>{e.check(a)&&(h+=";"+a)}),this._restopt=e.remain();let m=Promise.resolve(!0);if(this._pads)m=Y(this,!1).then(()=>(t=this.getPadPainter(),t.divide(n.fGraphs.arr.length,0,!0)));else if(e.check("A")||!this.getMainPainter()){let a=this.scanGraphsRange(n.fGraphs,n.fHistogram,this.getPadPainter()?.getRootPad(!0));m=this.drawAxisHist(a,h).then(f=>{f.setSecondaryId(this,"hist"),this.firstpainter=f})}return m.then(()=>(this.addToPadPrimitives(),this.drawNextGraph(0,t))).then(()=>this._pads?this:new H(this,this.getPadPainter(),this.getObject().fFunctions,!0).drawNext(0))})}static draw(r,i,e){return c(this,null,function*(){return new _(r,i,e).redrawWith(e,!0)})}};var E=class _ extends P{drawAxisHist(r,i){return c(this,null,function*(){let e=this.getDrawDom();return this._3d?I.draw(e,r,"LEGO"+i):w.draw(e,r,i)})}drawGraph(r,i,e,n){return c(this,null,function*(){return this._3d&&(e+=`pos3d_${n}`),C.draw(r,i,e)})}static draw(r,i,e){return c(this,null,function*(){return new _(r,i,e).redrawWith(e,!0)})}};export{E as TMultiGraphPainter};

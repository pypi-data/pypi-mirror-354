import{c as k,d as V,e as j,f as I,g as K}from"./chunk-LGENSGLC.js";import{d as O}from"./chunk-LWQ6XHU3.js";import{h as N}from"./chunk-YC5SGHGH.js";import{a as u,d as E}from"./chunk-FYXTN3X2.js";import{c as G}from"./chunk-3L3RRFVB.js";import{aa as Z,db as F,t as L,u as R}from"./chunk-KYOHYQWH.js";import{k as A}from"./chunk-KYPE3LET.js";function $(h){let _=h.getHisto(),s=h.getFramePainter(),g=s.z_handle.getScaleMin(),w=s.z_handle.getScaleMax(),c=_.fBins.arr.length,f=s.grz(g),x,r,d,p;h.maxbin=h.gmaxbin,h.minbin=h.gminbin,h.minposbin=h.gminposbin;let W=h.getContour(!0),q=h.getHistPalette();for(d=0;d<c;++d){if(r=_.fBins.arr[d],r.fContent<g||(x=W.getPaletteIndex(q,r.fContent),x===null)||r.fXmin>s.scale_xmax||r.fXmax<s.scale_xmin||r.fYmin>s.scale_ymax||r.fYmax<s.scale_ymin)continue;p=s.grz(r.fContent>w?w:r.fContent);let S=[],X=[],Y=1,y=r.fPoly,B=0;y._typename===Z&&(Y=r.fPoly.fGraphs.arr.length,y=null);for(let l=0;l<Y;++l){(!y||l>0)&&(y=r.fPoly.fGraphs.arr[l]);let a=y.fX,m=y.fY,e=y.fNpoints;for(;e>2&&a[0]===a[e-1]&&m[0]===m[e-1];)--e;let n,o;for(let b=0;b<2;++b){let P,D,C,H,T=s.size_x3d*s.size_z3d,Q=b>0?0:T/1e6;n=[],o=null;for(let v=0;v<e;++v)C=s.grx(a[v]),H=s.gry(m[v]),v>0&&(T=(C-P)*(C-P)+(H-D)*(H-D)),T>Q&&(n.push(new u.Vector2(C,H)),P=C,D=H);try{n.length>2&&(o=u.ShapeUtils.triangulateShape(n,[]))}catch{o=null}if(o&&o.length>n.length-3)break}o?.length&&n&&(S.push(n),X.push(o),B+=o.length*2,p>f&&(B+=n.length*2))}let i=new Float32Array(B*9),t=0;for(let l=0;l<S.length;++l){let a=S[l],m=X[l];for(let e=0;e<2;++e)for(let n=0;n<m.length;++n){let o=m[n],b=a[o[0]],P=a[o[e===0?2:1]],D=a[o[e===0?1:2]];i[t]=b.x,i[t+1]=b.y,i[t+2]=e?p:f,t+=3,i[t]=P.x,i[t+1]=P.y,i[t+2]=e?p:f,t+=3,i[t]=D.x,i[t+1]=D.y,i[t+2]=e?p:f,t+=3}if(p>f)for(let e=0;e<a.length;++e){let n=a[e],o=a[e>0?e-1:a.length-1];i[t]=n.x,i[t+1]=n.y,i[t+2]=f,t+=3,i[t]=o.x,i[t+1]=o.y,i[t+2]=f,t+=3,i[t]=o.x,i[t+1]=o.y,i[t+2]=p,t+=3,i[t]=n.x,i[t+1]=n.y,i[t+2]=f,t+=3,i[t]=o.x,i[t+1]=o.y,i[t+2]=p,t+=3,i[t]=n.x,i[t+1]=n.y,i[t+2]=p,t+=3}}let M=new u.BufferGeometry;M.setAttribute("position",new u.BufferAttribute(i,3)),M.computeVertexNormals();let J=new u.MeshBasicMaterial(E(h._color_palette?.getColor(x),{vertexColors:!1,side:u.DoubleSide})),z=new u.Mesh(M,J);s.add3DMesh(z),z.painter=h,z.bins_index=d,z.draw_z0=f,z.draw_z1=p,z.tip_color=65280,z.tooltip=function(){let l=this.painter,a=l.getFramePainter(),m=l.getObject().fBins.arr[this.bins_index];return{use_itself:!0,x1:a.grx(m.fXmin),x2:a.grx(m.fXmax),y1:a.gry(m.fYmin),y2:a.gry(m.fYmax),z1:this.draw_z0,z2:this.draw_z1,bin:this.bins_index,value:r.fContent,color:this.tip_color,lines:l.getPolyBinTooltips(this.bins_index)}}}}var U=class h extends O{draw3D(_){return A(this,null,function*(){this.mode3d=!0;let s=this.getFramePainter(),g=this.isMainPainter(),w=this.getHisto(),c=Promise.resolve(!0),f=!0;if(_==="resize"){let x=g?s.resize3D():!1;x!==1&&(f=!1,x&&s.render3D())}if(f){let x=this.getPadPainter().getRootPad(!0),r=x?.fLogv??x?.fLogz,d=1;this.options.ohmin&&this.options.ohmax?(this.zmin=this.options.hmin,this.zmax=this.options.hmax):this.options.minimum!==F&&this.options.maximum!==F?(this.zmin=this.options.minimum,this.zmax=this.options.maximum):(this.draw_content||this.gmaxbin!==0)&&(this.zmin=r?this.gminposbin*.3:this.gminbin,this.zmax=this.gmaxbin,d=1+2*R.fHistTopMargin),r&&this.zmin<=0&&(this.zmin=this.zmax*1e-5),this.createHistDrawAttributes(!0),g&&(k(s),c=s.create3DScene(this.options.Render3D,this.options.x3dscale,this.options.y3dscale,this.options.Ortho).then(()=>{s.setAxesRanges(w.fXaxis,this.xmin,this.xmax,w.fYaxis,this.ymin,this.ymax,w.fZaxis,this.zmin,this.zmax,this),s.set3DOptions(this.options),s.drawXYZ(s.toplevel,G,{ndim:2,hist_painter:this,zmult:d,zoom:L.Zooming,draw:this.options.Axis!==-1,drawany:this.options.isCartesian(),reverse_x:this.options.RevX,reverse_y:this.options.RevY})})),s.mode3d&&(c=c.then(()=>{this.draw_content?this.isTH2Poly()?$(this):this.options.Contour?I(this,!0):this.options.Surf?K(this):this.options.Error?j(this):V(this):this.options.Axis&&this.options.Zscale&&(this.getContourLevels(!0),this.getHistPalette()),s.render3D(),this.updateStatWebCanvas(),s.addKeysHandler()}))}return g&&(c=c.then(()=>this.drawColorPalette(this.options.Zscale&&(this.options.Lego===12||this.options.Lego===14||this.options.Surf===11||this.options.Surf===12)))),c.then(()=>this.updateFunctions()).then(()=>this.updateHistTitle()).then(()=>this)})}static draw(_,s,g){return A(this,null,function*(){return N._drawHist(new h(_,s),g)})}};export{U as a};

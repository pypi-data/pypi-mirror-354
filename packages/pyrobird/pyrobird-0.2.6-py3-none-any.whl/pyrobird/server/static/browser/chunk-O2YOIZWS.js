import{c as Gt}from"./chunk-C4APR3G7.js";import{h as $t}from"./chunk-YC5SGHGH.js";import{H as gt,K as ut,P as Ft,b as _t}from"./chunk-FVXVO67X.js";import{Ta as Mt,Xa as Et,db as F,f as wt,fb as St,t as xt,u as Q}from"./chunk-KYOHYQWH.js";import{k as J}from"./chunk-KYPE3LET.js";var Nt=["LOGXY","LOGX","LOGY","LOGZ","LOGV","LOG","LOG2X","LOG2Y","LOG2","LNX","LNY","LN","GRIDXY","GRIDX","GRIDY","TICKXY","TICKX","TICKY","TICKZ","FB","GRAYSCALE"],Pt=class Xt extends $t{getHisto(){let t=super.getHisto();if(t?._typename===Et)switch(t.$getBinContent||(t.$getBinContent=t.getBinContent),this.options?.ProfileProj){case"B":t.getBinContent=t.getBinEntries;break;case"C=E":t.getBinContent=t.getBinError;break;case"W":t.getBinContent=function(e){return this.$getBinContent(e)*this.getBinEntries(e)};break;default:t.getBinContent=t.$getBinContent;break}return t}convertTH1K(){let t=this.getObject();if(t.fReady)return;let e=t.fArray,s=t.fEntries;t.fNcells=t.fXaxis.fNbins+2,t.fArray=new Float64Array(t.fNcells).fill(0);for(let r=0;r<t.fNIn;++r)t.Fill(e[r]);t.fReady=1,t.fEntries=s}scanContent(t){t&&!this.nbinsx&&(t=!1),this.isTH1K()&&this.convertTH1K();let e=this.getHisto();t||this.extractAxesProperties(1);let s=this.getSelectIndex("x","left"),r=this.getSelectIndex("x","right"),m=this.getPadPainter()?.getPadLog(this.options.swap_xy()?"x":"y"),f=this.options.Func?this.findFunction(Mt):null;if(t&&s===this.scan_xleft&&r===this.scan_xright)return;this.draw_content=!(this.options.Axis>0),this.scan_xleft=s,this.scan_xright=r;let B=this.isTProfile(),w=Math.min(0,s),d=Math.max(this.nbinsx,r),i=0,o=0,n=0,h=0,x=!0,l,M={low:0,up:0};for(let _=w;_<d;++_)if(l=e.getBinContent(_+1),h+=B?e.fBinEntries[_+1]:l,!(_<s||_>=r)&&(l>0&&(o===0||l<o)&&(o=l),x&&(i=n=l,x=!1),this.options.Error&&(M=this.getBinErrors(e,_+1,l)),i=Math.min(i,l-M.low),n=Math.max(n,l+M.up),f)){let b=e.fXaxis.GetBinCenter(_+1),a=Gt(f,b);a!==void 0&&(n=Math.max(n,a),m&&l>0&&a>.3*l&&(o=Math.min(o,a)))}B?h+=e.fBinEntries[0]+e.fBinEntries[this.nbinsx+1]:h+=e.getBinContent(0)+e.getBinContent(this.nbinsx+1),this.stat_entries=h,this.hmin=i,this.hmax=n,(this.nbinsx===0||Math.abs(i)<1e-300&&Math.abs(n)<1e-300)&&(this.draw_content=!1);let u=!1;(this.draw_content||this.isMainPainter()&&this.options.Axis>0&&!this.options.ohmin&&!this.options.ohmax&&e.fMinimum===F&&e.fMaximum===F)&&(i>=n?i===0?(this.ymin=0,this.ymax=1):i<0?(this.ymin=2*i,this.ymax=0):(this.ymin=0,this.ymax=i*2):m?(this.ymin=(o||i)*.5,this.ymax=n*2*(.9/.95)):(this.ymin=i,this.ymax=n)),i=this.options.minimum,n=this.options.maximum,i===n&&i!==F&&(i<0?(i*=2,n=0):(i=0,n*=2,n||(n=1)));let c=!1,v=!1;if(this.options.ohmin&&this.options.ohmax&&!this.draw_content?this.options.zoom_min_max?(i!==F&&i<=this.ymin&&(i=F),n!==F&&n>=this.ymax&&(n=F),u=!0):i=n=F:i!==F&&n!==F&&!this.draw_content&&(this.ymin===this.ymax||this.ymin>i||this.ymax<n)?(this.ymin=i,this.ymax=n,c=v=!0):(i!==F&&(c=!0,i<this.ymin&&(this.ymin=i),u=!0),n!==F&&(v=!0,n>this.ymax&&(this.ymax=n),u=!0)),!this._exact_y_range&&!m){if(!c)if(this.options.BaseLine!==!1&&this.ymin>=0)this.ymin=0;else{let _=this.ymin>=0;this.ymin-=Q.fHistTopMargin*(this.ymax-this.ymin),_&&this.ymin<0&&(this.ymin=0)}v||(this.ymax+=Q.fHistTopMargin*(this.ymax-this.ymin))}t||(u&&(i!==F||n!==F)?(this.zoom_ymin=i===F?this.ymin:i,this.zoom_ymax=n===F?this.ymax:n):(delete this.zoom_ymin,delete this.zoom_ymax)),this.wheel_zoomy=this.getDimension()>1||!this.draw_content}countStat(t,e){let s=this.isTProfile(),r=this.getHisto(),m=r.fXaxis,f=this.getSelectIndex("x","left"),B=this.getSelectIndex("x","right"),w=this.getFramePainter(),d={name:r.fName,meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:r.fEntries>0?r.fEntries:this.stat_entries,eff_entries:0,xmax:0,wmax:0,skewx:0,skewd:0,kurtx:0,kurtd:0},i=!w.isAxisZoomed("x")&&Math.abs(r.fTsumw)>1e-300,o=0,n=0,h=0,x=0,l=0,M=0,u,c,v,_=null,b=null;for(wt(t)||(t=null),u=f;u<B;++u)c=m.GetBinCoord(u+.5),!(t&&!t(c))&&(s?(v=r.fBinEntries[u+1],l+=r.fArray[u+1],M+=r.fSumw2[u+1]):v=r.getBinContent(u+1),(_===null||v>b)&&(_=c,b=v),i||(o+=v,n+=v*v,h+=v*c,x+=v*c**2));if(i&&(o=r.fTsumw,n=r.fTsumw2,h=r.fTsumwx,x=r.fTsumwx2),d.integral=o,d.eff_entries=n?o*o/n:Math.abs(o),Math.abs(o)>1e-300&&(d.meanx=h/o,d.meany=l/o,d.rmsx=Math.sqrt(Math.abs(x/o-d.meanx**2)),d.rmsy=Math.sqrt(Math.abs(M/o-d.meany**2))),_!==null&&(d.xmax=_,d.wmax=b),e){let a=0,T=0,p=0;for(u=f;u<B;++u)c=m.GetBinCoord(u+.5),!(t&&!t(c))&&(v=s?r.fBinEntries[u+1]:r.getBinContent(u+1),p+=v,a+=v*Math.pow(c-d.meanx,3),T+=v*Math.pow(c-d.meanx,4));let E=Math.pow(d.rmsx,3),$=Math.pow(d.rmsx,4);p*E!==0&&(d.skewx=a/(p*E)),d.skewd=d.eff_entries>0?Math.sqrt(6/d.eff_entries):0,p*$!==0&&(d.kurtx=T/(p*$)-3),d.kurtd=d.eff_entries>0?Math.sqrt(24/d.eff_entries):0}return d}fillStatistic(t,e,s){if(this.isIgnoreStatsFill())return!1;e===1&&(e=1111),s===1&&(s=111);let r=this.getHisto(),m=e%10,f=Math.floor(e/10)%10,B=Math.floor(e/100)%10,w=Math.floor(e/1e3)%10,d=Math.floor(e/1e4)%10,i=Math.floor(e/1e5)%10,o=Math.floor(e/1e6)%10,n=Math.floor(e/1e7)%10,h=Math.floor(e/1e8)%10,x=this.countStat(void 0,n>0||h>0);return t.clearPave(),m>0&&t.addText(x.name),this.isTProfile()?(f>0&&t.addText("Entries = "+t.format(x.entries,"entries")),B>0&&(t.addText("Mean = "+t.format(x.meanx)),t.addText("Mean y = "+t.format(x.meany))),w>0&&(t.addText("Std Dev = "+t.format(x.rmsx)),t.addText("Std Dev y = "+t.format(x.rmsy)))):(f>0&&t.addText("Entries = "+t.format(x.entries,"entries")),B>0&&t.addText("Mean = "+t.format(x.meanx)),w>0&&t.addText("Std Dev = "+t.format(x.rmsx)),d>0&&t.addText("Underflow = "+t.format(r.fArray.length>0?r.fArray[0]:0,"entries")),i>0&&t.addText("Overflow = "+t.format(r.fArray.length>0?r.fArray.at(-1):0,"entries")),o>0&&t.addText("Integral = "+t.format(x.integral,"entries")),n===2?t.addText(`Skewness = ${t.format(x.skewx)} #pm ${t.format(x.skewd)}`):n>0&&t.addText(`Skewness = ${t.format(x.skewx)}`),h===2?t.addText(`Kurtosis = ${t.format(x.kurtx)} #pm ${t.format(x.kurtd)}`):h>0&&t.addText(`Kurtosis = ${t.format(x.kurtx)}`)),s&&t.fillFunctionStat(this.findFunction(Mt),s,1),!0}getBarBaseline(t,e){let s=t.swap_xy?0:e;return Number.isFinite(this.options.BaseLine)&&this.options.BaseLine>=t.scale_ymin&&(s=Math.round(t.gry(this.options.BaseLine))),s}drawBars(t,e){return J(this,null,function*(){let s=this.getSelectIndex("x","left",-1),r=this.getSelectIndex("x","right",1),m=this.getHisto(),f=m.fXaxis,B=this.options.Text,w,d,i,o=this.options.BarStyle>10?this.options.BarStyle%10:0,n=Promise.resolve();o>4&&(o=4);let h=this.getBarBaseline(t,e);return B&&(w=this.getColor(m.fMarkerColor),d=-1*this.options.TextAngle,i=20,m.fMarkerSize!==1&&d&&(i=.02*e*m.fMarkerSize),n=this.startTextDrawingAsync(42,i,this.draw_g,i)),n.then(()=>{let x="",l="",M="";for(let u=s;u<r;++u){let c=f.GetBinLowEdge(u+1),v=f.GetBinLowEdge(u+2);if(t.logx&&v<=0)continue;let _=Math.round(t.grx(c)),b=Math.round(t.grx(v)),a=b-_,T=m.getBinContent(u+1);if(t.logy&&T<t.scale_ymin)continue;let p=Math.round(t.gry(T));if(_+=Math.round(m.fBarOffset/1e3*a),a=Math.round(m.fBarWidth/1e3*a),t.swap_xy?x+=`M${h},${_}h${p-h}v${a}h${h-p}z`:x+=`M${_},${p}h${a}v${h-p}h${-a}z`,o>0&&(b=_+a,a=Math.round(a*o/10),t.swap_xy?(l+=`M${h},${_}h${p-h}v${a}h${h-p}z`,M+=`M${h},${b}h${p-h}v${-a}h${h-p}z`):(l+=`M${_},${p}h${a}v${h-p}h${-a}z`,M+=`M${b},${p}h${-a}v${h-p}h${a}z`)),B&&T){let E=T===Math.round(T)?T.toString():gt(T,Q.fPaintTextFormat);t.swap_xy?this.drawText({align:12,x:Math.round(p+i/2),y:Math.round(_+.1),height:Math.round(a*.8),text:E,color:w,latex:0}):d?this.drawText({align:12,x:_+a/2,y:Math.round(p-2-i/5),width:0,height:0,rotate:d,text:E,color:w,latex:0}):this.drawText({align:22,x:Math.round(_+a*.1),y:Math.round(p-2-i),width:Math.round(a*.8),height:i,text:E,color:w,latex:0})}}if(x&&this.draw_g.append("svg:path").attr("d",x).call(this.fillatt.func),l&&this.draw_g.append("svg:path").attr("d",l).call(this.fillatt.func).style("fill",_t(this.fillatt.color).brighter(.5).formatRgb()),M&&this.draw_g.append("svg:path").attr("d",M).call(this.fillatt.func).style("fill",_t(this.fillatt.color).darker(.5).formatRgb()),B)return this.finishTextDrawing()})})}drawFilledErrors(t){let e=this.getSelectIndex("x","left",0),s=this.getSelectIndex("x","right",0),r=this.getHisto(),m=[],f=[];for(let i=e;i<s;++i){let o=r.fXaxis.GetBinCoord(i+.5);if(t.logx&&o<=0)continue;let n=Math.round(t.grx(o)),h=r.getBinContent(i+1),x=this.getBinErrors(r,i+1,h);t.logy&&h-x.low<t.scale_ymin||(m.push({grx:n,gry:Math.round(t.gry(h+x.up))}),f.unshift({grx:n,gry:Math.round(t.gry(h-x.low))}))}let B=this.options.ErrorKind!==4,w=ut(m,{line:B}),d=ut(f,{line:B,cmd:"L"});this.draw_g.append("svg:path").attr("d",w+d+"Z").call(this.fillatt.func)}drawNormal(t,e,s){return J(this,null,function*(){let r=this.getSelectIndex("x","left",-1),m=this.getSelectIndex("x","right",2),f=this.getHisto(),B=!this.isBatchMode()&&xt.Tooltip,w=f.fXaxis,d=!this.options.Zero,i=this.options.Error,o=this.options.Curve,n=this.options.Text,h=n&&this.options.TextKind==="E"&&this.isTProfile()&&f.fBinEntries,x=[],l="",M=!1,u=this.options.Mark,c=this.options.Line,v,_,b,a,T,p,E,$,g,y,P,O,G,Z,q,rt=null,K=null,W=null,X="",tt=null,V=null,D=5,ot=!1,ht=!1,N=0,H=0,k,z,U,R,pt,L,Y,S,lt,ft,st,ct,Bt,it,A,vt=Promise.resolve();i&&!u&&f.fMarkerStyle>1&&(u=!0),this.options.ErrorKind===2?this.fillatt.empty()?u=!0:rt="":i&&(c=!1,K="",tt=B?"":null,ht=!0),H=this.lineatt.width+Q.fEndErrorSize,this.options.ErrorKind===1&&(N=Math.floor((this.lineatt.width-1)/2)),u&&(this.createAttMarker({attr:f,style:this.options.MarkStyle}),this.markeratt.size>0?(W="",ot=!0,this.markeratt.resetPos(),tt===null&&B&&(!this.markeratt.fill||this.markeratt.getFullSize()<7)&&(V="",D=Math.max(5,Math.round(this.markeratt.getFullSize()*.7)))):u=!1);let dt=i||u,yt=dt||n||c||o,et=this.options.Hist&&(!this.lineatt.empty()||!this.fillatt.empty()),Dt=i&&f.fSumw2?.length,Ht=yt||m-r>3*e;if(!et&&!yt)return this.removeG();if(n){if(Bt=this.getColor(f.fMarkerColor),it=-1*this.options.TextAngle,A=20,f.fMarkerSize!==1&&it&&(A=.02*s*f.fMarkerSize),!it&&!this.options.TextKind){let nt=e/(m-r+1);nt<3*A&&(it=270,A=Math.round(nt*.7))}vt=this.startTextDrawingAsync(42,A,this.draw_g,A)}return vt.then(()=>{let nt=C=>(R=f.getBinContent(C+1),d&&R===0&&(!Dt||!f.fSumw2[C+1])?!1:(L=Math.round(t.grx(w.GetBinLowEdge(C+1))),Y=Math.round(t.grx(w.GetBinLowEdge(C+2))),S=Math.round((L+Y)/2),_===void 0&&(_=S),k=Math.round(t.gry(R)),i?(pt=this.getBinErrors(f,C+1,R),z=Math.round(k-t.gry(R+pt.up)),U=Math.round(t.gry(R-pt.low)-k)):z=U=20,!0)),bt=()=>{let C=5;if(this.options.errorX>0&&(C=Math.round((Y-L)*this.options.errorX),st=S-C,ct=S+C,this.options.ErrorKind===1?K+=`M${st+N},${k-H}v${2*H}m0,-${H}h${ct-st-2*N}m0,-${H}v${2*H}`:K+=`M${st+N},${k}h${ct-st-2*N}`),this.options.ErrorKind===1?K+=`M${S-H},${k-z+N}h${2*H}m${-H},0v${z+U-2*N}m${-H},0h${2*H}`:K+=`M${S},${k-z+N}v${z+U-2*N}`,tt!==null){let I=Math.max(z,5),j=Math.max(U,5);tt+=`M${S-C},${k-I}h${2*C}v${I+j}h${-2*C}z`}},Tt=()=>{t.swap_xy?(W+=this.markeratt.create(k,S),V!==null&&(V+=`M${k-D},${S-D}v${2*D}h${2*D}v${-2*D}z`)):(W+=this.markeratt.create(S,k),V!==null&&(V+=`M${S-D},${k-D}h${2*D}v${2*D}h${-2*D}z`))},at=C=>{if(nt(C)){if(n){let I=h?f.fBinEntries[C+1]:R;if(I!==0){let j=it?{align:12,x:S,y:Math.round(k-2-A/5),width:0,height:0,rotate:it}:{align:22,x:Math.round(L+(Y-L)*.1),y:Math.round(k-2-A),width:Math.round((Y-L)*.8),height:A};j.text=I===Math.round(I)?I.toString():gt(I,Q.fPaintTextFormat),j.color=Bt,j.latex=0,t.swap_xy&&(j.x=k,j.y=Math.round(S-A/2)),this.drawText(j)}}c?(t.swap_xy?X+=(X?"L":"M")+`${k},${S}`:X.length===0?X=`M${S},${k}`:lt===S?X+=`v${k-ft}`:ft===k?X+=`h${S-lt}`:X+=`l${S-lt},${k-ft}`,lt=S,ft=k):o&&x.push({grx:(L+Y)/2,gry:t.gry(R)}),dt&&k>=-z&&k<=s+U&&(rt!==null&&(rt+=`M${L},${k-z}h${Y-L}v${z+U+1}h${L-Y}z`),W!==null&&ot&&Tt(),K!==null&&ht&&bt())}};if((ot||ht)&&(!xt.OptimizeDraw||m-r<5e4&&xt.OptimizeDraw===1)){for(G=r;G<m;++G)nt(G)&&(W!==null&&Tt(),K!==null&&bt());ht=ot=!1}for(G=r;G<=m;++G)T=w.GetBinLowEdge(G+1),!(this.logx&&T<=0)&&(p=Math.round(t.grx(T)),M=G===m,M&&r<m?$=a:(E=f.getBinContent(G+1),$=Math.round(t.gry(E))),l.length===0?(Z=q=G,O=v=b=p,P=g=y=a=$,l=`M${b},${a}`):Ht?p===b&&!M?($<g?q=G:$>y&&(Z=G),g=Math.min(g,$),y=Math.max(y,$),a=$):(yt&&(Z===q?at(Z):Z<q?(at(Z),at(q)):(at(q),at(Z))),et&&(g!==y||P!==g)&&(O!==b&&(l+="h"+(b-O)),a===g?(y!==P&&(l+="v"+(y-P)),g!==y&&(l+="v"+(g-y))):(g!==P&&(l+="v"+(g-P)),y!==g&&(l+="v"+(y-g)),a!==y&&(l+="v"+(a-y))),O=b,P=a),M&&O!==p&&(l+="h"+(p-O)),Z=q=G,g=y=a=$,b=p):($!==a||M)&&(p!==b&&(l+=`h${p-b}`),$!==a&&(l+=`v${$-a}`),a=$,b=p));let kt=B&&this.fillatt.empty()&&et&&!dt&&!c&&!o&&!this._ignore_frame,mt=s+3;if(!kt){let C=Math.round(t.gry(0));C<=0?mt=-3:C<s&&(mt=C)}let zt=`L${b},${mt}H${v}Z`,Ct=()=>{this.draw_g.append("svg:path").attr("d",l+(!this.fillatt.empty()||kt?zt:"")).style("stroke-linejoin","miter").call(this.lineatt.func).call(this.fillatt.func)};if(l&&et&&!this.fillatt.empty()&&(Ct(),l=""),(dt||c||o)&&(!X&&x.length&&(t.swap_xy&&x.forEach(C=>{let I=C.grx;C.grx=C.gry,C.gry=I}),X=ut(x)),rt?this.draw_g.append("svg:path").attr("d",rt).call(this.fillatt.func):X&&!this.fillatt.empty()&&!et&&this.draw_g.append("svg:path").attr("d",X+`L${S},${mt}H${_}Z`).call(this.fillatt.func),K&&this.draw_g.append("svg:path").attr("d",K).call(this.lineatt.func),tt&&this.draw_g.append("svg:path").attr("d",tt).style("fill","none").style("pointer-events",this.isBatchMode()?null:"visibleFill"),X&&this.draw_g.append("svg:path").attr("d",X).style("fill","none").call(this.lineatt.func),W&&this.draw_g.append("svg:path").attr("d",W).call(this.markeratt.func),V&&this.draw_g.append("svg:path").attr("d",V).style("fill","none").style("pointer-events",this.isBatchMode()?null:"visibleFill")),l&&et&&Ct(),n)return this.finishTextDrawing()})})}draw1DBins(){this.options.Same&&this._ignore_frame&&this.getFrameSvg().style("display","none"),this.createHistDrawAttributes();let t=this.getFramePainter(),e=this.getHistGrFuncs(t),s=t.getFrameWidth(),r=t.getFrameHeight();return!this.draw_content||s<=0||r<=0?this.removeG():(this.createG(!this._ignore_frame),this.options.Bar?this.drawBars(e,r).then(()=>{if(this.options.ErrorKind===1)return this.drawNormal(e,s,r)}):this.options.ErrorKind===3||this.options.ErrorKind===4?this.drawFilledErrors(e):this.drawNormal(e,s,r))}getBinTooltips(t){let e=[],s=this.getObjectHint(),r=this.getFramePainter(),m=this.getHistGrFuncs(r),f=this.getHisto(),B=f.fXaxis.GetBinLowEdge(t+1),w=f.fXaxis.GetBinLowEdge(t+2),d=this.getAxisBinTip("x",f.fXaxis,t),i=f.getBinContent(t+1);if(s&&e.push(s),this.options.Error||this.options.Mark||this.isTF1()){if(e.push(`x = ${d}`,`y = ${m.axisAsText("y",i)}`),this.options.Error){d[0]==="["&&e.push(`error x = ${((w-B)/2).toPrecision(4)}`);let o=this.getBinErrors(f,t+1,i);o.poisson?e.push(`error low = ${o.low.toPrecision(4)}`,`error up = ${o.up.toPrecision(4)}`):e.push(`error y = ${o.up.toPrecision(4)}`)}}else e.push(`bin = ${t+1}`,`x = ${d}`),f.$baseh&&(i-=f.$baseh.getBinContent(t+1)),i===Math.round(i)?e.push(`entries = ${i}`):e.push(`entries = ${gt(i,Q.fStatFormat)}`);return e}processTooltipEvent(t){if(!t||!this.draw_content||!this.draw_g||this.options.Mode3D)return this.draw_g?.selectChild(".tooltip_bin").remove(),null;let e=this.getFramePainter(),s=this.getHistGrFuncs(e),r=this.getHisto(),m=this.getSelectIndex("x","left",-1),f=this.getSelectIndex("x","right",2),B=e.getFrameWidth(),w=e.getFrameHeight(),d,i,o,n,h,x=2,l=m,M=f,u=t.x,c=t.y,v=g=>{let y=r.fXaxis.GetBinLowEdge(g+1);return s.logx&&y<=0?null:s.grx(y)},_=g=>{let y=r.getBinContent(g+1);return s.logy&&y<s.scale_ymin?s.swap_xy?-1e3:10*w:Math.round(s.gry(y))};s.swap_xy&&([u,c,B,w]=[c,u,w,B]);let b=s.swap_xy!==e.x_handle.reverse;for(;l<M-1;){let g=Math.round((l+M)*.5),y=v(g);y===null||y<u-.5?b?M=g:l=g:y>u+.5?b?l=g:M=g:(l++,M--)}let a=M=l;if(i=v(a),b){for(;l>m&&v(l-1)<i+2;)--l;for(;M<f&&v(M+1)>i-2;)++M}else{for(;l>m&&v(l-1)>i-2;)--l;for(;M<f&&v(M+1)<i+2;)++M}if(l<M){let g=w;for(let y=l;y<=M;y++){let P=Math.abs(_(y)-c);P<g&&(g=P,a=y)}g>w/10&&(a=Math.round(l+(M-l)/w*c)),i=v(a)}if(i=Math.round(i),o=Math.round(v(a+1)),this.options.Bar){let g=o-i;i+=Math.round(r.fBarOffset/1e3*g),o=i+Math.round(r.fBarWidth/1e3*g)}i>o&&([i,o]=[o,i]);let T=Math.round((i+o)/2),p=n=h=_(a);if(this.options.Bar)d=!0,x=0,n=this.getBarBaseline(s,w),n>h&&([n,h]=[h,n]),!t.touch&&t.nproc===1&&(c<n||c>h)&&(a=null);else if(this.options.Error&&this.options.Hist!==!0||this.options.Mark||this.options.Line||this.options.Curve){d=!this.isTF1();let g=3;if(this.markeratt&&(g=Math.max(g,this.markeratt.getFullSize())),this.options.Error){let y=r.getBinContent(a+1),P=this.getBinErrors(r,a+1,y);n=Math.round(s.gry(y+P.up)),h=Math.round(s.gry(y-P.low)),y===0&&this.isTProfile()&&(a=null);let O=(o-i)*this.options.errorX;i=Math.round(T-O),o=Math.round(T+O)}o-i<2*g&&(i=T-g,o=T+g),n=Math.min(n,p-g),h=Math.max(h,p+g),!t.touch&&t.nproc===1&&(c<n||c>h)&&(a=null)}else d=t.nproc===1&&f-m<B,d&&(h=w,this.fillatt.empty()||(h=Math.min(w,Math.max(0,Math.round(s.gry(0)))),h<n&&([n,h]=[h,n])),(t.y<n||t.y>h)&&!t.touch&&(a=null));a!==null&&(a===m&&i>u+x||a===f-1&&o<u-x||u<i-x||u>o+x||!this.options.Zero&&r.getBinContent(a+1)===0&&r.getBinError(a+1)===0)&&(a=null);let E=this.draw_g.selectChild(".tooltip_bin");if(a===null||h<=0||n>=w)return E.remove(),null;let $={name:this.getObjectName(),title:r.fTitle,x:T,y:p,exact:!0,color1:this.lineatt?.color??"green",color2:this.fillatt?.getFillColorAlt("blue")??"blue",lines:this.getBinTooltips(a)};if(t.disabled)E.remove(),$.changed=!0;else if(d)E.empty()&&(E=this.draw_g.append("svg:rect").attr("class","tooltip_bin").style("pointer-events","none").call(Ft)),$.changed=E.property("current_bin")!==a,$.changed&&E.attr("x",s.swap_xy?n:i).attr("width",s.swap_xy?h-n:o-i).attr("y",s.swap_xy?i:n).attr("height",s.swap_xy?o-i:h-n).style("opacity","0.3").property("current_bin",a),$.exact=Math.abs(p-c)<=5||c>=n&&c<=h,$.menu=$.exact,$.menu_dist=Math.sqrt((T-u)**2+(p-c)**2);else{let g=this.lineatt.width+3;E.empty()&&(E=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",g).call(this.lineatt.func).call(this.fillatt.func)),$.exact=Math.abs(T-t.x)<=g&&Math.abs(p-t.y)<=g,$.menu=$.exact,$.menu_dist=Math.sqrt((T-t.x)**2+(p-t.y)**2),$.changed=E.property("current_bin")!==a,$.changed&&E.attr("cx",T).attr("cy",p).property("current_bin",a)}return $.changed&&($.user_info={obj:r,name:r.fName,bin:a,cont:r.getBinContent(a+1),grx:T,gry:p}),$}fillHistContextMenu(t){t.add("Auto zoom-in",()=>this.autoZoom());let e=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",e,s=>{if(s.indexOf(St)===0)return this.showInspector(s);this.decodeOptions(s),this.options.need_fillcol&&this.fillatt?.empty()&&this.fillatt.change(5,1001),this.interactiveRedraw("pad","drawopt")}),!this.snapid&&!this.isTProfile()&&!this.isTF1()&&t.addRebinMenu(s=>this.rebinHist(s))}rebinHist(t){let e=this.getHisto(),s=e.fXaxis,r=Math.floor(s.fNbins/t);if(r<2)return;let m=new Array(r+2),f=s.fXbins.length>0?new Array(r):null;m[0]=e.fArray[0];let B=1;for(let d=1;d<=r;++d){f&&(f[d-1]=s.fXbins[B-1]);let i=0;for(let o=0;o<t;++o)i+=e.fArray[B++];m[d]=i}f?(B<=s.fXbins.length&&(s.fXmax=s.fXbins[B-1]),s.fXbins=f):s.fXmax=s.fXmin+(s.fXmax-s.fXmin)/s.fNbins*r*t,s.fNbins=r;let w=0;for(;B<e.fArray.length;)w+=e.fArray[B++];m[r+1]=w,e.fArray=m,e.fSumw2=[],this.scanContent(),this.interactiveRedraw("pad")}autoZoom(){let t=this.getSelectIndex("x","left",-1),e=this.getSelectIndex("x","right",1),s=e-t,r=this.getHisto();if(s===0||!r)return;let m=r.getBinContent(t+1);for(let f=t;f<e;++f)m=Math.min(m,r.getBinContent(f+1));if(!(m>0)){for(;t<e&&r.getBinContent(t+1)<=m;)++t;for(;t<e&&r.getBinContent(e)<=m;)--e;if(t===e-1&&t>2&&e<this.nbinsx-2&&(--t,++e),e-t<s&&t<e)return this.getFramePainter().zoom(r.fXaxis.GetBinLowEdge(t+1),r.fXaxis.GetBinLowEdge(e+1))}}canZoomInside(t,e,s){let r=this.getHisto();return!!(t==="x"&&r&&r.fXaxis.FindBin(s,.5)-r.fXaxis.FindBin(e,0)>1||t==="y"&&Math.abs(s-e)>Math.abs(this.ymax-this.ymin)*1e-6)}draw2D(t){return J(this,null,function*(){return this.clear3DScene(),this.scanContent(t==="zoom"),(this.isMainPainter()?this.drawColorPalette(!1):Promise.resolve(!0)).then(()=>this.drawAxes()).then(()=>this.draw1DBins()).then(()=>this.updateFunctions()).then(()=>this.updateHistTitle()).then(()=>(this.updateStatWebCanvas(),this.addInteractivity()))})}draw3D(t){return J(this,null,function*(){return console.log("3D drawing is disabled, load ./hist/TH1Painter.mjs"),this.draw2D(t)})}callDrawFunc(t){return J(this,null,function*(){let e=this.getMainPainter(),s=this.getFramePainter();return e!==this&&s&&s.mode3d!==this.options.Mode3D&&this.copyOptionsFrom(e),this.options.Mode3D?this.draw3D(t).catch(r=>{let m=this.getCanvPainter();return wt(m?.showConsoleError)?m.showConsoleError(r):console.error("Fail to draw histogram in 3D - back to 2D"),this.options.Mode3D=!1,this.draw2D(t)}):this.draw2D(t)})}redraw(t){return this.callDrawFunc(t)}static draw(t,e,s){return J(this,null,function*(){return $t._drawHist(new Xt(t,e),s)})}};export{Nt as a,Pt as b};

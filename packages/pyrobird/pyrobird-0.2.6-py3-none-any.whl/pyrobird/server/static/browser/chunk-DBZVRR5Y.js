import{Ja as P,f as C,ha as S,y as M}from"./chunk-FVXVO67X.js";import{hb as b}from"./chunk-KYOHYQWH.js";import{k as T}from"./chunk-KYPE3LET.js";var B=class $ extends S{updateObject(t){return this.matchObjectType(t)?(this.assignObject(t),!0):!1}getMenuHeader(){return this.getObject()?.fClassName||"TWebPainting"}fillContextMenu(t){let r=this.getMenuHeader();return t.header(r,`${b}${r}.html`),!0}handleMouseClick(t){let r=C(t,this.draw_g.node()),i=this.getPadPainter(),n=i?.getPadRect();i&&n&&this.snapid&&i.selectObjectPainter(this,{x:r[0]+n.x,y:r[1]+n.y})}redraw(){return T(this,null,function*(){let t=this.getObject(),r=this.getAxisToSvgFunc();if(!t?.fOper||!r)return this;let i=0,n={},d=null,y="none",x="",h,g,a,c=t.fOper.split(";"),l=e=>{if(e!==y&&(d&&(d.attr("d",x),x="",d=null,y="none"),!!e))switch(y=e,d=this.draw_g.append("svg:path").attr("d",""),e){case"f":d.call(this.fillatt.func);break;case"l":d.call(this.lineatt.func).style("fill","none");break;case"m":d.call(this.markeratt.func);break}},m=(e,u)=>{let s=0,f={_typename:"any"};for(let o=0;o<u.length;++o){let p=e.indexOf(":",s+1);f[u[o]]=parseInt(e.slice(s+1,p>s?p:void 0)),s=p}return f},w=e=>{for(;++e<c.length;)switch(h=c[e][0],h){case"z":this.createAttLine({attr:m(c[e],["fLineColor","fLineStyle","fLineWidth"]),force:!0}),l();continue;case"y":this.createAttFill({attr:m(c[e],["fFillColor","fFillStyle"]),force:!0}),l();continue;case"x":this.createAttMarker({attr:m(c[e],["fMarkerColor","fMarkerStyle","fMarkerSize"]),force:!0}),l();continue;case"o":n=m(c[e],["fTextColor","fTextFont","fTextSize","fTextAlign","fTextAngle"]),n.fTextSize<0&&(n.fTextSize*=-.001),l();continue;case"r":case"b":{l(h==="b"?"f":"l");let u=r.x(t.fBuf[i++]),s=r.y(t.fBuf[i++]),f=r.x(t.fBuf[i++]),o=r.y(t.fBuf[i++]);x+=`M${u},${s}h${f-u}v${o-s}h${u-f}z`;continue}case"l":case"f":{for(l(h),g=parseInt(c[e].slice(1)),a=0;a<g;++a)x+=`${a>0?"L":"M"}${r.x(t.fBuf[i++])},${r.y(t.fBuf[i++])}`;h==="f"&&(x+="Z");continue}case"m":{for(l(h),g=parseInt(c[e].slice(1)),this.markeratt.resetPos(),a=0;a<g;++a)x+=this.markeratt.create(r.x(t.fBuf[i++]),r.y(t.fBuf[i++]));continue}case"h":case"t":{if(n.fTextSize){l();let u=n.fTextSize>1?n.fTextSize:this.getPadPainter().getPadHeight()*n.fTextSize,s=this.draw_g.append("svg:g");return this.startTextDrawingAsync(n.fTextFont,u,s).then(()=>{let f=c[e].slice(1),o=n.fTextAngle;if(o>=360&&(o-=Math.floor(o/360)*360),h==="h"){let p="";for(a=0;a<f.length;a+=2)p+=String.fromCharCode(parseInt(f.slice(a,a+2),16));f=p}return this.drawText({align:n.fTextAlign,x:r.x(t.fBuf[i++]),y:r.y(t.fBuf[i++]),rotate:-o,text:f,color:M(n.fTextColor),latex:0,draw_g:s}),this.finishTextDrawing(s)}).then(()=>w(e))}continue}default:console.log(`unsupported operation ${h}`)}return Promise.resolve(!0)};return this.createG(),w(-1).then(()=>(l(),P(this),this.isBatchMode()||this.draw_g.on("click",e=>this.handleMouseClick(e)),this))})}static draw(t,r){return T(this,null,function*(){let i=new $(t,r);return i.addToPadPrimitives(),i.redraw()})}};export{B as TWebPaintingPainter};

import{a as lt,b as k}from"./chunk-D3GAWKNQ.js";import{a as ft,b as at}from"./chunk-K2P6CES6.js";import{b as ht}from"./chunk-Z4ZYSIRC.js";import{B as et,I as st,ha as nt,pa as m,qa as ot,ta as rt,y as it}from"./chunk-FVXVO67X.js";import{Da as K,Ia as J,R as j,Ta as V,Va as q,Xa as H,Ya as v,Za as Q,ba as W,db as g,e as Y,eb as _,f as p,g as Z,gb as P,ia as X,ib as D,j as E,ja as z,kb as tt,qa as S,s as R,t as N,u as d,x as O}from"./chunk-KYOHYQWH.js";import{k as T}from"./chunk-KYPE3LET.js";var G=1,ct=2,dt=3,gt=4,pt=5,Ct=0,Tt=1,xt=2,$=class{constructor(){this.reset()}reset(){Object.assign(this,{Axis:0,RevX:!1,RevY:!1,SymlogX:0,SymlogY:0,Bar:!1,BarStyle:0,Curve:!1,Hist:1,Line:!1,Fill:!1,Error:0,ErrorKind:-1,errorX:d.fErrorX,Mark:!1,Same:!1,Scat:!1,ScatCoef:1,Func:!0,AllFunc:!1,Arrow:!1,Box:!1,BoxStyle:0,Text:!1,TextAngle:0,TextKind:"",Char:0,Color:!1,Contour:0,Cjust:!1,Lego:0,Surf:0,Off:0,Tri:0,Proj:0,AxisPos:0,Ortho:d.fOrthoCamera,Spec:!1,Pie:!1,List:!1,Zscale:!1,Zvert:!0,PadPalette:!1,Candle:"",Violin:"",Scaled:null,Circular:0,Poisson:Ct,GLBox:0,GLColor:!1,Project:"",ProfileProj:"",Profile2DProj:"",System:G,AutoColor:!1,NoStat:!1,ForceStat:!1,PadStats:!1,PadTitle:!1,AutoZoom:!1,HighRes:0,Zero:1,Palette:0,BaseLine:!1,ShowEmpty:!1,Optimize:N.OptimizeDraw,Mode3D:!1,x3dscale:1,y3dscale:1,SwapXY:!1,Render3D:R.Render3D.Default,FrontBox:!0,BackBox:!0,need_fillcol:!1,minimum:g,maximum:g,ymin:0,ymax:0,cutg:null,IgnoreMainScale:!1,IgnorePalette:!1})}isCartesian(){return this.System===G}is3d(){return this.Lego||this.Surf}decodeSumw2(e,s){let t=e.fSumw2?.length??0,r=!1;for(let n=0;n<t;++n)if(e.fSumw2[n]>0){r=!0;break}(Number.isInteger(this.Error)||s)&&(this.Error=r?1:0),(Number.isInteger(this.Hist)||s)&&(this.Hist=r?0:1),(Number.isInteger(this.Zero)||s)&&(this.Zero=r?0:1)}canHavePalette(){return this.ndim===3?this.BoxStyle===12||this.BoxStyle===13||this.GLBox===12:this.ndim===1?this.Lego===12||this.Lego===14:this.Mode3D?this.Lego===12||this.Lego===14||this.Surf===11||this.Surf===12:this.Color||this.Contour||this.Hist||this.Axis?!0:!this.Scat&&!this.Box&&!this.Arrow&&!this.Proj&&!this.Candle&&!this.Violin&&!this.Text}decode(e,s,t,r,n,o){if(this.orginal=e,this.cutg_name="",Z(e)&&s===2){let h=e.lastIndexOf("["),u=e.lastIndexOf("]");h>=0&&u>h+1&&(this.cutg_name=e.slice(h+1,u),e=e.slice(0,h)+e.slice(u+1),this.cutg=r?.findInPrimitives(this.cutg_name,W),this.cutg&&(this.cutg.$redraw_pad=!0))}let i=new st(e);s===1&&this.decodeSumw2(t,!0),this.ndim=s||1,i.check("USE_PAD_TITLE"),i.check("USE_PAD_PALETTE"),i.check("USE_PAD_STATS"),i.check("IGNORE_PALETTE")&&(this.IgnorePalette=!0),i.check("PAL",!0)&&(this.Palette=i.partAsInt()),i.check("MINIMUM:",!0)?(this.ominimum=!0,this.minimum=parseFloat(i.part)):(this.ominimum=!1,this.minimum=t.fMinimum),i.check("MAXIMUM:",!0)?(this.omaximum=!0,this.maximum=parseFloat(i.part)):(this.omaximum=!1,this.maximum=t.fMaximum),!this.ominimum&&!this.omaximum&&this.minimum===this.maximum&&(this.minimum=this.maximum=g),i.check("HMIN:",!0)?(this.ohmin=!0,this.hmin=parseFloat(i.part)):(this.ohmin=!1,delete this.hmin),i.check("HMAX:",!0)?(this.ohmax=!0,this.hmax=parseFloat(i.part)):(this.ohmax=!1,delete this.hmax),this.zoom_min_max=i.check("ZOOM_MIN_MAX"),i.check("HTITLE:",!0)&&(t.fTitle=decodeURIComponent(i.part.toLowerCase())),i.check("XTITLE:",!0)&&(t.fXaxis.fTitle=decodeURIComponent(i.part.toLowerCase())),i.check("YTITLE:",!0)&&(t.fYaxis.fTitle=decodeURIComponent(i.part.toLowerCase())),i.check("ZTITLE:",!0)&&(t.fZaxis.fTitle=decodeURIComponent(i.part.toLowerCase())),i.check("POISSON2")&&(this.Poisson=xt),i.check("POISSON")&&(this.Poisson=Tt),i.check("SHOWEMPTY")&&(this.ShowEmpty=!0),i.check("NOOPTIMIZE")&&(this.Optimize=0),i.check("OPTIMIZE")&&(this.Optimize=2),i.check("AUTOCOL")&&(this.AutoColor=!0),i.check("AUTOZOOM")&&(this.AutoZoom=!0),i.check("OPTSTAT",!0)&&(this.optstat=i.partAsInt()),i.check("OPTFIT",!0)&&(this.optfit=i.partAsInt()),(this.optstat||this.optfit)&&t?.SetBit(_,!1),i.check("ALLBINS")&&t&&(t.fXaxis.fFirst=0,t.fXaxis.fLast=t.fXaxis.fNbins+1,t.fXaxis.SetBit(m.kAxisRange),this.ndim>1&&(t.fYaxis.fFirst=0,t.fYaxis.fLast=t.fYaxis.fNbins+1,t.fYaxis.SetBit(m.kAxisRange)),this.ndim>2&&(t.fZaxis.fFirst=0,t.fZaxis.fLast=t.fZaxis.fNbins+1,t.fZaxis.SetBit(m.kAxisRange))),i.check("NOSTAT")&&(this.NoStat=!0),i.check("STAT")&&(this.ForceStat=!0),i.check("NOTOOLTIP")&&o?.setTooltipAllowed(!1),i.check("TOOLTIP")&&o?.setTooltipAllowed(!0),i.check("SYMLOGX",!0)&&(this.SymlogX=i.partAsInt(0,3)),i.check("SYMLOGY",!0)&&(this.SymlogY=i.partAsInt(0,3)),i.check("X3DSC",!0)&&(this.x3dscale=i.partAsInt(0,100)/100),i.check("Y3DSC",!0)&&(this.y3dscale=i.partAsInt(0,100)/100),(i.check("PERSPECTIVE")||i.check("PERSP"))&&(this.Ortho=!1),i.check("ORTHO")&&(this.Ortho=!0);let a=0,f=0,c="";if(i.check("LOG2XY")&&(a=f=2),i.check("LOGXY")&&(a=f=1),i.check("LOG2X")&&(a=2),i.check("LOGX")&&(a=1),i.check("LOG2Y")&&(f=2),i.check("LOGY")&&(f=1),a&&n&&(n.fLogx=a,n.fUxmin=0,n.fUxmax=1,n.fX1=0,n.fX2=1),f&&n&&(n.fLogy=f,n.fUymin=0,n.fUymax=1,n.fY1=0,n.fY2=1),i.check("LOG2Z")&&n&&(n.fLogz=2),i.check("LOGZ")&&n&&(n.fLogz=1),i.check("LOGV")&&n&&(n.fLogv=1),i.check("GRIDXY")&&n&&(n.fGridx=n.fGridy=1),i.check("GRIDX")&&n&&(n.fGridx=1),i.check("GRIDY")&&n&&(n.fGridy=1),i.check("TICKXY")&&n&&(n.fTickx=n.fTicky=1),i.check("TICKX")&&n&&(n.fTickx=1),i.check("TICKY")&&n&&(n.fTicky=1),i.check("TICKZ")&&n&&(n.fTickz=1),i.check("GRAYSCALE")&&r?.setGrayscale(!0),i.check("FILL_","color")&&(this.histoFillColor=i.color,this.histoFillPattern=1001),i.check("LINE_","color")&&(this.histoLineColor=it(i.color)),i.check("WIDTH_",!0)&&(this.histoLineWidth=i.partAsInt()),i.check("XAXIS_","color")&&(t.fXaxis.fAxisColor=t.fXaxis.fLabelColor=t.fXaxis.fTitleColor=i.color),i.check("YAXIS_","color")&&(t.fYaxis.fAxisColor=t.fYaxis.fLabelColor=t.fYaxis.fTitleColor=i.color),i.check("X+")&&(this.AxisPos=10,this.second_x=!!o?.getMainPainter()),i.check("Y+")&&(this.AxisPos+=1,this.second_y=!!o?.getMainPainter()),i.check("SAME0")&&(this.Same=!0,this.IgnoreMainScale=!0),i.check("SAMES")&&(this.Same=!0,this.ForceStat=!0),i.check("SAME")&&(this.Same=!0,this.Func=!0),i.check("SPEC")&&(this.Spec=!0),i.check("BASE0")||i.check("MIN0")?this.BaseLine=0:d.fHistMinimumZero&&(this.BaseLine=0),i.check("PIE")&&(this.Pie=!0),i.check("CANDLE",!0)&&(this.Candle=i.part||"1"),i.check("VIOLIN",!0)&&(this.Violin=i.part||"1",delete this.Candle),i.check("NOSCALED")&&(this.Scaled=!1),i.check("SCALED")&&(this.Scaled=!0),i.check("GLBOX",!0)&&(this.GLBox=10+i.partAsInt()),i.check("GLCOL")&&(this.GLColor=!0),i.check("GL"),(i.check("CIRCULAR",!0)||i.check("CIRC",!0))&&(this.Circular=11,i.part.indexOf("0")>=0&&(this.Circular=10),i.part.indexOf("1")>=0&&(this.Circular=11),i.part.indexOf("2")>=0&&(this.Circular=12)),this.Chord=i.check("CHORD"),i.check("LEGO",!0)&&(this.Lego=1,i.part.indexOf("0")>=0&&(this.Zero=!1),i.part.indexOf("1")>=0&&(this.Lego=11),i.part.indexOf("2")>=0&&(this.Lego=12),i.part.indexOf("3")>=0&&(this.Lego=13),i.part.indexOf("4")>=0&&(this.Lego=14),c=i.part,i.part.indexOf("Z")>=0&&(this.Zscale=!0),i.part.indexOf("H")>=0&&(this.Zvert=!1)),i.check("R3D_",!0)&&(this.Render3D=R.Render3D.fromString(i.part.toLowerCase())),i.check("POL")&&(this.System=ct),i.check("CYL")&&(this.System=dt),i.check("SPH")&&(this.System=gt),i.check("PSR")&&(this.System=pt),i.check("SURF",!0)&&(this.Surf=i.partAsInt(10,1),c=i.part,i.part.indexOf("Z")>=0&&(this.Zscale=!0),i.part.indexOf("H")>=0&&(this.Zvert=!1)),i.check("TF3",!0)&&(c=i.part),i.check("ISO",!0)&&(c=i.part),i.check("LIST")&&(this.List=!0),i.check("CONT",!0)&&s>1&&(this.Contour=1,i.part.indexOf("Z")>=0&&(this.Zscale=!0),i.part.indexOf("H")>=0&&(this.Zvert=!1),i.part.indexOf("1")>=0?this.Contour=11:i.part.indexOf("2")>=0?this.Contour=12:i.part.indexOf("3")>=0?this.Contour=13:i.part.indexOf("4")>=0&&(this.Contour=14)),i.check("HBAR",!0)?this.BarStyle=20:i.check("BAR",!0)&&(this.BarStyle=10),this.BarStyle>0&&(this.Hist=!1,this.need_fillcol=!0,this.BarStyle+=i.partAsInt()),i.check("ARR")&&(this.Arrow=!0),i.check("BOX",!0)&&(this.BoxStyle=10,i.part.indexOf("1")>=0?this.BoxStyle=11:i.part.indexOf("2")>=0?this.BoxStyle=12:i.part.indexOf("3")>=0&&(this.BoxStyle=13),i.part.indexOf("Z")>=0&&(this.Zscale=!0),i.part.indexOf("H")>=0&&(this.Zvert=!1)),this.Box=this.BoxStyle>0,i.check("CJUST")&&(this.Cjust=!0),i.check("COL7")&&(this.Color=7),i.check("COL")&&(this.Color=!0),i.check("CHAR")&&(this.Char=1),i.check("ALLFUNC")&&(this.AllFunc=!0),i.check("FUNC")&&(this.Func=!0,this.Hist=!1),i.check("HAXISG")&&(this.Axis=3,this.SwapXY=1),i.check("HAXIS")&&(this.Axis=1,this.SwapXY=1),i.check("HAXIG")&&(this.Axis=2,this.SwapXY=1),i.check("AXISG")&&(this.Axis=3),i.check("AXIS")&&(this.Axis=1),i.check("AXIG")&&(this.Axis=2),i.check("TEXT",!0)&&(this.Text=!0,this.Hist=!1,this.TextAngle=Math.min(i.partAsInt(),90),i.part.indexOf("N")>=0&&(this.TextKind="N"),i.part.indexOf("E0")>=0&&(this.TextLine=!0),i.part.indexOf("E")>=0&&(this.TextKind="E")),i.check("SCAT=",!0)&&(this.Scat=!0,this.ScatCoef=parseFloat(i.part),(!Number.isFinite(this.ScatCoef)||this.ScatCoef<=0)&&(this.ScatCoef=1)),i.check("SCAT")&&(this.Scat=!0),i.check("TRI",!0)&&(this.Color=!1,this.Tri=1,c=i.part,i.part.indexOf("ERR")>=0&&(this.Error=!0)),i.check("AITOFF")&&(this.Proj=1),i.check("MERCATOR")&&(this.Proj=2),i.check("SINUSOIDAL")&&(this.Proj=3),i.check("PARABOLIC")&&(this.Proj=4),i.check("MOLLWEIDE")&&(this.Proj=5),this.Proj>0&&(this.Contour=14),i.check("PROJXY",!0)){let h=!0;t?._typename===v&&i.part&&!Number.isInteger(Number.parseInt(i.part))&&(this.Profile2DProj=i.part,h=i.check("PROJXY",!0)),h&&(this.Project="XY"+i.partAsInt(0,1))}i.check("PROJX",!0)&&(t?._typename===H?this.ProfileProj=i.part||"B":this.Project="X"+i.part),i.check("PROJY",!0)&&(this.Project="Y"+i.part),i.check("PROJ")&&(this.Project="Y1"),c&&(c.indexOf("FB")>=0&&(this.FrontBox=!1),c.indexOf("BB")>=0&&(this.BackBox=!1)),s===3&&i.check("FB")&&(this.FrontBox=!1),s===3&&i.check("BB")&&(this.BackBox=!1),i.check("PFC")&&!this._pfc&&(this._pfc=2),(i.check("PLC")||this.AutoColor)&&!this._plc&&(this._plc=2),i.check("PMC")&&!this._pmc&&(this._pmc=2);let l=(h,u,x)=>{if(u==="fZaxis"&&s<3&&!this.Lego&&!this.Surf)return;let C=i.check(h);n&&n["$"+h]&&(C=!0,n["$"+h]=void 0),C&&t&&t[u].SetBit(x,!0)};if(l("OTX","fXaxis",m.kOppositeTitle),l("OTY","fYaxis",m.kOppositeTitle),l("OTZ","fZaxis",m.kOppositeTitle),l("CTX","fXaxis",m.kCenterTitle),l("CTY","fYaxis",m.kCenterTitle),l("CTZ","fZaxis",m.kCenterTitle),l("MLX","fXaxis",m.kMoreLogLabels),l("MLY","fYaxis",m.kMoreLogLabels),l("MLZ","fZaxis",m.kMoreLogLabels),l("NOEX","fXaxis",m.kNoExponent),l("NOEY","fYaxis",m.kNoExponent),l("NOEZ","fZaxis",m.kNoExponent),(i.check("RX")||n?.$RX)&&(this.RevX=!0),(i.check("RY")||n?.$RY)&&(this.RevY=!0),i.check("L")&&(this.Line=!0,this.Hist=!1),i.check("F")&&(this.Fill=!0,this.need_fillcol=!0),i.check("A")&&(this.Axis=-1),n?.$ratio_pad==="up")this.Same||(this.Axis=0),t.fXaxis.fLabelSize=0,t.fXaxis.fTitle="",t.fYaxis.$use_top_pad=!0;else if(n?.$ratio_pad==="low"){this.Same||(this.Axis=0),t.fXaxis.$use_top_pad=!0,t.fYaxis.$use_top_pad=!0,t.fXaxis.fTitle="x";let h=o?.getCanvPainter().findPainterFor(null,"upper_pad",K)?.getFramePainter();h&&(o.zoom_xmin=h.scale_xmin,o.zoom_xmax=h.scale_xmax)}i.check("B1")&&(this.BarStyle=1,this.BaseLine=0,this.Hist=!1,this.need_fillcol=!0),i.check("B")&&(this.BarStyle=1,this.Hist=!1,this.need_fillcol=!0),i.check("C")&&(this.Curve=!0,this.Hist=!1),i.check("][")&&(this.Off=1,this.Hist=!0),i.check("HIST")&&(this.Hist=!0,this.Func=!0,this.Error=!1),this.Bar=this.BarStyle>0,delete this.MarkStyle,i.check("P0")&&(this.Mark=!0,this.Hist=!1,this.Zero=!0),i.check("P")&&(this.Mark=!0,this.Hist=!1,this.Zero=!1),i.check("HZ")&&(this.Zscale=!0,this.Zvert=!1),i.check("Z")&&(this.Zscale=!0),i.check("*")&&(this.Mark=!0,this.MarkStyle=3,this.Hist=!1),i.check("H")&&(this.Hist=!0),i.check("E",!0)&&(this.Error=!0,s===1&&(this.Zero=!1,this.Hist===1&&(this.Hist=!1),Number.isInteger(parseInt(i.part[0]))&&(this.ErrorKind=parseInt(i.part[0])),(this.ErrorKind===3||this.ErrorKind===4)&&(this.need_fillcol=!0),this.ErrorKind===0&&(this.Zero=!0),i.part.indexOf("X0")>=0&&(this.errorX=0))),i.check("9")&&(this.HighRes=1),i.check("0")&&(this.Zero=!1),this.Color&&i.check("1")&&(this.Zero=!1),(this.Lego>0||s===3||(this.Surf>0||this.Error)&&s===2)&&(this.Mode3D=!0),o?.isTF1()&&s===1&&this.Hist===1&&!this.Line&&!this.Fill&&!this.Curve&&!this.Mark&&(this.Hist=!1,this.Curve=N.FuncAsCurve,this.Line=!this.Curve,this.Fill=!0),this.Surf===15&&(this.System===ct||this.System===G)&&(this.Surf=13)}swap_xy(){return this.BarStyle>=20||this.SwapXY}asString(e,s){let t="",r="";return this.Zscale&&(r=this.Zvert?"Z":"HZ"),this.Mode3D?(this.Lego?(t="LEGO",this.Zero||(t+="0"),this.Lego>10&&(t+=this.Lego-10),t+=r):this.Surf&&(t="SURF"+(this.Surf-10),t+=r),this.FrontBox||(t+="FB"),this.BackBox||(t+="BB"),this.x3dscale!==1&&(t+=`_X3DSC${Math.round(this.x3dscale*100)}`),this.y3dscale!==1&&(t+=`_Y3DSC${Math.round(this.y3dscale*100)}`)):(this.Candle?t="CANDLE"+this.Candle:this.Violin?t="VIOLIN"+this.Violin:this.Scat?t="SCAT":this.Color?(t="COL",this.Zero||(t+="0"),t+=r,this.Axis<0&&(t+="A")):this.Contour?(t="CONT",this.Contour>10&&(t+=this.Contour-10),t+=r):this.Bar?t=this.BaseLine===!1?"B":"B1":this.Mark?t=this.Zero?"P0":"P":this.Line?(t+="L",this.Fill&&(t+="F")):this.Off&&(t="]["),this.Error&&(t+="E",this.ErrorKind>=0&&(t+=this.ErrorKind),this.errorX===0&&(t+="X0")),this.Cjust&&(t+=" CJUST"),this.Hist===!0&&(t+="HIST"),this.Text&&(t+="TEXT",this.TextAngle&&(t+=this.TextAngle),t+=this.TextKind)),this.Palette&&this.canHavePalette()&&(t+=`_PAL${this.Palette}`),this.is3d()&&this.Ortho&&e&&(t+="_ORTHO"),this.ProfileProj&&(t+="_PROJX"+this.ProfileProj),this.Profile2DProj&&(t+="_PROJXY"+this.Profile2DProj),this.Proj&&(t+="_PROJ"+this.Proj),this.ShowEmpty&&(t+="_SHOWEMPTY"),this.Same?t+=this.ForceStat?"SAMES":"SAME":e&&t&&(this.ForceStat||this.StatEnabled===!0?t+="_STAT":(this.NoStat||this.StatEnabled===!1)&&(t+="_NOSTAT")),e&&s&&t&&(s.fLogx===2?t+="_LOG2X":s.fLogx&&(t+="_LOGX"),s.fLogy===2?t+="_LOG2Y":s.fLogy&&(t+="_LOGY"),s.fLogz===2?t+="_LOG2Z":s.fLogz&&(t+="_LOGZ"),s.fGridx&&(t+="_GRIDX"),s.fGridy&&(t+="_GRIDY"),s.fTickx&&(t+="_TICKX"),s.fTicky&&(t+="_TICKY"),s.fTickz&&(t+="_TICKZ")),this.cutg_name&&(t+=` [${this.cutg_name}]`),t}},U=class{constructor(e,s){this.arr=[],this.colzmin=e,this.colzmax=s,this.below_min_indx=-1,this.exact_min_indx=0}getLevels(){return this.arr}createNormal(e,s,t){if(s){this.colzmax<=0&&(this.colzmax=1),this.colzmin<=0&&(t===void 0||t<=0?this.colzmin=1e-4*this.colzmax:this.colzmin=t<3||t>100?.3*t:1),this.colzmin>=this.colzmax&&(this.colzmin=1e-4*this.colzmax);let r=Math.log(this.colzmin)/Math.log(10),n=Math.log(this.colzmax)/Math.log(10),o=(n-r)/e;this.arr.push(this.colzmin);for(let i=1;i<e;i++)this.arr.push(Math.exp((r+o*i)*Math.log(10)));this.arr.push(this.colzmax),this.custom=!0}else{this.colzmin===this.colzmax&&this.colzmin!==0&&(this.colzmax+=.01*Math.abs(this.colzmax),this.colzmin-=.01*Math.abs(this.colzmin));let r=(this.colzmax-this.colzmin)/e;for(let n=0;n<=e;n++)this.arr.push(this.colzmin+r*n)}}createCustom(e){this.custom=!0;for(let s=0;s<e.length;++s)this.arr.push(e[s]);this.colzmax>this.arr.at(-1)&&this.arr.push(this.colzmax)}configIndicies(e,s){this.below_min_indx=e,this.exact_min_indx=s}getContourIndex(e){if(e<this.colzmin)return this.below_min_indx;if(e===this.colzmin)return this.exact_min_indx;if(!this.custom)return Math.floor(.01+(e-this.colzmin)*(this.arr.length-1)/(this.colzmax-this.colzmin));let s=0,t=this.arr.length-1;if(e<this.arr[0])return-1;if(e>=this.arr[t])return t;for(;s<t-1;){let r=Math.round((s+t)/2);this.arr[r]>e?t=r:s=r}return s}getPaletteColor(e,s){let t=this.getContourIndex(s);if(t<0)return null;let r=e.calcColorIndex(t,this.arr.length);return e.getColor(r)}getPaletteIndex(e,s){let t=this.getContourIndex(s);return t<0?null:e.calcColorIndex(t,this.arr.length)}},B=class{constructor(e,s,t,r){this.painter=e,this.pp=s;let n=[],o=[],i=r===!0;this.newfuncs=[],this.newopts=[],i||s?.forEachPainterInPad(a=>{a.isSecondary(e)&&a.getSecondaryId()?.match(/^func_|^indx_/)&&n.push(a)},"objects");for(let a=0;a<t?.arr.length;++a){let f=t.arr[a],c=t.opt[a];if(!f?._typename||p(e.needDrawFunc)&&!e.needDrawFunc(e.getObject(),f))continue;let l=null,h=-1;if(!i){for(let u=0;u<n.length;++u)if(n[u].matchObjectType(f._typename)&&n[u].getObjectName()===f.fName){l=n[u],h=u;break}!l&&f.fName&&(l=s?.findPainterFor(null,f.fName,f._typename))}l?(l.updateObject(f,c),h>=0&&(n.splice(h,1),o.push(l))):(this.newfuncs[a]=f,this.newopts[a]=c)}if(Y(r)){let a=n.indexOf(r);a>=0&&n.splice(a,1)}n.length>0&&s?.cleanPrimitives(a=>n.indexOf(a)>=0),o.length>0&&(this._extraPainters=o)}drawNext(e){if(this._extraPainters){let o=this._extraPainters.shift();return this._extraPainters.length===0&&delete this._extraPainters,E(o.redraw()).then(()=>this.drawNext(0))}if(!this.newfuncs||e>=this.newfuncs.length)return delete this.newfuncs,delete this.newopts,Promise.resolve(this.painter);let s=this.newfuncs[e],t=this.newopts[e];if(!s||this.pp?.findPainterFor(s))return this.drawNext(e+1);let r=s?.fName?`func_${s.fName}`:`indx_${e}`;return s.$main_painter=this.painter,(k.canDraw(s)?k.draw(this.pp,s,t):this.pp.drawObject(this.pp,s,t)).then(o=>(o.setSecondaryId(this.painter,r),this.drawNext(e+1)))}},_t=O(10),ut=O(16),A=O(17),mt=class extends nt{constructor(e,s){super(e,s),this.draw_content=!0,this.nbinsx=this.nbinsy=0,this.mode3d=!1}getHisto(){return this.getObject()}getAxis(e){let s=this.getObject();switch(e){case"x":return s?.fXaxis;case"y":return s?.fYaxis;case"z":return s?.fZaxis}return null}isTProfile(){return this.matchObjectType(H)}isTF1(){return!1}isTH1K(){return this.matchObjectType("TH1K")}isTH2Poly(){return this.matchObjectType(/^TH2Poly/)||this.matchObjectType(/^TProfile2Poly/)}clear3DScene(){let e=this.getFramePainter();p(e?.create3DScene)&&e.create3DScene(-1),this.mode3d=!1}cleanup(){this.clear3DScene(),delete this._color_palette,delete this.fContour,delete this.options,super.cleanup()}getDimension(){let e=this.getHisto();return e?e._typename.match(/^TH2/)||e._typename===v?2:e._typename.match(/^TH3/)||e._typename===Q?3:this.isTH2Poly()?2:1:0}decodeOptions(e){let s=this.getHisto(),t=this.getDimension(),r=this.getPadPainter(),n=r?.getRootPad(!0);this.options?this.options.reset():this.options=new $,this.lineatt?.setUsed(!1),this.fillatt?.setUsed(!1),this.markeratt?.setUsed(!1),this.options.decode(e||s.fOption,t,s,r,n,this),this.storeDrawOpt(e)}copyOptionsFrom(e){if(e===this)return;let s=this.options,t=e.options;s.Mode3D=t.Mode3D,s.Zero=t.Zero,t.Mode3D?(s.Lego=t.Lego,s.Surf=t.Surf):(s.Color=t.Color,s.Contour=t.Contour)}copyOptionsToOthers(){this.forEachPainter(e=>{e!==this&&p(e.copyOptionsFrom)&&e.copyOptionsFrom(this)},"objects")}scanContent(){}checkPadRange(){this.isMainPainter()&&(this.check_pad_range=this.options.Same?"pad_range":!0)}createHistDrawAttributes(e){let s=this.getHisto(),t=this.options;if(t._pfc>1||t._plc>1||t._pmc>1){let r=this.getPadPainter();if(p(r?.getAutoColor)){let n=r.getAutoColor(s.$num_histos);this._auto_exec="",t._pfc>1&&(t._pfc=1,s.fFillColor=n,this._auto_exec+=`SetFillColor(${n});;`,delete this.fillatt),t._plc>1&&(t._plc=1,s.fLineColor=n,this._auto_exec+=`SetLineColor(${n});;`,delete this.lineatt),t._pmc>1&&(t._pmc=1,s.fMarkerColor=n,this._auto_exec+=`SetMarkerColor(${n});;`,delete this.markeratt)}}e?this.deleteAttr():(this.createAttFill({attr:s,color:this.options.histoFillColor,pattern:this.options.histoFillPattern,kind:1}),this.createAttLine({attr:s,color0:this.options.histoLineColor,width:this.options.histoLineWidth}))}updateAxes(e,s,t){let r=(n,o,i)=>{n.fTitle=o.fTitle,n.fLabels=o.fLabels,n.fXmin=o.fXmin,n.fXmax=o.fXmax,n.fTimeDisplay=o.fTimeDisplay,n.fTimeFormat=o.fTimeFormat,n.fAxisColor=o.fAxisColor,n.fLabelColor=o.fLabelColor,n.fLabelFont=o.fLabelFont,n.fLabelOffset=o.fLabelOffset,n.fLabelSize=o.fLabelSize,n.fNdivisions=o.fNdivisions,n.fTickLength=o.fTickLength,n.fTitleColor=o.fTitleColor,n.fTitleFont=o.fTitleFont,n.fTitleOffset=o.fTitleOffset,n.fTitleSize=o.fTitleSize,i&&(n.fFirst=o.fFirst,n.fLast=o.fLast,n.fBits=o.fBits)};r(e.fXaxis,s.fXaxis,this.snapid&&!t?.zoomChangedInteractive("x")),r(e.fYaxis,s.fYaxis,this.snapid&&!t?.zoomChangedInteractive("y")),r(e.fZaxis,s.fZaxis,this.snapid&&!t?.zoomChangedInteractive("z"))}updateObject(e,s){let t=this.getHisto(),r=this.getFramePainter(),n=this.getPadPainter(),o=this.options;if(e!==t){if(!this.matchObjectType(e))return!1;let i=n?.findPainterFor(this.findStat());t.TestBit(_)!==e.TestBit(_)&&(t.SetBit(_,e.TestBit(_)),i&&(i.Enabled=!t.TestBit(_)&&!this.options.NoStat,i.Enabled||i.removeG())),t.SetBit(ut,e.TestBit(ut)),this.snapid!==void 0&&(t.fName=e.fName,o._pfc=o._plc=o._pmc=0),o._pfc||(t.fFillColor=e.fFillColor),t.fFillStyle=e.fFillStyle,o._plc||(t.fLineColor=e.fLineColor),t.fLineStyle=e.fLineStyle,t.fLineWidth=e.fLineWidth,o._pmc||(t.fMarkerColor=e.fMarkerColor),t.fMarkerSize=e.fMarkerSize,t.fMarkerStyle=e.fMarkerStyle,t.fEntries=e.fEntries,t.fTsumw=e.fTsumw,t.fTsumwx=e.fTsumwx,t.fTsumwx2=e.fTsumwx2,t.fXaxis.fNbins=e.fXaxis.fNbins,this.getDimension()>1&&(t.fTsumwy=e.fTsumwy,t.fTsumwy2=e.fTsumwy2,t.fTsumwxy=e.fTsumwxy,t.fYaxis.fNbins=e.fYaxis.fNbins,this.getDimension()>2&&(t.fTsumwz=e.fTsumwz,t.fTsumwz2=e.fTsumwz2,t.fTsumwxz=e.fTsumwxz,t.fTsumwyz=e.fTsumwyz,t.fZaxis.fNbins=e.fZaxis.fNbins)),this.updateAxes(t,e,r),t.fArray=e.fArray,t.fNcells=e.fNcells,t.fTitle=e.fTitle,t.fMinimum=e.fMinimum,t.fMaximum=e.fMaximum,t.fSumw2=e.fSumw2,o.ominimum||(o.minimum=t.fMinimum),o.omaximum||(o.maximum=t.fMaximum),this.getDimension()===1&&o.decodeSumw2(t),this.isTProfile()?t.fBinEntries=e.fBinEntries:this.isTH1K()?(t.fNIn=e.fNIn,t.fReady=0):this.isTH2Poly()&&(t.fBins=e.fBins),this._funcHandler=new B(this,n,e.fFunctions,i);let a=t.fOption!==e.fOption;t.fOption=e.fOption,(s!==void 0&&o.original!==s||a)&&this.decodeOptions(s||t.fOption)}return o.ominimum||(o.minimum=t.fMinimum),o.omaximum||(o.maximum=t.fMaximum),!o.ominimum&&!o.omaximum&&o.minimum===o.maximum&&(o.minimum=o.maximum=g),(!r||!r.zoomChangedInteractive())&&this.checkPadRange(),this.scanContent(),this.histogram_updated=!0,!0}accessMM(e,s){let t=e?"minimum":"maximum";if(s===void 0)return this.options[t];this.options[t]=s,this.interactiveRedraw("pad",e?`exec:SetMinimum(${s})`:`exec:SetMaximum(${s})`)}extractAxesProperties(e){let s=r=>{r.fXbins.length>=r.fNbins?(r.GetBinCoord=function(n){let o=Math.round(n);if(o<=0)return this.fXmin;if(o>this.fNbins)return this.fXmax;if(o===n)return this.fXbins[o];let i=n<o?o-1:o+1;return this.fXbins[o]*Math.abs(n-i)+this.fXbins[i]*Math.abs(n-o)},r.FindBin=function(n,o){for(let i=1;i<this.fXbins.length;++i)if(n<this.fXbins[i])return Math.floor(i-1+o);return this.fNbins}):(r.$binwidth=(r.fXmax-r.fXmin)/(r.fNbins||1),r.GetBinCoord=function(n){return this.fXmin+n*this.$binwidth},r.FindBin=function(n,o){return Math.floor((n-this.fXmin)/this.$binwidth+o)})};this.nbinsx=this.nbinsy=this.nbinsz=0;let t=this.getHisto();this.nbinsx=t.fXaxis.fNbins,this.xmin=t.fXaxis.fXmin,this.xmax=t.fXaxis.fXmax,t.fXaxis.TestBit(m.kAxisRange)&&t.fXaxis.fFirst!==t.fXaxis.fLast&&(t.fXaxis.fFirst===0&&(this.xmin=t.fXaxis.GetBinLowEdge(0)),t.fXaxis.fLast===this.nbinsx+1&&(this.xmax=t.fXaxis.GetBinLowEdge(this.nbinsx+2))),s(t.fXaxis),this.ymin=t.fYaxis.fXmin,this.ymax=t.fYaxis.fXmax,this._exact_y_range=e===1&&this.options.ohmin&&this.options.ohmax,this._exact_y_range&&(this.ymin=this.options.hmin,this.ymax=this.options.hmax),e>1&&(this.nbinsy=t.fYaxis.fNbins,t.fYaxis.TestBit(m.kAxisRange)&&t.fYaxis.fFirst!==t.fYaxis.fLast&&(t.fYaxis.fFirst===0&&(this.ymin=t.fYaxis.GetBinLowEdge(0)),t.fYaxis.fLast===this.nbinsy+1&&(this.ymax=t.fYaxis.GetBinLowEdge(this.nbinsy+2))),s(t.fYaxis),this.zmin=t.fZaxis.fXmin,this.zmax=t.fZaxis.fXmax,e===2&&this.options.ohmin&&this.options.ohmax&&(this.zmin=this.options.hmin,this.zmax=this.options.hmax)),e>2&&(this.nbinsz=t.fZaxis.fNbins,t.fZaxis.TestBit(m.kAxisRange)&&t.fZaxis.fFirst!==t.fZaxis.fLast&&(t.fZaxis.fFirst===0&&(this.zmin=t.fZaxis.GetBinLowEdge(0)),t.fZaxis.fLast===this.nbinsz+1&&(this.zmax=t.fZaxis.GetBinLowEdge(this.nbinsz+2))),s(t.fZaxis))}drawAxes(){return T(this,null,function*(){let e=this.getFramePainter();if(!e)return!1;let s=this.getHisto();if(this.ymin===this.ymax&&(this.ymax+=1),!this.isMainPainter()){let r={second_x:this.options.AxisPos>=10,second_y:this.options.AxisPos%10===1,hist_painter:this};return!r.second_x&&!r.second_y||e.hasDrawnAxes(r.second_x,r.second_y)?!1:(e.setAxes2Ranges(r.second_x,s.fXaxis,this.xmin,this.xmax,r.second_y,s.fYaxis,this.ymin,this.ymax),e.createXY2(r),e.drawAxes2(r.second_x,r.second_y))}if(e.setAxesRanges(s.fXaxis,this.xmin,this.xmax,s.fYaxis,this.ymin,this.ymax,s.fZaxis,0,0),e.createXY({ndim:this.getDimension(),check_pad_range:this.check_pad_range,zoom_xmin:this.zoom_xmin,zoom_xmax:this.zoom_xmax,zoom_ymin:this.zoom_ymin,zoom_ymax:this.zoom_ymax,xmin_nz:s.$xmin_nz,ymin_nz:this.ymin_nz??s.$ymin_nz,swap_xy:this.options.swap_xy(),reverse_x:this.options.RevX,reverse_y:this.options.RevY,symlog_x:this.options.SymlogX,symlog_y:this.options.SymlogY,Proj:this.options.Proj,extra_y_space:this.options.Text&&this.options.BarStyle>0,hist_painter:this}),delete this.check_pad_range,delete this.zoom_xmin,delete this.zoom_xmax,delete this.zoom_ymin,delete this.zoom_ymax,this.options.Same)return!1;let t=this.options.Axis<0||this.options.Axis===2;return e.drawAxes(!1,t,t,this.options.AxisPos,this.options.Zscale&&this.options.Zvert,this.options.Zscale&&!this.options.Zvert,this.options.Axis!==1)})}processOnlineChange(e){let s=this.getCanvPainter();p(s?.processChanges)&&s.processChanges(e,this)}fillWebObjectOptions(e){this._auto_exec&&e&&(e.fcust="auto_exec:"+this._auto_exec,delete this._auto_exec)}toggleTitle(e){let s=this.getHisto();if(!this.isMainPainter()||!s)return!1;if(e==="only-check")return!s.TestBit(A);s.InvertBit(A),this.updateHistTitle().then(()=>this.processOnlineChange(`exec:SetBit(TH1::kNoTitle,${s.TestBit(A)?1:0})`))}updateHistTitle(){return T(this,null,function*(){if(!this.isMainPainter()||this.options.Same||this.options.Axis>0)return this;let e=this.getPadPainter()?.findPainterFor(null,P,X),s=e?.getObject();if(!e||!s)return this;let t=this.getHisto(),r=!t.TestBit(A)&&d.fOptTitle>0;return s.Clear(),r&&s.AddText(t.fTitle),e.redraw().then(()=>this)})}drawHistTitle(){return T(this,null,function*(){if(!this.isMainPainter()||this.options.Same||this.options.Axis>0)return this;let e=this.getHisto(),s=d,t=!e.TestBit(A)&&s.fOptTitle>0,r=this.getPadPainter(),n=r.findInPrimitives(P,X);return n?(n.Clear(),t&&n.AddText(e.fTitle),this):(n=D(X),Object.assign(n,{fName:P,fOption:"blNDC",fFillColor:s.fTitleColor,fFillStyle:s.fTitleStyle,fBorderSize:s.fTitleBorderSize,fTextFont:s.fTitleFont,fTextSize:s.fTitleFontSize,fTextColor:s.fTitleTextColor,fTextAlign:22}),t&&n.AddText(e.fTitle),k.draw(r,n,lt).then(o=>(o?.setSecondaryId(this,P),this)))})}processTitleChange(e){let s=this.getHisto(),t=this.getPadPainter()?.findPainterFor(null,P);if(!s||!t)return null;if(e==="check")return!this.isMainPainter()||this.options.Same?null:s;t.clearPave(),t.addText(s.fTitle),t.redraw(),this.submitCanvExec(`SetTitle("${s.fTitle}")`)}updateStatWebCanvas(){if(!this.snapid)return;let e=this.findStat(),s=this.getPadPainter()?.findPainterFor(e);s&&!s.snapid&&s.redraw()}findStat(){return this.findFunction(z,"stats")}toggleStat(e){let s=this.getPadPainter(),t=this.findStat(),r;if(e||(e=""),t)r=s.findPainterFor(t);else{if(e.indexOf("-check")>0)return!1;t=this.createStat(!0)}if(e==="only-check")return r?.Enabled||!1;if(e==="fitpar-check")return t?.fOptFit||!1;if(e==="fitpar-toggle")return t?(t.fOptFit=t.fOptFit?0:1111,r?.redraw(),!0):!1;let n;return r?(r.Enabled=!r.Enabled,this.options.StatEnabled=r.Enabled,r.redraw(),n=r.Enabled):n=k.draw(s,t),this.processOnlineChange(`exec:SetBit(TH1::kNoStats,${n?0:1})`,this),n}isIgnoreStatsFill(){return!this.getObject()||!this.draw_content&&!this.create_stats&&!this.snapid}createStat(e){let s=this.getHisto();if(!s||!e&&!this.options.ForceStat&&(this.options.NoStat||s.TestBit(_)||!N.AutoStat||!this.isMainPainter()))return null;let t=d,r=this.findStat(),n=this.options.optstat,o=this.options.optfit;return n!==void 0?(r&&(r.fOptStat=n),delete this.options.optstat):n=s.$custom_stat||t.fOptStat,o!==void 0?(r&&(r.fOptFit=o),delete this.options.optfit):o=t.fOptFit,!r&&!n&&!o?null:(this.create_stats=!0,r||(r=D(z),Object.assign(r,{fName:"stats",fOptStat:n,fOptFit:o,fX1NDC:t.fStatX-t.fStatW,fY1NDC:t.fStatY-t.fStatH,fX2NDC:t.fStatX,fY2NDC:t.fStatY,fTextAlign:12}),r.AddText(s.fName),this.addFunction(r),r))}findFunction(e,s){let t=this.getHisto()?.fFunctions?.arr;if(!t)return null;for(let r=0;r<t.length;++r){let n=t[r];if(!(s&&n.fName!==s)&&n._typename===e)return n}return null}addFunction(e,s){let t=this.getHisto();!t||!e||(t.fFunctions||(t.fFunctions=D(j)),s?t.fFunctions.AddFirst(e):t.fFunctions.Add(e))}needDrawFunc(e,s){return s._typename===z?s.fName!=="stats"||!e.TestBit(_)&&!this.options.NoStat:s._typename===V||s._typename===q?this.options.AllFunc||!s.TestBit(O(9)):s._typename==="TGraphDelaunay"||s._typename==="TGraphDelaunay2D"?!1:s._typename!==S}drawFunctions(){return T(this,null,function*(){return new B(this,this.getPadPainter(),this.getHisto().fFunctions,!0).drawNext(0)})}updateFunctions(){return T(this,null,function*(){let e=this._funcHandler?.drawNext(0)??this;return delete this._funcHandler,e})}getSelectIndex(e,s,t){let r,n=this.getAxis(e),o=this[`nbins${e}`]??0;this.options.second_x&&e==="x"&&(e="x2"),this.options.second_y&&e==="y"&&(e="y2");let i=this.getFramePainter(),a=i?i[`zoom_${e}min`]:0,f=i?i[`zoom_${e}max`]:0;return a!==f&&n?(s==="left"?r=n.FindBin(a,t||0):r=n.FindBin(f,(t||0)+.5),r<0?r=0:r>o&&(r=o)):r=s==="left"?0:o,n&&(n.fFirst===n.fLast||!n.TestBit(m.kAxisRange)||n.fFirst===1&&n.fLast===o)&&(n=null),s==="left"?(r=Math.max(r,0),n&&n.fFirst>1&&r<n.fFirst?r=n.fFirst-1:n?.fFirst===0&&(r=-1)):(r=Math.min(r,o),n&&n.fLast<=o&&r>n.fLast?r=n.fLast:n?.fLast===o+1&&(r=o+1)),r}unzoomUserRange(e,s,t){let r=this.getHisto();if(!r)return!1;let n=!1,o=a=>!a||!a.TestBit(m.kAxisRange)||a.fFirst===a.fLast||a.fFirst<=1&&a.fLast>=a.fNbins?!1:(a.InvertBit(m.kAxisRange),!0),i=a=>this.getDimension()!==a||this.options.minimum===g&&this.options.maximum===g||!this.draw_content?!1:(this.options.minimum=this.options.maximum=g,this.scanContent(),!0);return e&&o(r.fXaxis)&&(n=!0),s&&(o(r.fYaxis)||i(1))&&(n=!0),t&&(o(r.fZaxis)||i(2))&&(n=!0),n}addInteractivity(){return T(this,null,function*(){let e=this.isMainPainter(),s=this.options.AxisPos>0;return(e||s?this.getFramePainter():null)?.addInteractivity(!e&&s)??!1})}changeUserRange(e,s){let t=this.getHisto(),r=t?t[`f${s}axis`]:null;if(!r)return;let n=`[1,${r.fNbins}]`;r.TestBit(m.kAxisRange)&&(n=`[${r.fFirst},${r.fLast}]`),e.input(`Enter user range for axis ${s} like [1,${r.fNbins}]`,n).then(o=>{if(!o||(o=JSON.parse(o),!o||o.length!==2))return;let i=parseInt(o[0]),a=parseInt(o[1]);!Number.isInteger(i)||!Number.isInteger(a)||(r.fFirst=i,r.fLast=a,r.SetBit(m.kAxisRange,r.fFirst<r.fLast&&r.fFirst>=1&&r.fLast<=r.fNbins),this.interactiveRedraw())})}changeValuesRange(e){let s;this.options.minimum!==g&&this.options.maximum!==g?s=`[${this.options.minimum},${this.options.maximum}]`:s=`[${this.gminbin},${this.gmaxbin}]`,e.input("Enter min/max hist values or empty string to reset",s).then(t=>{t=t?JSON.parse(t):[],!Y(t)||t.length!==2||!Number.isFinite(t[0])||!Number.isFinite(t[1])?this.options.minimum=this.options.maximum=g:(this.options.minimum=t[0],this.options.maximum=t[1]),this.interactiveRedraw()})}executeMenuCommand(e,s){if(super.executeMenuCommand(e,s))return!0;if(e.fClassName===J){let t=Z(e.$execid)?e.$execid.indexOf("#"):-1,r=t>0?e.$execid.slice(t+1):"x",n=this.getFramePainter();if(e.fName==="UnZoom")return n?.unzoom(r),!0;if(e.fName==="SetRange"){let o=n?.getAxis(r),i=JSON.parse(`[${s}]`);o&&i?.length===2&&n?.zoom(r,o.GetBinLowEdge(i[0]),o.GetBinLowEdge(i[1]+1))}else if(e.fName==="SetRangeUser"){let o=JSON.parse(`[${s}]`);o?.length===2&&n?.zoom(r,o[0],o[1])}}return!1}fillContextMenuItems(e){let s=this.getHisto(),t=this.getFramePainter();if(s){if(this.options.Axis<=0&&!this.isTF1()&&e.addchk(this.toggleStat("only-check"),"Show statbox",()=>this.toggleStat()),this.isMainPainter()&&(e.sub("Title"),e.addchk(this.toggleTitle("only-check"),"Show",()=>this.toggleTitle()),e.add("Edit",()=>e.input("Enter histogram title",s.fTitle).then(r=>{tt(s,r),this.interactiveRedraw()})),e.endsub()),this.draw_content&&(this.getDimension()===1?e.add("User range X",()=>this.changeUserRange(e,"X")):(e.sub("User ranges"),e.add("X",()=>this.changeUserRange(e,"X")),e.add("Y",()=>this.changeUserRange(e,"Y")),this.getDimension()>2?e.add("Z",()=>this.changeUserRange(e,"Z")):e.add("Values",()=>this.changeValuesRange(e)),e.endsub()),p(this.fillHistContextMenu)&&this.fillHistContextMenu(e),e.addRedrawMenu(this.getPrimary())),this.options.Mode3D){e.size()>0&&e.separator();let r=this.getMainPainter()||this;e.addchk(r.isTooltipAllowed(),"Show tooltips",()=>r.setTooltipAllowed("toggle")),e.addchk(t?.enable_highlight,"Highlight bins",()=>{t.enable_highlight=!t.enable_highlight,!t.enable_highlight&&t.mode3d&&p(t.highlightBin3D)&&t.highlightBin3D(null)}),p(t?.render3D)&&(e.addchk(r.options.FrontBox,"Front box",()=>{r.options.FrontBox=!r.options.FrontBox,t.render3D()}),e.addchk(r.options.BackBox,"Back box",()=>{r.options.BackBox=!r.options.BackBox,t.render3D()}),e.addchk(t.camera?.isOrthographicCamera,"Orthographic camera",n=>{r.options.Ortho=n,t.change3DCamera(n)})),this.draw_content&&(e.addchk(!this.options.Zero,"Suppress zeros",()=>{this.options.Zero=!this.options.Zero,this.interactiveRedraw("pad")}),(this.options.Lego===12||this.options.Lego===14)&&(e.addchk(this.options.Zscale,"Z scale",()=>this.toggleColz()),this.fillPaletteMenu(e,!0))),p(r.control?.reset)&&e.add("Reset camera",()=>r.control.reset())}this.histogram_updated&&t.zoomChangedInteractive()&&e.add("Let update zoom",()=>t.zoomChangedInteractive("reset"))}}getSnapId(e){if(!this.snapid)return"";let s=this.snapid.toString();return e&&(s+="#",this.isTF1()&&(e==="x"||e==="y"||e==="z")&&(s+="hist#"),s+=e),s}autoZoom(){}clickButton(e){let s=this.getFramePainter();if(!this.isMainPainter()||!s)return!1;switch(e){case"ToggleZoom":if(s.zoom_xmin!==s.zoom_xmax||s.zoom_ymin!==s.zoom_ymax||s.zoom_zmin!==s.zoom_zmax){let t=s.unzoom();return s.zoomChangedInteractive("reset"),t}if(this.draw_content)return this.autoZoom();break;case"ToggleLogX":return s.toggleAxisLog("x");case"ToggleLogY":return s.toggleAxisLog("y");case"ToggleLogZ":return s.toggleAxisLog("z");case"ToggleStatBox":return E(this.toggleStat());case"ToggleColorZ":return this.toggleColz()}return!1}fillToolbar(e){let s=this.getPadPainter();s&&(s.addPadButton("auto_zoom","Toggle between unzoom and autozoom-in","ToggleZoom","Ctrl *"),s.addPadButton("arrow_right","Toggle log x","ToggleLogX","PageDown"),s.addPadButton("arrow_up","Toggle log y","ToggleLogY","PageUp"),this.getDimension()>1&&s.addPadButton("arrow_diag","Toggle log z","ToggleLogZ"),s.addPadButton("statbox","Toggle stat box","ToggleStatBox"),e||s.showPadButtons())}get3DToolTip(e){let s=this.getHisto(),t={bin:e,name:s.fName,title:s.fTitle};switch(this.getDimension()){case 1:t.ix=e,t.iy=1,t.value=s.getBinContent(t.ix),t.error=s.getBinError(e),t.lines=this.getBinTooltips(e-1);break;case 2:t.ix=e%(this.nbinsx+2),t.iy=(e-t.ix)/(this.nbinsx+2),t.value=s.getBinContent(t.ix,t.iy),t.error=s.getBinError(e),t.lines=this.getBinTooltips(t.ix-1,t.iy-1);break;case 3:t.ix=e%(this.nbinsx+2),t.iy=(e-t.ix)/(this.nbinsx+2)%(this.nbinsy+2),t.iz=(e-t.ix-t.iy*(this.nbinsx+2))/(this.nbinsx+2)/(this.nbinsy+2),t.value=s.getBinContent(t.ix,t.iy,t.iz),t.error=s.getBinError(e),t.lines=this.getBinTooltips(t.ix-1,t.iy-1,t.iz-1);break}return t}createContour(e,s,t,r,n){let o=new U(s,t),i=this.getDimension(),a=this.isTH2Poly(),f=this.getFramePainter();if(n)o.createCustom(n);else{e<2&&(e=d.fNumberContours);let c=this.getPadPainter().getRootPad(!0),l=c?.fLogv??(i===2&&c?.fLogz);o.createNormal(e,l??0,r)}return o.configIndicies(this.options.Zero&&!a?-1:0,o.colzmin!==0||!this.options.Zero||a?0:-1),f&&i<3&&!f.mode3d&&(f.zmin=o.colzmin,f.zmax=o.colzmax),this.fContour=o,o}getContour(e){if(this.fContour&&!e)return this.fContour;let s=this.getMainPainter(),t=this.getFramePainter();if(s?.fContour&&s!==this&&!this.options.IgnoreMainScale)return this.fContour=s.fContour,this.fContour;let r=this.getObject(),n=this!==s&&s?.minbin!==void 0&&!this.options.IgnoreMainScale&&!s?.tt_handle?.ScatterPlot?s:this,o=0,i,a=n.minbin,f=n.maxbin,c=n.minposbin,l;a===f&&(this.options.ohmin&&this.options.ohmax&&this.options.Zscale?(a=this.options.hmin,f=this.options.hmax,c=Math.max(a,f*1e-10)):(a=n.gminbin,f=n.gmaxbin,c=n.gminposbin));let h=a,u=f;if(this.options.minimum!==g&&(a=this.options.minimum,h=Math.min(h,a),i=!0),this.options.maximum!==g&&(f=this.options.maximum,u=Math.max(u,f),i=!1),a>=f&&(i||!a?f=a+1:a=f-1),t?.zoomChangedInteractive("z")){let C=t.zoom_zmin!==t.zoom_zmax;a=C?t.zoom_zmin:h,f=C?t.zoom_zmax:u}r.fContour?.length>1&&(r.TestBit(_t)?l=r.fContour:o=r.fContour.length);let x=this.createContour(o,a,f,c,l);return this.getDimension()<3&&t&&(t.zmin=h,t.zmax=u,h!==x.colzmin||u!==x.colzmax?(t.zoom_zmin=x.colzmin,t.zoom_zmax=x.colzmax):t.zoom_zmin=t.zoom_zmax=0),x}getContourLevels(e){return this.getContour(e).getLevels()}getHistPalette(e){e&&(this._color_palette=null);let s=this.getPadPainter();return!this._color_palette&&!this.options.Palette&&p(s?.getCustomPalette)&&(this._color_palette=s.getCustomPalette()),this._color_palette||(this._color_palette=et(this.options.Palette,s?.isGrayscale())),this._color_palette}fillPaletteMenu(e,s){if(e.addPaletteMenu(this.options.Palette||N.Palette,t=>{this.options.Palette=parseInt(t),this.getHistPalette(!0),this.redraw()}),!s){e.add("Default position",()=>{this.drawColorPalette(this.options.Zscale,!1,!0).then(()=>this.processOnlineChange("drawopt"))},"Set default position for palette");let t=this.findFunction(S),r=t?t.fX2NDC-t.fX1NDC<t.fY2NDC-t.fY1NDC:!0;e.addchk(r,"Vertical",n=>{this.options.Zvert=n,this.drawColorPalette(this.options.Zscale,!1,"toggle").then(()=>this.processOnlineChange("drawopt"))},"Toggle palette vertical/horizontal flag"),e.add("Bring to front",()=>this.getPadPainter()?.findPainterFor(t)?.bringToFront())}}drawColorPalette(e,s,t){return T(this,null,function*(){if(this.options.IgnorePalette)return null;let r=this.getMainPainter(),n=this.getPadPainter();if(r!==this&&r&&r.draw_content!==!1&&r.options.Zscale)return null;let o=this.findFunction(S),i=n?.findPainterFor(o),a=!!o;if(this._can_move_colz&&(delete this._can_move_colz,t||(t=!0)),!i&&!o&&!this.options.Axis&&(i=n?.findPainterFor(void 0,void 0,S),i&&(o=i.getObject(),this.addFunction(o,!0))),!e)return i&&!this.options.Same&&(this.options.Zvert=i._palette_vertical,i.Enabled=!1,i.removeG()),null;if(o)i?._palette_vertical!==void 0&&(this.options.Zvert=i._palette_vertical);else{if(o=D(S),t||(t=!this.options.Same),o.fInit=1,o.$can_move=t,o.$generated=!0,this.options.Zvert?Object.assign(o,{fX1NDC:1.005-d.fPadRightMargin,fX2NDC:1.045-d.fPadRightMargin,fY1NDC:d.fPadBottomMargin,fY2NDC:1-d.fPadTopMargin}):Object.assign(o,{fX1NDC:d.fPadLeftMargin,fX2NDC:1-d.fPadRightMargin,fY1NDC:1.005-d.fPadTopMargin,fY2NDC:1.045-d.fPadTopMargin}),Object.assign(o.fAxis,{fChopt:"+",fLineSyle:1,fLineWidth:1,fTextAngle:0,fTextAlign:11}),this.getDimension()===2){let h=this.getHisto().fZaxis;Object.assign(o.fAxis,{fTitle:h.fTitle,fTitleSize:h.fTitleSize,fTitleOffset:h.fTitleOffset,fTitleColor:h.fTitleColor,fLineColor:h.fAxisColor,fTextSize:h.fLabelSize,fTextColor:h.fLabelColor,fTextFont:h.fLabelFont,fLabelOffset:h.fLabelOffset})}this.addFunction(o,!0)}let f=this.getFramePainter();if(t&&f&&o.$can_move)if(this.options.Zvert){if(t==="toggle"){let h=o.fY2NDC-o.fY1NDC;o.fX1NDC=f.fX2NDC+.005,o.fX2NDC=o.fX1NDC+h}o.fX1NDC>(f.fX1NDC+f.fX2NDC)*.5?(o.fX2NDC=f.fX2NDC+.005+(o.fX2NDC-o.fX1NDC),o.fX1NDC=f.fX2NDC+.005):(o.fX1NDC=f.fX1NDC-.03-(o.fX2NDC-o.fX1NDC),o.fX2NDC=f.fX1NDC-.03),o.fY1NDC=f.fY1NDC,o.fY2NDC=f.fY2NDC}else{if(t==="toggle"){let h=o.fX2NDC-o.fX1NDC;o.fY1NDC=f.fY2NDC+.005,o.fY2NDC=o.fY1NDC+h}o.fX1NDC=f.fX1NDC,o.fX2NDC=f.fX2NDC,o.fY2NDC>(f.fY1NDC+f.fY2NDC)*.5?(o.fY2NDC=f.fY2NDC+.005+(o.fY2NDC-o.fY1NDC),o.fY1NDC=f.fY2NDC+.005):(o.fY1NDC=f.fY1NDC-.05-(o.fY2NDC-o.fY1NDC),o.fY2NDC=f.fY1NDC-.05)}o.$main_painter=this;let c="bring_stats_front",l;if(s&&(c+=";postpone"),t&&!this.do_redraw_palette&&(c+=";can_move"),this.options.Cjust&&(c+=";cjust"),!i)l=k.draw(n,o,c).then(h=>{i=h,i.setSecondaryId(this,a&&!o.$generated?`func_${o.fName}`:void 0)});else{if(i.Enabled=!0,s)return i;l=i.drawPave(c)}return l.then(()=>{this.options.Zvert=i._palette_vertical,i.redraw=()=>{};let h=!1;if(t&&f&&!this.do_redraw_palette){let x=n?.getRootPad(!0);this.options.Zvert?(o.fX1NDC>.5&&f.fX2NDC>o.fX1NDC?(h=!0,f.fX2NDC=o.fX1NDC-.01,f.fX1NDC>f.fX2NDC-.1&&(f.fX1NDC=Math.max(0,f.fX2NDC-.1))):o.fX2NDC<.5&&f.fX1NDC<o.fX2NDC&&(h=!0,f.fX1NDC=o.fX2NDC+.05,f.fX2NDC<f.fX1NDC+.1&&(f.fX2NDC=Math.min(1,f.fX1NDC+.1))),h&&x&&(x.fLeftMargin=f.fX1NDC,x.fRightMargin=1-f.fX2NDC)):(o.fY1NDC>.5&&f.fY2NDC>o.fY1NDC?(h=!0,f.fY2NDC=o.fY1NDC-.01,f.fY1NDC>f.fY2NDC-.1&&(f.fY1NDC=Math.max(0,f.fXYNDC-.1))):o.fY2NDC<.5&&f.fY1NDC<o.fY2NDC&&(h=!0,f.fY1NDC=o.fY2NDC+.05,f.fXYNDC<f.fY1NDC+.1&&(f.fY2NDC=Math.min(1,f.fY1NDC+.1))),h&&x&&(x.fTopMargin=f.fY1NDC,x.fBottomMargin=1-f.fY2NDC))}return h?(this.do_redraw_palette=!0,f.redraw(),(s?Promise.resolve(!0):this.redraw()).then(()=>(delete this.do_redraw_palette,i))):i})})}toggleColz(){if(this.options.canHavePalette())return this.options.Zscale=!this.options.Zscale,this.drawColorPalette(this.options.Zscale,!1,!0).then(()=>this.processOnlineChange("drawopt"))}toggleMode3D(){return this.options.Mode3D=!this.options.Mode3D,this.options.Mode3D&&!this.options.Surf&&!this.options.Lego&&!this.options.Error&&(this.nbinsx>=50||this.nbinsy>=50?this.options.Lego=this.options.Scat?13:14:this.options.Lego=this.options.Scat?1:12,this.options.Zero=!1),this.copyOptionsToOthers(),this.interactiveRedraw("pad","drawopt")}getHistGrFuncs(e,s=!0){if(!this._ignore_frame)return e?.getGrFuncs(this.options.second_x,this.options.second_y);let t=this.getAxisToSvgFunc(!1,s,!1);return t&&(t.painter=this,t.grx=t.x,t.gry=t.y,t.logx=t.pad?.fLogx,t.logy=t.pad?.fLogy,t.getFrameWidth=function(){return this.painter.getPadPainter().getPadWidth()},t.getFrameHeight=function(){return this.painter.getPadPainter().getPadHeight()},t.revertAxis=function(r,n){return this.painter.svgToAxis(r,n)},t.axisAsText=function(r,n){return n.toString()}),t}prepareDraw(e){e||(e={rounding:!0,extra:0,middle:0}),e.extra===void 0&&(e.extra=0),e.middle===void 0&&(e.middle=0);let s=this.getHisto(),t=s.fXaxis,r=s.fYaxis,n=this._ignore_frame?null:this.getFramePainter(),o=this.getDimension(),i={i1:e.nozoom?0:this.getSelectIndex("x","left",0-e.extra),i2:e.nozoom?this.nbinsx:this.getSelectIndex("x","right",1+e.extra),j1:o===1||e.nozoom?0:this.getSelectIndex("y","left",0-e.extra),j2:o===1?1:e.nozoom?this.nbinsy:this.getSelectIndex("y","right",1+e.extra),min:0,max:0,sumz:0,xbar1:0,xbar2:1,ybar1:0,ybar2:1,width:n?.getFrameWidth()??600,height:n?.getFrameHeight()??400};if(e.cutg){let w=i.i2,M=i.i1,b=i.j2,I=i.j1;for(let y=i.i1;y<i.i2;++y)for(let L=i.j1;L<i.j2;++L)e.cutg.IsInside(t.GetBinCoord(y+e.middle),r.GetBinCoord(L+e.middle))&&(w=Math.min(w,y),M=Math.max(M,y+1),b=Math.min(b,L),I=Math.max(I,L+1));i.i1=w,i.i2=M,i.j1=b,i.j2=I}let a,f,c,l,h,u;i.grx=i.i1<0?{}:new Float32Array(i.i2+1),i.gry=i.j1<0?{}:new Float32Array(i.j2+1),typeof s.fBarOffset=="number"&&typeof s.fBarWidth=="number"&&(s.fBarOffset||s.fBarWidth!==1e3)&&(s.fBarOffset<=1e3?i.xbar1=i.ybar1=.001*s.fBarOffset:s.fBarOffset<=3e3?i.xbar1=.001*(s.fBarOffset-2e3):s.fBarOffset<=5e3&&(i.ybar1=.001*(s.fBarOffset-4e3)),s.fBarWidth<=1e3?(i.xbar2=Math.min(1,i.xbar1+.001*s.fBarWidth),i.ybar2=Math.min(1,i.ybar1+.001*s.fBarWidth)):s.fBarWidth<=3e3?i.xbar2=Math.min(1,i.xbar1+.001*(s.fBarWidth-2e3)):s.fBarWidth<=5e3&&(i.ybar2=Math.min(1,i.ybar1+.001*(s.fBarWidth-4e3)))),e.original&&(i.original=!0,i.origx=i.i1<0?{}:new Float32Array(i.i2+1),i.origy=i.j1<0?{}:new Float32Array(i.j2+1)),e.pixel_density&&(e.rounding=!0);let x=this.getHistGrFuncs(n,e.rounding);if(!x)return console.warn("cannot draw histogram without frame or pad"),i;for(a=i.i1;a<=i.i2;++a){if(c=t.GetBinCoord(a+e.middle),x.logx&&c<=0){i.i1=a+1;continue}i.origx&&(i.origx[a]=c),i.grx[a]=x.grx(c),e.rounding&&(i.grx[a]=Math.round(i.grx[a])),e.use3d&&(i.grx[a]<-n.size_x3d&&(i.grx[a]=-n.size_x3d,this.options.RevX?i.i2=a:i.i1=a),i.grx[a]>n.size_x3d&&(i.grx[a]=n.size_x3d,this.options.RevX?i.i1=a:i.i2=a))}if(o===1)i.gry[0]=x.gry(0),i.gry[1]=x.gry(1);else for(f=i.j1;f<=i.j2;++f){if(l=r.GetBinCoord(f+e.middle),x.logy&&l<=0){i.j1=f+1;continue}i.origy&&(i.origy[f]=l),i.gry[f]=x.gry(l),e.rounding&&(i.gry[f]=Math.round(i.gry[f])),e.use3d&&(i.gry[f]<-n.size_y3d&&(i.gry[f]=-n.size_y3d,this.options.RevY?i.j2=f:i.j1=f),i.gry[f]>n.size_y3d&&(i.gry[f]=n.size_y3d,this.options.RevY?i.j1=f:i.j2=f))}let C=!0;for(this.minposbin=0,a=i.i1;a<i.i2;++a)for(f=i.j1;f<i.j2;++f){if(h=s.getBinContent(a+1,f+1),i.sumz+=h,e.pixel_density){if(u=(i.grx[a+1]-i.grx[a])*(i.gry[f]-i.gry[f+1]),u<=0)continue;i.max=Math.max(i.max,h),h>0&&(h<i.min||i.min===0)&&(i.min=h),h/=u}C?(this.maxbin=this.minbin=h,C=!1):(this.maxbin=Math.max(this.maxbin,h),this.minbin=Math.min(this.minbin,h)),h>0&&(this.minposbin===0||h<this.minposbin)&&(this.minposbin=h)}return C&&(this.maxbin=this.minbin=0),this.fContour=null,i}getAxisBinTip(e,s,t){let r=this.getFramePainter(),n=r.getGrFuncs(this.options.second_x,this.options.second_y),o=n[`${e}_handle`],i=s.GetBinLowEdge(t+1);if(o.kind===ot)return n.axisAsText(e,i);let a=s.GetBinLowEdge(t+2);return o.kind===rt||this.isTF1()?n.axisAsText(e,(i+a)/2):`[${n.axisAsText(e,i)}, ${n.axisAsText(e,a)})`}getBinErrors(e,s,t){let r=e.getBinError(s),n={low:r,up:r},o=this.options.Poisson||e.fBinStatErrOpt;if(!o||e.fSumw2.fN&&e.fTsumw!==e.fTsumw2)return n;let i=o===xt?.05:1-.682689492,a=Math.round(t);return t<0||(n.poisson=!0,a===0?n.low=0:n.low=t-at(i/2,a,1),n.up=ft(i/2,a+1,1)-t),n}static _drawHist(e,s){return T(this,null,function*(){return ht(e).then(()=>(e.decodeOptions(s),e.options.Same?e._ignore_frame=!e.getPadPainter()?.getMainPainter():e.setAsMainPainter(),e.isTH2Poly()&&e.options.Mode3D&&(e.options.Lego=12),e.checkPadRange(),e.scanContent(),e.createStat(),e.callDrawFunc())).then(()=>e.drawFunctions()).then(()=>e.drawHistTitle()).then(()=>{if(!e.Mode3D&&e.options.AutoZoom)return e.autoZoom()}).then(()=>{if(e.options.Project&&!e.mode3d&&p(e.toggleProjection))return e.toggleProjection(e.options.Project)}).then(()=>(e.fillToolbar(),e))})}};export{G as a,ct as b,dt as c,gt as d,pt as e,U as f,B as g,mt as h};

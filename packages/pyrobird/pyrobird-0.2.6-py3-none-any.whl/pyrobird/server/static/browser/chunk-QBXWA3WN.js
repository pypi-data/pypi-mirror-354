import{a as G}from"./chunk-J5ATPEI3.js";import{b as X}from"./chunk-Z4ZYSIRC.js";import"./chunk-3L3RRFVB.js";import{ha as F}from"./chunk-FVXVO67X.js";import{Da as l,f as T,ib as C,ya as k}from"./chunk-KYOHYQWH.js";import{k as g}from"./chunk-KYPE3LET.js";var y="upper_pad",w="lower_pad",$="top_pad",b=class L extends F{setGridsRange(e,a,n,i,f){let r=this.getObject();if(e===a){let t=this.getPadPainter()?.findPainterFor(r.fLowerPad,w,l)?.getFramePainter()?.x_handle;if(!t)return;e===0?(e=t.full_min,a=t.full_max):(e=t.scale_min,a=t.scale_max)}r.fGridlines.forEach(t=>{t.fX1=e,t.fX2=a});let o=Math.min(r.fGridlines.length,r.fGridlinePositions.length);for(let t=0;t<o;++t){let d=r.fGridlinePositions[t],s=r.fGridlines[t];n!=="ignorey"&&(s.$do_not_draw=n!==i&&(d<n||d>i),s.fY1=s.fY2=d),f?.findPainterFor(s)?.redraw()}}configureInteractive(){let e=this.getObject(),a=this.getPadPainter(),n=a.findPainterFor(e.fUpperPad,y,l),i=n?.getFramePainter(),f=a.findPainterFor(e.fLowerPad,w,l),r=f?.getFramePainter();!n||!f||(f.forEachPainterInPad(o=>{T(o?.testEditable)&&o.testEditable(!1)}),this.setGridsRange(r.scale_xmin,r.scale_xmax,r.scale_ymin,r.scale_ymax,f),!(n._ratio_interactive&&f._ratio_interactive)&&(n._ratio_interactive=!0,f._ratio_interactive=!0,i.o_zoom=i.zoom,i._ratio_low_fp=r,i._ratio_painter=this,i.zoom=function(o,t,d,s,_,c){return this.o_zoom(o,t,d,s,_,c).then(u=>(this._ratio_painter.setGridsRange(i.scale_xmin,i.scale_xmax,"ignory"),this._ratio_low_fp.o_zoom(i.scale_xmin,i.scale_xmax).then(()=>u)))},i.o_sizeChanged=i.sizeChanged,i.sizeChanged=function(){this.o_sizeChanged(),this._ratio_low_fp.fX1NDC=this.fX1NDC,this._ratio_low_fp.fX2NDC=this.fX2NDC,this._ratio_low_fp.o_sizeChanged()},r.o_zoom=r.zoom,r._ratio_up_fp=i,r._ratio_painter=this,r.zoom=function(o,t,d,s,_,c){return o===t?(o=i.xmin,t=i.xmax):(o<i.xmin&&(o=i.xmin),t>i.xmax&&(t=i.xmax)),this._ratio_painter.setGridsRange(o,t,d,s),this._ratio_up_fp.o_zoom(o,t).then(()=>this.o_zoom(o,t,d,s,_,c))},r.o_sizeChanged=r.sizeChanged,r.sizeChanged=function(){this.o_sizeChanged(),this._ratio_up_fp.fX1NDC=this.fX1NDC,this._ratio_up_fp.fX2NDC=this.fX2NDC,this._ratio_up_fp.o_sizeChanged()}))}redrawOld(){return g(this,null,function*(){let e=this.getObject(),a=this.getPadPainter(),n=a.findPainterFor(e.fTopPad,$,l),i=a.getRootPad(),f=i.fFrameFillStyle===0?1:0,r=i.fTickx||f,o=i.fTicky||f;n?.disablePadDrawing();let t=a.findPainterFor(e.fUpperPad,y,l),d=t?.getMainPainter(),s=t?.getFramePainter(),_=a.findPainterFor(e.fLowerPad,w,l),c=_?.getMainPainter(),u=_?.getFramePainter(),m=Promise.resolve(!0);if(t&&d&&s&&u&&!t._ratio_configured){t._ratio_configured=!0,d.options.Axis=0;let h=d.getHisto();h.fYaxis.$use_top_pad=!0,h.fXaxis.fLabelSize=0,h.fXaxis.fTitle="",t.getRootPad().fTickx=r,t.getRootPad().fTicky=o,m=t.redrawPad()}return m.then(()=>{if(!_||!c||!u||!s||_._ratio_configured)return this;_._ratio_configured=!0,c.options.Axis=0;let h=c.getHisto();h.fXaxis.fTitle="x",h.fXaxis.$use_top_pad=!0,h.fYaxis.$use_top_pad=!0,_.getRootPad().fTickx=r,_.getRootPad().fTicky=o;let z=[];return e.fGridlinePositions.length>0&&e.fGridlines.length<e.fGridlinePositions.length&&e.fGridlinePositions.forEach(P=>{let x=!1;if(e.fGridlines.forEach(p=>{p.fY1===p.fY2&&Math.abs(p.fY1-P)<1e-6&&(x=!0)}),!x){let p=C(k);p.fX1=s.scale_xmin,p.fX2=s.scale_xmax,p.fY1=p.fY2=P,p.fLineStyle=2,e.fGridlines.push(p),z.push(G.draw(_,p))}}),Promise.all(z).then(()=>u.zoomSingle("x",s.scale_xmin,s.scale_xmax)).then(P=>P?!0:_.redrawPad()).then(()=>this)})})}redraw(){return g(this,null,function*(){let e=this.getObject(),a=this.getPadPainter();if(this.$oldratio===void 0&&(this.$oldratio=!!a.findPainterFor(e.fTopPad,$,l)),a.$userInteractive=()=>this.configureInteractive(),this.$oldratio)return this.redrawOld();let n=a.getRootPad(),i=n.fFrameFillStyle===0?1:0,f=n.fTickx||i,r=n.fTicky||i;return e.fTopPad.$disable_drawing=!0,e.fUpperPad.$ratio_pad="up",e.fUpperPad.fTickx=f,e.fUpperPad.fTicky=r,e.fLowerPad.$ratio_pad="low",e.fLowerPad.fTickx=f,e.fLowerPad.fTicky=r,this})}static draw(e,a,n){return g(this,null,function*(){let i=new L(e,a,n);return X(i,!1).then(()=>i.redraw())})}};export{b as TRatioPlotPainter};

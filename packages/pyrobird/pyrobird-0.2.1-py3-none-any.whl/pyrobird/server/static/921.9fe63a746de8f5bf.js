"use strict";(self.webpackChunkfirebird=self.webpackChunkfirebird||[]).push([[921],{921:(mt,ft,H)=>{H.r(ft),H.d(ft,{TGraph2DPainter:()=>it});var U=H(467),v=H(6998),ht=H(9041),ct=H(675),ut=H(4149),dt=H(4571),b=H(3366),rt=H(9407);function nt(F){let t=F[0];for(let s=1;s<F.length;++s)t=Math.max(t,F[s]);return t}function lt(F){let t=F[0];for(let s=1;s<F.length;++s)t=Math.min(t,F[s]);return t}class Yt{constructor(t){this.fGraph2D=t,this.fX=t.fX,this.fY=t.fY,this.fZ=t.fZ,this.fNpoints=t.fNpoints,this.fZout=0,this.fNdt=0,this.fNhull=0,this.fHullPoints=null,this.fXN=null,this.fYN=null,this.fOrder=null,this.fDist=null,this.fPTried=null,this.fNTried=null,this.fMTried=null,this.fInit=!1,this.fXNmin=0,this.fXNmax=0,this.fYNmin=0,this.fYNmax=0,this.fXoffset=0,this.fYoffset=0,this.fXScaleFactor=0,this.fYScaleFactor=0,this.SetMaxIter()}Initialize(){this.fInit||(this.CreateTrianglesDataStructure(),this.FindHull(),this.fInit=!0)}ComputeZ(t,s){this.Initialize();const f=(t+this.fXoffset)*this.fXScaleFactor,i=(s+this.fYoffset)*this.fYScaleFactor;let o=this.Interpolate(f,i);return 0===o&&(o=this.Interpolate(f+1e-4,i)),o}CreateTrianglesDataStructure(){const t=nt(this.fGraph2D.fX),s=nt(this.fGraph2D.fY),f=lt(this.fGraph2D.fX),i=lt(this.fGraph2D.fY);this.fXoffset=-(t+f)/2,this.fYoffset=-(s+i)/2,this.fXScaleFactor=1/(t-f),this.fYScaleFactor=1/(s-i),this.fXNmax=(t+this.fXoffset)*this.fXScaleFactor,this.fXNmin=(f+this.fXoffset)*this.fXScaleFactor,this.fYNmax=(s+this.fYoffset)*this.fYScaleFactor,this.fYNmin=(i+this.fYoffset)*this.fYScaleFactor,this.fXN=new Array(this.fNpoints+1),this.fYN=new Array(this.fNpoints+1);for(let o=0;o<this.fNpoints;o++)this.fXN[o+1]=(this.fX[o]+this.fXoffset)*this.fXScaleFactor,this.fYN[o+1]=(this.fY[o]+this.fYoffset)*this.fYScaleFactor;this.fPTried=[],this.fNTried=[],this.fMTried=[]}Enclose(t,s,f,i){const o=[this.fXN[t],this.fXN[s],this.fXN[f],this.fXN[t]],r=[this.fYN[t],this.fYN[s],this.fYN[f],this.fYN[t]],a=this.fXN[i],n=this.fYN[i];let p=0,d=o.length-1,u=!1;for(;p<o.length;++p)(r[p]<n&&r[d]>=n||r[d]<n&&r[p]>=n)&&o[p]+(n-r[p])/(r[d]-r[p])*(o[d]-o[p])<a&&(u=!u),d=p;return u}FileIt(t,s,f){let i,o,r=t,a=s,n=f;do{i=!1,a>r&&(o=r,r=a,a=o,i=!0),n>a&&(o=a,a=n,n=o,i=!0)}while(i);this.fNdt++,this.fPTried.push(r),this.fNTried.push(a),this.fMTried.push(n)}FindAllTriangles(){if(this.fAllTri)return;this.fAllTri=!0;let t,s,f,i,o,r,a,n,p,d,u,X,e,l,c,h,N,Y,_,g,x,T,M,E,y,P=0,m=0,Z=0;const z=[!1,!1,!1],I=1e-4;for(this.Initialize(),t=0,s=0,y=1;y<=this.fNhull;y++)t+=this.fXN[this.fHullPoints[y-1]],s+=this.fYN[this.fHullPoints[y-1]];for(t=t/this.fNhull+I,s=s/this.fNhull+I,this.Interpolate(t,s),h=1;h<=this.fNdt;){for(Y=this.fPTried[h-1],_=this.fNTried[h-1],g=this.fMTried[h-1],z[0]=!1,z[1]=!1,z[2]=!1,N=1;N<=this.fNdt;N++)N!==h&&(x=this.fPTried[N-1],T=this.fNTried[N-1],M=this.fMTried[N-1],Y===x&&_===T||Y===x&&_===M||Y===T&&_===M?z[0]=!0:Y===x&&g===T||Y===x&&g===M||Y===T&&g===M?z[1]=!0:(_===x&&g===T||_===x&&g===M||_===T&&g===M)&&(z[2]=!0));for(E=1;E<=3;E++)z[E-1]||(1===E?(P=Y,m=_,Z=g):2===E?(P=Y,m=g,Z=_):3===E&&(P=_,m=g,Z=Y),f=(this.fXN[P]+this.fXN[m])/2,i=(this.fYN[P]+this.fYN[m])/2,a=this.fXN[P]-this.fXN[m],n=this.fYN[P]-this.fYN[m],p=n,d=-a,l=Math.sqrt(p*p+d*d),p/=l,d/=l,u=this.fXN[Z]-f,X=this.fYN[Z]-i,e=u*p+X*d,e>0&&(p=-p,d=-d),c=Math.abs(Math.max(I*f,I*i)),o=f+p*c,r=i+d*c,this.Interpolate(o,r));h++}}FindHull(){this.fHullPoints||(this.fHullPoints=new Array(this.fNpoints));let t=0;for(let s=1;s<=this.fNpoints;s++)this.InHull(s,s)||(t++,this.fHullPoints[t-1]=s);this.fNhull=t}InHull(t,s){let f,i,o,r,a,n,p,d,u,X,e,l,c,h,N,Y,_,g,x,T,M,P=!1;const m=this.fXN[t],E=this.fYN[t];for(a=this.fNhull>0?this.fNhull:this.fNpoints,f=1,i=2,f===s?(f=i,i++):i===s&&i++,u=m-this.fXN[f],l=E-this.fYN[f],X=m-this.fXN[i],c=E-this.fYN[i],x=Math.atan2(l,u),T=Math.atan2(c,X),M=x-T-Math.floor((x-T)/(2*Math.PI))*Math.PI*2,M<0&&(M+=2*Math.PI),n=M,o=1;o<=a;o++)if(r=this.fNhull>0?this.fHullPoints[o-1]:o,r!==f&&r!==i&&r!==s&&(u=m-this.fXN[f],l=E-this.fYN[f],X=m-this.fXN[i],c=E-this.fYN[i],e=m-this.fXN[r],h=E-this.fYN[r],p=X*l-u*c,d=u*c-X*l,p*d!=0&&(N=(X*h-e*c)/p,Y=(u*h-e*l)/d,N<0||Y<0))){if(_=(u*e+l*h)/Math.sqrt(u*u+l*l),g=(X*e+c*h)/Math.sqrt(X*X+c*c),_>g?(f=r,x=Math.atan2(h,e),T=Math.atan2(c,X)):(i=r,x=Math.atan2(l,u),T=Math.atan2(h,e)),M=x-T-Math.floor((x-T)/(2*Math.PI))*Math.PI*2,M<0&&(M+=2*Math.PI),(M-Math.PI)*(n-Math.PI)<0)return P=!0,P;n=M}return P}InterpolateOnPlane(t,s,f,i){let o,r,a=t,n=s,p=f;do{r=!1,n>a&&(o=a,a=n,n=o,r=!0),p>n&&(o=n,n=p,p=o,r=!0)}while(r);const d=this.fXN[a],u=this.fXN[n],X=this.fXN[p],e=this.fYN[a],l=this.fYN[n],c=this.fYN[p],h=this.fZ[a-1],N=this.fZ[n-1],Y=this.fZ[p-1],_=(h*(l-c)+N*(c-e)+Y*(e-l))/(d*(l-c)+u*(c-e)+X*(e-l)),g=(h*(u-X)+N*(X-d)+Y*(d-u))/(e*(u-X)+l*(X-d)+c*(d-u));return _*this.fXN[i]+g*this.fYN[i]+(h-_*d-g*e)}Interpolate(t,s){let f,i,o,r,a,n,p,d,u,X,e,l,c,h,N,Y,_,g,x,T,Z,z,I,O,G,k,D,A,R,W,L,S,j,C,w,q,J,st,Q,V,et,at,ot,M=0,P=0,m=0,E=0,y=0;const $=[0,0,0],K=[0,0,0];if(this.Initialize(),this.fOrder||(this.fOrder=new Array(this.fNpoints),this.fDist=new Array(this.fNpoints)),this.fXN[0]=t,this.fYN[0]=s,f=this.fZout,o=0,t>this.fXNmax||t<this.fXNmin||s>this.fYNmax||s<this.fYNmin)return f;for(i=1;i<=this.fNdt;i++)if(r=this.fPTried[i-1],a=this.fNTried[i-1],n=this.fMTried[i-1],this.Enclose(r,a,n,0))return f=this.InterpolateOnPlane(r,a,n,0),f;const Nt=this.InHull(0,-1);if(!Nt)return f;for(i=1;i<=this.fNpoints;i++)Z=this.fXN[i],z=this.fYN[i],this.fDist[i-1]=Math.sqrt((t-Z)*(t-Z)+(s-z)*(s-z));for(function Xt(F,t,s){const f=new Array(F);for(let i=0;i<F;++i)f[i]={v:t[i],i};f.sort((i,o)=>i.v<o.v?-1:i.v>o.v?1:0);for(let i=0;i<F;++i)s[i]=f[i].i}(this.fNpoints,this.fDist,this.fOrder),i=0;i<this.fNpoints;i++)this.fOrder[i]++;for(u=3;u<=this.fNpoints;u++)for(n=this.fOrder[u-1],d=2;d<=u-1;d++)for(a=this.fOrder[d-1],p=1;p<=d-1;p++){let B=!1;if(r=this.fOrder[p-1],o>this.fMaxIter)return f;if(o++,I=Math.sqrt((this.fXN[r]-this.fXN[a])**2+(this.fYN[r]-this.fYN[a])**2),O=Math.sqrt((this.fXN[r]-this.fXN[n])**2+(this.fYN[r]-this.fYN[n])**2),G=Math.sqrt((this.fXN[a]-this.fXN[n])**2+(this.fYN[a]-this.fYN[n])**2),!(I+O<=G||I+G<=O||O+G<=I)&&this.Enclose(r,a,n,0)){for(M=0,e=1;e<=this.fNpoints;e++)if(e!==r&&e!==a&&e!==n){for(X=1;X<=this.fNpoints;X++)if(this.fOrder[X-1]===e){if(!(X<p||X<d||X<u))break;if(this.Enclose(r,a,n,e)){B=!0;break}}if(B)break;if((this.fXN[r]-this.fXN[e])*(this.fYN[r]-this.fYN[a])==(this.fYN[r]-this.fYN[e])*(this.fXN[r]-this.fXN[a])?(Y=r,_=a):(this.fXN[r]-this.fXN[e])*(this.fYN[r]-this.fYN[n])==(this.fYN[r]-this.fYN[e])*(this.fXN[r]-this.fXN[n])?(Y=r,_=n):(this.fXN[a]-this.fXN[e])*(this.fYN[a]-this.fYN[n])==(this.fYN[a]-this.fYN[e])*(this.fXN[a]-this.fXN[n])?(Y=a,_=n):(Y=0,_=0),0!==Y){if(this.fXN[Y]!==this.fXN[_]){if((this.fXN[e]-this.fXN[Y])*(this.fXN[e]-this.fXN[_])<0){B=!0;break}(this.fXN[e]-this.fXN[Y])*(this.fXN[e]-this.fXN[_])==0&&console.warn(`Interpolate Two of these three points are coincident ${Y} ${_} ${e}`)}else{if((this.fYN[e]-this.fYN[Y])*(this.fYN[e]-this.fYN[_])<0){B=!0;break}(this.fYN[e]-this.fYN[Y])*(this.fYN[e]-this.fYN[_])==0&&console.warn(`Interpolate Two of these three points are coincident ${Y} ${_} ${e}`)}continue}if(B)break;for(l=n,h=r,N=a,$[0]=this.fXN[r]-this.fXN[e],K[0]=this.fYN[r]-this.fYN[e],$[1]=this.fXN[a]-this.fXN[e],K[1]=this.fYN[a]-this.fYN[e],$[2]=this.fXN[n]-this.fXN[e],K[2]=this.fYN[n]-this.fYN[e],X=1;X<=3;X++)if(q=$[X-1],J=$[X%3],st=$[(X+1)%3],Q=K[X-1],V=K[X%3],et=K[(X+1)%3],at=(et*J-st*V)*(Q*J-q*V),ot=(et*q-st*Q)*(V*q-J*Q),at>=0&&ot>=0){1===X?(l=n,h=r,N=a):2===X?(l=r,h=a,N=n):(l=a,h=n,N=r);break}if(j=((this.fXN[l]-this.fXN[h])*(this.fXN[e]-this.fXN[h])+(this.fYN[l]-this.fYN[h])*(this.fYN[e]-this.fYN[h]))/Math.sqrt(((this.fXN[l]-this.fXN[h])*(this.fXN[l]-this.fXN[h])+(this.fYN[l]-this.fYN[h])*(this.fYN[l]-this.fYN[h]))*((this.fXN[e]-this.fXN[h])*(this.fXN[e]-this.fXN[h])+(this.fYN[e]-this.fYN[h])*(this.fYN[e]-this.fYN[h]))),C=((this.fXN[N]-this.fXN[h])*(this.fXN[e]-this.fXN[h])+(this.fYN[N]-this.fYN[h])*(this.fYN[e]-this.fYN[h]))/Math.sqrt(((this.fXN[N]-this.fXN[h])*(this.fXN[N]-this.fXN[h])+(this.fYN[N]-this.fYN[h])*(this.fYN[N]-this.fYN[h]))*((this.fXN[e]-this.fXN[h])*(this.fXN[e]-this.fXN[h])+(this.fYN[e]-this.fYN[h])*(this.fYN[e]-this.fYN[h]))),w=((this.fXN[N]-this.fXN[h])*(this.fXN[l]-this.fXN[h])+(this.fYN[N]-this.fYN[h])*(this.fYN[l]-this.fYN[h]))/Math.sqrt(((this.fXN[N]-this.fXN[h])*(this.fXN[N]-this.fXN[h])+(this.fYN[N]-this.fYN[h])*(this.fYN[N]-this.fYN[h]))*((this.fXN[l]-this.fXN[h])*(this.fXN[l]-this.fXN[h])+(this.fYN[l]-this.fYN[h])*(this.fYN[l]-this.fYN[h]))),!(j>C||j>w)){if(A=Math.sqrt((this.fXN[e]-this.fXN[h])*(this.fXN[e]-this.fXN[h])+(this.fYN[e]-this.fYN[h])*(this.fYN[e]-this.fYN[h])),R=Math.sqrt((this.fXN[e]-this.fXN[N])*(this.fXN[e]-this.fXN[N])+(this.fYN[e]-this.fYN[N])*(this.fYN[e]-this.fYN[N])),W=Math.sqrt((this.fXN[l]-this.fXN[h])*(this.fXN[l]-this.fXN[h])+(this.fYN[l]-this.fYN[h])*(this.fYN[l]-this.fYN[h])),L=Math.sqrt((this.fXN[l]-this.fXN[N])*(this.fXN[l]-this.fXN[N])+(this.fYN[l]-this.fYN[N])*(this.fYN[l]-this.fYN[N])),k=((this.fXN[e]-this.fXN[h])*(this.fXN[e]-this.fXN[N])+(this.fYN[e]-this.fYN[h])*(this.fYN[e]-this.fYN[N]))/A/R,D=((this.fXN[l]-this.fXN[h])*(this.fXN[l]-this.fXN[N])+(this.fYN[l]-this.fYN[h])*(this.fYN[l]-this.fYN[N]))/W/L,S=k*Math.sqrt(1-D*D)+D*Math.sqrt(1-k*k),S<-1e-6){B=!0;break}Math.abs(S)<=1e-6&&(M++,P=e,m=l,E=h,y=N)}}if(!B)return M>0?(c=P,l=m,h=E,N=y,this.fZ[h-1]+this.fZ[N-1]>this.fZ[c-1]+this.fZ[l-1]?(g=r,x=a,T=n,this.FileIt(r,a,n),this.FileIt(c,h,N)):(g=l,x=c,T=this.Enclose(l,c,h,0)?h:N,this.FileIt(l,c,h),this.FileIt(l,c,N))):(this.FileIt(r,a,n),g=r,x=a,T=n),f=this.InterpolateOnPlane(g,x,T,0),f}}return Nt&&console.error(`Interpolate Point outside hull when expected inside: this point could be dodgy ${t}  ${s} ${o}`),f}SetMaxIter(t=1e5){this.fAllTri=!1,this.fMaxIter=t}SetMarginBinsContent(t){this.fZout=t}GetContourList(t){if(!this.fNdt)return null;let s,f,i,o,r,a,n,p,d,u,X,e,l,c,h,N,Y,_,g,x,M,P,m,E,T=0;const y=[0,0,0],Z=new Array(this.fNdt).fill(0),z=new Array(this.fNdt).fill(0),I=new Array(this.fNdt).fill(0),O=new Array(this.fNdt).fill(0);for(Y=0;Y<this.fNdt;Y++){if(y[0]=this.fPTried[Y],y[1]=this.fNTried[Y],y[2]=this.fMTried[Y],r=y[0]-1,a=y[1]-1,n=y[2]-1,p=this.fX[r],c=this.fX[r],d=this.fY[r],h=this.fY[r],u=this.fZ[r],N=this.fZ[r],_=g=x=0,this.fZ[a]<=u&&(u=this.fZ[a],p=this.fX[a],d=this.fY[a],_=1),this.fZ[a]>N&&(N=this.fZ[a],c=this.fX[a],h=this.fY[a],x=1),this.fZ[n]<=u&&(u=this.fZ[n],p=this.fX[n],d=this.fY[n],_=2),this.fZ[n]>N&&(N=this.fZ[n],c=this.fX[n],h=this.fY[n],x=2),0===_&&0===x)return console.error("GetContourList: wrong vertices ordering"),null;g=3-x-_,X=this.fX[y[g]-1],e=this.fY[y[g]-1],l=this.fZ[y[g]-1],t>=u&&t<=N&&(i=(t-u)/(N-u),M=i*(c-p)+p,P=i*(h-d)+d,t>=l&&t<=N?(f=(t-l)/(N-l),m=f*(c-X)+X,E=f*(h-e)+e):(o=(t-u)/(l-u),m=o*(X-p)+p,E=o*(e-d)+d),(M!==m||P!==E)&&(T++,Z[T-1]=M,z[T-1]=P,I[T-1]=m,O[T-1]=E))}const G=[],k=new Array(this.fNdt).fill(!1);let L,S,j,C,w,D=0,A=0,R=0,W=0;for(C=0;C<T;C++)if(!k[C]){for(S=j=!1,w=0;w<T;w++)C!==w&&(Z[C]===Z[w]&&z[C]===z[w]&&(S=!0),Z[C]===I[w]&&z[C]===O[w]&&(S=!0),I[C]===Z[w]&&O[C]===z[w]&&(j=!0),I[C]===I[w]&&O[C]===O[w]&&(j=!0));if(!S&&!j){s=[],s.push(Z[C],z[C]),s.push(I[C],O[C]),k[C]=!0,G.push(s);continue}if(!S||!j){for(s=[],S&&(D=Z[C],A=z[C],R=I[C],W=O[C]),j&&(D=I[C],A=O[C],R=Z[C],W=z[C]),s.push(R,W),k[C]=!0,w=0;;){for(L=!1;w<T&&k[w];)w++;if(D===Z[w]&&A===z[w]?(D=I[w],A=O[w],L=!0):D===I[w]&&A===O[w]&&(D=Z[w],A=z[w],L=!0),L)k[w]=!0,s.push(D,A),w=0;else if(++w>=T)break}G.push(s)}}for(C=0;C<T;C++)if(!k[C]){for(s=[],k[C]=!0,D=Z[C],A=z[C],w=0,s.push(D,A);;){for(;w<T&&k[w];)w++;if(L=!1,D===Z[w]&&A===z[w]?(D=I[w],A=O[w],L=!0):D===I[w]&&A===O[w]&&(D=Z[w],A=z[w],L=!0),L)k[w]=!0,s.push(D,A),w=0;else if(++w>=T)break}s.push(Z[C],z[C]),G.push(s)}return G}}function tt(F){let t=Math.floor(F.index/this.nvertex);if(t<0||t>=this.index.length)return null;const s=n=>n*n;t=this.index[t];const f=this.fp,i=this.graph;let o=f.grx(i.fX[t]),r=f.gry(i.fY[t]),a=f.grz(i.fZ[t]);if(this.check_next&&t+1<i.fX.length){const n=F.point,p=f.grx(i.fX[t+1]),d=f.gry(i.fY[t+1]),u=f.grz(i.fZ[t+1]);s(n.x-p)+s(n.y-d)+s(n.z-u)<s(n.x-o)+s(n.y-r)+s(n.z-a)&&(o=p,r=d,a=u,t++)}return{x1:o-this.scale0,x2:o+this.scale0,y1:r-this.scale0,y2:r+this.scale0,z1:a-this.scale0,z2:a+this.scale0,color:this.tip_color,lines:[this.tip_name,"pnt: "+t,"x: "+f.axisAsText("x",i.fX[t]),"y: "+f.axisAsText("y",i.fY[t]),"z: "+f.axisAsText("z",i.fZ[t])]}}class it extends ct.JW{decodeOptions(t){const s=new ht.nC(t);this.options||(this.options={});const f=this.options,i=this.getObject();s.check("FILL_","color")&&i&&(i.fFillColor=s.color),s.check("LINE_","color")&&i&&(i.fLineColor=s.color),s.check("SAME"),s.check("CONT5")?f.Contour=15:f.Triangles=s.check("TRI1")?11:s.check("TRI2")?10:s.check("TRIW")?1:s.check("TRI")?2:0,f.Line=s.check("LINE"),f.Error=s.check("ERR")&&(this.matchObjectType(v.clTGraph2DErrors)||this.matchObjectType(v.clTGraph2DAsymmErrors)),s.check("P0COL")?f.Color=f.Circles=f.Markers=!0:(f.Color=s.check("COL"),f.Circles=s.check("P0"),f.Markers=s.check("P")),f.Markers||(f.Color=!1),(f.Color||f.Triangles>=10||f.Contour)&&(f.Zscale=s.check("Z")),f.isAny=function(){return this.Markers||this.Error||this.Circles||this.Line||this.Triangles||f.Contour},f.Contour?f.Axis="":f.isAny()?(f.Axis="lego2",f.Zscale&&(f.Axis+="z")):f.Axis=t,this.storeDrawOpt(t)}createHistogram(){const t=this.getObject(),s=this.matchObjectType(v.clTGraph2DAsymmErrors);let f=t.fX[0],i=f,o=t.fY[0],r=o,a=t.fZ[0],n=a;for(let x=0;x<t.fNpoints;++x){const T=t.fX[x],M=t.fY[x],P=t.fZ[x];this.options.Error?(f=Math.min(f,T-(s?t.fEXlow[x]:t.fEX[x])),i=Math.max(i,T+(s?t.fEXhigh[x]:t.fEX[x])),o=Math.min(o,M-(s?t.fEYlow[x]:t.fEY[x])),r=Math.max(r,M+(s?t.fEYhigh[x]:t.fEY[x])),a=Math.min(a,P-(s?t.fEZlow[x]:t.fEZ[x])),n=Math.max(n,P+(s?t.fEZhigh[x]:t.fEZ[x]))):(f=Math.min(f,T),i=Math.max(i,T),o=Math.min(o,M),r=Math.max(r,M),a=Math.min(a,P),n=Math.max(n,P))}function p(x,T,M){return x<T?M*(T-x):Math.abs(x)<1e5?.02:.02*Math.abs(x)}const d=p(f,i,t.fMargin),u=p(o,r,t.fMargin),X=p(a,n,0);let e=f-d,l=i+d,c=o-u,h=r+u,N=a-X,Y=n+X;e<0&&f>=0&&(e=.98*f),l>0&&i<=0&&(l=0),c<0&&o>=0&&(c=.98*o),h>0&&r<=0&&(h=0),N<0&&a>=0&&(N=.98*a),Y>0&&n<=0&&(Y=0);const _=this.getObject();_.fMinimum!==v.kNoZoom&&(N=_.fMinimum),_.fMaximum!==v.kNoZoom&&(Y=_.fMaximum),this._own_histogram=!0;const g=(0,v.createHistogram)(v.clTH2D,_.fNpx,_.fNpy);if(g.fName=_.fName+"_h",(0,v.setHistogramTitle)(g,_.fTitle),g.fXaxis.fXmin=e,g.fXaxis.fXmax=l,g.fYaxis.fXmin=c,g.fYaxis.fXmax=h,g.fZaxis.fXmin=N,g.fZaxis.fXmax=Y,g.fMinimum=N,g.fMaximum=Y,g.fBits|=v.kNoStats,!this.options.isAny()){const x=this.buildDelaunay(_);if(x)for(let T=0;T<_.fNpx;++T){const M=e+(T+.5)/_.fNpx*(l-e);for(let P=0;P<_.fNpy;++P){const E=x.ComputeZ(M,c+(P+.5)/_.fNpy*(h-c));g.fArray[g.getBin(T+1,P+1)]=E}}}return g}buildDelaunay(t){return this._delaunay||(this._delaunay=new Yt(t),this._delaunay.FindAllTriangles(),this._delaunay.fNdt||delete this._delaunay),this._delaunay}drawTriangles(t,s,f,i){const o=this.buildDelaunay(s);if(!o)return;const r=t.logz?u=>u<t.scale_zmin?-.1:t.grz(u):t.grz,a=2===this.options.Triangles,n=this.options.Triangles>=10||a,p=this.options.Triangles%10==1||a&&s.fLineColor!==s.fFillColor,d=new dt.N7(f,r,0,2*t.size_z3d,p);for(d.loop=0;d.loop<2;++d.loop){d.createBuffers();for(let u=0;u<o.fNdt;++u){const X=[o.fPTried[u],o.fNTried[u],o.fMTried[u]],e=[];let l=!0;for(let c=0;c<3;++c){const h=X[c]-1;e.push(t.grx(s.fX[h]),t.gry(s.fY[h]),r(s.fZ[h])),(s.fX[h]<t.scale_xmin||s.fX[h]>t.scale_xmax||s.fY[h]<t.scale_ymin||s.fY[h]>t.scale_ymax)&&(l=!1)}n&&l&&d.addMainTriangle(...e),p&&l&&(d.addLineSegment(e[0],e[1],e[2],e[3],e[4],e[5]),d.addLineSegment(e[3],e[4],e[5],e[6],e[7],e[8]),d.addLineSegment(e[6],e[7],e[8],e[0],e[1],e[2]))}}d.callFuncs((u,X)=>{const e=(0,rt.cD)(this.getMainPainter(),X,null,100,100),l=a?this.getColor(s.fFillColor):i.calcColor(u,f.length),c=new b.ZH.MeshBasicMaterial((0,b.Bx)(l,{side:b.ZH.DoubleSide,vertexColors:!1})),h=new b.ZH.Mesh(e,c);t.add3DMesh(h,this),h.painter=this},(u,X)=>{const e=this.getColor(s.fLineColor),l=new b.ZH.LineBasicMaterial({color:new b.ZH.Color(e),linewidth:s.fLineWidth}),c=(0,b.Fc)((0,rt.QK)(this.getMainPainter(),X,100,100),l);t.add3DMesh(c,this)})}updateObject(t,s){if(!this.matchObjectType(t))return!1;if(s&&s!==this.options.original&&this.decodeOptions(s,t),Object.assign(this.getObject(),t),delete this._delaunay,delete this.$redraw_hist,this.axes_draw){const f=this.getMainPainter();f?.updateObject(this.createHistogram(),this.options.Axis),this.$redraw_hist=f}return!0}redraw(){var t=this;return(0,U.A)(function*(){let s=Promise.resolve(!0);return t.$redraw_hist&&(s=t.$redraw_hist.redraw(),delete t.$redraw_hist),s.then(()=>t.drawGraph2D())})()}drawContour(t,s,f){var i=this;return(0,U.A)(function*(){const o=i.buildDelaunay(f);if(!o)return i;const r=s.getContour(),a=s.getHistPalette(),n=r.getLevels(),p=t.getGrFuncs();i.createG(!0),i.createAttLine({attr:f,nocolor:!0});for(let d=0;d<n.length;++d){const u=o.GetContourList(n[d]),X=r.getPaletteColor(a,n[d]);let e="";for(let l=0;l<u.length;++l){const c=u[l],h=[];for(let N=0;N<c.length;N+=2)h.push({grx:p.grx(c[N]),gry:p.gry(c[N+1])});e+=(0,ht.Mw)(h,{cmd:"M",line:!0})}i.lineatt.color=X,i.draw_g.append("svg:path").attr("d",e).style("fill","none").call(i.lineatt.func)}return i})()}drawGraph2D(){var t=this;return(0,U.A)(function*(){const s=t.getFramePainter(),f=t.getMainPainter(),i=t.getObject();if(!i||!f||!s)return t;if(t.options.Contour)return t.drawContour(s,f,i);if(!s.mode3d)return t;if(s.remove3DMeshes(t),!t.options.isAny()){if(f.draw_content)return t;1===i.fMarkerSize&&1===i.fMarkerStyle?t.options.Circles=!0:t.options.Markers=!0}const o=(X,e)=>{let l=0;for(let c=0;c<i.fNpoints;++c)i.fX[c]>=s.scale_xmin&&i.fX[c]<=s.scale_xmax&&i.fY[c]>=s.scale_ymin&&i.fY[c]<=s.scale_ymax&&i.fZ[c]>=X&&i.fZ[c]<e&&++l;return l};let r=1;if(v.settings.OptimizeDraw>0&&!s.webgl){const X=o(s.scale_zmin,s.scale_zmax),e=5e4;X>e&&(r=Math.floor(X/e),r<=2&&(r=2))}const a=t.createAttMarker({attr:i,std:!1}),n=[];let p=null,d=[s.scale_zmin,s.scale_zmax],u=s.size_x3d/100*a.getFullSize();t.options.Circles&&(u=.06*s.size_x3d),s.usesvg&&(u*=.3),u*=7*Math.max(s.size_x3d/s.getFrameWidth(),s.size_z3d/s.getFrameHeight()),(t.options.Color||t.options.Triangles>=10)&&(d=f.getContourLevels(!0),p=f.getHistPalette()),t.options.Triangles&&t.drawTriangles(s,i,d,p);for(let X=0;X<d.length-1;++X){const e=Math.max(d[X],s.scale_zmin),l=Math.min(d[X+1],s.scale_zmax);if(e>=l)continue;const c=Math.floor(o(e,l)/r),h=new Int32Array(c),N=t.options.Markers||t.options.Circles?new b._l(c,s.webgl,u/3):null,Y=t.options.Error?new Float32Array(6*c*3):null,_=Y&&t.matchObjectType(v.clTGraph2DAsymmErrors),g=t.options.Line?new Float32Array(6*(c-1)):null;let x=0,T=0,M=0,P=0;for(let m=0;m<i.fNpoints;++m){if(i.fX[m]<s.scale_xmin||i.fX[m]>s.scale_xmax||i.fY[m]<s.scale_ymin||i.fY[m]>s.scale_ymax||i.fZ[m]<e||i.fZ[m]>=l||r>1&&(x=(x+1)%r,0!==x))continue;h[T++]=m;const E=s.grx(i.fX[m]),y=s.gry(i.fY[m]),Z=s.grz(i.fZ[m]);N?.addPoint(E,y,Z),Y&&(Y[M]=s.grx(i.fX[m]-(_?i.fEXlow[m]:i.fEX[m])),Y[M+1]=y,Y[M+2]=Z,Y[M+3]=s.grx(i.fX[m]+(_?i.fEXhigh[m]:i.fEX[m])),Y[M+4]=y,Y[M+5]=Z,M+=6,Y[M]=E,Y[M+1]=s.gry(i.fY[m]-(_?i.fEYlow[m]:i.fEY[m])),Y[M+2]=Z,Y[M+3]=E,Y[M+4]=s.gry(i.fY[m]+(_?i.fEYhigh[m]:i.fEY[m])),Y[M+5]=Z,M+=6,Y[M]=E,Y[M+1]=y,Y[M+2]=s.grz(i.fZ[m]-(_?i.fEZlow[m]:i.fEZ[m])),Y[M+3]=E,Y[M+4]=y,Y[M+5]=s.grz(i.fZ[m]+(_?i.fEZhigh[m]:i.fEZ[m])),M+=6),g&&(P>=6&&(g[P]=g[P-3],g[P+1]=g[P-2],g[P+2]=g[P-1],P+=3),g[P]=E,g[P+1]=y,g[P+2]=Z,P+=3)}if(g&&P>3&&g.length===P){const m=t.getColor(i.fLineColor),E=new b.ZH.LineBasicMaterial({color:new b.ZH.Color(m),linewidth:i.fLineWidth}),y=(0,b.Fc)(g,E);s.add3DMesh(y,t),y.graph=i,y.index=h,y.fp=s,y.scale0=.7*u,y.tip_name=t.getObjectHint(),y.tip_color=3===i.fMarkerColor?16711680:65280,y.nvertex=2,y.check_next=!0,y.tooltip=tt}if(Y){const m=t.getColor(i.fLineColor),E=new b.ZH.LineBasicMaterial({color:new b.ZH.Color(m),linewidth:i.fLineWidth}),y=(0,b.Fc)(Y,E);s.add3DMesh(y,t),y.graph=i,y.index=h,y.fp=s,y.scale0=.7*u,y.tip_name=t.getObjectHint(),y.tip_color=3===i.fMarkerColor?16711680:65280,y.nvertex=6,y.tooltip=tt}if(N){let m="blue";(!t.options.Circles||t.options.Color)&&(m=p?.calcColor(X,d.length)??t.getColor(i.fMarkerColor));const E=N.createPoints({color:m,fill:t.options.Circles?"white":void 0,style:t.options.Circles?4:i.fMarkerStyle}).then(y=>{y.graph=i,y.fp=s,y.tip_color=3===i.fMarkerColor?16711680:65280,y.scale0=.3*u,y.index=h,y.tip_name=t.getObjectHint(),y.tooltip=tt,s.add3DMesh(y,t)});n.push(E)}}return Promise.all(n).then(()=>{const X=t.getMainPainter();if(!t.axes_draw&&!1!==X?.draw_content)return;const l=X?.findFunction(v.clTPaletteAxis),c=t.getPadPainter()?.findPainterFor(l);if(c){if(c.Enabled=t.options.Zscale,t.options.Zscale)return c.drawPave();c.removeG()}}).then(()=>(s.render3D(100),t))})()}static draw(t,s,f){return(0,U.A)(function*(){const i=new it(t,s);i.decodeOptions(f,s);let o=Promise.resolve(null);return i.getMainPainter()||(o=ut.TH2Painter.draw(t,i.createHistogram(),i.options.Axis),i.axes_draw=!0),o.then(()=>(i.addToPadPrimitives(),i.drawGraph2D()))})()}}}}]);
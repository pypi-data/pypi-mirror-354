"use strict";(self.webpackChunkfirebird=self.webpackChunkfirebird||[]).push([[3050],{3050:(wt,lt,F)=>{F.r(lt),F.d(lt,{RH1Painter:()=>rt});var S=F(467),T=F(6998),ht=F(5680),j=F(9041),gt=F(6563),mt=F(2928);class it extends gt.G{constructor(t,e){super(t,e),this.wheel_zoomy=!1}scanContent(t){const e=this.getHisto();if(!e)return;!this.nbinsx&&t&&(t=!1),t||this.extractAxesProperties(1);let r=0,s=0,i=0,o=0;if(this.isDisplayItem())r=e.fContMin,s=e.fContMinPos,i=e.fContMax,o=i;else{const a=this.getSelectIndex("x","left"),m=this.getSelectIndex("x","right");if(t&&a===this.scan_xleft&&m===this.scan_xright)return;this.scan_xleft=a,this.scan_xright=m;let c,x,w=!0;for(let n=0;n<this.nbinsx;++n)c=e.getBinContent(n+1),o+=c,!(n<a||n>=m)&&(c>0&&(0===s||c<s)&&(s=c),w&&(r=i=c,w=!1),x=0,r=Math.min(r,c-x),i=Math.max(i,c+x))}if(this.stat_entries=o,this.hmin=r,this.hmax=i,this.ymin_nz=s,this.draw_content=!(0===this.nbinsx||Math.abs(r)<1e-300&&Math.abs(i)<1e-300),this.draw_content)if(r>=i)0===r?(this.ymin=0,this.ymax=1):r<0?(this.ymin=2*r,this.ymax=0):(this.ymin=0,this.ymax=2*r);else{const a=.05*(i-r);this.ymin=r-a,this.ymin<0&&r>=0&&(this.ymin=0),this.ymax=i+a}}countStat(t){const e=this.getHisto(),r=this.getAxis("x"),s=this.getSelectIndex("x","left"),i=this.getSelectIndex("x","right"),m={name:"histo",meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:this.stat_entries,xmax:0,wmax:0};let n,w=0,c=0,x=0,p=null,u=null;for(n=s;n<i;++n){const h=r.GetBinCoord(n+.5);if(t&&!t(h))continue;const _=e.getBinContent(n+1);(null===p||_>u)&&(p=h,u=_),w+=_,c+=_*h,x+=_*h**2}return m.integral=w,Math.abs(w)>1e-300&&(m.meanx=c/w,m.meany=0/w,m.rmsx=Math.sqrt(Math.abs(x/w-m.meanx**2)),m.rmsy=Math.sqrt(Math.abs(0/w-m.meany**2))),null!==p&&(m.xmax=p,m.wmax=u),m}fillStatistic(t,e){const r=this.getHisto(),s=this.countStat(),i=e%10,o=Math.floor(e/10)%10,a=Math.floor(e/100)%10,m=Math.floor(e/1e3)%10,w=Math.floor(e/1e4)%10,c=Math.floor(e/1e5)%10,x=Math.floor(e/1e6)%10,n=Math.floor(e/1e7)%10,p=Math.floor(e/1e8)%10;return t.clearStat(),i>0&&t.addText(s.name),o>0&&t.addText("Entries = "+t.format(s.entries,"entries")),a>0&&t.addText("Mean = "+t.format(s.meanx)),m>0&&t.addText("Std Dev = "+t.format(s.rmsx)),w>0&&t.addText("Underflow = "+t.format(r.getBinContent(0),"entries")),c>0&&t.addText("Overflow = "+t.format(r.getBinContent(this.nbinsx+1),"entries")),x>0&&t.addText("Integral = "+t.format(s.integral,"entries")),n>0&&t.addText("Skew = <not avail>"),p>0&&t.addText("Kurt = <not avail>"),!0}getBarBaseline(t,e){let r=t.swap_xy?0:e;return Number.isFinite(this.options.BaseLine)&&this.options.BaseLine>=t.scale_ymin&&(r=Math.round(t.gry(this.options.BaseLine))),r}drawBars(t,e,r,s){var i=this;return(0,S.A)(function*(){i.createG(!0);const o=t.i1,a=t.i2,m=t.stepi,w=i.getFramePainter(),c=i.getHisto(),x=i.getAxis("x");let n,p,u,h,_,v,f,y,z="",$="",B="";const l=i.getBarBaseline(e,s);for(n=o;n<a;n+=m)p=x.GetBinCoord(n),u=x.GetBinCoord(n+m),!(e.logx&&u<=0)&&(h=Math.round(e.grx(p)),_=Math.round(e.grx(u)),v=c.getBinContent(n+1),!(e.logy&&v<e.scale_ymin)&&(f=Math.round(e.gry(v)),y=_-h,h+=Math.round(i.options.BarOffset*y),y=Math.round(i.options.BarWidth*y),z+=w.swap_xy?`M${l},${h}h${f-l}v${y}h${l-f}z`:`M${h},${f}h${y}v${l-f}h${-y}z`,i.options.BarStyle>0&&(_=h+y,y=Math.round(y/10),w.swap_xy?($+=`M${l},${h}h${f-l}v${y}h${l-f}z`,B+=`M${l},${_}h${f-l}v${-y}h${l-f}z`):($+=`M${h},${f}h${y}v${l-f}h${-y}z`,B+=`M${_},${f}h${-y}v${l-f}h${y}z`))));return i.fillatt.empty()&&i.fillatt.setSolidColor("blue"),z&&i.draw_g.append("svg:path").attr("d",z).call(i.fillatt.func),$&&i.draw_g.append("svg:path").attr("d",$).call(i.fillatt.func).style("fill",(0,ht.Qh)(i.fillatt.color).brighter(.5).formatRgb()),B&&i.draw_g.append("svg:path").attr("d",B).call(i.fillatt.func).style("fill",(0,ht.Qh)(i.fillatt.color).darker(.5).formatRgb()),!0})()}drawFilledErrors(t,e){var r=this;return(0,S.A)(function*(){r.createG(!0);const s=t.i1,i=t.i2,o=t.stepi,a=r.getHisto(),m=r.getAxis("x"),w=[],c=[];let x,n,p,u,h,_;for(x=s;x<i;x+=o)n=m.GetBinCoord(x+.5),!(e.logx&&n<=0)&&(p=Math.round(e.grx(n)),u=a.getBinContent(x+1),h=a.getBinError(x+1),!(e.logy&&u-h<e.scale_ymin)&&(_=Math.round(e.gry(u+h)),w.push({grx:p,gry:_}),_=Math.round(e.gry(u-h)),c.unshift({grx:p,gry:_})));const v=(0,j.Mw)(w,{line:4!==r.options.ErrorKind}),f=(0,j.Mw)(c,{line:4!==r.options.ErrorKind,cmd:"L"});return r.fillatt.empty()&&r.fillatt.setSolidColor("blue"),r.draw_g.append("svg:path").attr("d",v+f+"Z").call(r.fillatt.func),!0})()}draw1DBins(){var t=this;return(0,S.A)(function*(){const e=t.getFramePainter(),r=e.getFrameRect();if(!t.draw_content||r.width<=0||r.height<=0)return t.removeG(),!1;t.createHistDrawAttributes();const s=t.prepareDraw({extra:1,only_indexes:!0}),i=e.getGrFuncs(t.options.second_x,t.options.second_y);return t.options.Bar?t.drawBars(s,i,r.width,r.height):3===t.options.ErrorKind||4===t.options.ErrorKind?t.drawFilledErrors(s,i,r.width,r.height):t.drawHistBins(s,i,r.width,r.height)})()}drawHistBins(t,e,r,s){var i=this;return(0,S.A)(function*(){i.createG(!0);const o=i.options,a=t.i1,m=t.i2,w=t.stepi,c=i.getHisto(),x=!i.isBatchMode()&&T.settings.Tooltip,n=i.getAxis("x"),p=!o.Zero,u=o.Error,h=o.Line,_=o.Text;let z,$,B,l,b,E,M,d,g,A,H,k,K,Z,D,I,Y,G,at,L,W,O,P,v=o.Mark,f="",y=!1,U=null,Q=null,J=null,X=null,V=null,nt="",st="",q=0,dt=Promise.resolve();if(u&&!v&&i.v7EvalAttr("marker_style",1)>1&&(v=!0),2===o.ErrorKind?i.fillatt.empty()?v=!0:U="":o.Error&&(Q="",V=x?"":null),h&&(X=""),v&&(i.createv7AttMarker(),i.markeratt.size>0?(J="",i.markeratt.resetPos()):v=!1),_){if(P=i.v7EvalFont("text",{size:20,color:"black",align:22}),!P.angle&&!o.TextKind){const tt=r/(m-a+1);tt<3*P.size&&(P.setAngle(270),P.setSize(Math.round(.7*tt)))}dt=i.startTextDrawingAsync(P,"font")}return dt.then(()=>{let tt=m-a>3*r;if(1===o.ErrorKind){const C=i.lineatt.width+T.gStyle.fEndErrorSize;nt=`m0,${C}v${-2*C}m0,${C}`,st=`m${C},0h${-2*C}m${C},0`,q=Math.floor((i.lineatt.width-1)/2)}const N=u||v;(N||_||h)&&(tt=!0);const et=C=>{if(G=c.getBinContent(C+1),!p||0!==G){if(L=Math.round(e.grx(n.GetBinCoord(C))),W=Math.round(e.grx(n.GetBinCoord(C+w))),O=Math.round((L+W)/2),D=Math.round(e.gry(G)),I=Y=20,u&&(at=c.getBinError(C+1),I=Math.round(D-e.gry(G+at)),Y=Math.round(e.gry(G-at)-D)),_&&0!==G){const R=G===Math.round(G)?G.toString():(0,j.lg)(G,T.gStyle.fPaintTextFormat);i.drawText(P.angle?{align:12,x:O,y:Math.round(D-2-P.size/5),text:R,latex:0}:{x:Math.round(L+.1*(W-L)),y:Math.round(D-2-P.size),width:Math.round(.8*(W-L)),height:P.size,text:R,latex:0})}if(h&&null!==X&&(X+=(0===X.length?"M":"L")+O+","+D),N&&D>=-I&&D<=s+Y&&(null!==U&&(U+=`M${L},${D-I}h${W-L}v${I+Y+1}h${L-W}z`),null!==J&&(J+=i.markeratt.create(O,D)),null!==Q)){let R=5;if(i.options.errorX>0){R=Math.round((W-L)*i.options.errorX);const ct=O-R;Q+=`M${ct+q},${D}${nt}h${O+R-ct-2*q}${nt}`}Q+=`M${O},${D-I+q}${st}v${I+Y-2*q}${st}`,null!==V&&(V+=`M${O-R},${D-I}h${2*R}v${I+Y}h${-2*R}z`)}}};for(k=a;k<=m;k+=w)l=n.GetBinCoord(k),!(e.logx&&l<=0)&&(b=Math.round(e.grx(l)),y=k>m-w,y&&a<m?M=B:(E=c.getBinContent(k+1),M=Math.round(e.gry(E))),0===f.length?(K=Z=k,H=z=$=b,A=d=g=B=M,f="M"+$+","+B):tt?b!==$||y?((N||_||h)&&(K===Z?et(K):K<Z?(et(K),et(Z)):(et(Z),et(K))),!N&&(d!==g||A!==d)&&(H!==$&&(f+="h"+($-H)),B===d?(g!==A&&(f+="v"+(g-A)),d!==g&&(f+="v"+(d-g))):(d!==A&&(f+="v"+(d-A)),g!==d&&(f+="v"+(g-d)),B!==g&&(f+="v"+(B-g))),H=$,A=B),y&&H!==b&&(f+="h"+(b-H)),K=Z=k,d=g=B=M,$=b):(M<d?Z=k:M>g&&(K=k),d=Math.min(d,M),g=Math.max(g,M),B=M):(M!==B||y)&&(b!==$&&(f+="h"+(b-$)),M!==B&&(f+="v"+(M-B)),B=M,$=b));const ut=!i.isBatchMode()&&i.fillatt.empty()&&o.Hist&&T.settings.Tooltip&&!N&&!h;let ot=s+3;if(!ut){const C=Math.round(e.gry(0));C<=0?ot=-3:C<s&&(ot=C)}const xt=`L${$},${ot}H${z}Z`;return N||h?(U&&i.draw_g.append("svg:path").attr("d",U).call(i.fillatt.func),Q&&i.draw_g.append("svg:path").attr("d",Q).call(i.lineatt.func),V&&i.draw_g.append("svg:path").attr("d",V).style("fill","none").style("pointer-events",i.isBatchMode()?null:"visibleFill"),X&&(!i.fillatt.empty()&&!o.Hist&&i.draw_g.append("svg:path").attr("d",X+xt).call(i.fillatt.func),i.draw_g.append("svg:path").attr("d",X).style("fill","none").call(i.lineatt.func)),J&&i.draw_g.append("svg:path").attr("d",J).call(i.markeratt.func)):f&&o.Hist&&i.draw_g.append("svg:path").attr("d",f+(!i.fillatt.empty()||ut?xt:"")).style("stroke-linejoin","miter").call(i.lineatt.func).call(i.fillatt.func),!_||i.finishTextDrawing()})})()}getBinTooltips(t){const e=[],r=this.getObjectHint(),s=this.getFramePainter(),i=this.getHisto(),o=this.getAxis("x"),a=this.isDisplayItem()?i.stepx:1,m=o.GetBinCoord(t),w=o.GetBinCoord(t+a),c=this.getAxisBinTip("x",t,a);let x=i.getBinContent(t+1);if(r&&e.push(r),this.options.Error||this.options.Mark)e.push(`x = ${c}`,`y = ${s.axisAsText("y",x)}`),this.options.Error&&("["===c[0]&&e.push("error x = "+((w-m)/2).toPrecision(4)),e.push("error y = "+i.getBinError(t+1).toPrecision(4)));else{e.push(`bin = ${t+1}`,`x = ${c}`),i.$baseh&&(x-=i.$baseh.getBinContent(t+1));const n="entries = "+(a>1?"~":"");x===Math.round(x)?e.push(n+x):e.push(n+(0,j.lg)(x,T.gStyle.fStatFormat))}return e}processTooltipEvent(t){let e=this.draw_g?.selectChild(".tooltip_bin");if(!t||!this.draw_content||this.options.Mode3D||!this.draw_g)return e?.remove(),null;const r=this.getFramePainter(),s=r.getGrFuncs(this.options.second_x,this.options.second_y),i=r.getFrameWidth(),o=r.getFrameHeight(),a=this.getHisto(),m=this.getAxis("x"),w=this.getSelectIndex("x","left",-1),c=this.getSelectIndex("x","right",2);let x,n,p,u,h,_=2,v=w,f=c;function y(d){const g=m.GetBinCoord(d);return s.logx&&g<=0?null:s.grx(g)}function z(d){const g=a.getBinContent(d+1);return s.logy&&g<s.scale_ymin?s.swap_xy?-1e3:10*o:Math.round(s.gry(g))}const $=s.swap_xy?t.y:t.x,B=s.swap_xy?t.x:t.y;for(;v<f-1;){const d=Math.round(.5*(v+f)),g=y(d);null===g||g<$-.5?s.swap_xy?f=d:v=d:g>$+.5?s.swap_xy?v=d:f=d:(v++,f--)}let l=f=v;if(n=y(l),s.swap_xy){for(;v>w&&y(v-1)<n+2;)--v;for(;f<c&&y(f+1)>n-2;)++f}else{for(;v>w&&y(v-1)>n-2;)--v;for(;f<c&&y(f+1)<n+2;)++f}if(v<f){let d=o;for(let g=v;g<=f;g++){const A=Math.abs(z(g)-B);A<d&&(d=A,l=g)}d>o/10&&(l=Math.round(v+(f-v)/o*B)),n=y(l)}if(n=Math.round(n),p=Math.round(y(l+1)),this.options.Bar){const d=p-n;n+=Math.round(this.options.BarOffset*d),p=n+Math.round(this.options.BarWidth*d)}if(n>p&&([n,p]=[p,n]),this.isDisplayItem()&&(l<=a.dx||l>=a.dx+a.nx))return e.remove(),null;const b=Math.round((n+p)/2),E=u=h=z(l);if(this.options.Bar)x=!0,_=0,u=this.getBarBaseline(s,o),u>h&&([u,h]=[h,u]),!t.touch&&1===t.nproc&&(B<u||B>h)&&(l=null);else if(this.options.Error||this.options.Mark){x=!0;let d=3;if(this.markeratt&&(d=Math.max(d,this.markeratt.getFullSize())),this.options.Error){const g=a.getBinContent(l+1),A=a.getBinError(l+1);u=Math.round(s.gry(g+A)),h=Math.round(s.gry(g-A));const H=(p-n)*this.options.errorX;n=Math.round(b-H),p=Math.round(b+H)}p-n<2*d&&(n=b-d,p=b+d),u=Math.min(u,E-d),h=Math.max(h,E+d),!t.touch&&1===t.nproc&&(B<u||B>h)&&(l=null)}else this.options.Line?x=!1:(x=1===t.nproc&&c-w<i,x&&(h=o,this.fillatt.empty()||(h=Math.min(o,Math.max(0,Math.round(s.gry(0)))),h<u&&([u,h]=[h,u])),(t.y<u||t.y>h)&&!t.touch&&(l=null)));if(null!==l&&(l===w&&n>$+_||l===c-1&&p<$-_||$<n-_||$>p+_||!this.options.Zero&&0===a.getBinContent(l+1))&&(l=null),null===l||h<=0||u>=o)return e.remove(),null;const M={name:"histo",title:a.fTitle,x:b,y:E,exact:!0,color1:this.lineatt?.color??"green",color2:this.fillatt?.getFillColorAlt("blue")??"blue",lines:this.getBinTooltips(l)};if(t.disabled)e.remove(),M.changed=!0;else if(x)e.empty()&&(e=this.draw_g.append("svg:rect").attr("class","tooltip_bin").style("pointer-events","none").call(j.Ru)),M.changed=e.property("current_bin")!==l,M.changed&&e.attr("x",r.swap_xy?u:n).attr("width",r.swap_xy?h-u:p-n).attr("y",r.swap_xy?n:u).attr("height",r.swap_xy?p-n:h-u).style("opacity","0.3").property("current_bin",l),M.exact=Math.abs(E-B)<=5||B>=u&&B<=h,M.menu=M.exact,M.menu_dist=Math.sqrt((b-$)**2+(E-B)**2);else{const d=this.lineatt.width+3;e.empty()&&(e=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",d).call(this.lineatt.func).call(this.fillatt.func)),M.exact=Math.abs(b-t.x)<=d&&Math.abs(E-t.y)<=d,M.menu=M.exact,M.menu_dist=Math.sqrt((b-t.x)**2+(E-t.y)**2),M.changed=e.property("current_bin")!==l,M.changed&&e.attr("cx",b).attr("cy",E).property("current_bin",l)}return M.changed&&(M.user_info={obj:a,name:"histo",bin:l,cont:a.getBinContent(l+1),grx:b,gry:E}),M}fillHistContextMenu(t){t.add("Auto zoom-in",()=>this.autoZoom());const e=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",e,r=>{if(0===r.indexOf(T.kInspect))return this.showInspector(r);this.decodeOptions(r),this.options.need_fillcol&&this.fillatt?.empty()&&this.fillatt.change(5,1001),this.interactiveRedraw("pad","drawopt")})}autoZoom(){let t=this.getSelectIndex("x","left",-1),e=this.getSelectIndex("x","right",1);const r=e-t,s=this.getHisto(),i=this.getAxis("x");if(0===r)return;let o=s.getBinContent(t+1);for(let a=t;a<e;++a)o=Math.min(o,s.getBinContent(a+1));if(!(o>0)){for(;t<e&&s.getBinContent(t+1)<=o;)++t;for(;t<e&&s.getBinContent(e)<=o;)--e;if(t===e-1&&t>2&&e<this.nbinsx-2&&(--t,++e),e-t<r&&t<e)return this.getFramePainter().zoom(i.GetBinCoord(t),i.GetBinCoord(e))}}canZoomInside(t,e,r){const s=this.getAxis("x");return"x"===t&&s.FindBin(r,.5)-s.FindBin(e,0)>1||"y"===t&&Math.abs(r-e)>1e-6*Math.abs(this.ymax-this.ymin)}callDrawFunc(t){var e=this;return(0,S.A)(function*(){const r=e.getFramePainter();return r&&r.mode3d!==e.options.Mode3D&&!e.isMainPainter()&&(e.options.Mode3D=r.mode3d),e.options.Mode3D?e.draw3D(t):e.draw2D(t)})()}draw2D(t){var e=this;return(0,S.A)(function*(){return e.clear3DScene(),e.drawFrameAxes().then(r=>!!r&&e.drawingBins(t)).then(r=>{if(r)return e.draw1DBins().then(()=>e.addInteractivity())}).then(()=>e)})()}draw3D(t){var e=this;return(0,S.A)(function*(){return console.log("3D drawing is disabled, load ./hist/RH1Painter.mjs"),e.draw2D(t)})()}redraw(t){var e=this;return(0,S.A)(function*(){return e.callDrawFunc(t)})()}static _draw(t,e){return(0,S.A)(function*(){return(0,mt.ensureRCanvas)(t).then(()=>{t.setAsMainPainter(),t.options={Hist:!1,Bar:!1,BarStyle:0,Error:!1,ErrorKind:-1,errorX:T.gStyle.fErrorX,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!1,TextAngle:0,TextKind:"",AutoColor:0,BarOffset:0,BarWidth:1,BaseLine:!1,Mode3D:!1,FrontBox:!1,BackBox:!1};const r=new j.nC(e);r.check("R3D_",!0)&&(t.options.Render3D=T.constants.Render3D.fromString(r.part.toLowerCase()));const s=t.v7EvalAttr("kind","hist"),i=t.v7EvalAttr("sub",0),o=!!t.getMainPainter(),a=t.options;switch(a.Text=t.v7EvalAttr("drawtext",!1),a.BarOffset=t.v7EvalAttr("baroffset",0),a.BarWidth=t.v7EvalAttr("barwidth",1),a.second_x=o&&t.v7EvalAttr("secondx",!1),a.second_y=o&&t.v7EvalAttr("secondy",!1),s){case"bar":a.Bar=!0,a.BarStyle=i;break;case"err":a.Error=!0,a.ErrorKind=i;break;case"p":a.Mark=!0;break;case"l":a.Line=!0;break;case"lego":a.Lego=i>0?10+i:12,a.Mode3D=!0;break;default:a.Hist=!0}return t.scanContent(),t.callDrawFunc()})})()}static draw(t,e,r){return(0,S.A)(function*(){return it._draw(new it(t,e),r)})()}}var pt=F(9274),ft=F(9407);class rt extends it{draw3D(t){this.mode3d=!0;const e=this.getFramePainter(),r=this.isMainPainter(),s=1+2*T.gStyle.fHistTopMargin;let i=Promise.resolve(this);return"resize"===t?(r&&e.resize3D()&&e.render3D(),i):(this.deleteAttr(),this.scanContent(!0),r&&((0,ft.wx)(e),i=e.create3DScene(this.options.Render3D).then(()=>{e.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,null,this.ymin,this.ymax,null,0,0),e.set3DOptions(this.options),e.drawXYZ(e.toplevel,pt.R,{use_y_for_z:!0,zmult:s,zoom:T.settings.Zooming,ndim:1,draw:!0,v7:!0})})),e.mode3d?i.then(()=>this.drawingBins(t)).then(()=>{const o=this.getFramePainter();return(0,ft.CS)(this,!0),this.updatePaletteDraw(),o.render3D(),o.addKeysHandler(),this}):i)}static draw(t,e,r){return(0,S.A)(function*(){return rt._draw(new rt(t,e),r)})()}}}}]);
"use strict";(self.webpackChunkfirebird=self.webpackChunkfirebird||[]).push([[4843],{4843:(w,O,h)=>{h.r(O),h.d(O,{TF2Painter:()=>p});var A=h(467),m=h(6998),z=h(4149),N=h(3693),E=h(230),B=h(675),X=h(9041),L=h(3277);class p extends z.TH2Painter{#e;getObjectName(){return this.$func?.fName??"func"}getClassName(){return this.$func?._typename??m.clTF2}isTF1(){return!0}getPrimaryObject(){return this.$func}updateObject(e){if(!e||this.getClassName()!==e._typename)return!1;delete e.evalPar;const t=this.getHisto();if(this.webcanv_hist){const i=this.getPadPainter()?.findInPrimitives("Func",m.clTH2F);i&&this.updateAxes(t,i,this.getFramePainter())}return this.$func=e,this.createTF2Histogram(e,t),this.scanContent(),!0}redraw(e){return!this.#e&&("logx"===e||"logy"===e||"zoom"===e)&&(this.createTF2Histogram(this.$func,this.getHisto()),this.scanContent()),super.redraw(e)}createTF2Histogram(e,t){let i=e.fSave.length-6;i>0&&i!==(e.fSave[i+4]+1)*(e.fSave[i+5]+1)&&(i=0),this.#e=i>0&&(m.settings.PreferSavedPoints||this.use_saved>1);const d=this.getFramePainter(),g=this.getPadPainter()?.getRootPad(!0),l=g?.fLogx,v=g?.fLogy,s=d?.getGrFuncs(this.second_x,this.second_y);let o=e.fXmin,y=e.fXmax,f=e.fYmin,c=e.fYmax,x=Math.max(e.fNpx,20),P=Math.max(e.fNpy,20);if(s?.zoom_xmin!==s?.zoom_xmax){const a=(y-o)/x;o<s.zoom_xmin&&s.zoom_xmin<y&&(o=Math.max(o,s.zoom_xmin-a)),o<s.zoom_xmax&&s.zoom_xmax<y&&(y=Math.min(y,s.zoom_xmax+a))}if(s?.zoom_ymin!==s?.zoom_ymax){const a=(c-f)/P;f<s.zoom_ymin&&s.zoom_ymin<c&&(f=Math.max(f,s.zoom_ymin-a)),f<s.zoom_ymax&&s.zoom_ymax<c&&(c=Math.min(c,s.zoom_ymax+a))}const b=(a,n)=>{t.fNcells!==(a+2)*(n+2)&&(t.fNcells=(a+2)*(n+2),t.fArray=new Float32Array(t.fNcells)),t.fArray.fill(0),t.fXaxis.fNbins=a,t.fXaxis.fXbins=[],t.fYaxis.fNbins=n,t.fYaxis.fXbins=[]};if(delete this._fail_eval,!this.#e){let a=!1;!e.evalPar&&!(0,N.Dx)(e)&&(a=!0),b(x,P),t.fXaxis.fXmin=o,t.fXaxis.fXmax=y,t.fYaxis.fXmin=f,t.fYaxis.fXmax=c,l&&(0,E.produceTAxisLogScale)(t.fXaxis,x,o,y),v&&(0,E.produceTAxisLogScale)(t.fYaxis,P,f,c);for(let n=0;n<P&&!a;++n)for(let T=0;T<x&&!a;++T){const _=t.fXaxis.GetBinCenter(T+1),M=t.fYaxis.GetBinCenter(n+1);let r=0;try{r=e.evalPar(_,M)}catch{a=!0}a||t.setBinContent(t.getBin(T+1,n+1),Number.isFinite(r)?r:0)}a&&(this._fail_eval=!0),a&&i>6&&(this.#e=!0)}if(this.#e){x=Math.round(e.fSave[i+4]),P=Math.round(e.fSave[i+5]),o=e.fSave[i],y=e.fSave[i+1],f=e.fSave[i+2],c=e.fSave[i+3];const a=(y-o)/x,n=(c-f)/P,T=(_,M)=>{if(_<o||_>y||a<=0||M<f||M>c||n<=0)return 0;const r=Math.min(x-1,Math.floor((_-o)/a)),u=Math.min(P-1,Math.floor((M-f)/n)),F=(_-(o+r*a))/a,C=(M-(f+u*n))/n;return(1-F)*(1-C)*e.fSave[u*(x+1)+r]+F*(1-C)*e.fSave[u*(x+1)+r+1]+F*C*e.fSave[(u+1)*(x+1)+r+1]+(1-F)*C*e.fSave[(u+1)*(x+1)+r]};b(e.fNpx,e.fNpy),t.fXaxis.fXmin=e.fXmin,t.fXaxis.fXmax=e.fXmax,t.fYaxis.fXmin=e.fYmin,t.fYaxis.fXmax=e.fYmax;for(let _=0;_<e.fNpy;++_){const M=t.fYaxis.GetBinCenter(_+1);for(let r=0;r<e.fNpx;++r){const S=T(t.fXaxis.GetBinCenter(r+1),M);t.setBinContent(t.getBin(r+1,_+1),Number.isFinite(S)?S:0)}}}return t.fName="Func",(0,m.setHistogramTitle)(t,e.fTitle),t.fMinimum=e.fMinimum,t.fMaximum=e.fMaximum,t.fLineColor=e.fLineColor,t.fLineStyle=e.fLineStyle,t.fLineWidth=e.fLineWidth,t.fFillColor=e.fFillColor,t.fFillStyle=e.fFillStyle,t.fMarkerColor=e.fMarkerColor,t.fMarkerStyle=e.fMarkerStyle,t.fMarkerSize=e.fMarkerSize,t.fBits|=m.kNoStats,t}extractAxesProperties(e){super.extractAxesProperties(e);const t=this.$func,i=t?.fSave.length??0;i>6&&this.#e&&(this.xmin=Math.min(this.xmin,t.fSave[i-6]),this.xmax=Math.max(this.xmax,t.fSave[i-5]),this.ymin=Math.min(this.ymin,t.fSave[i-4]),this.ymax=Math.max(this.ymax,t.fSave[i-3])),t&&(this.xmin=Math.min(this.xmin,t.fXmin),this.xmax=Math.max(this.xmax,t.fXmax),this.ymin=Math.min(this.ymin,t.fYmin),this.ymax=Math.max(this.ymax,t.fYmax))}getTF2Tooltips(e){const t=[this.getObjectHint()],i=this.getFramePainter()?.getGrFuncs(this.options.second_x,this.options.second_y);if(!i||!(0,m.isFunc)(this.$func?.evalPar))return t.push("grx = "+e.x,"gry = "+e.y),t;const d=i.revertAxis("x",e.x),g=i.revertAxis("y",e.y);let l=0,v=!1;try{l=this.$func.evalPar(d,g)}catch{v=!0}return t.push("x = "+i.axisAsText("x",d),"y = "+i.axisAsText("y",g),"value = "+(v?"<fail>":(0,X.lg)(l,m.gStyle.fStatFormat))),t}processTooltipEvent(e){if(this.#e)return super.processTooltipEvent(e);let t=this.draw_g?.selectChild(".tooltip_bin");if(!this.draw_g||!e)return t?.remove(),null;const i={name:this.$func?.fName,title:this.$func?.fTitle,x:e.x,y:e.y,color1:this.lineatt?.color??"green",color2:this.fillatt?.getFillColorAlt("blue")??"blue",lines:this.getTF2Tooltips(e),exact:!0,menu:!0};return e.disabled?t.remove():(t.empty()&&(t=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").style("fill","none").attr("r",(this.lineatt?.width??1)+4)),t.attr("cx",e.x).attr("cy",e.y),this.lineatt&&t.call(this.lineatt.func)),i}fillWebObjectOptions(e){e.fcust=this._fail_eval&&!this.use_saved?"func_fail":""}static draw(e,t,i){return(0,A.A)(function*(){const d=(0,E.scanTF1Options)(i);i=d.opt,delete d.opt;const g=new X.nC(i);let l;g.empty()?i="cont3":"SAME"===g.opt&&(i="cont2 same"),d.webcanv_hist&&(l=new B.JW(e).getPadPainter()?.findInPrimitives("Func",m.clTH2F)),l||(l=(0,m.createHistogram)(m.clTH2F,20,20),l.fBits|=m.kNoStats);const v=new p(e,l);return v.$func=t,Object.assign(v,d),v.createTF2Histogram(t,l),L.mf._drawHist(v,i)})()}}}}]);
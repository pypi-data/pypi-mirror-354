"use strict";(self.webpackChunkfirebird=self.webpackChunkfirebird||[]).push([[9810],{9810:(X,T,f)=>{f.r(T),f.d(T,{RPalettePainter:()=>D,drawBox:()=>S,drawLine:()=>U,drawMarker:()=>Z,drawText:()=>K});var j=f(467),P=f(6998),p=f(5680),F=f(9041),k=f(8631),B=f(4952),H=f(2928),I=f(6370);function K(){const _=this.getObject(),e=this.getPadPainter(),i=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,n=!!i&&this.v7EvalAttr("clipping",!1),t=e.getCoordinate(_.fPos,i),s=this.v7EvalFont("text",{size:12,color:"black",align:22});return this.createG(n?"main_layer":!!i&&"upper_layer"),this.startTextDrawingAsync(s,"font").then(()=>(this.drawText({x:t.x,y:t.y,text:_.fText,latex:1}),this.finishTextDrawing()))}function U(){const _=this.getObject(),e=this.getPadPainter(),i=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,n=!!i&&this.v7EvalAttr("clipping",!1),t=e.getCoordinate(_.fP1,i),s=e.getCoordinate(_.fP2,i);this.createG(n?"main_layer":!!i&&"upper_layer"),this.createv7AttLine(),this.draw_g.append("svg:path").attr("d",`M${t.x},${t.y}L${s.x},${s.y}`).call(this.lineatt.func)}function S(){const _=this.getObject(),e=this.getPadPainter(),i=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,n=!!i&&this.v7EvalAttr("clipping",!1),t=e.getCoordinate(_.fP1,i),s=e.getCoordinate(_.fP2,i);this.createG(n?"main_layer":!!i&&"upper_layer"),this.createv7AttLine("border_"),this.createv7AttFill(),this.draw_g.append("svg:path").attr("d",`M${t.x},${t.y}H${s.x}V${s.y}H${t.x}Z`).call(this.lineatt.func).call(this.fillatt.func)}function Z(){const _=this.getObject(),e=this.getPadPainter(),i=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,n=!!i&&this.v7EvalAttr("clipping",!1),t=e.getCoordinate(_.fP,i);this.createG(n?"main_layer":!!i&&"upper_layer"),this.createv7AttMarker();const s=this.markeratt.create(t.x,t.y);s&&this.draw_g.append("svg:path").attr("d",s).call(this.markeratt.func)}class D extends k.D{getHistPalette(){const e=this.getObject()?.fPalette;return e&&!(0,P.isFunc)(e.getColor)&&(0,P.addMethods)(e,`${P.nsREX}RPalette`),e}drawPalette(e){const i=this.getHistPalette(),n=i.getContour(),t=this.getFramePainter();if(!n)return console.log("no contour - no palette");if(!t)return console.log("no frame painter - no palette");const s=n.at(0),R=n.at(-1),c=t.getFrameRect(),y=this.getPadPainter().getPadWidth(),O=this.getPadPainter().getPadHeight(),G=this.v7EvalAttr("visible",!0),l=this.v7EvalAttr("vertical",!0);let C,b,o,d,E=i.full_min,A=i.full_max;if(e){o=e.width,d=e.height;const a={};l?(this.v7AttrChange(a,"margin",(e.x-c.x-c.width)/y),this.v7AttrChange(a,"width",o/y)):(this.v7AttrChange(a,"margin",(e.y-c.y-c.height)/y),this.v7AttrChange(a,"width",d/O)),this.v7SendAttrChanges(a,!1)}else{if(l){const a=this.v7EvalLength("margin",y,.02);C=Math.round(c.x+c.width+a),o=this.v7EvalLength("width",y,.05),b=c.y,d=c.height}else{const a=this.v7EvalLength("margin",O,.02);C=c.x,o=c.width,b=Math.round(c.y+c.height+a),d=this.v7EvalLength("width",O,.05)}(0,F.bk)(this.draw_g,C,b)}let w=this.draw_g.selectChild(".colbtns");if(w.empty()?w=this.draw_g.append("svg:g").attr("class","colbtns"):w.selectAll("*").remove(),!G)return;w.append("svg:path").attr("d",`M0,0H${o}V${d}H0Z`).style("stroke","black").style("fill","none"),(void 0===E||void 0===A)&&(E=s,A=R),l?t.z_handle.configureAxis("zaxis",E,A,s,R,!0,[d,0],-d,{reverse:!1}):t.z_handle.configureAxis("zaxis",E,A,s,R,!1,[0,o],o,{reverse:!1});for(let a=0;a<n.length-1;++a){const m=Math.round(t.z_handle.gr(n[a])),u=Math.round(t.z_handle.gr(n[a+1])),g=i.getContourColor((n[a]+n[a+1])/2),x=w.append("svg:path").attr("d",l?`M0,${u}H${o}V${m}H0Z`:`M${m},0V${d}H${u}V0Z`).style("fill",g).style("stroke",g).property("fill0",g).property("fill1",(0,p.Qh)(g).darker(.5).formatRgb());this.isBatchMode()||(this.isTooltipAllowed()&&x.on("mouseover",function(){(0,p.Lt)(this).transition().duration(100).style("fill",(0,p.Lt)(this).property("fill1"))}).on("mouseout",function(){(0,p.Lt)(this).transition().duration(100).style("fill",(0,p.Lt)(this).property("fill0"))}).append("svg:title").text(n[a].toFixed(2)+" - "+n[a+1].toFixed(2)),P.settings.Zooming&&x.on("dblclick",()=>t.unzoom("z")))}t.z_handle.maxTickSize=Math.round(.3*o);const $=t.z_handle.drawAxis(this.draw_g,(0,F.bk)(l?o:0,d),l?-1:1);return this.isBatchMode()||e?$:$.then(()=>{if(P.settings.ContextMenu&&this.draw_g.on("contextmenu",r=>{r.stopPropagation(),r.preventDefault(),(0,I.ES)(r,this).then(h=>{h.header("Palette"),h.addchk(l,"Vertical",M=>{this.v7SetAttr("vertical",M),this.redrawPad()}),t.z_handle.fillAxisContextMenu(h,"z"),h.show()})}),(0,B.WJ)(this,{x:C,y:b,width:o,height:d,minwidth:20,minheight:20,no_change_x:!l,no_change_y:l,redraw:r=>this.drawPalette(r)}),!P.settings.Zooming)return;let g,x,L,v,a=!1,m=0,u=0;const V=r=>{if(!a)return;if(r.preventDefault(),v=(0,p.Wn)(r,this.draw_g.node()),L)return t.z_handle.processLabelsMove("move",v);u=l?Math.min(Math.max(v[1],0),d):Math.min(Math.max(v[0],0),o);const h=Math.abs(u-m);!x&&h>1&&(g.style("display",null),x=!0),l?g.attr("y",Math.min(m,u)).attr("height",h):g.attr("x",Math.min(m,u)).attr("width",h)},J=r=>{if(a)if(r.preventDefault(),(0,p.Lt)(window).on("mousemove.colzoomRect",null).on("mouseup.colzoomRect",null),g.remove(),g=null,a=!1,L)t.z_handle.processLabelsMove("stop",v);else{const h=t.z_handle.func,M=h.invert(m),z=h.invert(u);this.getFramePainter().zoom("z",Math.min(M,z),Math.max(M,z))}},Q=r=>{a||(a=!0,r.preventDefault(),r.stopPropagation(),v=(0,p.Wn)(r,this.draw_g.node()),m=u=v[l?1:0],x=!1,L=!1,g=w.append("svg:rect").attr("class","zoom").attr("id","colzoomRect").style("display","none"),l?g.attr("x",0).attr("width",o).attr("y",m).attr("height",1):g.attr("x",m).attr("width",1).attr("y",0).attr("height",d),(0,p.Lt)(window).on("mousemove.colzoomRect",V).on("mouseup.colzoomRect",J,!0),setTimeout(()=>{!x&&a&&(L=t.z_handle.processLabelsMove("start",v))},500))},W=()=>{this.draw_g.selectAll(".axis_zoom, .axis_labels").on("mousedown",Q).on("dblclick",()=>t.unzoom("z")),P.settings.ZoomWheel&&this.draw_g.on("wheel",r=>{r.stopPropagation(),r.preventDefault();const h=(0,p.Wn)(r,this.draw_g.node()),z=t.z_handle.analyzeWheelEvent(r,l?1-h[1]/d:h[0]/o);z.changed&&t.zoom("z",z.min,z.max)})};t.z_handle.setAfterDrawHandler(W),W()})}static draw(e,i,n){return(0,j.A)(function*(){const t=new D(e,i,n,"palette");return(0,H.ensureRCanvas)(t,!1).then(()=>(t.createG(),t))})()}}}}]);
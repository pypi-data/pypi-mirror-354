"use strict";(self.webpackChunkfirebird=self.webpackChunkfirebird||[]).push([[9845],{9845:(L,A,p)=>{p.r(A),p.d(A,{TGraphPolarPainter:()=>O,TGraphPolargramPainter:()=>T});var u=p(467),c=p(6998),R=p(5680),_=p(9041),y=p(675),v=p(4485),k=p(9025),C=p(4952),w=p(6370);const E=(0,c.BIT)(17);class T extends y.JW{constructor(t,e,r){super(t,e,r),this.$polargram=!0,this.zoom_rmin=this.zoom_rmax=0,this.t0=0,this.mult=1,this.decodeOptions(r)}isNormalAngles(){const t=this.getObject();return t?.fRadian||t?.fGrad||t?.fDegree}decodeOptions(t){const e=new _.nC(t);this.options||(this.options={}),Object.assign(this.options,{rdot:e.check("RDOT"),rangle:e.check("RANGLE",!0)?e.partAsInt():0,NoLabels:e.check("N"),OrthoLabels:e.check("O")}),this.storeDrawOpt(t)}setAnglesRange(t,e,r){if(t>=e&&(e=t+1),r){const i=this.getObject();i.fRwtmin=t,i.fRwtmax=e}this.t0=t,this.mult=2*Math.PI/(e-t)}translate(t,e,r){const i=(t-this.t0)*this.mult;let a=this.r(e),s=a/this.szx*this.szy,o=a*Math.cos(-i),n=s*Math.sin(-i);return r||(o=Math.round(o),n=Math.round(n),a=Math.round(a),s=Math.round(s)),{grx:o,gry:n,rx:a,ry:s}}format(t){return t===Math.round(t)?t.toString():this.ndig>10?t.toExponential(4):t.toFixed(this.ndig>0?this.ndig:0)}axisAsText(t,e){return"r"===t?e===Math.round(e)?e.toString():this.ndig>10?e.toExponential(4):e.toFixed(this.ndig+2):(e*=180/Math.PI)===Math.round(e)?e.toString():e.toFixed(1)}getFrameRect(){const t=this.getPadPainter(),e=t.getRootPad(!0),r=t.getPadWidth(),i=t.getPadHeight(),a={};return e?(a.szx=Math.round(Math.max(.1,.5-Math.max(e.fLeftMargin,e.fRightMargin))*r),a.szy=Math.round(Math.max(.1,.5-Math.max(e.fBottomMargin,e.fTopMargin))*i)):(a.szx=Math.round(.5*r),a.szy=Math.round(.5*i)),a.width=2*a.szx,a.height=2*a.szy,a.x=Math.round(r/2-a.szx),a.y=Math.round(i/2-a.szy),a.hint_delta_x=a.szx,a.hint_delta_y=a.szy,a.transform=(0,_.bk)(a.x,a.y)||"",a}mouseEvent(t,e){let r=null;if("leave"!==t){const i=(0,R.Wn)(e,this.draw_g.node());r={x:i[0],y:i[1],touch:!1}}this.processFrameTooltipEvent(r)}mouseWheel(t){t.stopPropagation(),t.preventDefault(),this.processFrameTooltipEvent(null);const e=this.getObject();if(!e)return;let r=t.wheelDelta?-t.wheelDelta:t.deltaY||t.detail;if(!r)return;r=r<0?-.2:.2;let i=this.scale_rmin,a=this.scale_rmax;a+=r*(a-i),(i<e.fRwrmin||a>e.fRwrmax)&&(i=a=0),(this.zoom_rmin!==i||this.zoom_rmax!==a)&&(this.zoom_rmin=i,this.zoom_rmax=a,this.redrawPad())}mouseDoubleClick(){(this.zoom_rmin||this.zoom_rmax)&&(this.zoom_rmin=this.zoom_rmax=0,this.redrawPad())}drawPolarLabels(t,e){var r=this;return(0,u.A)(function*(){const i=Math.round(t.fPolarTextSize*r.szy*2);return r.startTextDrawingAsync(t.fPolarLabelFont,i).then(()=>{const a=8===e?["0","#frac{#pi}{4}","#frac{#pi}{2}","#frac{3#pi}{4}","#pi","#frac{5#pi}{4}","#frac{3#pi}{2}","#frac{7#pi}{4}"]:["0","#frac{2#pi}{3}","#frac{4#pi}{3}"],s=[12,11,21,31,32,33,23,13];for(let o=0;o<e;++o){const n=2*-o*Math.PI/e;r.draw_g.append("svg:path").attr("d",`M0,0L${Math.round(r.szx*Math.cos(n))},${Math.round(r.szy*Math.sin(n))}`).call(r.lineatt.func);let l=12,f=0;r.options.OrthoLabels?(f=-o/e*360,f>-271&&f<-91&&(l=32,f+=180)):l=s[Math.round(16-n/Math.PI*4)%8],r.drawText({align:l,rotate:f,x:Math.round((r.szx+i)*Math.cos(n)),y:Math.round((r.szy+i/r.szx*r.szy)*Math.sin(n)),text:a[o],color:r.getColor(t.fPolarLabelColor),latex:1})}return r.finishTextDrawing()})})()}redraw(){var t=this;return(0,u.A)(function*(){if(!t.isMainPainter())return;const e=t.getObject(),r=t.getPadPainter().getFrameRect();t.createG(),(0,_.bk)(t.draw_g,Math.round(r.x+r.width/2),Math.round(r.y+r.height/2)),t.szx=r.szx,t.szy=r.szy,t.scale_rmin=e.fRwrmin,t.scale_rmax=e.fRwrmax,t.zoom_rmin!==t.zoom_rmax&&(t.scale_rmin=t.zoom_rmin,t.scale_rmax=t.zoom_rmax),t.r=(0,R.m4)().domain([t.scale_rmin,t.scale_rmax]).range([0,t.szx]),e.fRadian?(e.fRwtmin=0,e.fRwtmax=2*Math.PI):e.fDegree?(e.fRwtmin=0,e.fRwtmax=360):e.fGrad&&(e.fRwtmin=0,e.fRwtmax=200),t.setAnglesRange(e.fRwtmin,e.fRwtmax);const i=t.r.ticks(5);let a=Math.floor(e.fNdivRad%1e4/100),s=e.fNdivPol%100;3!==s&&(s=8),t.createAttLine({attr:e}),t.gridatt||(t.gridatt=t.createAttLine({color:e.fLineColor,style:2,width:1,std:!1}));const o=Math.abs(e.fRwrmax-e.fRwrmin);t.ndig=o<=0?-3:Math.round(Math.log10(i.length/o));let n=[],l=0;for(;l<i.length;){const g=t.format(i[l]);if(n.indexOf(g)>=0){if(++t.ndig>10)break;n=[],l=0}else n.push(g),l++}let f=!1;const d=t.isBatchMode()?null:"visibleFill";return i[i.length-1]<e.fRwrmax&&t.zoom_rmin===t.zoom_rmax&&(i.push(e.fRwrmax),f=!0),t.startTextDrawingAsync(e.fRadialLabelFont,Math.round(e.fRadialTextSize*t.szy*2)).then(()=>{const g=-(t.options.rangle||e.fAxisAngle)/180*Math.PI,h=Math.cos(g),b=Math.sin(g);for(let m=0;m<i.length;++m){let x=t.r(i[m]),M=x/t.szx*t.szy;if(t.draw_g.append("ellipse").attr("cx",0).attr("cy",0).attr("rx",Math.round(x)).attr("ry",Math.round(M)).style("fill","none").style("pointer-events",d).call(t.lineatt.func),m<i.length-1||!f){const z=h>.7?1:h>0?3:h>-.7?1:3,P=Math.abs(h)<.7?1:3;t.drawText({align:10*z+P,x:Math.round(x*h),y:Math.round(M*b),text:t.format(i[m]),color:t.getColor(e.fRadialLabelColor),latex:0}),t.options.rdot&&t.draw_g.append("ellipse").attr("cx",Math.round(x*h)).attr("cy",Math.round(M*b)).attr("rx",3).attr("ry",3).style("fill","red")}if(a>1&&(m<i.length-1||!f)){const z=(i[1]-i[0])/a;for(let P=1;P<a;++P){const D=i[m]+z*P;if(D>t.scale_rmax)break;x=t.r(D),M=x/t.szx*t.szy,t.draw_g.append("ellipse").attr("cx",0).attr("cy",0).attr("rx",Math.round(x)).attr("ry",Math.round(M)).style("fill","none").style("pointer-events",d).call(t.gridatt.func)}}}return h<.999&&t.draw_g.append("path").attr("d",`M0,0L${Math.round(t.szx*h)},${Math.round(t.szy*b)}`).style("pointer-events",d).call(t.lineatt.func),t.finishTextDrawing()}).then(()=>!!t.options.NoLabels||t.drawPolarLabels(e,s)).then(()=>{if(a=Math.floor(e.fNdivPol%1e4/100),a>1)for(let g=0;g<s*a;++g){if(g%a==0)continue;const h=2*-g*Math.PI/s/a;t.draw_g.append("svg:path").attr("d",`M0,0L${Math.round(t.szx*Math.cos(h))},${Math.round(t.szy*Math.sin(h))}`).call(t.gridatt.func)}t.isBatchMode()||(C.G_.assign(t),(0,w.wh)(t,w.Og),t.assignZoomHandler(t.draw_g))})})()}fillContextMenuItems(t){const e=this.getObject();t.sub("Axis range"),t.addchk(e.fRadian,"Radian",r=>{e.fRadian=r,e.fDegree=e.fGrad=!1,this.interactiveRedraw("pad",r?"exec:SetToRadian()":"exec:SetTwoPi()")},"Handle data angles as radian range 0..2*Pi"),t.addchk(e.fDegree,"Degree",r=>{e.fDegree=r,e.fRadian=e.fGrad=!1,this.interactiveRedraw("pad",r?"exec:SetToDegree()":"exec:SetTwoPi()")},"Handle data angles as degree range 0..360"),t.addchk(e.fGrad,"Grad",r=>{e.fGrad=r,e.fRadian=e.fDegree=!1,this.interactiveRedraw("pad",r?"exec:SetToGrad()":"exec:SetTwoPi()")},"Handle data angles as grad range 0..200"),t.endsub(),t.addSizeMenu("Axis angle",0,315,45,this.options.rangle||e.fAxisAngle,r=>{this.options.rangle=e.fAxisAngle=r,this.interactiveRedraw("pad",`exec:SetAxisAngle(${r})`)})}assignZoomHandler(t){t.on("mouseenter",e=>this.mouseEvent("enter",e)).on("mousemove",e=>this.mouseEvent("move",e)).on("mouseleave",e=>this.mouseEvent("leave",e)),c.settings.Zooming&&t.on("dblclick",e=>this.mouseDoubleClick(e)),c.settings.Zooming&&c.settings.ZoomWheel&&t.on("wheel",e=>this.mouseWheel(e))}static draw(t,e,r){return(0,u.A)(function*(){const i=(0,y.Nn)(t);if(i){if(i.getObject()===e)return i;throw Error("Cannot superimpose TGraphPolargram with any other drawings")}const a=new T(t,e,r);return(0,k.ensureTCanvas)(a,!1).then(()=>(a.setAsMainPainter(),a.redraw())).then(()=>a)})()}}class O extends y.JW{decodeOptions(t){const e=new _.nC(t||"L");this.options||(this.options={});const r=e.check("RDOT"),i=e.check("RANGLE",!0)?e.partAsInt():0;Object.assign(this.options,{mark:e.check("P"),err:e.check("E"),fill:e.check("F"),line:e.check("L"),curve:e.check("C"),radian:e.check("R"),degree:e.check("D"),grad:e.check("G"),Axis:e.check("N")?"N":""}),e.check("O")&&(this.options.Axis+="O"),r&&(this.options.Axis+="_rdot"),i&&(this.options.Axis+=`_rangle${i}`),this.storeDrawOpt(t)}updateObject(t,e){return!!this.matchObjectType(t)&&(e&&e!==this.options.original&&this.decodeOptions(e),this._draw_axis&&t.fPolargram&&this.getMainPainter().updateObject(t.fPolargram),delete t.fPolargram,Object.assign(this.getObject(),t),!0)}redraw(){return this.drawGraphPolar().then(()=>this.updateTitle())}drawGraphPolar(){var t=this;return(0,u.A)(function*(){const e=t.getObject(),r=t.getMainPainter();if(!e||!r?.$polargram)return;if(t.options.mark&&t.createAttMarker({attr:e}),(t.options.err||t.options.line||t.options.curve)&&t.createAttLine({attr:e}),t.options.fill&&t.createAttFill({attr:e}),t.createG(),t._draw_axis&&!r.isNormalAngles()){const n=e.fEX?.length;let l=e.fX[0],f=e.fX[0];for(let d=0;d<e.fNpoints;++d)l=Math.min(l,e.fX[d]-(n?e.fEX[d]:0)),f=Math.max(f,e.fX[d]+(n?e.fEX[d]:0));f+=(f-l)/e.fNpoints,r.setAnglesRange(l,f,!0)}t.draw_g.attr("transform",r.draw_g.attr("transform"));let i="",a="";const s=[],o=t.isBatchMode()?null:"visibleFill";for(let n=0;n<e.fNpoints;++n){if(e.fY[n]>r.scale_rmax)continue;if(t.options.err){const f=r.translate(e.fX[n],e.fY[n]-e.fEY[n]),d=r.translate(e.fX[n],e.fY[n]+e.fEY[n]),g=r.translate(e.fX[n]+e.fEX[n],e.fY[n]),h=r.translate(e.fX[n]-e.fEX[n],e.fY[n]);a+=`M${f.grx},${f.gry}L${d.grx},${d.gry}M${g.grx},${g.gry}A${h.rx},${h.ry},0,0,1,${h.grx},${h.gry}`}const l=r.translate(e.fX[n],e.fY[n]);t.options.mark&&(i+=t.markeratt.create(l.grx,l.gry)),(t.options.curve||t.options.line||t.options.fill)&&s.push(l)}if((t.options.fill||t.options.line)&&s.length){const n=(0,_.Mw)(s,{line:!0});t.options.fill&&t.draw_g.append("svg:path").attr("d",n+"Z").style("pointer-events",o).call(t.fillatt.func),t.options.line&&t.draw_g.append("svg:path").attr("d",n).style("fill","none").style("pointer-events",o).call(t.lineatt.func)}t.options.curve&&s.length&&t.draw_g.append("svg:path").attr("d",(0,_.Mw)(s)).style("fill","none").style("pointer-events",o).call(t.lineatt.func),a&&t.draw_g.append("svg:path").attr("d",a).style("fill","none").style("pointer-events",o).call(t.lineatt.func),i&&t.draw_g.append("svg:path").attr("d",i).style("pointer-events",o).call(t.markeratt.func),t.isBatchMode()||((0,w.wh)(t,w.Og),r.assignZoomHandler(t.draw_g))})()}createPolargram(t){t.fPolargram||(t.fPolargram=(0,c.create)("TGraphPolargram"),this.options.radian?t.fPolargram.fRadian=!0:this.options.degree?t.fPolargram.fDegree=!0:this.options.grad&&(t.fPolargram.fGrad=!0));let e=t.fY[0]||0,r=e;const i=t.fEY?.length;for(let a=0;a<t.fNpoints;++a)e=Math.min(e,t.fY[a]-(i?t.fEY[a]:0)),r=Math.max(r,t.fY[a]+(i?t.fEY[a]:0));return t.fPolargram.fRwrmin=e-.1*(r-e),t.fPolargram.fRwrmax=r+.1*(r-e),t.fPolargram}extractTooltip(t){if(!t)return null;const e=this.getObject(),r=this.getMainPainter();let i=1e10,a=-1,s=null;for(let l=0;l<e.fNpoints;++l){const f=r.translate(e.fX[l],e.fY[l]),d=(f.grx-t.x)**2+(f.gry-t.y)**2;d<i&&(i=d,a=l,s=f)}let o=5;if(this.markeratt?.used&&(o=this.markeratt.getFullSize()),Math.sqrt(i)>o)return null;const n={name:this.getObject().fName,title:this.getObject().fTitle,x:s.grx,y:s.gry,color1:(this.markeratt?.used?this.markeratt.color:void 0)??(this.fillatt?.used?this.fillatt.color:void 0)??this.lineatt?.color,exact:Math.sqrt(i)<4,lines:[this.getObjectHint()],binindx:a,menu_dist:o,radius:o};return n.lines.push(`r = ${r.axisAsText("r",e.fY[a])}`,`phi = ${r.axisAsText("phi",e.fX[a])}`),e.fEY&&e.fEY[a]&&n.lines.push(`error r = ${r.axisAsText("r",e.fEY[a])}`),e.fEX&&e.fEX[a]&&n.lines.push(`error phi = ${r.axisAsText("phi",e.fEX[a])}`),n}updateTitle(){var t=this;return(0,u.A)(function*(){if(!t._draw_axis)return t;const e=t.getPadPainter()?.findPainterFor(null,c.kTitle,c.clTPaveText),r=e?.getObject();if(!e||!r)return t;const i=t.getObject(),a=!i.TestBit(E)&&c.gStyle.fOptTitle>0;return r.Clear(),a&&r.AddText(i.fTitle),e.redraw().then(()=>t)})()}drawTitle(){var t=this;return(0,u.A)(function*(){if(!t._draw_axis)return t;const e=t.getObject(),r=c.gStyle,i=!e.TestBit(E)&&r.fOptTitle>0,a=t.getPadPainter();let s=a.findInPrimitives(c.kTitle,c.clTPaveText);return s?(s.Clear(),i&&s.AddText(e.fTitle),t):(s=(0,c.create)(c.clTPaveText),Object.assign(s,{fName:c.kTitle,fFillColor:r.fTitleColor,fFillStyle:r.fTitleStyle,fBorderSize:r.fTitleBorderSize,fTextFont:r.fTitleFont,fTextSize:r.fTitleFontSize,fTextColor:r.fTitleTextColor,fTextAlign:22}),i&&s.AddText(e.fTitle),v.TPavePainter.draw(a,s,v.kPosTitle).then(o=>(o?.setSecondaryId(t,c.kTitle),t)))})()}showTooltip(t){let e=this.draw_g?.selectChild(".tooltip_bin");t&&this.draw_g?(e.empty()&&(e=this.draw_g.append("svg:ellipse").attr("class","tooltip_bin").style("pointer-events","none")),t.changed=e.property("current_bin")!==t.binindx,t.changed&&e.attr("cx",t.x).attr("cy",t.y).attr("rx",Math.round(t.radius)).attr("ry",Math.round(t.radius)).style("fill","none").style("stroke",t.color1).property("current_bin",t.binindx)):e?.remove()}processTooltipEvent(t){const e=this.extractTooltip(t);return(!t||!t.disabled)&&this.showTooltip(e),e}static draw(t,e,r){return(0,u.A)(function*(){const i=new O(t,e,r);i.decodeOptions(r);const a=i.getMainPainter();if(a&&!a.$polargram)return console.error("Cannot superimpose TGraphPolar with plain histograms"),null;let s=Promise.resolve(null);return a||(i._draw_axis=!0,s=T.draw(t,i.createPolargram(e),i.options.Axis)),s.then(o=>(o?.setSecondaryId(i,"polargram"),i.addToPadPrimitives(),i.drawGraphPolar())).then(()=>i.drawTitle())})()}}}}]);
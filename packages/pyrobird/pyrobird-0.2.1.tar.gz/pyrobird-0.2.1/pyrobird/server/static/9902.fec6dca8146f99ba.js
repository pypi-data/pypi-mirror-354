"use strict";(self.webpackChunkfirebird=self.webpackChunkfirebird||[]).push([[9902],{9902:(Y,G,c)=>{c.r(G),c.d(G,{TMultiGraphPainter:()=>v});var o=c(467),l=c(6998),C=c(9041),D=c(675),H=c(3277),T=c(2953),F=c(4693),L=c(9025);const S=(0,l.BIT)(17);class w extends D.JW{constructor(e,a){super(e,a),this.firstpainter=null,this.painters=[]}cleanup(){this.painters=[],super.cleanup()}updateObject(e){if(!this.matchObjectType(e))return!1;const a=this.getObject(),t=e.fGraphs,n=this.getPadPainter();a.fTitle=e.fTitle;let s=!1;if(this.firstpainter){const m=this.scanGraphsRange(t,e.fHistogram,n?.getRootPad(!0),!0);this.firstpainter.updateObject(m)&&(s=!0)}const r=Math.min(t.arr.length,this.painters.length);for(let m=0;m<r;++m)this.painters[m].updateObject(t.arr[m],(t.opt[m]||this._restopt)+this._auto)&&(s=!0);return this._funcHandler=new H.eP(this,n,e.fFunctions),s}redraw(e){var a=this;return(0,o.A)(function*(){const t=a.firstpainter?.redraw(e)??Promise.resolve(!0),n=function(){var s=(0,o.A)(function*(r){return r>=a.painters.length?a:a.painters[r].redraw(e).then(()=>n(r+1))});return function(m){return s.apply(this,arguments)}}();return t.then(()=>n(0)).then(()=>{const s=a._funcHandler?.drawNext(0)??a;return delete a._funcHandler,s})})()}scanGraphsRange(e,a,t,n){const s=this.getObject(),r={xmin:0,xmax:0,ymin:0,ymax:0,first:!0},m=(f,x)=>Math.abs(x-f)<1e-6;let u,i,p,d=!1,y=!1,X=!1;t&&(d=t.fLogx,y=t.fLogv??t.fLogy),this._3d&&a&&!a.fXaxis.fLabels&&(a=null),a?(X=m(a.fMinimum,-.05)&&m(a.fMaximum,1.05)&&m(a.fXaxis.fXmin,-.05)&&m(a.fXaxis.fXmax,1.05),p=a):p=e.arr[0]?.fHistogram,e.arr.forEach(f=>{if(0!==f.fNpoints){f.TestBit(S)&&(n=!0),r.first&&(r.xmin=r.xmax=f.fX[0],r.ymin=r.ymax=f.fY[0],r.first=!1);for(let x=0;x<f.fNpoints;++x)r.xmin=Math.min(r.xmin,f.fX[x]),r.xmax=Math.max(r.xmax,f.fX[x]),r.ymin=Math.min(r.ymin,f.fY[x]),r.ymax=Math.max(r.ymax,f.fY[x])}}),r.xmin===r.xmax&&(r.xmax+=1),r.ymin===r.ymax&&(r.ymax+=1);const N=.05*(r.xmax-r.xmin),A=.05*(r.ymax-r.ymin);let g=r.xmin-N,P=r.xmax+N;y?(r.ymin<=0&&(r.ymin=.001*r.ymax),i=r.ymin/(1+.5*Math.log10(r.ymax/r.ymin)),u=r.ymax*(1+.2*Math.log10(r.ymax/r.ymin))):(i=r.ymin-A,u=r.ymax+A),i<0&&r.ymin>=0&&(i=0),u>0&&r.ymax<=0&&(u=0);const k=i,R=u;if(g<0&&r.xmin>=0&&(g=d?.9*r.xmin:0),P>0&&r.xmax<=0&&(P=d?1.1*r.xmax:0),s.fMinimum!==l.kNoZoom&&(r.ymin=i=s.fMinimum),s.fMaximum!==l.kNoZoom&&(r.ymax=u=s.fMaximum),i<0&&r.ymin>=0&&y&&(i=.9*r.ymin),u>0&&r.ymax<=0&&y&&(u=1.1*r.ymax),i<=0&&y&&(i=.001*u),!y&&i>0&&i<.05*u&&(i=0),g<=0&&d&&(g=P>1e3?1:.001*P),!a||n||X){let f,x;if(this._3d){f=(a=(0,l.createHistogram)(l.clTH2F,e.arr.length,10)).fXaxis,f.fXmin=0,f.fXmax=e.arr.length,f.fLabels=(0,l.create)(l.clTHashList);for(let h=0;h<e.arr.length;h++){const M=(0,l.create)(l.clTObjString);M.fString=e.arr[h].fTitle||`gr${h}`,M.fUniqueID=e.arr.length-h,f.fLabels.Add(M,"")}f=a.fYaxis,x=a.fZaxis}else f=(a=(0,l.createHistogram)(l.clTH1F,10)).fXaxis,x=a.fYaxis;if(p&&(f.fTimeDisplay=p.fXaxis.fTimeDisplay,f.fTimeFormat=p.fXaxis.fTimeFormat,f.fTitle=p.fXaxis.fTitle,x.fTitle=p.fYaxis.fTitle),a.fTitle=s.fTitle,a.fTitle.indexOf(";")>=0){const h=a.fTitle.split(";");a.fTitle=h[0],h[1]&&(f.fTitle=h[1]),h[2]&&(x.fTitle=h[2])}f.fXmin=g,f.fXmax=P}const O=this._3d?a.fZaxis:a.fYaxis;return O.fXmin=Math.min(i,k),O.fXmax=Math.max(u,R),a.fMinimum===l.kNoZoom&&(a.fMinimum=i),a.fMaximum===l.kNoZoom&&(a.fMaximum=u),a.fBits|=l.kNoStats,a}drawAxisHist(e,a){var t=this;return(0,o.A)(function*(){return T.N.draw(t.getDrawDom(),e,a)})()}drawGraph(e,a,t){return(0,o.A)(function*(){return F.TGraphPainter.draw(e,a,t)})()}drawNextGraph(e,a){var t=this;return(0,o.A)(function*(){const n=t.getObject().fGraphs;if(e>=n.arr.length)return t;const s=n.arr[e],r=(n.opt[e]||t._restopt)+t._auto,m=n.arr.length-e,u=`graphs_${e}`;if(a){const i=a.getSubPadPainter(e+1);return i?(i.cleanPrimitives(!0),t.drawGraph(i,s,r,m).then(d=>(d&&(d.setSecondaryId(t,u),t.painters.push(d)),t.drawNextGraph(e+1,a)))):t}return t._auto&&(s.$num_graphs=n.arr.length),t.drawGraph(t.getPadPainter(),s,r,m).then(i=>(i&&(i.setSecondaryId(t,u),t.painters.push(i)),t.drawNextGraph(e+1)))})()}fillContextMenuItems(e){e.addRedrawMenu(this)}redrawWith(e,a){var t=this;return(0,o.A)(function*(){if(!a){t.firstpainter=null,t.painters=[];const i=t.getPadPainter();i?.removePrimitive(t,!0),t._pads&&i?.divide(0,0)}const n=new C.nC(e),s=t.getObject();t._3d=n.check("3D"),t._auto="",t._pads=n.check("PADS"),["PFC","PLC","PMC"].forEach(i=>{n.check(i)&&(t._auto+=" "+i)});let r="",m=null;n.check("FB")&&t._3d&&(r+="FB"),T.c.forEach(i=>{n.check(i)&&(r+=";"+i)}),t._restopt=n.remain();let u=Promise.resolve(!0);if(t._pads)u=(0,L.ensureTCanvas)(t,!1).then(()=>(m=t.getPadPainter(),m.divide(s.fGraphs.arr.length,0,!0)));else if(n.check("A")||!t.getMainPainter()){const i=t.scanGraphsRange(s.fGraphs,s.fHistogram,t.getPadPainter()?.getRootPad(!0));u=t.drawAxisHist(i,r).then(d=>{d.setSecondaryId(t,"hist"),t.firstpainter=d})}return u.then(()=>(t.addToPadPrimitives(),t.drawNextGraph(0,m))).then(()=>t._pads?t:new H.eP(t,t.getPadPainter(),t.getObject().fFunctions,!0).drawNext(0))})()}static draw(e,a,t){return(0,o.A)(function*(){return new w(e,a,t).redrawWith(t,!0)})()}}var b=c(4149),j=c(895);class v extends w{drawAxisHist(e,a){var t=this;return(0,o.A)(function*(){const n=t.getDrawDom();return t._3d?b.TH2Painter.draw(n,e,"LEGO"+a):T.N.draw(n,e,a)})()}drawGraph(e,a,t,n){var s=this;return(0,o.A)(function*(){return s._3d&&(t+=`pos3d_${n}`),j.k.draw(e,a,t)})()}static draw(e,a,t){return(0,o.A)(function*(){return new v(e,a,t).redrawWith(t,!0)})()}}}}]);
"use strict";(self.webpackChunkfirebird=self.webpackChunkfirebird||[]).push([[6423],{6423:(I,S,p)=>{p.r(S),p.d(S,{drawEllipse:()=>O,drawJSImage:()=>j,drawMarker:()=>R,drawPie:()=>C,drawPolyMarker:()=>Y,drawText:()=>X});var k=p(467),m=p(6998),y=p(9041),T=p(6714),w=p(6370);function X(){return D.apply(this,arguments)}function D(){return(D=(0,k.A)(function*(){const t=this.getObject(),c=this.getPadPainter(),f=this.getFramePainter(),e=t.fName.startsWith("http://")||t.fName.startsWith("https://");let a=t.fX,o=t.fY,d=!1,n=1,h=this.matchObjectType(m.clTAnnotation);if(this.createAttText({attr:t}),h&&f?.mode3d&&(0,m.isFunc)(f?.convert3DtoPadNDC)){const s=f.convert3DtoPadNDC(t.fX,t.fY,t.fZ);a=s.x,o=s.y,this.isndc=!0,h="3d"}else t.TestBit((0,m.BIT)(14))?this.isndc=!0:c.getRootPad(!0)?d=new y.nC(this.getDrawOpt()).check("FRAME"):(this.isndc=!0,a=o=.5,t.fTextAlign=22);this.createG(d?"frame2d":void 0,e),this.draw_g.attr("transform",null),this.pos_x=this.axisToSvg("x",a,this.isndc),this.pos_y=this.axisToSvg("y",o,this.isndc),this.swap_xy=d&&f?.swap_xy,this.swap_xy&&([this.pos_x,this.pos_y]=[this.pos_y,this.pos_x]);const r=this.textatt.createArg({x:this.pos_x,y:this.pos_y,text:t.fTitle,latex:0});return t._typename===m.clTLatex||h?r.latex=1:t._typename===m.clTMathText&&(r.latex=2,n=.8),e&&(this.draw_g.attr("href",t.fName),this.isBatchMode()||this.draw_g.append("svg:title").text(`link on ${t.fName}`)),this.startTextDrawingAsync(this.textatt.font,this.textatt.getSize(c,n)).then(()=>this.drawText(r)).then(()=>this.finishTextDrawing()).then(()=>this.isBatchMode()?this:c.isButton()&&!c.isEditable()?(this.draw_g.on("click",()=>this.getCanvPainter().selectActivePad(c)),this):(this.pos_dx=this.pos_dy=0,this.moveDrag||(this.moveDrag=function(s,i){this.pos_dx+=s,this.pos_dy+=i,(0,y.bk)(this.draw_g,this.pos_dx,this.pos_dy)}),this.moveEnd||(this.moveEnd=function(s){if(s)return;const i=this.getObject();let x=this.svgToAxis("x",this.pos_x+this.pos_dx,this.isndc),l=this.svgToAxis("y",this.pos_y+this.pos_dy,this.isndc);this.swap_xy&&([x,l]=[l,x]),i.fX=x,i.fY=l,this.submitCanvExec(`SetX(${x});;SetY(${l});;`)}),"3d"!==h?(0,T.X2)(this,!0,e):(f.processRender3D=!0,this.handleRender3D=()=>{const s=f.convert3DtoPadNDC(t.fX,t.fY,t.fZ),i=this.axisToSvg("x",s.x,!0),x=this.axisToSvg("y",s.y,!0);(0,y.bk)(this.draw_g,i-this.pos_x,x-this.pos_y)}),(0,w.wh)(this),this.fillContextMenuItems=function(s){s.add("Change text",()=>s.input("Enter new text",t.fTitle).then(i=>{t.fTitle=i,this.interactiveRedraw("pad",`exec:SetTitle("${i}")`)}))},this.matchObjectType(m.clTLink)&&this.draw_g.style("cursor","pointer").on("click",()=>this.submitCanvExec("ExecuteEvent(kButton1Up, 0, 0);;")),this))})).apply(this,arguments)}function O(){const t=this.getObject(),c=0===t.fPhimin&&360===t.fPhimax,f="TCrown"===t._typename;this.createAttLine({attr:t}),this.createAttFill({attr:t}),this.createG();const e=this.getAxisToSvgFunc(),a=e.x(t.fX1),o=e.y(t.fY1),d=f&&t.fR1<=0?e.x(t.fX1+t.fR2)-a:e.x(t.fX1+t.fR1)-a,n=o-e.y(t.fY1+t.fR2),h=Math.PI/180;let r="";if(f&&t.fR1>0){const s=t.fYXRatio??1,i=d,x=s*n,l=s*(o-e.y(t.fY1+t.fR1)),u=e.x(t.fX1+t.fR2)-a;if(c)r=`M${-i},0A${i},${l},0,1,0,${i},0A${i},${l},0,1,0,${-i},0M${-u},0A${u},${x},0,1,0,${u},0A${u},${x},0,1,0,${-u},0`;else{const P=t.fPhimax-t.fPhimin>=180?1:0,g=t.fPhimin*h,_=t.fPhimax*h,v=Math.round(i*Math.cos(g)),A=Math.round(l*Math.sin(g));r=`M${Math.round(i*Math.cos(_))},${Math.round(l*Math.sin(_))}A${i},${l},0,${P},0,${v},${A}L${Math.round(u*Math.cos(g))},${Math.round(x*Math.sin(g))}A${u},${x},0,${P},1,${Math.round(u*Math.cos(_))},${Math.round(x*Math.sin(_))}Z`}}else if(0===t.fTheta)r=c?`M${-d},0A${d},${n},0,1,0,${d},0A${d},${n},0,1,0,${-d},0Z`:`M0,0L${Math.round(d*Math.cos(t.fPhimin*h))},${Math.round(n*Math.sin(t.fPhimin*h))}A${d},${n},0,1,1,${Math.round(d*Math.cos(t.fPhimax*h))},${Math.round(n*Math.sin(t.fPhimax*h))}Z`;else{const s=Math.cos(t.fTheta*h),i=Math.sin(t.fTheta*h),x=t.fPhimin*h,u=200,P=(t.fPhimax*h-x)/(u-(c?0:1));let g=0,_=0;c||(r="M0,0");for(let v=0;v<u;++v){const A=x+v*P,E=t.fR1*Math.cos(A),b=t.fR2*Math.sin(A),M=e.x(t.fX1+E*s-b*i)-a,$=e.y(t.fY1+E*i+b*s)-o;r?r+=g===M?"v"+($-_):_===$?"h"+(M-g):`l${M-g},${$-_}`:r=`M${M},${$}`,g=M,_=$}r+="Z"}this.x=a,this.y=o,(0,y.bk)(this.draw_g.append("svg:path"),a,o).attr("d",r).call(this.lineatt.func).call(this.fillatt.func),(0,w.wh)(this),(0,T.X2)(this),this.moveDrag=function(s,i){this.x+=s,this.y+=i,(0,y.bk)(this.draw_g.select("path"),this.x,this.y)},this.moveEnd=function(s){if(s)return;const i=this.getObject();i.fX1=this.svgToAxis("x",this.x),i.fY1=this.svgToAxis("y",this.y),this.submitCanvExec(`SetX1(${i.fX1});;SetY1(${i.fY1});;Notify();;`)}}function C(){this.createG();const t=this.getObject(),c=t.fPieSlices.length,f=this.axisToSvg("x",t.fX),e=this.axisToSvg("y",t.fY),a=this.axisToSvg("x",t.fX+t.fRadius)-f,o=this.axisToSvg("y",t.fY+t.fRadius)-e;(0,y.bk)(this.draw_g,f,e);let d=0,n=t.fAngularOffset*Math.PI/180,h=Math.round(a*Math.cos(n)),r=Math.round(o*Math.sin(n));for(let s=0;s<c;s++)d+=t.fPieSlices[s].fValue;for(let s=0;s<c;s++){const i=t.fPieSlices[s];this.createAttLine({attr:i}),this.createAttFill({attr:i}),n+=i.fValue/d*2*Math.PI;const x=Math.round(a*Math.cos(n)),l=Math.round(o*Math.sin(n));this.draw_g.append("svg:path").attr("d",`M0,0L${h},${r}A${a},${o},0,0,0,${x},${l}z`).call(this.lineatt.func).call(this.fillatt.func),h=x,r=l}}function R(){const t=this.getObject(),c=(0,m.BIT)(14);this.isndc=t.TestBit(c);const f=!this.isndc&&new y.nC(this.getDrawOpt()).check("FRAME"),e=f&&this.getFramePainter()?.swap_xy;this.createAttMarker({attr:t}),this.createG(f?"frame2d":void 0);let a=this.axisToSvg("x",t.fX,this.isndc),o=this.axisToSvg("y",t.fY,this.isndc);e&&([a,o]=[o,a]);const d=this.markeratt.create(a,o);d&&this.draw_g.append("svg:path").attr("d",d).call(this.markeratt.func),(0,w.wh)(this),(0,T.X2)(this),this.dx=this.dy=0,this.moveDrag=function(n,h){this.dx+=n,this.dy+=h,(0,y.bk)(this.draw_g.select("path"),this.dx,this.dy)},this.moveEnd=function(n){if(n)return;const h=this.getObject();let r=this.svgToAxis("x",this.axisToSvg("x",h.fX,this.isndc)+this.dx,this.isndc),s=this.svgToAxis("y",this.axisToSvg("y",h.fY,this.isndc)+this.dy,this.isndc);e&&([r,s]=[s,r]),h.fX=r,h.fY=s,this.submitCanvExec(`SetX(${r});;SetY(${s});;Notify();;`),this.redraw()}}function Y(){const t=this.getObject(),c=this.getAxisToSvgFunc();this.createAttMarker({attr:t}),this.createG();let f="";for(let e=0;e<=t.fLastPoint;++e)f+=this.markeratt.create(c.x(t.fX[e]),c.y(t.fY[e]));f&&this.draw_g.append("svg:path").attr("d",f).call(this.markeratt.func),(0,w.wh)(this),(0,T.X2)(this),this.dx=this.dy=0,this.moveDrag=function(e,a){this.dx+=e,this.dy+=a,(0,y.bk)(this.draw_g.select("path"),this.dx,this.dy)},this.moveEnd=function(e){if(e)return;const a=this.getObject(),o=this.getAxisToSvgFunc();let d="";for(let n=0;n<=a.fLastPoint;++n){const h=this.svgToAxis("x",o.x(a.fX[n])+this.dx),r=this.svgToAxis("y",o.y(a.fY[n])+this.dy);a.fX[n]=h,a.fY[n]=r,d+=`SetPoint(${n},${h},${r});;`}this.submitCanvExec(d+"Notify();;"),this.redraw()}}function j(t,c,f){const e=new y.b8(t),a=e.selectDom(),o=a.append("img").attr("src",c.fName).attr("title",c.fTitle||c.fName);return f&&f.indexOf("scale")>=0?o.style("width","100%").style("height","100%"):f&&f.indexOf("center")>=0&&(a.style("position","relative"),o.attr("style","margin: 0; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);")),e.setTopPainter(),e}}}]);
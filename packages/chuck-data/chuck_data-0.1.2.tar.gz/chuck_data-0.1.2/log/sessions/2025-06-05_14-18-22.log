2025-06-05 14:18:22,895 - DEBUG - Logging initialized. Writing to /Users/johnrush/repos/chuck-data/log/sessions/2025-06-05_14-18-22.log
2025-06-05 14:18:22,898 - DEBUG - HTTP error: HTTP 401, Response: {"status":401,"message":"Unauthorized"}
2025-06-05 14:18:22,899 - DEBUG - GET request to: https://test-workspace.cloud.databricks.com/test-endpoint
2025-06-05 14:18:22,899 - DEBUG - Connection error: Connection failed
2025-06-05 14:18:22,900 - DEBUG - GET request to: https://test-workspace.cloud.databricks.com/test-endpoint
2025-06-05 14:18:22,900 - DEBUG - HTTP error: HTTP 404, Response: Not Found
2025-06-05 14:18:22,900 - DEBUG - GET request to: https://test-workspace.cloud.databricks.com/test-endpoint
2025-06-05 14:18:22,901 - DEBUG - POST request to: https://test-workspace.cloud.databricks.com/test-endpoint
2025-06-05 14:18:22,901 - DEBUG - Connection error: Connection failed
2025-06-05 14:18:22,902 - DEBUG - POST request to: https://test-workspace.cloud.databricks.com/test-endpoint
2025-06-05 14:18:22,902 - DEBUG - HTTP error: HTTP 400, Response: Bad Request
2025-06-05 14:18:22,903 - DEBUG - POST request to: https://test-workspace.cloud.databricks.com/test-endpoint
2025-06-05 14:18:22,905 - DEBUG - Saved configuration to /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpogeyky1y/test_config.json
2025-06-05 14:18:22,905 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpogeyky1y/test_config.json
2025-06-05 14:18:22,906 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpogeyky1y/test_config.json
2025-06-05 14:18:22,906 - DEBUG - Saved configuration to /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpogeyky1y/test_config.json
2025-06-05 14:18:22,906 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpogeyky1y/test_config.json
2025-06-05 14:18:22,906 - DEBUG - Saved configuration to /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpogeyky1y/test_config.json
2025-06-05 14:18:22,907 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpogeyky1y/test_config.json
2025-06-05 14:18:22,907 - DEBUG - Saved configuration to /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpogeyky1y/test_config.json
2025-06-05 14:18:22,907 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpogeyky1y/test_config.json
2025-06-05 14:18:22,907 - DEBUG - Saved configuration to /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpogeyky1y/test_config.json
2025-06-05 14:18:22,907 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpogeyky1y/test_config.json
2025-06-05 14:18:22,907 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpogeyky1y/test_config.json
2025-06-05 14:18:22,908 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpogeyky1y/test_config.json
2025-06-05 14:18:22,908 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpogeyky1y/test_config.json
2025-06-05 14:18:22,908 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpogeyky1y/test_config.json
2025-06-05 14:18:22,909 - DEBUG - Saved configuration to /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpuztcwfjp/test_config.json
2025-06-05 14:18:22,909 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpuztcwfjp/test_config.json
2025-06-05 14:18:22,911 - DEBUG - Saved configuration to /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmppfugz1ip/test_config.json
2025-06-05 14:18:22,911 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmppfugz1ip/test_config.json
2025-06-05 14:18:22,912 - DEBUG - Saved configuration to /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmp6vcd0xnp/test_config.json
2025-06-05 14:18:22,912 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmp6vcd0xnp/test_config.json
2025-06-05 14:18:22,912 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmp6vcd0xnp/test_config.json
2025-06-05 14:18:22,913 - DEBUG - Saved configuration to /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmp6vcd0xnp/test_config.json
2025-06-05 14:18:22,913 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmp6vcd0xnp/test_config.json
2025-06-05 14:18:22,913 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmp6vcd0xnp/test_config.json
2025-06-05 14:18:22,915 - DEBUG - Saved configuration to /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpeqygvdwj/test_config.json
2025-06-05 14:18:22,915 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpeqygvdwj/test_config.json
2025-06-05 14:18:22,915 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpeqygvdwj/test_config.json
2025-06-05 14:18:22,915 - DEBUG - Saved configuration to /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpeqygvdwj/test_config.json
2025-06-05 14:18:22,915 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpeqygvdwj/test_config.json
2025-06-05 14:18:22,915 - DEBUG - Saved configuration to /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpeqygvdwj/test_config.json
2025-06-05 14:18:22,915 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpeqygvdwj/test_config.json
2025-06-05 14:18:22,916 - DEBUG - Saved configuration to /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpeqygvdwj/test_config.json
2025-06-05 14:18:22,916 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpeqygvdwj/test_config.json
2025-06-05 14:18:22,916 - DEBUG - Saved configuration to /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpeqygvdwj/test_config.json
2025-06-05 14:18:22,916 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpeqygvdwj/test_config.json
2025-06-05 14:18:22,916 - DEBUG - Using workspace_url from environment variable CHUCK_WORKSPACE_URL
2025-06-05 14:18:22,916 - DEBUG - Using active_model from environment variable CHUCK_ACTIVE_MODEL
2025-06-05 14:18:22,916 - DEBUG - Using warehouse_id from environment variable CHUCK_WAREHOUSE_ID
2025-06-05 14:18:22,916 - DEBUG - Using active_catalog from environment variable CHUCK_ACTIVE_CATALOG
2025-06-05 14:18:22,916 - DEBUG - Using active_schema from environment variable CHUCK_ACTIVE_SCHEMA
2025-06-05 14:18:22,916 - DEBUG - Using usage_tracking_consent from environment variable CHUCK_USAGE_TRACKING_CONSENT
2025-06-05 14:18:22,916 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpeqygvdwj/test_config.json
2025-06-05 14:18:22,918 - DEBUG - Saved configuration to /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmp9f7kknru/test_config.json
2025-06-05 14:18:22,918 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmp9f7kknru/test_config.json
2025-06-05 14:18:22,918 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmp9f7kknru/test_config.json
2025-06-05 14:18:22,918 - WARNING - Invalid workspace_url provided, using default instead
2025-06-05 14:18:22,918 - DEBUG - Saved configuration to /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmp9f7kknru/test_config.json
2025-06-05 14:18:22,918 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmp9f7kknru/test_config.json
2025-06-05 14:18:22,918 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmp9f7kknru/test_config.json
2025-06-05 14:18:22,919 - DEBUG - Saved configuration to /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmp9f7kknru/test_config.json
2025-06-05 14:18:22,919 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmp9f7kknru/test_config.json
2025-06-05 14:18:22,920 - DEBUG - Using workspace_url from environment variable CHUCK_WORKSPACE_URL
2025-06-05 14:18:22,920 - DEBUG - Using workspace_url from environment variable CHUCK_WORKSPACE_URL
2025-06-05 14:18:22,920 - DEBUG - Using active_model from environment variable CHUCK_ACTIVE_MODEL
2025-06-05 14:18:22,920 - DEBUG - Using amperity_token from environment variable CHUCK_AMPERITY_TOKEN
2025-06-05 14:18:22,920 - DEBUG - Using databricks_token from environment variable CHUCK_DATABRICKS_TOKEN
2025-06-05 14:18:22,920 - DEBUG - Saved configuration to /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmprbu4wnoz/test_config.json
2025-06-05 14:18:22,921 - DEBUG - Loaded configuration from /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmprbu4wnoz/test_config.json
2025-06-05 14:18:22,922 - DEBUG - Saved configuration to /var/folders/3f/2n5sjdw50vj9gfnrxjbptj4c0000gn/T/tmpbgxbd_hs/test_config.json
2025-06-05 14:18:22,930 - DEBUG - GET request to: https://adb-3856707039489412.12.azuredatabricks.net/test-endpoint
2025-06-05 14:18:22,933 - DEBUG - GET request to: https://test-workspace.cloud.databricks.com/test-endpoint
2025-06-05 14:18:22,933 - DEBUG - Connection error: Connection failed
2025-06-05 14:18:22,934 - DEBUG - GET request to: https://test-workspace.cloud.databricks.com/test-endpoint
2025-06-05 14:18:22,934 - DEBUG - HTTP error: HTTP 404, Response: Not Found
2025-06-05 14:18:22,935 - WARNING - Model 'nonexistent-model' not found
2025-06-05 14:18:22,936 - DEBUG - GET request to: https://test-workspace.cloud.databricks.com/test-endpoint
2025-06-05 14:18:22,939 - CRITICAL - Warehouses response: {'warehouses': [{'id': '123'}, {'id': '456'}]}
2025-06-05 14:18:22,940 - DEBUG - POST request to: https://test-workspace.cloud.databricks.com/test-endpoint
2025-06-05 14:18:22,940 - DEBUG - Connection error: Connection failed
2025-06-05 14:18:22,941 - DEBUG - POST request to: https://test-workspace.cloud.databricks.com/test-endpoint
2025-06-05 14:18:22,941 - DEBUG - HTTP error: HTTP 400, Response: Bad Request
2025-06-05 14:18:22,942 - DEBUG - POST request to: https://test-workspace.cloud.databricks.com/test-endpoint
2025-06-05 14:18:22,943 - DEBUG - File upload request to: https://test-workspace.cloud.databricks.com/api/2.0/fs/files/test/path.txt
2025-06-05 14:18:22,946 - DEBUG - File upload request to: https://test-workspace.cloud.databricks.com/api/2.0/fs/files/test/path.txt
2025-06-05 14:18:22,947 - DEBUG - Token validation failed: Token validation failed
2025-06-05 14:18:22,948 - DEBUG - Saved configuration to /tmp/.test_chuck_integration_config.json
2025-06-05 14:18:22,949 - DEBUG - Saved configuration to /tmp/.test_chuck_integration_config.json
2025-06-05 14:18:22,950 - DEBUG - Saved configuration to /tmp/.test_chuck_integration_config.json
2025-06-05 14:18:22,950 - DEBUG - Saved configuration to /tmp/.test_chuck_integration_config.json
2025-06-05 14:18:22,951 - DEBUG - Saved configuration to /tmp/.test_chuck_integration_config.json
2025-06-05 14:18:22,951 - DEBUG - Saved configuration to /tmp/.test_chuck_integration_config.json
2025-06-05 14:18:22,955 - DEBUG - Sending metric: {"event": "USAGE", "prompt": "test prompt"}...
2025-06-05 14:18:22,955 - DEBUG - Error sending metrics: Test exception
Traceback (most recent call last):
  File "/Users/johnrush/repos/chuck-data/src/metrics_collector.py", line 123, in send_metric
    return self._client.submit_metrics(payload, token)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "/Users/johnrush/repos/chuck-data/tests/fixtures.py", line 60, in submit_metrics
    raise Exception("Test exception")
Exception: Test exception
2025-06-05 14:18:22,956 - DEBUG - Sending metric: {"event": "USAGE", "prompt": "test prompt"}...
2025-06-05 14:18:22,957 - DEBUG - Cannot send metrics - no authentication token available
2025-06-05 14:18:22,958 - DEBUG - Sending metric: {"event": "USAGE", "prompt": "test prompt"}...
2025-06-05 14:18:22,960 - DEBUG - Metrics tracking skipped - user has not provided consent
2025-06-05 14:18:22,961 - ERROR - Connection error when getting model: Connection failed
2025-06-05 14:18:22,962 - ERROR - Failed to get model: HTTP error occurred: 500 Internal Server Error
2025-06-05 14:18:22,963 - ERROR - Connection error when listing models: Connection failed
2025-06-05 14:18:22,964 - ERROR - Failed to list models: HTTP error occurred: 404 Not Found
2025-06-05 14:18:22,992 - ERROR - Error executing handler for command 'test_command': Command failed
Traceback (most recent call last):
  File "/Users/johnrush/repos/chuck-data/src/service.py", line 395, in execute_command
    result: CommandResult = command_def.handler(
                            ~~~~~~~~~~~~~~~~~~~^
        effective_client, **args_for_handler
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py", line 1167, in __call__
    return self._mock_call(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py", line 1171, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py", line 1226, in _execute_mock_call
    raise effect
Exception: Command failed
2025-06-05 14:18:23,017 - DEBUG - Executing SQL: SELECT * INVALID SQL
2025-06-05 14:18:23,018 - DEBUG - Executing SQL: SELECT * INVALID SQL
2025-06-05 14:18:23,019 - DEBUG - Executing SQL: SELECT * FROM table
2025-06-05 14:18:23,020 - DEBUG - Executing SQL: SELECT * FROM table
2025-06-05 14:18:23,021 - DEBUG - Executing SQL: SELECT * FROM table
2025-06-05 14:18:23,022 - DEBUG - Executing SQL: SELECT * FROM table

$schema: http://azureml/sdk-1-5/DistributedComponent.json
name: fl_fedavg_pytorch
version: 0.0.1
display_name: FedAvg
type: DistributedComponent
description: |
  FedAvg of up to 10 input pytorch models, with (optional) customized weights
  Modified based on [sr_main_agg](https://msdata.visualstudio.com/Vienna/_git/aml-ds?path=/recipes/signed-components/fl_smartreply_agg/sr_main_agg.py)
is_deterministic: true
tags:
  helpDocument: shrike-docs.com
  contact: aims-team@microsoft.com
inputs:
  num_models:
    type: Integer
    optional: false
  model_input_dir_1:
    type: path
    optional: false
  model_input_dir_2:
    type: path
    optional: false
  model_input_dir_3:
    type: path
    optional: true
  model_input_dir_4:
    type: path
    optional: true
  model_input_dir_5:
    type: path
    optional: true
  model_input_dir_6:
    type: path
    optional: true  
  model_input_dir_7:
    type: path
    optional: true
  model_input_dir_8:
    type: path
    optional: true
  model_input_dir_9:
    type: path
    optional: true
  model_input_dir_10:
    type: path
    optional: true
  weights:
    type: String
    description: Comma-separated string of model weights (summing up to 1), equal weights by default
    optional: true
  model_name:
    type: String
    description: Name of input/output model, default is pytorch_model.bin
    optional: true
outputs:
  model_output_dir:
    type: path
    description: Path of output models directory
environment:
  docker:
    image: mcr.microsoft.com/azureml/openmpi4.1.0-cuda11.0.3-cudnn8-ubuntu18.04
  conda:
    conda_dependencies_file: env.yaml
  os: Linux
launcher:
  type: mpi
  additional_arguments: >-
    python run.py 
    --model_output_dir {outputs.model_output_dir} 
    --num_models {inputs.num_models} 
    [--weights {inputs.weights}]
    [--model_name {inputs.model_name}]
    --model_input_dir_1 {inputs.model_input_dir_1} 
    --model_input_dir_2 {inputs.model_input_dir_2}
    [--model_input_dir_3 {inputs.model_input_dir_3}] 
    [--model_input_dir_4 {inputs.model_input_dir_4}]
    [--model_input_dir_5 {inputs.model_input_dir_5}] 
    [--model_input_dir_6 {inputs.model_input_dir_6}]
    [--model_input_dir_7 {inputs.model_input_dir_7}] 
    [--model_input_dir_8 {inputs.model_input_dir_8}]
    [--model_input_dir_9 {inputs.model_input_dir_9}] 
    [--model_input_dir_10 {inputs.model_input_dir_10}]

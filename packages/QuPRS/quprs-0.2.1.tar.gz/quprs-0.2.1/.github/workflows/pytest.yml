# .github/workflows/pytest.yml

name: Python Pytest CI

# Trigger this workflow on push or pull request to main branch
on:
    push:
        branches: [ "main" ]
    pull_request:
        branches: [ "main" ]

jobs:
    build:
        # Specify the runner environment
        runs-on: ubuntu-latest

        # Test matrix for multiple Python versions
        strategy:
            fail-fast: false
            matrix:
                python-version: ["3.11", "3.12", "3.13"]

        steps:
          # Step 1: Checkout repository code
          - name: Check out repository code
            uses: actions/checkout@v4

          # Step 2: Set up Python environment
          - name: Set up Python ${{ matrix.python-version }}
            uses: actions/setup-python@v5
            with:
              python-version: ${{ matrix.python-version }}
              cache: 'pip'

          # Step 3: Install dependencies
          - name: Install dependencies
            run: |
              python -m pip install --upgrade pip
              pip install pytest
              pip install .

          # Step 4: Run pytest
          - name: Run tests with pytest
            run: |
              pytest --junitxml=pytest-results.xml

          # Step 5: Upload pytest results as artifact
          - name: Upload pytest results
            if: always()
            uses: actions/upload-artifact@v4
            with:
              name: pytest-results-${{ matrix.python-version }}
              path: pytest-results.xml
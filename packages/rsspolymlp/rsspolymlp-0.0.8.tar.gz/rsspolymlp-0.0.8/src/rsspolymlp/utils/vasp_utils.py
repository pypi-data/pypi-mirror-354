"""
Copyright (c) 2024, pypolymlp, Atsuto Seko
Copyright (c) 2025, rsspolymlp, Hayato Wakai
"""

from pypolymlp.core.data_format import PolymlpStructure


def write_poscar_file(
    st: PolymlpStructure,
    filename: str = "POSCAR",
):
    """Write structure in POSCAR file."""
    f = open(filename, "w")

    if st.comment is not None:
        print(st.comment, file=f)
    else:
        print("Generated by rsspolymlp", file=f)

    print("1.0", file=f)
    for n in st.axis.T:
        print(
            "  ",
            "{0:15.15f}".format(n[0]),
            "{0:15.15f}".format(n[1]),
            "{0:15.15f}".format(n[2]),
            file=f,
        )
    index = 0
    print(" ", end="", file=f)
    for n in st.n_atoms:
        if n > 0:
            print(st.elements[index], " ", end="", file=f)
            index += n
    print("", file=f)
    print(" ", end="", file=f)
    for n in st.n_atoms:
        if n > 0:
            print(n, " ", end="", file=f)
    print("", file=f)
    print("Direct", file=f)
    for n in st.positions.T:
        print(
            "  ",
            "{0:15.15f}".format(float(n[0])),
            "{0:15.15f}".format(float(n[1])),
            "{0:15.15f}".format(float(n[2])),
            file=f,
        )

    f.close()
